<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><title>Polypaths</title><meta name="viewport" content="width=device-width,initial-scale=1"><script src="lib/p5.min.js"></script><script src="lib/p5.easycam.js"></script><script src="https://js.pusher.com/8.2.0/pusher.min.js"></script><link rel="stylesheet" type="text/css" href="style.css"></head><body><img src="project.png" class="project-image" alt="project"><div id="canvas-container"><div id="canvas-border"></div></div><script>let e=0,t=0,r=1,o=0;let l={},n=0,a=[],s=[];let c=0;const p={dim:1024,pix:1,ratio:1};function preload(){const e=window.location.hash;const t=e.match(/&pix_(\d+(\.\d+)?)/);if(t){const e=parseFloat(t[1]);if(!isNaN(e)){p.pix=e;console.log("***从URL读取pix:",e)}}xo();window.addEventListener("hashchange",(function(e){const t=new URL(e.newURL);const r=new URL(e.oldURL);const o=t.hash.includes("data_")?t.hash.split("data_")[1].split("#")[0]:"";const l=r.hash.includes("data_")?r.hash.split("data_")[1].split("#")[0]:"";const n=t.hash.includes("seed_")?t.hash.split("seed_")[1].split("#")[0]:"";const a=r.hash.includes("seed_")?r.hash.split("seed_")[1].split("#")[0]:"";if(o!==l||n!==a){window.location.reload()}}));if(e&&e.includes("#data_")){hashPart=e.split("&")[0];n=1;console.log(" 讀取網址 hash 已啟用 ")}console.log(e);const r=e.match(/seed_(\d+)/);if(r){Nt=parseInt(r[1]);console.log("***從URL讀取seed:",Nt)}else{Nt=Tr(3e6,99e5);console.log("***新亂數產生seed:",Nt)}if(e.includes("&sp_2")){o=2;console.log("***特殊植物模式2已啟用")}else if(e.includes("&sp_1")){o=1;console.log("***特殊植物模式1已啟用")}Rl(Nt)}function h(){a=[];pixelDensity(p.pix);if(ht)frameRate(1);Ht=Dr([0,1,2,3,4,0,1,2,3,4,0,2,5]);if(n==1)Ht=Dr([1,3,4]);l.layout=Ht;ct=random(0,1)>.6?1:0;l.specialLayout=ct;z=Dr([11,13,15,17,19,21]);if(Ht==2)p.ratio=.7;else if(Ht==1||Ht==5)p.ratio=1.33;else if(Ht==4)p.ratio=.7;else p.ratio=1;if(Ht==3||Ht==1||Ht==4)Hl=1;if(Hl==1){if(n==1){let e=Fo();s=e;if(e){Ml=e;qt="url";console.log("***使用 URL 中的数据")}else{console.log("***URL 数据解析失败，使用默认数据");Ml=Jl;qt="預設圓形"}}else{if(Ht==3)Ml=Dr([Gl,ql,Jl,$l,Zl,en]);else if(Ht==1)Ml=Dr([Ul,$l,Jl,jl,Zl,en]);else if(Ht==4)Ml=Dr([jl,Kl,Ql,Zl,en]);if(Ml===Gl)qt="0";else if(Ml===Ul)qt="1";else if(Ml===$l)qt="2";else if(Ml===ql)qt="3";else if(Ml===Jl)qt="4";else if(Ml===jl)qt="5";else if(Ml===Kl)qt="6";else if(Ml===Ql)qt="7";else if(Ml===Zl)qt="8";else if(Ml===en)qt="9"}let e=0;for(let t=0;t<Ml.paths.length;t++){e+=Ml.paths[t].length-1}z=e+Ml.dots.length;console.table({"json路徑組":qt,"總植物數量":z,"路徑段數量":e,"點的數量":Ml.dots.length});a.push({"json路徑組":qt,"總植物數量":z,"路徑段數量":e,"點的數量":Ml.dots.length})}let e=createCanvas(p.dim*p.ratio,p.dim,WEBGL);dt=new Dw.EasyCam(this._renderer);ortho(-width/2,width/2,-height/2,height/2,-1e4,1e4);dt.setDistanceMin(100);dt.setDistanceMax(2e3);dt.setDistance(1e3);dt.setRotationConstraint(false,false,false);dt.removeMouseListeners();textSize(24);colorMode(HSB,360,1,1,1);imageMode(CENTER);Kr();particles=[];M=.7;zt=vr();Rt={...Ur()};typeC={...qr()};if(Hl==0){if(z>16){Tt=random(0,1)<.7?0:random(0,1)<.4?1:3;z=Math.floor(z*1.3);if(Tt==3)Ht=5}else{Tt=random(0,1)<.5?0:2}l.植物類型=Tt;l.植物數量=z}Ce=zt.colors.bg;Ee=zt.colors.stroke;if(r==1){let e=new URLSearchParams(window.location.search);let t=e.has("paperType")?parseInt(e.get("paperType")):null;zl(t);lo();pgBg.background(zt.colors.bg[0][0],zt.colors.bg[0][1],zt.colors.bg[0][2],1)}else{pgBg.background(0,0,.8,1)}Nl()}function setup(){h();ne=[1,0,1,0];l.植物類型=Tt;ot=random(0,1)<.9?0:Dr([1,2]);l.筆刷類型=ot;nt=random(0,1)<.5?1:0;l.狂野模式=nt;ae=0;_e=random(0,1)>.05?Dr([0,1,2,3]):4;l.花朵類=_e;Ne=Dr([0,1]);l.花蕊類=Ne;Me=random(0,1)<.85?Dr([0,1,2,3]):random(0,1)<.7?4:5;l.果實類=Me;je=random(0,1)>.9?Dr([.4,.6,.8]):1;if(n==1)je=1;l.畫掉下葉子概率=je;be=random(0,1)<.8?Ar(.3,1.2):.2;ye=random(0,1)<.8?Ar(.3,1.2):.2;if(random(0,1)>.1){U=.1;l.多鬆=0}else{ye=6;be=3;U=.03;l.多鬆=1}xe=be;Fe=ye;l.偏移比例=U;l.筆刷偏移=be;l.填色偏移=ye;Qe=random(0,1)>.95?.1:random(0,1)>.2?.8:random(0,1)>.3?.3:1;l.素描率=Qe;if(random(0,1)>Qe)Ke=1;else Ke=0;Je=random(0,1)<.1?1.1:random(0,1)<.3?0:Dr([.3,.6,.8]);l.葉子漸變率=Je;et=Dr([.9,1,1.1]);l.素描填色明暗=et;He=random(0,1)<.1?3:random(0,1)<.9?0:1;l.葉子類型=He;te=[Tr(10,20),Tr(10,25)];Ze=Dr([1,.9]);l.頂點修改率=Ze;at=random(0,1)>.3?0:1;l.深度顏色=at;$=Ar(.8,1.2);if(Ht!=3)M=1;if(Ht==0)_=.35;else if(Ht==2)_=.6;else if(Ht==1)_=.35,te=[20,25];else if(Ht==5)_=.6,te=[25,30];Dt=Dr([.1,.33,.5,.7,.8,.9,.95]);At=Dr([.1,.33,.5,.7,.8,.9,.95,1,1,1]);l.樹幹更新率=Dt;l.植物參數更新率=At;Wt=.8;me=random(0,1)<.05?0:random(0,1)<.3?.7:1;l.改變顏色機率=me;Xt=.2;Lt=random(0,1)<.95?Dr([.96,.98,.995,.995,1,1,1,1,1,1]):.8;St=random(0,1)<.95?Dr([.96,.98,.995,.995,1,1,1,1,1,1]):.8;Bt=random(0,1)>.5?.985:1;l.蝴蝶概率=Lt;l.蜻蜓概率=St;l.瓢蟲概率=Bt;q=random(0,1)<.8?Dr([0,1,2,3,4,5]):6;l.物件組=q;if(q==0){J={leaf:80,flower:30,fruit:20,grass:20,mushroom:5}}else if(q==1){J={leaf:2,flower:30,fruit:0,grass:20,mushroom:10}}else if(q==2){J={leaf:40,flower:0,fruit:20,grass:20,mushroom:10}}else if(q==3){J={leaf:15,flower:5,fruit:10,grass:5,mushroom:5}}else if(q==4){J={leaf:0,flower:0,fruit:3,grass:5,mushroom:3};z=floor(z*1.5);te=[Tr(20,30),Tr(20,30)];Dt=.6;At=1}else if(q==5){J={leaf:20,flower:0,fruit:2,grass:20,mushroom:2};H=1;M=.6}else if(q==6){J={leaf:constrain(Tr(-10,40),0,40),flower:constrain(Tr(-10,40),0,40),fruit:constrain(Tr(-10,40),0,40),grass:constrain(Tr(-10,40),0,40),mushroom:constrain(Tr(-10,40),0,40)}}if(Hl==1){J.grass=Tr(4,10);J.mushroom=Tr(2,6)}if(Ml==$l||Ml==Ql){me=Ar(.8,1.05);Dt=Ar(.8,1.05);At=Ar(.8,1.1);console.log("");console.log("****特殊模式")}if(o==1){J={leaf:200,flower:5,fruit:0,grass:10,mushroom:3};Xt=.4;_=.4;H=1;M=1;_e=2;nt=0;He=0;Lt=1;St=1;Bt=1;me=1;Dt=1;At=1;at=1;Qe=1;ye=.2;be=.5;$=1;N=.1}else if(o==2){J={leaf:20,flower:2,fruit:1,grass:0,mushroom:0};Xt=.7;_=.4;H=1;M=1;_e=4;nt=0;He=0;Lt=1;St=1;Bt=1;me=1;Dt=1;At=1;at=1;Qe=1;ye=.2;be=.5;te=[12,12];$=.8;N=1}Gt=random(height*.45,height*.55);let e=random(0,1)>.1?0:Dr([0,0]);ue=Tr(-1,5)*10+e;let t=random(0,1)>.1?0:5;if(o==2)ue=0,t=0;l.特殊顏色模式=t;l.色相偏移=ue;if(t==0){we=[0,1,1];Ve=[0,1,1]}else if(t==5){nt=1;we=[Dr([0,Ar(0,120)]),Dr([Ar(0,1),Ar(1,5)]),Dr([Ar(0,1),Ar(1,5)])];Ve=[Dr([0,Ar(0,120)]),Dr([Ar(0,1),Ar(1,5)]),Dr([Ar(0,1),Ar(1,5)])];ne=[0,0,Dr([0,1]),Dr([0,1])]}console.table(l,["參數"]);console.table(J,["單株數量限制"]);a.push(l);a.push(J);console.log("");if(Hl==1)yo();let r=window.location.href;let baseUrl=r.split("#")[0];window.addEventListener("beforeunload",To);ft="seed_"+Nt;let s=decodeURIComponent(window.location.hash);let c="";const i=s.match(/data_([^#]*)/);if(i){c="#data_"+i[1]}if(c){window.location.hash=c}}function f(){Vo();if(Te==5)po(Jt);if(Te==0||Te==1||Te==2)fo(Jt);if(Te==3||Te==4)uo(Jt,jt);if(Te==0)rr=random(0,1)>.95?1:0;else if(Te==1)rr=random(0,1)>.95?1:0;else if(Te==2)rr=random(0,1)>.95?1:0;else if(Te==3)rr=random(0,1)>1?1:0;else if(Te==4)rr=random(0,1)>1?1:0;if(Ht==1||Ht==4||Te==5)rr=0;Nt=Nt+100;Rl(Nt);if(Hl==0){if(oe<8){if(Tt==0)Yt=random(0,1)<.5?"A":Dr(["B","B","C","D","E"]);else if(Tt==1)Yt=random(0,1)>.9?"A":Dr(["C","B","D","E"]);else if(Tt==2)Yt=Dr(["A","B","C","E"]);else if(Tt==3)Yt=random(0,1)>.9?"A":random(0,1)>.3?"E":"D";else Yt="A";if(Yt=="A")oe++;else le++}else{Yt=Dr(["B","C","D","E"]);le++}}qe=random(0,1)<Je?1:0;if(o==2)qe=1,_=random(.3,.45);if(o==0){st=random(0,1)<.5?0:1;te=random(0,1)<.3?[5,5]:[Tr(10,20),Tr(10,25)];G=random(0,1)<.1?Dr([.2,.3,.6,.8]):Dr([.9,1,1,1,1,1.2])}re={x:0,y:0,height:Infinity};if(Ht==0){j=random(width*.3,width*.7);Gt=Gt+random(height*.04,height*.1);if(Gt>height*.95)Gt=random(height*.45,height*.55);K=Gt;if(ct==1){j=width/2+random(-50,50);K=height*.8+random(-50,50)}}else if(Ht==4){j=random(width*.15,width*.85);Gt=Gt+random(height*.02,height*.07);if(Gt>height*.9)Gt=random(height*.2,height*.3);K=Gt}else if(Ht==2){j=random(0,1)<.8?random(width*.35,width*.65):random(width*.1,width*.9);if(Yt=="A")K=random(height*.95,height*1.1);else K=random(height*.92,height*.97)}else if(Ht==5){j=random(width*.1,width*.9);Gt=Gt+random(height*.04,height*.1);if(Gt>height*.9)Gt=random(height*.25,height*.35);K=Gt}if(Hl==1){if(X<$t.segments.length){const e=X%$t.segments.length;const t=$t.segments[e];j=int(map(Number(t.baseX.toFixed(2)),0,500,0,width));K=int(map(Number(t.baseY.toFixed(2)),0,500,0,height));Yt="A";if(e===0||t.pathIndex!==$t.segments[e-1].pathIndex){Kt=1}else{Kt=0}}else{const e=X-$t.segments.length;if(e<$t.dots.length){const t=$t.dots[e];j=int(map(Number(t.baseX.toFixed(2)),0,500,0,width));K=int(map(Number(t.baseY.toFixed(2)),0,500,0,height));Yt=Dr(["B","C","D","E"]);Kt=0}else{j=random(width*.1,width*.9);K=random(height*.1,height*.9);Yt=Dr(["B","C","D","E"]);Kt=0}}}{ie=random(0,1)>me?Tr(0,28):ce;if(Yt!="B"){const e=Pr(ce);Ot={...zt};if(ie!==ce){ce=ie;zt.colors=e;zt.colorsID=ce;const t=Qr();Object.assign(Ot,t)}}else{const e=Pr(ce);Ot={...Rt};if(ie!==ce){ce=ie;Rt.colors=e;Rt.colorsID=ce;const t=Qr();Object.assign(Ot,t)}}}if(at==0){if(K<height*.6&&random(0,1)>.7){ge=.7;pe=.4;he=Dr([.6,2]);fe=.4;de=1}else{ge=.6;pe=1;he=1;fe=1;de=1}if(random(0,1)>.9){ge=.7;pe=.4;he=Dr([.6,2]);fe=.4;de=1}et=Dr([.9,1,1.1])}else if(at==1){ge=.5;pe=1;he=1;fe=1;de=1}if(random(0,1)>Qe)Ke=1;else Ke=0;if(Ke==1){pe=1;he=1;fe=1;de=1;rt=random(0,1)<Ze?0:2;be=xe*random(1,1.5);ye=Fe*random(1,1.5);let e=Dr([[11,2],[1,4],[2,12],[4,2]]);Ot.veinsType=e;tt=Dr([0,1,2]);if(tt==2)ge=random(1.2,2.2);else ge=random(.8,1.2)}else{if(o==0){rt=random(0,1)<Ze?0:2;be=xe;ye=Fe;Ot.veinsType=Ue}}Ge=Tr(3,4);if(Yt=="A"){Ot.plantType="woody";if(random(0,1)>Dt){se=Dr([[1,1],[1,1.1],[1,1.2],[.5,1.5],[20,2]]);Xt=random(.1,.4);_=Dr([.3,.35,.4,.45,.5,.65]);M=random(0,1)>.9?Ar(1.15,1.3):Dr([.6,.8,.9]);console.log("  |生成樹幹參數:",M);N=Dr([.6,.8,.7]);H=random(0,1)>.95?4:Dr([.5,.6,.8,.7,1.2,1.5,2]);oo();ro()}if(random(0,1)>At&&X<=15){M=random(0,1)>.9?Ar(1.15,1.3):Dr([.6,.8,.9]);console.log("  |生成花朵參數:",M);ae=random(0,1)<.2?1:0;_e=Dr([0,1,2,3]);Ne=Dr([0,1]);Me=random(0,1)<.85?Dr([0,1,2,3]):random(0,1)<.7?4:5;ot=random(0,1)<.9?0:Dr([1,2]);He=random(0,1)<.1?3:random(0,1)<.9?0:1;Zr(tr);eo(tr);to(tr)}if(random(0,1)>je)b.drawLoseLeaves(j,K,Tr(0,1))}else if(Yt=="B"){Ot.plantType="grass";O=1;if(random(0,1)>je)b.drawLoseLeaves(j,K,Tr(0,1))}else if(Yt=="C"){let e=qr();e.capWidth=Tr(5,20)+int(map(e.mushroomWidth,1.5,3,10,40));Ot={...e};Ot.plantType="mushroom";O=1;if(random(0,1)>je)b.drawLoseLeaves(j,K,Tr(0,1))}else if(Yt=="D"){O=1;Ot.plantType="stone";if(random(0,1)>.5)Ho(j,K);else Mo(j,K);if(random(0,1)>je)b.drawLoseLeaves(j,K,Tr(0,1))}else if(Yt=="E"){O=1;Ot=zt;Ot.plantType="woodBlock"}else if(Yt=="F"){O=1;Ot.plantType="loseLeaves";if(random(0,1)>je)b.drawLoseLeaves(j,K,1);else{O=1;Ot=zt;Ot.plantType="woodBlock"}}let e=`plant_${X}_${j}_${K}`;vt={pg:pgL3,baseX:j,baseY:K,PT:Ot,plantId:e,branchCounter:0,widthFunc:e=>1,lastLeafNode:0,hasDrawnFlower:false};if(!Ct.has(e)){m(vt);Ct.add(e)}R=true;Y=0}function d(){Eo();if(Y==0&&Ot.branchFork==1&&!Ot.vineDrawn&&Ot.branchDepth<2){if(Ot.branchWidth<=4){console.log("  |生成藤蔓");F.drawAllPath(Ot);if(re.path){F.drawVines({...Ot,widthFunc:vt.widthFunc,path:re.path,spiral:Ot.spiral});Ot.vineDrawn=true}}}if(Ot.plantType==="woody"&&vt&&vt.PLANT&&vt.PLANT.length>0){O=vt.PLANT.length}if(Y<O){doleafDirection=random(0,1)>.85?1:0;De=random(0,1)>.5?1:0;let e=u(Y);if(e){Y++}}else{X++;R=false;if(Ot.plantType!="woody")Vo()}}function m(e){re={x:e.baseX,y:e.baseY,height:Infinity,plantId:e.plantId,segmentIndex:X};currentPath=[];e.vineDrawn=false;e.PT.leafCount=0;e.PT.flowerCount=0;e.PT.fruitCount=0;e.PT.grassCount=0;e.PT.leaflimit=J.leaf;e.PT.flowerlimit=J.flower;e.PT.fruitlimit=J.fruit;e.PT.grasslimit=J.grass;if(e.PT.plantType==="woody"){let t=null;if(Hl==0){let r=0;if(Ht==0)r=random(-.5,.5);else if(Ht==2)r=random(-.3,.3);else if(Ht==5)r=random(-2,2);e.PLANT=t=F.drawWoody({pg:pgL1,baseX:e.baseX,baseY:e.baseY,baseRotation:createVector(PI/2,0,r),branchLength:p.dim*_,branchWidthFunc:e.PT.branchWidth*random(.7,1),maxBranchDepth:e.PT.branchDepth,col:[e.PT.branchColor[0],e.PT.branchColor[1],e.PT.branchColor[2]*random(.7,1),1],forkCount:e.PT.branchFork,maxBranchWidth:e.PT.maxBranchWidth,meta:e.PT,stemTexLine:e.PT.stemTexLine})}else if(Hl==1){const r=X%$t.segments.length;const l=$t.segments[r];if(Ml==$l||Ml==Ql){te=[Tr(5,15),Tr(5,15)]}else{te=[Tr(5,20),Tr(5,30)]}if(n==1){if(random(0,1)>.1)te=[Tr(3,10),Tr(3,10)];else te=[Tr(8,20),Tr(8,20)]}if(o!=0){te=[Tr(8,16),Tr(8,16)]}e.PLANT=t=F.drawWoody({pg:pgL1,baseX:e.baseX,baseY:e.baseY,baseRotation:l.baseRotation,branchLength:l.branchLength,branchWidthFunc:l.branchWidthFunc,maxBranchDepth:l.maxBranchDepth,col:l.col,forkCount:l.forkCount,maxBranchWidth:l.maxBranchWidth,meta:l.meta,twistIntensity:l.twistIntensity,stemTexLine:l.stemTexLine})}console.log(X+":木本生成")}else if(e.PT.plantType==="grass"){e.PLANT=Do({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,branchLength:e.PT.stemLength,branchWidthFunc:e.PT.stemWidth,col:e.PT.stemColor,benScale:e.PT.stembenScale,branchBendFunc:t=>createVector(map(noise(t*1),0,1,-1,1)*t*e.PT.stemBend,0,0),meta:e.PT});console.log(X+":草生成")}else if(e.PT.plantType==="mushroom"){e.PLANT=Ao({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,capWidth:e.PT.capWidth||30});console.log(X+":蘑菇生成")}else if(e.PT.plantType==="woodBlock"){se=[.5,1.1];let t=Dr([1,2,3,4,6,8,15,20]);let r;r=random(0,1)<.33?e=>5*(1-e)*map(noise(e*5),0,1,.5,1)+t:random(0,1)<.5?e=>5*sin(e*PI)*map(noise(e*10),0,1,.5,1.2)+t*.8:e=>5*cos(e*PI*2)*map(noise(e*20),0,1,.3,.6)+t;e.PLANT=F.wood({pg:pgL0,baseX:e.baseX,baseY:e.baseY,branchLength:random(50,300),branchWidthFunc:r,branchSegments:Tr(60,80),branchSegmentsH:Tr(6,16),strokeStrength:.8,forceHorizontal:random(0,1)<.3?true:false,depth:1});console.log(X+":木塊生成")}e.stepIndex=0}function u(e){if(!vt||!vt.PLANT||e>=vt.PLANT.length)return true;let t;let r=Ot.branchDepth===0&&Ot.branchFork===1;if(r&&Ot.branchWidth>5){r=false}let o=0;let l=0;if(r){if(!vt.PLANT[0]||!vt.PLANT[0][1]){console.log("藤蔓點陣列無效，step="+e);return true}t=vt.PLANT[0][1]}else{if(!vt.PLANT[e]||!vt.PLANT[e][1]){console.log("分支點陣列無效，step="+e+"，可能當前分支沒有點數據");return true}t=vt.PLANT[e][1]}if(!t||t.length===0){console.log("點陣列為空，step="+e);return true}for(let e=1;e<t.length;e++){o+=dist(t[e][0],t[e][1],t[e-1][0],t[e-1][1])}const n=width*1.05;const a=height*1.05;const s=-width*.05;const c=-height*.05;let i=Xt;let p=r?e/O:e/vt.PLANT.length;if(typeof vt.currentPointIndex==="undefined"){vt.currentPointIndex=0}const h=10;const f=vt.currentPointIndex;const d=min(f+h,t.length-1);l=0;for(let e=1;e<=f;e++)l+=dist(t[e][0],t[e][1],t[e-1][0],t[e-1][1]);if(vt.branchFinished&&vt.branchFinished[e]){console.log("分支已標記為完成，跳過處理，step="+e);vt.currentPointIndex=0;return true}for(let h=f;h<d;h++){if(t[h][0]>n||t[h][0]<s||t[h][1]>a||t[h][1]<c){continue}if(h>0)l+=dist(t[h][0],t[h][1],t[h-1][0],t[h-1][1]);let f=(l/o).toFixed(2);if(r){let r=h/t.length;if(f>=.9){let r=t[t.length-1];vt.PT.leafGrowType=ur;Ge=4;let o=atan2(t[t.length-1][1]-t[t.length-2][1],t[t.length-1][0]-t[t.length-2][0]);if(random(0,1)>.5){P.addLeaf(r[0],r[1],vt,o,"final",1)}if(!vt.branchFinished){vt.branchFinished={}}vt.branchFinished[e]=true;vt.currentPointIndex=0;return true}if(r>p||f<i)continue}else{let r=Xt;if(e>=2){r=Math.max(.05,Xt-e*.05)}if(f>=r){if(!vt.branchFinished){vt.branchFinished={}}if(!vt.branchFinished[e]){g(t,h,vt,f,e,He)}}else{}}}if(d>=t.length-1){if(!vt.branchFinished){vt.branchFinished={}}vt.branchFinished[e]=true;vt.currentPointIndex=0;return true}vt.currentPointIndex=d;return false}function g(e,t,r,l,n,a){let s=r.PT.branchDepth===0&&r.PT.branchFork===1;let c=r.PLANT[n][0]==r.PT.branchDepth;let i=t/(e.length-1);let p=r.widthFunc?r.widthFunc(i):1;let h=atan2(e[t-1][1]-e[t][1],e[t-1][0]-e[t][0]);let f=r.PT.leafProb;let d=random(0,1)>f&&r.PT.leafCount<r.PT.leaflimit;let m=l>=.9;if(d){if(m){if(o==2){if(!r.branchPetalDrawn){r.branchPetalDrawn={}}if(!r.branchPetalDrawn[n]){let t=e[e.length-1];let o=e[e.length-2];let l=o[0]-t[0];let a=o[1]-t[1];let s=atan2(a,l)-1.57;if(random(0,1)>.1){b.petal2({pg:pgL0,baseX:e[e.length-1][0],baseY:e[e.length-1][1],baseRotation:createVector(PI/2,0,s),strokeStrength:1,branchLength:random(15,30),branchWidthFunc:e=>p*(1-e*.8)*2,branchBendFunc:e=>createVector(0,random(-.3,.3),0),col:[Ot.flowerColorA[0],Ot.flowerColorA[1]*1.2,Ot.flowerColorA[2]*1.2],col2:[Ot.branchColor[0],Ot.branchColor[1],Ot.branchColor[2]*1.2],branchSegments:10,branchSegmentsH:3,closeS:true,closeE:true,doLeafVeins:false,meta:Ot,stemMode:3})}r.branchPetalDrawn[n]=true}}else if(o==1){if(!r.branchFlowerDrawn){r.branchFlowerDrawn={}}if(!r.branchFlowerDrawn[n]){N=.1;b.drawFlowerC({pg:pgL3,id:Ot.flowerCount,baseX:e[e.length-1][0],baseY:e[e.length-1][1],meta:Ot});r.branchFlowerDrawn[n]=true}}else{if(!r.branchPetalDrawn){r.branchPetalDrawn={}}if(!r.branchPetalDrawn[n]){if(random(0,1)>.5){r.PT.leafGrowType=ur;Ge=3;if(o==0)P.addLeaf(e[e.length-1][0],e[e.length-1][1],r,h,"final",1)}r.branchPetalDrawn[n]=true}}}else{if(a==3){f=.3;let e=10;let t=r.lastLeafNode||0;r.PT.leafGrowType=ur;Ge=3}if(o==1){r.PT.leafGrowType=mr;let o=createVector(e[t][0]-e[t-1][0],e[t][1]-e[t-1][1]);o.normalize();let n=atan2(o.y,o.x)+PI/2;let a=e[t][3]||1;if(c==false){pgText.noFill();pgText.strokeWeight(1);pgText.ellipse(e[t][0],e[t][1],7);st=0;P.addLeaf(e[t][0],e[t][1],r,n,"normal",l);r.lastLeafNode=t}}else if(o==2){r.PT.leafGrowType=dr;let o=5;if(!r.branchLeafNodes){r.branchLeafNodes={}}if(r.branchLeafNodes[n]===undefined){r.branchLeafNodes[n]=0}let a=r.branchLeafNodes[n];let s=e[t][3]||1;if(s<=5&&t-a>=o){st=0;pgText.noFill();pgText.stroke(ne[0],ne[1],ne[2],ne[3]);pgText.strokeWeight(1);pgText.ellipse(e[t][0],e[t][1],7);P.addLeaf(e[t][0],e[t][1],r,h,"normal",l);if(random(0,1)>.1){if(random(0,1)>.2)b.addFlower(e[t+1][0],e[t+1][1],r);else w.addFruit(e[t+1][0],e[t+1][1],r)}r.branchLeafNodes[n]=t}}else{let o=createVector(e[t][0]-e[t-1][0],e[t][1]-e[t-1][1]);o.normalize();let n=3.14;if(r.PT.leafGrowType==ur)n=0;if(doleafDirection){if(De)n=PI/2;else n=-PI/2}let s=atan2(o.y,o.x)+n;if(a==3){if(t%12==0){P.addLeaf(e[t][0],e[t][1],r,s,"normal",l);r.lastLeafNode=t}}else{P.addLeaf(e[t][0],e[t][1],r,s,"normal",l);r.lastLeafNode=t}}}}if(random(0,1)>r.PT.fruitProb&&o==0){if(r.PT.fruitCount<r.PT.fruitlimit)w.addFruit(e[t][0],e[t][1],r,p)}if(random(0,1)>r.PT.flowerProb&&o!=2){if(o==1)N=.5;if(r.PT.flowerCount<r.PT.flowerlimit)b.addFlower(e[t][0],e[t][1],r)}if(random(0,1)>r.PT.spikeProb){let o=floor(random(1,r.PT.spikeCountRange));for(let l=0;l<o;l++){let o=[];let l=r.widthFunc(i);let a=l*.3;let s=constrain(l*.3*r.PT.hasSpikesW,.05,l*.5);if(t>=5){o.push([e[t-5][0],e[t-5][1]])}else if(n>=5&&r.PLANT[n-5][1].length>0){let e=r.PLANT[n-5][1].length-1;o.push([r.PLANT[n-5][1][e][0],r.PLANT[n-5][1][e][1]])}else{o.push([e[t][0],e[t][1]+5])}o.push([e[t][0],e[t][1]]);if(t<e.length-1){o.push([e[t+1][0],e[t+1][1]])}else{o.push([e[t][0],e[t][1]-5])}if(random(0,1)>.7){F.drawSpike({pg:pgL1,baseX:e[t][0]+random(-a,a),baseY:e[t][1],meta:r.PT,baseWidth:s*.9,stemPoints:o,branchLengthScale:r.PT.hasSpikesL})}else{F.drawSpike({pg:pgL0,baseX:e[t][0]+random(-a,a),baseY:e[t][1],meta:r.PT,baseWidth:s*.9,stemPoints:o,branchLengthScale:r.PT.hasSpikesL})}}}if(random(0,1)>Lt){ko(e[t][0],e[t][1],r.PT)}if(random(0,1)>St){Xo(e[t][0],e[t][1],r.PT)}if(random(0,1)>Bt){if(It<20&&Ke==0)Yo(e[t][0],e[t][1],r.PT),It++}}class b{static petal2(e={}){let{pg:t,baseX:r=0,baseY:l=0,baseRotation:n=createVector(0,0,0),branchLength:a=100,col:s=[0,0,0,1],col2:c=[0,0,0,1],branchWidthFunc:i=e=>1,branchBendFunc:p=e=>createVector(0,0,0),branchSegments:h=10,branchSegmentsH:f=4,strokeStrength:d=1,closeS:m=false,closeE:u=false,doLeafVeins:g=false,meta:b=e.meta||{},stemMode:y=0}=e;if(y==3){}let x=wr(Nt);d=d+x.random(0,1)*2;let F=5*be;f=random(0,1)<.9?3:4;h=max(10,floor(a/4));h=max(5,floor(h*G));let w=createVector(0,0,0);let V=createVector(0,0,0);let C=[w.copy()];let E=[V.copy()];let T=[];let D=e=>yr.applyEulerRotation(e,n);let A;for(let e=0;e<h;e++){let t=e/(h-1);let r=p(t);V=p5.Vector.add(V,r.copy().mult(1/h));let o=createVector(0,0,a/h);let l=yr.applyEulerRotation(o,V);w=p5.Vector.add(w,D(l));E.push(V.copy());C.push(w.copy());A=i(e/h);T.push(A)}let[I,L]=wl({pts:C,branchWidthFunc:i});function S(e,o){const n=C.length-1;const a=f-1;const i=(o-1)/a;const p=o/a;let h=e/n;const d=.5;const m=constrain(map(h,d,1,0,1),0,1);let u,g,b,x;if(m===0){u=Yr(I[e-1],L[e-1],i);g=Yr(I[e],L[e],i);b=Yr(I[e-1],L[e-1],p);x=Yr(I[e],L[e],p)}else if(m===1){u=p5.Vector.lerp(I[e-1],L[e-1],i);g=p5.Vector.lerp(I[e],L[e],i);b=p5.Vector.lerp(I[e-1],L[e-1],p);x=p5.Vector.lerp(I[e],L[e],p)}else{const t=Yr(I[e-2],L[e-2],i);const r=Yr(I[e],L[e],i);const o=Yr(I[e-2],L[e-2],p);const l=Yr(I[e],L[e],p);const n=p5.Vector.lerp(I[e-1],L[e-1],i);const a=p5.Vector.lerp(I[e],L[e],i);const s=p5.Vector.lerp(I[e-1],L[e-1],p);const c=p5.Vector.lerp(I[e],L[e],p);u=p5.Vector.lerp(t,n,m);g=p5.Vector.lerp(r,a,m);b=p5.Vector.lerp(o,s,m);x=p5.Vector.lerp(l,c,m)}const F=1;let P=sin(p*PI)*h;let w=s[0];let V=s[1];let E=s[2];if(f==2){w=Lr(s[0],s[0],e*o/C.length/f)}else{w=Lr(s[0],s[0],h)}V=lerp(s[1],s[1],P)*map(noise(h*F,i*F,p*F),0,1,.5,1);E=lerp(s[2],s[2],P)*map(noise(h*F,i*F,p*F),0,1,.5,1);if(y===1){w=Lr(c[0],s[0],h);V=lerp(c[1],s[1],h);E=lerp(c[2],s[2],h)}else if(y===2){if(h<.5)h=0;else h=map(h,.5,1,0,1.2);w=Lr(c[0],s[0],pow(1-h,.6));V=lerp(c[1],s[1],pow(1-h,.6));E=lerp(c[2],s[2],pow(1-h,.6))}else if(y===3){w=Lr(c[0],s[0],h);V=lerp(c[1],s[1],h);E=lerp(c[2],s[2],h)}Cl({pg:t,pts:[u,g,x,b],baseX:r,baseY:l,doFill:true,col:kr(w,V,E,1),randomOffset:1,vertexMode:rt})}for(let e=1;e<C.length;e++){for(let t=1;t<f;t++){S(e,t)}}let B=zt.colors.stroke[0];if(de==0)B=zt.colors.stroke[2];let W=zt.colors.stroke[1];let k=e=>{const t=.2;const r=-.35;const o=(noise(e*t,Tr(0,100)*.05)+r)*2*ge;return o>.5?o:random(0,1)>.7?0:0};let X=e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*d*ge;let Y=Dr([k,X]);if(ot==1)Y=X;else if(ot==2)Y=k;if(o==0||y==1||y==3){El({pg:t,pts:I.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-F,F);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-F,F);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,doFill:true,col:kr(B[0],B[1],B[2],1),branchWidthFunc:Y,randomOffset:1,forceBrush:1});El({pg:t,pts:L.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-F,F);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-F,F);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,doFill:true,col:kr(B[0],B[1],B[2],1),branchWidthFunc:Y,randomOffset:1,forceBrush:1})}if(g){P.drawLeafVeins({pg:t,baseX:r,baseY:l,veinsType:b.petalfType,centerPos:C,leftPos:I,rightPos:L,col:kr(B[0],B[1],B[2],.5),strokeStrength:.5})}if(m==true){let e=[];for(let t=0;t<=f-1;t++){let r=t/(f-1);e.push(Yr(I[0],L[0],r))}El({pg:t,pts:e,baseX:r,baseY:l,doFill:true,col:kr(B[0],B[1],B[2],1),branchWidthFunc:e=>(.5*(1-e)*map(noise(e*10),0,1,.5,1)+.5)*d*ge*random(1,1.5),randomOffset:1,forceBrush:1})}if(u==true){let e=[];for(let t=0;t<=f;t++){let r=t/f;e.push(p5.Vector.lerp(I[I.length-1],L[L.length-1],r))}El({pg:t,pts:e,baseX:r,baseY:l,doFill:true,col:kr(B[0],B[1],B[2],1),branchWidthFunc:e=>(1-e)*map(noise(e*10),0,1,.1,.2)+.1,forceBrush:1})}return{centerPos:C,widths:T,centerPoints:C}}static stamen(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,baseRotation:l=createVector(0,0,0),PT:n,size:a=20,eachL:s=random(.8,2),stemLength:c=c,doFruit:i=1}=e;let p=n.fruitColors["apple"][0];let h=n.fruitColors["apple"][1];let f=n.fruitColors["apple"][2];let d=l;let m=F.stem({pg:t,baseX:r,baseY:o,baseRotation:d,branchLength:c+random(-5,5),col:Ot.branchColor,branchBendFunc:e=>createVector(random(1,2),random(1,2),0),strokeStrength:0});let u=m.centerPos[m.centerPos.length-1];let g=p5.Vector.sub(m.centerPos[m.centerPos.length-1],m.centerPos[m.centerPos.length-2]).normalize();let b=p5.Vector.cross(createVector(0,-1,0),g);let y=yr.angle(createVector(0,-1,0),g);let x=e=>{let t;if(b.mag()>.001){t=yr.rotateVectorAroundAxis(e,b,y)}else{t=e.copy()}return createVector(t.x+r+u.x,t.y+o+u.y,t.z)};let P=[p,h,f,1];let w=12;let V=[];let C=10;for(let e=0;e<=C;e++){let t=e/C;let r=-a*(2*t-1);V.push(createVector(0,r))}let E=e=>{let t=2*e-1;return a*sqrt(1-pow(t,2))};let[T,D]=wl({pts:V,branchWidthFunc:E});function A(e,r){const o=V.length-1;const l=w-1;const n=(r-1)/l;const a=r/l;const s=e/o;const c=p5.Vector.lerp(T[e-1],D[e-1],n);const i=p5.Vector.lerp(T[e],D[e],n);const p=p5.Vector.lerp(T[e-1],D[e-1],a);const h=p5.Vector.lerp(T[e],D[e],a);const f=P[0];const d=P[1];const m=P[2];Cl({pg:t,pts:[c,i,h,p].map(x),doFill:true,doFillStroke:true,doStr:false,col:kr(f,d,m,1),randomOffset:.5})}for(let e=1;e<V.length;e++){for(let t=1;t<w;t++){A(e,t)}}El({pg:t,pts:T.map(x),baseX:0,baseY:0,doFill:true,col:kr(P[0],P[1],P[2]*1.2,1),randomOffset:1,branchWidthFunc:e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1)+.05});El({pg:t,pts:D.map(x),baseX:0,baseY:0,doFill:true,col:kr(P[0],P[1],P[2]*1.2,1),randomOffset:1,branchWidthFunc:e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1)+.05})}static drawFlowerA(e={}){let{pg:t,id:r,baseX:o=0,baseY:l=0,meta:n}=e;let a=random(.6,1);Jr();let s=0;let c=random(0,1)>.9?random(.5,1.2):random(0,.5)*1;let i=random(0,1)>.5?random(1,2):random(1,1.5)*-1;let p=createVector(PI/2+c,PI/2+i,0);let h=F.stem({pg:pgL1,baseX:o,baseY:l,baseRotation:p,branchLength:n.flowerLengthC*N,col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]],branchWidthFunc:e=>1,branchBendFunc:e=>createVector(1,0,0),pointShift:2});let f=F.stem({pg:pgL1,baseX:o,baseY:l,baseRotation:p,branchLength:random(5,10),col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]*.8],branchWidthFunc:e=>random(1,3),branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let d=random(0,1)>.2?true:false;let m=h.centerPos[h.centerPos.length-1];let u=h.centerPos[h.centerPos.length-3];let g=p5.Vector.sub(u,m).normalize();let y=g;let x=createVector(1,0,0);if(abs(p5.Vector.dot(x,y))>.9){x=createVector(0,1,0)}x=p5.Vector.cross(y,createVector(0,1,0)).normalize();let P=p5.Vector.cross(y,x);let w=createVector(atan2(-P.z,y.z),asin(x.z),atan2(-x.y,x.x));let V=random(0,PI);let C=random(.9,1.1);let E=Dr([.1,.3,.5,.7,.9]);if(d==true){for(let e=0;e<n.flowerPetal;e++){let t=[n.flowerColorA[0],n.flowerColorA[1],n.flowerColorA[2]];let r=[n.flowerColorB[0],n.flowerColorB[1],n.flowerColorB[2]];let s=e/n.flowerPetal*TWO_PI;let c=createVector(cos(s),sin(s),0);let i=createVector(c.x*x.x+c.y*P.x+c.z*y.x,c.x*x.y+c.y*P.y+c.z*y.y,c.x*x.z+c.y*P.z+c.z*y.z).normalize();let p=0;let h=createVector(m.x+i.x*p,m.y+i.y*p,m.z+i.z*p);let f=createVector(-i.x,-i.y,-i.z).normalize();let d=createVector(f.x,f.y+.5,f.z);let u,g,F;if(random(0,1)>.5){u=t[0];g=t[1];F=t[2]}else{u=t[0];g=t[1]*.95;F=t[2]*.95}b.petal({pg:pgL3,baseX:o+h.x,baseY:l+h.y,branchLength:a*n.flowerLengthA*random(.9,1.1),branchSegments:24,col:[u,g,F,1],colorFunction:n.flowerColorFn,strokeStrength:.5,direction:f,branchWidthFunc:e=>a*n.flowerShape(e)*n.flowerWidthA,branchBendFunc:e=>createVector(n.flowerOpenCurve(e)*Dr([1,-.1,-.2,-.3,-1]),C,0)});if(Ne==0){if(random(0,1)>.5){u=r[0];g=r[1];F=r[2]}else{u=r[0];g=r[1]*.95;F=r[2]*.95}b.petal({pg:pgL4,baseX:o+m.x,baseY:l+m.y,branchSegments:12,branchLength:n.flowerLengthA*random(.3,.6),col:[u,g,F,1],colorFunction:n.flowerColorFn,direction:d,strokeStrength:.3,branchWidthFunc:e=>n.flowerShape(e)*n.flowerWidthA*.3+1,branchBendFunc:e=>createVector(n.flowerOpenCurve(e)*Dr([-.1,-.2,-.3,-1]),C,0)})}else if(Ne==1){let e=createVector(o+m.x,l+m.y);let t=floor(random(-1,5));for(let r=0;r<t;r++){let t=random(3,6);let r=random(TWO_PI);let o=cos(r)*t;let l=sin(r)*t;let a=createVector(w.x+random(-3,3),w.y+random(-3,3),0);b.stamen({pg:pgL4,baseX:e.x,baseY:e.y,baseRotation:a,PT:n,size:random(2,4)*M,stemLength:random(10,30),doFruit:0})}}}}else if(d==false){for(let e=0;e<n.flowerPetal;e++){let t=e/n.flowerPetal*TWO_PI;let r=[n.flowerColorA[0],n.flowerColorA[1],n.flowerColorA[2]];let a=[n.flowerColorA[0],n.flowerColorA[1],n.flowerColorA[2]];b.petal2({pg:pgL2,baseX:o+h.centerPos[h.centerPos.length-2].x,baseY:l+h.centerPos[h.centerPos.length-2].y,baseRotation:w,branchLength:n.flowerLengthA*random(.6,.9),col:[r[0]*C,r[1],r[2]*random(.8,.9),1],branchWidthFunc:e=>n.flowerShape(e)*n.flowerWidthA*.3+2,branchBendFunc:e=>createVector(sin(e*PI)*-1*random(1,2),0,0),branchSegments:8,closeS:true})}}}static drawFlowerB(e={}){let{baseX:t=0,baseY:r=0,direction:l=createVector(0,0,1),rot:n=0,op:a=0,meta:s=e.meta,petalfType:c=s.petalfType||[10,2]}=e;let i=yr.vectorToEulerAngles(l);let p=b.petal2({pg:pgL1,baseX:t,baseY:r,baseRotation:i,branchLength:s.flowerLengthC*N,col:[s.branchColor[0],s.branchColor[1],s.branchColor[2]],branchWidthFunc:e=>1,branchSegments:10,branchSegmentsH:4,branchBendFunc:e=>createVector(1,0,0),closeS:true,meta:{...s,petalfType:c}});let h=F.stem({pg:pgL1,baseX:t,baseY:r,baseRotation:i,branchLength:random(5,10),col:[s.branchColor[0],s.branchColor[1],s.branchColor[2]*.8],branchWidthFunc:e=>random(2,3),branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let f=p.centerPoints[p.centerPoints.length-1];for(let e=0;e<s.flowerPetal;e++){let l=e/s.flowerPetal*TWO_PI+n;let c=createVector(0,-1,0);let p=createVector(0,-.1,.8);let h=p5.Vector.lerp(c,p,a);let d=yr.rotateVectorAroundAxis(h,createVector(0,0,1),l);let m=yr.applyEulerRotation(d,i);let u=yr.vectorToEulerAngles(m);let g=[s.flowerColorA[0],s.flowerColorA[1],s.flowerColorA[2]];let y,x,F;if(random(0,1)>.5){y=g[0];x=g[1];F=g[2]}else{y=g[0];x=g[1]*.95;F=g[2]*.95}let P=e<s.flowerPetal/2?-1:1;let w=e=>{if(s.branchBendFunc==undefined)return createVector(0,0,0);let t=s.branchBendFunc(e);return createVector(t.x,t.y*P,t.z)};let V=random(.5,.7);if(o==2)V=.5;let C=random(.8,1.2);if(o==2)C=.8;let E=true;if(s.spType==0)E=1;if(E)b.petal2({pg:pgL4,baseX:t+f.x,baseY:r+f.y,baseRotation:u,strokeStrength:.5,branchLength:s.flowerLengthA*C,col:[y,x,F,1],branchWidthFunc:e=>s.flowerShape(e)*s.flowerWidthA*V,branchBendFunc:w,branchSegments:18,branchSegmentsH:3,closeS:true,closeE:true,doLeafVeins:true,meta:s})}if(a<.5){b.drawCalyx({pg:pgL4,baseX:t+f.x,baseY:r+f.y,direction:l,baseEuler:i,flowerPetal:s.flowerPetal,flowerLengthA:s.flowerLengthA,flowerWidthA:s.flowerWidthA*.3,op:a,stemColor:s.flowerColorB})}}static drawFlowerC(e={}){let{pg:t,id:r,baseX:l=0,baseY:n=0,meta:a,baseRotation:s=createVector(0,0,0),ll:c=1}=e;Jr();let i=random(3,7);let h=e=>{while(e>PI)e-=TWO_PI;while(e<-PI)e+=TWO_PI;return e};let f=map(n,0,p.dim,1,2);let d=createVector(h(random(-.6*PI,.6*PI)+PI/2),h(random(-.6*PI,.6*PI)),0);if(o==1){d=createVector(PI/2+random(-1,1),0,random(-1,1));f=1.5}let m=xr.combineRotations(s,d);let u=F.stem({pg:pgL1,baseX:l,baseY:n,baseRotation:m,branchLength:a.flowerLengthC*N*random(.5,1)*c,col:[a.branchColor[0],a.branchColor[1],a.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2),branchBendFunc:e=>createVector(f,random(1,2)*Dr([-1,1]),random(1,2)*Dr([-1,1])),strokeStrength:1});let g=F.stem({pg:pgL0,baseX:l,baseY:n,baseRotation:m,branchLength:random(5,10),col:[a.branchColor[0],a.branchColor[1],a.branchColor[2]*.7],branchWidthFunc:e=>random(2,3),branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let y=u.centerPos[u.centerPos.length-1];let x=p5.Vector.sub(u.centerPos[u.centerPos.length-1],u.centerPos[u.centerPos.length-2]).normalize();t.push();t.translate(l+y.x,n+y.y);let P=i*1;let w=20;let V=[];for(let e=0;e<w;e++){let t=TWO_PI*e/w;let r=cos(t)*P;let o=sin(t)*P;V.push(createVector(r,o,0))}let C=V.map((e=>yr.applyEulerRotation(e,m)));t.fill(a.flowerColorB[0],a.flowerColorB[1],a.flowerColorB[2]);t.beginShape();C.forEach((e=>{t.vertex(e.x,e.y)}));t.endShape(CLOSE);t.pop();let E=a.sunflowerPetalCount;for(let e=0;e<9;e++){let t=e/9*TWO_PI;let r=createVector(i*1*cos(t),i*1*sin(t),0);let o=yr.applyEulerRotation(r,m);let s=createVector(cos(t),sin(t),0);s=yr.applyEulerRotation(s,m);let c=map(n,0,p.dim,3,.5);let h=map(n,p.dim*.2,p.dim,1.2,.8);let f=map(noise(l*100,n*100),0,1,.8,1.2);let d=noise(l*500,n*500)>.7?[0,2]:[1,1];let u=[a.flowerColorA[0],a.flowerColorA[1],a.flowerColorA[2]];let g,x,F;g=u[0];x=u[1]*.8*f;F=u[2]*.8*f;b.petal({pg:pgL2,baseX:l+y.x+o.x,baseY:n+y.y+o.y,branchLength:a.sunSize*.8,col:[g,x,F,1],colorFunction:a.flowerColorFn,direction:s,strokeStrength:.3,branchWidthFunc:e=>pow(sin(PI*(1-e)),.5)*a.flowerWidthA*.3,branchBendFunc:e=>createVector(c,0,0)})}for(let e=0;e<E;e++){let t=e/E*TWO_PI;let r=createVector(i*1*cos(t),i*1*sin(t),0);let o=yr.applyEulerRotation(r,m);let s=createVector(cos(t),sin(t),0);s=yr.applyEulerRotation(s,m);let c=map(n,0,p.dim,3,.5);let h=map(n,p.dim*.2,p.dim,1.2,.8);let f=map(noise(l*100,n*100),0,1,.8,1.2);let d=noise(l*500,n*500)>.7?[0,2]:[1,1];let u=[a.flowerColorA[0],a.flowerColorA[1],a.flowerColorA[2]];let g,x,F;if(random(0,1)>.5){g=u[0];x=u[1]*f*d[0];F=u[2]*f*d[1]}else{g=u[0];x=u[1]*.95*f*d[0];F=u[2]*.95*f*d[1]}b.petal({pg:pgL3,baseX:l+y.x+o.x,baseY:n+y.y+o.y,branchLength:a.sunSize,col:[g,x,F,1],colorFunction:a.flowerColorFn,direction:s,strokeStrength:.3,branchWidthFunc:e=>pow(sin(PI*(1-e)),.5)*a.flowerWidthA*.4,branchBendFunc:e=>createVector(c,0,0)})}let T=random(0,1);for(let e=0;e<10;e++){let t=e/10*TWO_PI;let r=createVector(i*.4*cos(t),i*.4*sin(t),0);let o=yr.applyEulerRotation(r,m);let s=createVector(cos(t),sin(t),0);s=yr.applyEulerRotation(s,m);b.petal({pg:pgL4,baseX:l+y.x+o.x,baseY:n+y.y+o.y,branchLength:20*M,col:a.flowerColorB,colorFunction:a.flowerColorFn,direction:s,branchSegments:10,strokeStrength:.5,branchWidthFunc:e=>.5,branchBendFunc:e=>createVector(a.flowerOpenCurve(e),sin(e*PI)*2,0)})}}static drawFlowerD(e={}){let{pg:t,id:r,baseX:o=0,baseY:l=0,meta:n}=e;const a=random(0,1)>.1?Tr(30,150):Tr(150,300);const s=Dr([1.4,1.4,1.4,2.8]);const c=F.stem({pg:pgL1,baseX:o,baseY:l,baseRotation:createVector(PI/2,0,random(-2,2)),branchLength:a*.5,col:n.branchColor,branchWidthFunc:e=>s*a/25,branchBendFunc:()=>createVector(1,1,0),pointShift:1});const i=c.centerPos[c.centerPos.length-1];const p=6;const h=137.5;const f=a*random(.05,.08);const d=h*PI/180;const m=random(TWO_PI);const[u,g,y]=n.flowerColorA;for(let e=0;e<p;e++){const t=7;const r=e*f;const s=map(e,0,p-1,.4,.3+random(-.1,.2));const c=map(e,0,p-1,.8,1.2);for(let p=0;p<t;p++){const h=p*TWO_PI/t+e*d+m;const f=createVector(cos(h),sin(h),0).normalize();const x=createVector(i.x+f.x*r,i.y+f.y*r,0);const F=createVector(f.x*.3,f.y*.3,-1).normalize();const P=yr.vectorToEulerAngles(F);b.petal2({pg:pgL3,baseX:o+x.x,baseY:l+x.y,baseRotation:createVector(P.x,P.y,random(-2,2)),branchLength:a*s,col:[u,g,y*c,1],branchWidthFunc:e=>n.flowerShape(e)*n.flowerWidthA*s*.5,branchBendFunc:e=>createVector(sin(e*PI)*.9,0,0),branchSegments:6,strokeStrength:.6,closeS:true})}}}static drawFlowerG(e={}){let{pg:t,baseX:r=0,baseY:l=0,direction:n=createVector(0,0,1),rot:a=random(0,1),op:s=0,meta:c=e.meta,petalfType:i=c.petalfType||[10,2],doFruit:p=0}=e;a=0;c.branchBendFunc=e=>{if(e<random(.55,.65)){return createVector(.6,0,0)}else{return createVector(0,cos(e*PI*2)*2,0)}};if(c.spType==0)c.branchBendFunc=e=>createVector(sin(e*PI)*-2,cos(e*PI)*.3,0);let h=yr.vectorToEulerAngles(n);let f=Dr([-1,1]);let d=b.petal2({pg:t,baseX:r,baseY:l,baseRotation:createVector(PI/2,0,1*f),branchLength:c.flowerLengthC*N*random(.5,1.2),col:[c.flowerColorA[0],c.flowerColorA[1],c.flowerColorA[2]*.7],col2:[c.branchColor[0],c.branchColor[1],c.branchColor[2]*.8],branchWidthFunc:e=>1.5,branchSegments:10,branchSegmentsH:4,branchBendFunc:e=>createVector(0,random(1.5,3)*f,0),closeS:true,meta:{...c,petalfType:i},stemMode:1});if(p){let e=d.centerPoints[d.centerPoints.length-1];w.melon({pg:t,baseX:r+e.x,baseY:l+e.y-10,baseRotation:createVector(0,0,0),PT:PT,size:30,length:30*random(.8,1.2),stemLength:PT.fruitstem,branchLength:80,stemBend:createVector(-1,0,0)})}let m=d.centerPoints[d.centerPoints.length-1];let u=0;for(let e=0;e<c.flowerPetal;e++){if(e>3&&e<10)u=1;else u=0;let n=e/c.flowerPetal*TWO_PI+a;let i=createVector(0,-1,0);let p=createVector(0,-.1,.8);let f=p5.Vector.lerp(i,p,s);let d=yr.rotateVectorAroundAxis(f,createVector(.05,.05,1),n);let g=yr.applyEulerRotation(d,h);let y=yr.vectorToEulerAngles(g);let x,F,P;let w=map(e,0,c.flowerPetal,.8,1.5);let V=map(e,0,c.flowerPetal,.8,1.5);let C=0;x=C;F=c.flowerColorA[1]*V;P=c.flowerColorA[2]*w;let E=e<7?-1:1;let T=e=>{let t=c.branchBendFunc(e);return createVector(t.x,t.y*E,t.z)};let D=random(.5,.7);if(o==2)D=.5;let A=random(.8,1.2);if(o==2)A=.8;if(c.spType==0)u=1;if(u)b.petal2({pg:t,baseX:r+m.x,baseY:l+m.y,baseRotation:y,strokeStrength:.5,branchLength:c.flowerLengthA*A,col:[x,F,P,1],branchWidthFunc:e=>c.flowerShape(e)*c.flowerWidthA*D,branchBendFunc:T,col:[c.flowerColorA[0],c.flowerColorA[1],c.flowerColorA[2]*.8],col2:[c.flowerColorB[0],c.flowerColorB[1],c.flowerColorB[2]*1.1],branchSegments:18,branchSegmentsH:3,closeS:true,closeE:true,doLeafVeins:false,stemMode:2,meta:c})}}static drawCalyx(e={}){let{baseX:t=0,baseY:r=0,direction:o=createVector(0,0,1),baseEuler:l=yr.vectorToEulerAngles(o),flowerPetal:n=5,flowerLengthA:a=20,flowerWidthA:s=8,op:c=0,stemColor:i=[100,.7,.8,1]}=e;let p=a*.3;let h=s*.8;let f=createVector(0,0,1);for(let e=0;e<n;e++){let o=e/n*TWO_PI;let a=c;let s=createVector(cos(o)*.1,sin(o)*.1,-.3);let d=createVector(cos(o)*.3,sin(o)*.3,-.1);let m=p5.Vector.lerp(d,s,a).normalize();let u=yr.applyEulerRotation(m,l);let g=u.angleBetween(f);let y;if(c>.5){y=g<PI/2?pgL1:pgL3}else{y=pgL3}let x=yr.vectorToEulerAngles(u);let F=map(a,0,1,3,1);b.petal2({pg:y,baseX:t,baseY:r,baseRotation:x,branchLength:-p,strokeStrength:.2,col:[i[0],i[1],i[2],1],branchWidthFunc:e=>{let t=h*(1-e*.7);return t*(a>.7?.2:map(a,0,.7,.5,.1))},branchBendFunc:e=>{let t=sin(e*PI)*(1-a)*F;let r=cos(e*PI)*F;let l=noise(o*10,e*10)*.4;return createVector(t+l,0,r+l)},branchSegments:16,branchSegmentsH:3,closeS:false,strokeStrength:.3})}}static drawLoseLeaves(e,t,r=0){rt=0;Ke=0;nt=0;let o=[zt.colors.leaf[1][0],zt.colors.leaf[1][1]*.5,zt.colors.leaf[1][2]];let l=[zt.colors.leaf[0][0],zt.colors.leaf[0][1]*.5,zt.colors.leaf[0][2]];o=o.map((e=>constrain(e,0,360)));l=l.map((e=>constrain(e,0,360)));pgBg.push();let n=5;if(r==0)n=Tr(10,30);else if(r==1)random(0,1)>.3?n=Tr(50,80):n=Tr(150,300);let a=[];for(let e=0;e<n;e++){a.push({size:random(0,1)<.9?random(40,60):random(70,120)})}let s=t-20;function c(e,t){if(e>.7){return sin(e*PI)*t*(1-e)*0}else{return sin(e*PI)*t*(1-e)*.8}}let i=1;if(r==0)i=random(0,1)<.7?random(2,3):random(3.5,4.5);else if(r==1)i=random(3.5,5.5);a.forEach(((t,r)=>{let n=0;if(random(0,1)>.95)n=i*3;else n=i;t.x=e+random(random(-t.size*n,t.size*n),random(-t.size*n,t.size*n));t.y=s+r*t.size*random(.01,.02);let a=random(0,1);let p=createVector(PI/2*Dr([1,-1]),-random(-.3,.3),0).normalize();let h=random(0,1)<.8?.1:.2;let f=random(.9,1.1);let d=constrain(random(-.3,1.3),0,1);let m=[lerp(o[0],l[0],d),lerp(o[1],l[1],d),lerp(o[2],l[2],d),random(.1,.8)];b.petal({pg:pgBg,baseX:t.x,baseY:t.y,direction:p,branchLength:t.size,col:[m[0],m[1],m[2]*f,m[3]],branchSegments:12,branchWidthFunc:e=>c(e,t.size*h),branchBendFunc:e=>createVector(0,-sin(e*PI)*.4,sin(e*PI)*.3),drawOutLine:1,strokeStrength:.2,downLeaf:1})}));pgBg.pop()}static petal(e={}){let{pg:t=pgBg,baseX:r=0,baseY:l=0,direction:n=createVector(0,0,1),branchLength:a=100,branchSegments:s=12,branchWidthFunc:c=e=>sin(e*PI)*20,col:i=e.col||{},colorFunction:p=e=>e,branchBendFunc:h=e=>createVector(0,0,0),pcc:f=false,drawOutLine:d=1,pointShift:m=0,strokeStrength:u=1,downLeaf:g=0,sameWidth:b=0}=e;let y=wr(Nt);u=u+y.random(0,1)*2;m=5*be;s=max(5,floor(s*G));let x=createVector(0,0,1);let F=p5.Vector.cross(x,n);let P=x.angleBetween(n);if(F.magSq()<1e-6){if(x.dot(n)<0){F=createVector(1,1,1);P=PI}else{F=createVector(1,0,0);P=0}}else{F.normalize()}let w=createVector(0,0,0);let V=createVector(0,0,0);let C=[];let E=[];let T=[];for(let e=0;e<s;e++){let o=e/(s-1);let f=h(o);V=p5.Vector.add(V,p5.Vector.mult(f,1/s));let d=createVector(0,0,a/s);d=yr.applyEulerRotation(d,V);w=p5.Vector.add(w,d);let m=c(o);let u=createVector(-n.y,n.x,0).normalize().mult(m);let g=p5.Vector.add(w,u);let b=p5.Vector.add(w,p5.Vector.mult(u,-1));let y=yr.rotateVectorAroundAxis(w,F,P);let x=yr.rotateVectorAroundAxis(g,F,P);let D=yr.rotateVectorAroundAxis(b,F,P);C.push(y.copy());E.push(x.copy());T.push(D.copy());if(e>0){let o=p5.Vector.sub(C[e],E[e-2]);let n=p5.Vector.sub(E[e],C[e]);let a=p5.Vector.cross(o,n);let s=map(abs(a.angleBetween(createVector(PI/2,PI/2,0))),0,PI,1,0);s=p(s);let c=i[0];let h=i[1];let f=i[2];let d=i[3]||1;Cl({pg:t,pts:[E[e],E[e-1],C[e-1],C[e]],baseX:r,baseY:l,col:kr(c,h,f,d),doFill:true,randomOffset:.3,vertexMode:rt});Cl({pg:t,pts:[T[e],T[e-1],C[e-1],C[e]],baseX:r,baseY:l,doFill:true,col:kr(c,h,f,d),randomOffset:.3,vertexMode:rt})}}let D=zt.colors.stroke[0];if(de==0)D=zt.colors.stroke[2];let A=zt.colors.stroke[1];let I=e=>{const t=.01;const r=-.35;const o=(noise(e*t,Tr(0,100)*.05)+r)*u*ge;return o>.5?o:random(0,1)>.7?0:0};let L=e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.4)*u*ge;let S=e=>(.5*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*u*ge;let B=Dr([I,L]);if(ot==1)B=L;else if(ot==2)B=I;if(o==1||o==2){B=e=>.5}let W=1;let k=.7;if(g==1){B=S;b=1;D=i;W=.7;k=.4}if(d>0){El({pg:t,pts:C.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-m,m);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,doFill:true,col:kr(D[0],D[1],D[2]*W,k),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1});El({pg:t,pts:E.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-m,m);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,doFill:true,col:kr(D[0],D[1],D[2]*W,k),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1});El({pg:t,pts:T.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-m,m);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,doFill:true,col:kr(D[0],D[1],D[2]*W,k),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1});let e=E[E.length-1];let o=T[T.length-1];let n=[e,o];El({pg:t,pts:n,baseX:r,baseY:l,doFill:true,col:kr(D[0],D[1],D[2]*W,k),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1})}return C}static addFlower(e,t,r){if(!r||!r.PT){console.warn("meta or meta.PT is undefined");return false}if(!r.PT.flowerPositions){r.PT.flowerPositions=[]}let l=false;for(let o of r.PT.flowerPositions){let r=dist(e,t,o.x,o.y);let n=_e==2?10:50;if(r<n){l=true;break}}if(!l){r.PT.flowerPositions.push({x:e,y:t});if(o==2)_e=4;switch(_e){case 0:b.drawFlowerA({pg:pgL3,id:r.PT.flowerCount,baseX:e,baseY:t,meta:r.PT});break;case 1:let o=wr(Nt);b.drawFlowerB({pg:pgL2,baseX:e,baseY:t,direction:Ir(o),rot:random(0,TWO_PI),op:Dr([.1,.1,.3,.6]),meta:r.PT});break;case 2:b.drawFlowerC({pg:pgL2,id:r.PT.flowerCount,baseX:e,baseY:t,meta:r.PT,ll:random(3,6)});break;case 3:b.drawFlowerD({pg:pgL2,id:r.PT.flowerCount,baseX:e,baseY:t,meta:r.PT});break;case 4:b.drawSpecialFlower({pg:pgL2,id:r.PT.flowerCount,baseX:e,baseY:t,meta:r.PT});break}r.PT.flowerCount++;return true}return false}static drawSpecialFlower({pg:e,baseX:t,baseY:r,meta:o}){let l={branchColor:o.branchColor,flowerColorA:[o.flowerColorA[0],o.flowerColorA[1],o.flowerColorA[2]*random(1.1,1.2)],flowerColorB:[o.flowerColorA[0],o.flowerColorA[1],o.flowerColorA[2]*random(.5,.7)],flowerPetal:1,flowerLengthA:80*random(.8,1.4),flowerWidthA:10*random(.6,1.2),flowerLengthC:30*random(.8,1.2),flowerShape:e=>{if(e<.5){return 2*pow(sin(e*3.14),1.5)+.3}else{return 2*pow(sin(e*3.14),1.5)+.2}},petalfType:[13,2,0],spType:0};let n={branchColor:o.branchColor,flowerColorA:[o.flowerColorA[0],o.flowerColorA[1],o.flowerColorA[2]*random(.8,1)],flowerColorB:[o.flowerColorB[0],o.flowerColorB[1],o.flowerColorB[2]*random(.9,1.1)],flowerPetal:12,flowerLengthA:110*random(.9,1.1),flowerWidthA:9*random(.6,1.2),flowerLengthC:30*random(.8,1.2),flowerShape:e=>{if(e<.4)return map(e,0,.5,.8,1);else if(e>=.4&&e<.6)return map(e,.4,.6,1,.5);else return map(e,.6,1,.5,.2)},petalfType:[13,2,0],spType:1};let a=createVector(0,1,Dr([-1,1]));let s;let c=random(0,1)>.7?l:n;if(c==l)s=createVector(0,1,a.z*-10);else s=createVector(0,1,a.z*-1);b.drawFlowerG({pg:pgL0,baseX:t,baseY:r,direction:a,op:1,meta:c});if(random(0,1)>.5){b.drawFlowerG({pg:pgL3,baseX:t,baseY:r,direction:s,op:1,meta:c})}}}class F{static drawWoody(e={}){let{meta:t=e.meta||{},pg:r=pgL1,baseX:l=0,baseY:n=0,baseRotation:a=createVector(PI/2,0,0),branchLength:s=p.dim*_,branchSegments:c=30,branchWidthFunc:i=1,twistIntensity:h=5,maxBranchWidth:f=4,col:d=[50,.2,.8],stemTexLine:m=e.stemTexLine||0,maxBranchDepth:u=3,forkCount:g=4,branchStats:b=e.branchStats||{mainStemLength:0,branchCount:0,branchesByDepth:{},totalLength:0,highestBranch:null},currentDepth:y=e.currentDepth||0,currentPath:currentPath=e.currentPath||[],isMainStem:x=y===0,parentStartPoint:P=null,branchId:w=e.branchId||"main"}=e;if(o==2)m=1;if(Se)console.log("drawWoody - 樹枝深度:"+y+" branchId:"+w);let V=new Set;let C=xr.combineRotations(a,createVector(Q,Z,ee));let E=s;b.totalLength+=E;if(y===0)b.mainStemLength=E;const T=Fr.createJoints(h,c);const D=Fr.createWidthFunction(i,f,T,c);const A=Fr.createbranchBendFunction(T,c);let{centerPos:I,widths:L}=F.stem({pg:pgL1,baseX:l,baseY:n,baseRotation:C,branchLength:E,branchSegments:c,branchWidthFunc:D,col:d,branchBendFunc:A,closeS:x,stemTexLine:m,currentDepth:y});let S=0;for(let e=1;e<I.length;e++){S+=dist(I[e].x,I[e].y,I[e-1].x,I[e-1].y)}if(x){if(!b.branchesByDepth[0]){b.branchesByDepth[0]=1}}else{if(!b.branchesByDepth[y]){b.branchesByDepth[y]=0}b.branchesByDepth[y]++}let B=[];if(u>0){let a=Tr(max(1,g-2),g+1);b.branchCount+=a;const p=width*1.05;const f=height*1.05;const d=-width*.05;const x=-height*.05;for(let g=0;g<a;g++){let a=floor(I.length*.1);let P=floor(I.length*.9);let C=floor(random(a,P));const E=l+(I[C]?I[C].x:0);const T=n+(I[C]?I[C].y:0);let D=false;for(let e of V){if(abs(e-C)<10){D=true;break}}if(D)continue;if(C>=0&&C<I.length){let a=L[C];let P=random(.3,.7);if(o!=0)P=random(.6,.8);V.add(C);let D=`${w}_${g}`;let A={x:I[C].x+l,y:I[C].y+n,depth:y+1,branchId:D,parentBranchId:w,plantId:vt.plantId};let S=pt?[...currentPath.slice(0,C+1),A]:[];if(Ht==3&&y>0)te=[Tr(0,10),Tr(0,15)];if(E>=d&&E<=p&&T>=x&&T<=f){let o=F.drawWoody({...e,pg:r,baseX:E,baseY:T,branchSegments:c,branchLength:s*random(.5,$),branchWidthFunc:i*P,twistIntensity:h*.7,maxBranchDepth:u-1,col:[t.branchColor[0],t.branchColor[1],t.branchColor[2]*random(.9,1),1],forkCount:t.branchFork,maxBranchWidth:a*P,branchStats:b,currentDepth:y+1,currentPath:S,isMainStem:false,parentStartPoint:A,branchId:D,stemTexLine:m});if(o&&o.length>0){B=B.concat(o)}}}}}if(pt){let e;if(V.size>0){let t=max(...Array.from(V));e=I.slice(0,t+1).map(((e,t)=>({x:round(e.x+l),y:round(e.y+n),depth:y,isMainStem:x,branchId:w,parentBranchId:P?.branchId||null,isStartbranch:V.has(t),plantId:vt.plantId,segmentIndex:X,doTimestamp:Date.now()})))}else{e=I.map(((e,t)=>({x:round(e.x+l),y:round(e.y+n),depth:y,isMainStem:x,branchId:w,parentBranchId:P?.branchId||null,isStartbranch:false,plantId:vt.plantId,segmentIndex:X,doTimestamp:Date.now()})))}if(!re.path){re.path=[]}re.path=[...re.path,...e];let t=I[I.length-1];if(t.y+n<re.height){re={x:t.x+l,y:t.y+n,height:t.y+n,path:re.path,plantId:vt.plantId,segmentIndex:X}}}let W=[[u,I.map(((e,t)=>[e.x+l,e.y+n,e.z,L[t]]))]].concat(B);W.widthFunc=D;W.baseWidth=i;W.maxBranchWidthidth=f;return W}static stem(e={}){let{pg:t=pgL3,baseX:r=0,baseY:l=0,baseRotation:n=createVector(PI/2,0,0),branchLength:a=400,branchSegments:s=20,branchSegmentsH:c=4,branchWidthFunc:i=e=>.5*(1-e)*map(noise(e*10),0,1,.5,1)+.2,branchBendFunc:p=e=>createVector(random(-10,10),0,random(-5,5)),mushroomStroke:h=false,branchStats:f=null,closeS:d=false,curveS:m=true,stemTexLine:u=0,pointShift:g=10,strokeStrength:b=.8,strokeNoiseScale:y=10,lineSegScale:x=Dr([.05,.2,1,5]),lineLimit:F=Dr([.7,.5,.3]),col:P=[250,.5,.4],jointCount:w=Tr(10,30),currentDepth:V=0}=e;let C=wr(Nt);b=b+C.random(0,1)*2;b=b*map(M,.2,5,1,2);g=5*be;s=max(5,floor(min(80,max(30,floor(a/6)))*G));let E=createVector(0,0,0);let T=createVector(0,0,0);let D=[E.copy()];let A=[T.copy()];let I=[];let L=e=>yr.applyEulerRotation(e,n);let S;let B=map(V,0,4,1,2)+random(-.2,.2);for(let e=0;e<s;e++){let t=e/(s-1);let r=p(t);T=p5.Vector.add(T,r.copy().mult(1/s));let o=createVector(0,0,a/s);let l=yr.applyEulerRotation(o,T);E=p5.Vector.add(E,L(l));A.push(T.copy());D.push(E.copy());S=i(e/s);I.push(S)}let[W,k]=wl({pts:D,branchWidthFunc:i});let X=W.map(((e,t)=>Yr(W[t],k[t],.3+random(-.05,.15))));let Y=W.map(((e,t)=>Yr(W[t],k[t],.7+random(-.15,.05))));if(c!=null){c=c}else{c=S<1.5?5:Dr([6,8,10])}function O(e,n){const a=D.length-1;const s=c-1;const i=e/a;const p=n/s;const h=(n+1)/s;const f={Pos0_0:Yr(W[e],k[e],p),Pos0_1:Yr(W[e+1],k[e+1],p),Pos1_0:Yr(W[e],k[e],h),Pos1_1:e>a-5?Yr(W[e+1],k[e+1],1):Yr(W[e+1],k[e+1],h)};const d=pow(1-i,1);const m={h:P[0],s:lerp(P[1],P[1]*.8,d),b:lerp(P[2]*B,P[2]*.8,d),alpha:1};let u=.6;if(o==2)u=0;Cl({pg:t,pts:[f.Pos0_0,f.Pos0_1,f.Pos1_1,f.Pos1_0],baseX:r,baseY:l,col:kr(m.h,m.s,m.b,m.alpha),randomOffset:u})}for(let e=0;e<D.length-1;e++){for(let t=0;t<c-1;t++){O(e,t)}}let z;z=zt.colors.stroke[0];if(de==0)z=zt.colors.stroke[2];let R=zt.colors.stroke[1];let v=zt.colors.vine[0];if(h){x=10;F=.8}let _=e=>{const t=.01;const r=-.35;const o=(noise(e*t,Tr(0,100)*.05)+r)*b*ge;return o>.5?o:random(0,1)>.8?0:0};let N=e=>(.2*(1-e)*map(noise(e*y),0,1,.5,1)+.3)*b*ge;let H=e=>.5;let $=.5;if(S>1&&u==0){for(let e=0;e<X.length-1;e++){let o=X[e];let n=X[e+1];if(noise(e*x)<F){let e=createVector(o.x,o.y);let a=createVector(n.x,n.y);let s=[];for(let t=0;t<=4;t++){let r=t/4;let o=lerp(e.x,a.x,r);let l=lerp(e.y,a.y,r);s.push(createVector(o,l))}El({pg:t,pts:s,baseX:r,baseY:l,col:kr(R[0],R[1],R[2],1),branchWidthFunc:N,randomOffset:.2,forceBrush:1})}}for(let e=0;e<Y.length-1;e++){let o=Y[e];let n=Y[e+1];if(noise(e*x+1e3)<F){let e=createVector(o.x,o.y);let a=createVector(n.x,n.y);let s=[];for(let t=0;t<=4;t++){let r=t/4;let o=lerp(e.x,a.x,r);let l=lerp(e.y,a.y,r);s.push(createVector(o,l))}El({pg:t,pts:s,baseX:r,baseY:l,col:kr(R[0],R[1],R[2],1),branchWidthFunc:N,randomOffset:.2,forceBrush:1})}}}Pl({pg:pgText,pts:D,baseX:r,baseY:l});let q=Dr([_,N]);if(ot==1)q=N;else if(ot==2)q=_;if(o==2)q=H,U=0,g=0;El({pg:t,pts:W.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-g,g);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-g,g);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,col:kr(z[0],z[1],z[2],$),branchWidthFunc:q,randomOffset:.5});El({pg:t,pts:k.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-g,g);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-g,g);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,col:kr(z[0],z[1],z[2],$),branchWidthFunc:q,randomOffset:.5});let J=[];let j=c;for(let e=0;e<=j;e++){let t=e/j;J.push(Yr(W[0],k[0],t))}if(d==true){El({pg:t,pts:J,baseX:r,baseY:l,col:kr(z[0],z[1],z[2],$),branchWidthFunc:q,randomOffset:.5})}if(S>1.5){let e=[];let o=c;for(let t=0;t<=o;t++){let r=t/o;e.push(p5.Vector.lerp(W[W.length-1],k[k.length-1],r))}El({pg:t,pts:e,baseX:r,baseY:l,col:kr(z[0],z[1],z[2],$),branchWidthFunc:q,randomOffset:0})}if(u==1&&S<10){let e=0;if(o==2)e=floor(w*Xt);for(let o=e;o<w;o++){let e=o/w;let n=floor(e*D.length);let a=D[n];let s=i(e)*2;let c=max(0,n-1);let p=min(D.length-1,n+1);let h=p5.Vector.sub(D[p],D[c]).normalize();let f=createVector(-h.y,h.x);let d=[];let m=[];let u=8;for(let e=0;e<=u;e++){let t=map(e,0,u,-s*random(.5,.65),s*random(.5,.65));let r=p5.Vector.add(a,p5.Vector.mult(f,t));d.push(r)}for(let e=0;e<=u;e++){let t=map(e,0,u,-s*.45,s*.45);let r=p5.Vector.add(a,p5.Vector.mult(f,t));m.push(r)}El({pg:t,pts:m,baseX:r,baseY:l,col:kr(z[0],z[1],z[2]*.5,.8),branchWidthFunc:e=>N(e)*4,randomOffset:0,forceBrush:1});El({pg:t,pts:m,baseX:r,baseY:l,col:kr(0,0,1,.8),branchWidthFunc:e=>N(e)*2,randomOffset:0,forceBrush:1})}}const K=D.reduce(((e,t)=>t.y<e.y?t:e),D[0]);const Q={centerPos:D,widths:I,highestPoint:K};return Q}static drawSpike(e={}){let{pg:t=pgL3,meta:r,baseX:o=0,baseY:l=0,branchLength:n=random(20,50),branchSegments:a=10,baseWidth:s,branchLengthScale:c,branchWidthFunc:i=e=>4*(1-e*.8),col:p=r.spikeColor,branchBendFunc:h=e.branchBendFunc||(e=>createVector(random(.5,1.5),random(1,3),0)),stemPoints:f=e.stemPoints||[],pointShift:d=5,strokeStrength:m=.2,strokeNoiseScale:u=10,sp2Mode:g=0}=e;let b=wr(Nt);m=m+b.random(0,1)*2;d=10*be;s=min(s,30);p=random(0,1)>.1?r.spikeColor:r.spikeColor2;i=e=>min(s*(1-e*.95),8);let y=createVector(0,-1);n=random(s*30,s*60)*N*c;h=e=>createVector(random(-.5,2),random(-1,3),0);if(f.length>=2){let e=createVector(f[0][0],f[0][1]);let t=createVector(f[2][0],f[2][1]);y=p5.Vector.sub(t,e).normalize();let r=random(0,1)>.5?PI/2:PI/4;let o=random(-PI/12,PI/12);let l=random(-PI/9,-PI/4.5);y.rotate(r+o);y.rotate(l)}let x=atan2(y.y,y.x);let F=createVector(0,0,x);a=4;let P=createVector(0,0,0);let w=createVector(0,0,0);let V=[P.copy()];let C=[w.copy()];let E=[];let T=e=>yr.applyEulerRotation(e,F);for(let e=0;e<a;e++){let t=e/(a-1);let r=h(t);w=p5.Vector.add(w,r.copy().mult(1/a));let o=createVector(0,0,n/a);let l=yr.applyEulerRotation(o,w);P=p5.Vector.add(P,T(l));C.push(w.copy());V.push(P.copy());E.push(i(e/a))}let[D,A]=wl({pts:V,branchWidthFunc:i});let I=6;let L=random(0,1)>.3?1:0;function S(e,r){const n=V.length-1;const a=I-1;const s=r/a;const c=(r+1)/a;const i=(e+1)/n;const h={Pos0_0:Yr(D[e],A[e],s),Pos0_1:Yr(D[e+1],A[e+1],s),Pos1_0:Yr(D[e],A[e],c),Pos1_1:Yr(D[e+1],A[e+1],c)};const f=map(c/i,0,1,1,.5)+noise(e,r)*.2;const d=L===1?{h:p[0],s:p[1]*f,b:p[2]*f}:{h:p[0],s:p[1]*.7,b:p[2]*.7};Cl({pg:t,pts:[h.Pos0_0,h.Pos0_1,h.Pos1_1,h.Pos1_0],baseX:o,baseY:l,col:kr(d.h,d.s,d.b,1),randomOffset:1})}for(let e=0;e<V.length-1;e++){for(let t=0;t<I-1;t++){S(e,t)}}let B=zt.colors.stroke[0];if(de==0)B=zt.colors.stroke[2];let W=zt.colors.stroke[1];El({pg:t,pts:D.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let r=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:o,baseY:l,col:kr(B[0],B[1],B[2]*.8,1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*m*ge,randomOffset:1});El({pg:t,pts:A.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let r=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:o,baseY:l,col:kr(B[0],B[1],B[2]*.8,1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*m*ge,randomOffset:1});return{centerPos:V,widths:E}}static drawAllPath(e){if(!re.path)return;let t=re.path.filter((e=>e.isMainStem));let r=re.path.filter((e=>!e.isMainStem));let o=r.reduce(((e,t)=>{if(!e[t.depth]){e[t.depth]=[]}e[t.depth].push(t);return e}),{})}static drawVines(e){if(!re.path)return;let t=2;let r=1;let o=1;let l=wr(Nt);o=o+l.random(0,1)*2;t=10*be;ge=.6;const n=e.spiral;const a={maxRadiusMultiplier:1,minRadius:.5,maxNoiseEffect:.15,maxBendEffect:.3,maxTwistEffect:PI/2};pgL0.strokeCap(ROUND);pgL1.strokeCap(ROUND);let s=re.path.filter((e=>e.isMainStem));let c=re.path.filter((e=>!e.isMainStem));let i=[];i=[...s];let p={};c.forEach((e=>{if(!p[e.parentBranchId]){p[e.parentBranchId]=[]}p[e.parentBranchId].push(e)}));Object.keys(p).forEach((e=>{let t=s.find((t=>t.branchId===e));if(t){i=i.concat(p[e])}}));const h=floor(i.length*n.maxLength);let f=i.slice(0,h);let d=random(1e3);let m=random(1e3);let u=.2;let g=f.map(((t,r)=>{let o=r/(f.length-1);let l=o;let s=e.widthFunc(l);let c=constrain(s*n.baseRadius*a.maxRadiusMultiplier,a.minRadius,s*1.2);let p=noise(d+o*u)*n.noiseStrength*a.maxNoiseEffect;let h=1.3*c*(1+p*.5)*(n.radiusVariation*.8);let m=map(t.y,i[0].y,i[i.length-1].y,0,1);let g=sin(m*PI)*n.bendStrength*a.maxBendEffect;h*=1+g*.8;let b=frameCount*.003;let y=sin(b+o*PI*.8)*.4+.6;let x=noise(b*u*.8,o*u*.8);let F=lerp(y,x,.2);let P=map(F,0,1,.2,1.5);n.spiralTightness=lerp(n.spiralTightness,P,.1);let w=n.baseFrequency*TWO_PI*n.spiralTightness;let V=noise(d)*n.twistFactor*a.maxTwistEffect;let C=w+V;let E=t.x+cos(C)*h;let T=t.y;let D=sin(C)*h;d+=n.noiseScale;return{x:E,y:T,z:D,baseRadius:c}}));let b=g.map(((e,t)=>{let r=t/(f.length-1);let o=1;if(e&&typeof e.baseRadius==="number"&&isFinite(e.baseRadius)){o=n.baseWidth*e.baseRadius*.2}let l=m+t*n.smoothness||0;let a=noise(l)*(n.widthVariation||.1)*.6;o=isFinite(o)?o:1;a=isFinite(a)?a:0;let s=constrain((o+a)/2,max(.1,o*.3),max(.2,o*1));s=isFinite(s)?s:1;let c=min(t+1,g.length-1);let i;if(t<g.length-1){let t=g[c];if(t&&e){i=createVector(t.x-e.x,t.y-e.y).normalize()}else{i=createVector(0,-1)}}else{if(t>0&&g[t-1]&&e){let r=g[t-1];i=createVector(e.x-r.x,e.y-r.y).normalize()}else{i=createVector(0,-1)}}if(!i){i=createVector(0,-1)}let p=createVector(-i.y,i.x).mult(s);return{x:e.x,y:e.y,z:e.z,widthVector:p,strokeWeight:s*2}}));pgL0.push();pgL1.push();let y=n.glowChance*random(.6,1.2);for(let e=0;e<b.length-1;e++){let t=b[e];let r=b[e+1];let l=e/(b.length-1);let a=n.detailLevel;let s=Lr(n.color[0],n.color[0],l);let c=map(l,0,1,n.color[1],n.color[1])*map(noise(l*a),0,1,.8,1);let i=map(l,0,1,n.color[2],n.color[2])*map(noise(l*a),0,1,.5,1);let p=kr(s,c,i,1);let h=kr(s,c*.8,i*.6,1);let f=createVector(t.x-t.widthVector.x,t.y-t.widthVector.y);let d=createVector(t.x+t.widthVector.x,t.y+t.widthVector.y);let m=createVector(r.x-r.widthVector.x,r.y-r.widthVector.y);let u=createVector(r.x+r.widthVector.x,r.y+r.widthVector.y);let g=random(.5,1.5)+2;if(t.z<0&&r.z<0){Cl({pg:pgL0,pts:[f,m,u,d],col:p,randomOffset:.5});El({pg:pgL0,pts:[f,m],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});El({pg:pgL0,pts:[d,u],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5})}else if(t.z>=0&&r.z>=0){Cl({pg:pgL1,pts:[f,m,u,d],col:p,randomOffset:.5});El({pg:pgL1,pts:[f,m],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});El({pg:pgL1,pts:[d,u],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5})}else{let e=abs(t.z)/(abs(t.z)+abs(r.z));let l=lerp(t.x,r.x,e);let n=lerp(t.y,r.y,e);let a=p5.Vector.lerp(t.widthVector,r.widthVector,e);let s=createVector(l-a.x,n-a.y);let c=createVector(l+a.x,n+a.y);if(t.z<0){Cl({pg:pgL0,pts:[f,s,c,d],col:p,randomOffset:.5});El({pg:pgL0,pts:[f,s],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});El({pg:pgL0,pts:[d,c],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});Cl({pg:pgL1,pts:[s,m,u,c],col:p,randomOffset:.5});El({pg:pgL1,pts:[s,m],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});El({pg:pgL1,pts:[c,u],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5})}else{Cl({pg:pgL1,pts:[f,s,c,d],col:p,randomOffset:.5});El({pg:pgL1,pts:[f,s],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});El({pg:pgL1,pts:[d,c],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});Cl({pg:pgL0,pts:[s,m,u,c],col:p,randomOffset:.5});El({pg:pgL0,pts:[s,m],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5});El({pg:pgL0,pts:[c,u],col:h,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*o*ge*random(.5,1),randomOffset:.5})}}}g.forEach(((t,r)=>{let o=r/(g.length-1);if(random(0,1)>.8){let r=createVector(random(-.5,.5),random(-.5,.5),random(-3,3));let o=P.leaf({pg:pgL0,outline:false,baseX:t.x,baseY:t.y,branchLength:n.leaf.size.length*random(.7,1),col:n.leaf.color,colorFunction:e.leafColorFn,branchSegments:10,baseRotation:createVector(r.x,r.y,r.z+PI/2),branchWidthFunc:e=>n.leaf.shape(e)*n.leaf.size.width,branchBendFunc:e=>createVector(map(noise(e*1,PI),0,1,-1,1)*5,0,map(noise(e*1,PI+PI),0,1,-1,1)*5),veinsType:[n.leaf.veins.type,n.leaf.veins.density,n.leaf.veins.spacing]});P.leaf({pg:pgL1,outline:false,baseX:t.x,baseY:t.y,branchLength:n.leaf.size.length*random(.7,1),col:n.leaf.color,colorFunction:e.leafColorFn,branchSegments:10,baseRotation:createVector(r.x,r.y,r.z-PI/2),branchWidthFunc:e=>n.leaf.shape(e)*n.leaf.size.width,branchBendFunc:e=>createVector(map(noise(e*1,PI+100),0,1,-1,1)*4,0,map(noise(e*1,PI+PI+100),0,1,-1,1)*4),veinsType:[n.leaf.veins.type,n.leaf.veins.density,n.leaf.veins.spacing]})}}));pgL0.pop();pgL1.pop()}static wood(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,baseRotation:l=createVector(PI/2,0,0),branchLength:n=400,branchSegments:a=20,branchSegmentsH:s=4,branchWidthFunc:c=e=>.5*(1-e)*map(noise(e*10),0,1,.5,1)+.2,branchBendFunc:i=e=>createVector(random(-10,10),0,random(-10,10)),pointShift:p=10,strokeStrength:h=.8,strokeNoiseScale:f=10,lineSegScale:d=Dr([.05,.2,1,5]),lineLimit:m=Dr([.7,.5,.3]),col:u=[250,.5,.4],depth:g=1,convexConcaveStrength:b=random(.2,1.3),forceHorizontal:y=false,enableCracks:x=random(0,1)>.7,crackDensity:P=random(.05,.3),crackDepth:w=random(.1,.3),enableHoles:V=random(0,1)>.7,holeDensity:C=random(.05,.3),holeSize:E=random(.1,.3),holeDepth:T=random(.1,.3)}=e;let D=wr(Nt);h=h*map(M,.2,5,1,1.8);p=3*be;u=zt.colors.branch[2];if(y){l=createVector(PI/2,random(0,.2),Dr([-1*random(1.3,1.8),random(1.3,1.8)]))}else{l=createVector(PI/2,random(0,.2),random(0,.2))}let A=createVector(0,0,0);let I=createVector(0,0,0);let L=[A.copy()];let S=[I.copy()];let B=e=>yr.applyEulerRotation(e,l);for(let e=0;e<a;e++){let t=e/(a-1);let r=i(t);I=p5.Vector.add(I,r.copy().mult(1/a));let o=createVector(0,0,n/a);let l=yr.applyEulerRotation(o,I);A=p5.Vector.add(A,B(l));S.push(I.copy());L.push(A.copy())}let[W,k]=wl({pts:L,branchWidthFunc:c});function X(e,t){const r=L.length-1;const o=s-1;const l=e/r;const n=(t-1)/o;const a=t/o;const c=.02;const i=.48;const p=.52;const h=.98;let f=0;if(l<=c){f=1*b}else if(l<i){f=(1-(l-c)/(i-c))*b}else if(l>=h){f=-1*b}else if(l>p){f=-((l-p)/(h-p))*b}const d=f>0;const m=f<0;let u,g,y,x;const F=e;if(d||m){const e=d?Yr:(e,t,r)=>Yr(t,e,1-r);const t=e(W[F-1],k[F-1],n);const r=e(W[F],k[F],n);const o=e(W[F-1],k[F-1],a);const s=e(W[F],k[F],a);const c=p5.Vector.lerp(W[F-1],k[F-1],n);const h=p5.Vector.lerp(W[F],k[F],n);const b=p5.Vector.lerp(W[F-1],k[F-1],a);const P=p5.Vector.lerp(W[F],k[F],a);const w=abs(f);u=p5.Vector.lerp(c,t,w);g=p5.Vector.lerp(h,r,w);y=p5.Vector.lerp(b,o,w);x=p5.Vector.lerp(P,s,w);const V=d&&l<i||m&&l>p?1+.2*w:1;if(V>1){const e=(u.x+x.x)/2;const t=(u.y+x.y)/2;const r=r=>createVector(e+(r.x-e)*V,t+(r.y-t)*V);u=r(u);g=r(g);y=r(y);x=r(x)}}else{u=p5.Vector.lerp(W[F-1],k[F-1],n);g=p5.Vector.lerp(W[F],k[F],n);y=p5.Vector.lerp(W[F-1],k[F-1],a);x=p5.Vector.lerp(W[F],k[F],a)}const P=(u.x+g.x+x.x+y.x)/4;const w=(u.y+g.y+x.y+y.y)/4;const V=random(1,1.2);const C=e=>createVector(P+(e.x-P)*V,w+(e.y-w)*V);return{Pos0_0:C(u),Pos0_1:C(g),Pos1_1:C(x),Pos1_0:C(y),center:createVector(P,w)}}function Y(e,l){const{Pos0_0:n,Pos0_1:a,Pos1_1:s,Pos1_0:c}=e;const{h:i,s:p,b:h,alpha:f}=l;Cl({pg:t,pts:[n,a,s,c],baseX:r,baseY:o,col:kr(i,p,h,f),randomOffset:.5})}function O(e,l){if(!x||random(0,1)>=P)return;const n=[e.Pos0_0,e.Pos0_1,e.Pos1_1,e.Pos1_0];const a=floor(random(4));let s;do{s=floor(random(4))}while(s===a);const c=n[a];const i=n[s];const p=p5.Vector.sub(i,c);const h=p.mag()*random(.3,.9);p.setMag(h);const f=p5.Vector.add(c,p5.Vector.mult(p,random(.3,.7)));const d=createVector(-p.y,p.x);d.setMag(h*w*random(.1,.3));f.add(d);const m=[];const u=floor(random(3,7));for(let e=0;e<=u;e++){let t=e/u;let r;if(e===0){r=c.copy()}else if(e===u){const e=p5.Vector.add(c,p5.Vector.mult(p,random(.7,1)));r=e.copy()}else{const e=t;const o=(1-e)**2*c.x+2*(1-e)*e*f.x+e**2*(c.x+p.x);const l=(1-e)**2*c.y+2*(1-e)*e*f.y+e**2*(c.y+p.y);const n=createVector(random(-5,5)*w,random(-5,5)*w);r=createVector(o,l).add(n)}m.push(r)}const{h:g,s:b,b:y,alpha:F}=l;const V=y*.5;const C=F*.9;for(let e=1;e<m.length;e++){const l=m[e-1];const n=m[e];const a=p5.Vector.sub(n,l);const s=createVector(-a.y,a.x);s.setMag(random(1,3)*w);const c=[p5.Vector.add(l,s),p5.Vector.add(n,s),p5.Vector.sub(n,s),p5.Vector.sub(l,s)];Cl({pg:t,pts:c,baseX:r,baseY:o,col:kr(g,b*.9,V,C),randomOffset:.3})}}function z(e,l){if(!V||random(0,1)>=C)return;const{Pos0_0:n,Pos0_1:a,Pos1_1:s,Pos1_0:c}=e;const i=[n,a,s,c];const p=createVector((n.x+a.x+s.x+c.x)/4,(n.y+a.y+s.y+c.y)/4);const h=i.reduce(((e,t)=>e+p5.Vector.dist(p,t)),0)/4;const f=h*E*random(.3,.7);const d=createVector(random(-h,h)*.3,random(-h,h)*.3);const m=p5.Vector.add(p,d);const u=floor(random(8,16));const g=[];for(let e=0;e<u;e++){const t=e/u*TWO_PI;const r=noise(e*.3)*.5+.5;const o=map(r,0,1,.7,1.3);const l=f*o;g.push(createVector(m.x+cos(t)*l,m.y+sin(t)*l))}const{h:b,s:y,b:x,alpha:F}=l;const P=x*(.3-T*.2);const w=F*.95;Cl({pg:t,pts:g,baseX:r,baseY:o,col:kr(b,y*.9,P,w),randomOffset:.2});const D=f*.15;for(let e=0;e<u;e++){const l=g[e];const n=g[(e+1)%u];const a=p5.Vector.sub(l,m);a.setMag(D);const s=p5.Vector.add(l,a);const c=p5.Vector.add(n,p5.Vector.sub(n,m).setMag(D));Cl({pg:t,pts:[l,n,c,s],baseX:r,baseY:o,col:kr(b,y*.9,lerp(P,x,.3),w),randomOffset:.3})}const A=floor(random(3,8));for(let e=0;e<A;e++){const e=random(TWO_PI);const dist=random(f*.1,f*.7);const l=createVector(m.x+cos(e)*dist,m.y+sin(e)*dist);const n=f*random(.05,.15);const a=floor(random(5,8));const s=[];for(let e=0;e<a;e++){const t=e/a*TWO_PI;const r=n*random(.8,1.2);s.push(createVector(l.x+cos(t)*r,l.y+sin(t)*r))}Cl({pg:t,pts:s,baseX:r,baseY:o,col:kr(b,y*.9,P*.7,w),randomOffset:.1})}}let R=zt.colors.stroke[0];let v=zt.colors.stroke[1];let _=e=>(.6*(1-e)*map(noise(e*10),0,1,.5,1)+.5)*h*ge;let N=Tr(10,15);if(g==0)N=Tr(1,4);const H=[];let G=.5;for(let e=0;e<N;e++){const t=.2+.8/(N-1)*e;let r;const line=[];for(let e=0;e<W.length;e++){let o=e/(W.length-1);r=t+map(noise(e*.1),0,1,-.2,.1);let l;if(o<=.48){let t=o<=.02?1:1-(o-.02)/(.48-.02);t*=b;let n=Yr(W[e],k[e],r);let a=createVector(lerp(W[e].x,k[e].x,r),lerp(W[e].y,k[e].y,r));let s=(W[e].x+k[e].x)/2;let c=(W[e].y+k[e].y)/2;l=createVector(lerp(a.x,n.x,t),lerp(a.y,n.y,t));if(o>.02&&o<.48){let e=1+.2*b*(1-(o-.02)/(.48-.02));l=createVector(s+(l.x-s)*e,c+(l.y-c)*e)}}else if(o>=.52){let t=o>=.98?-1:-(o-.52)/(.98-.52);t*=b;let n=Yr(k[e],W[e],1-r);let a=createVector(lerp(W[e].x,k[e].x,r),lerp(W[e].y,k[e].y,r));let s=(W[e].x+k[e].x)/2;let c=(W[e].y+k[e].y)/2;l=createVector(lerp(a.x,n.x,-t),lerp(a.y,n.y,-t));if(o>.52&&o<.98){let e=1+.2*b*((o-.52)/(.98-.52));l=createVector(s+(l.x-s)*e,c+(l.y-c)*e)}}else{l=createVector(lerp(W[e].x,k[e].x,r),lerp(W[e].y,k[e].y,r))}line.push(l)}H.push(line)}H.forEach(((line,e)=>{for(let l=0;l<line.length-1;l++){let n=line[l];let a=line[l+1];if(l%100==0)G=random(.1,.5);const s=l>line.length-5?.9:.6;if(noise(l*10+e*1e3)<s){let e=createVector(n.x,n.y);let l=createVector(a.x,a.y);let s=[];for(let t=0;t<=4;t++){let r=t/4;let o=lerp(e.x,l.x,r);let n=lerp(e.y,l.y,r);s.push(createVector(o,n))}El({pg:t,pts:s,baseX:r,baseY:o,col:kr(v[0],v[1],v[2],1),branchWidthFunc:e=>_(e)*G,randomOffset:0})}}}));El({pg:t,pts:W.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-p,p);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-p,p);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(R[0],R[1],R[2],1),branchWidthFunc:_,randomOffset:.5});El({pg:t,pts:k.map((e=>{let t=map(noise(e.x*U,e.y*U),0,1,-p,p);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-p,p);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(R[0],R[1],R[2],1),branchWidthFunc:_,randomOffset:.5});let $=[];let q=s*2;let J=createVector((W[0].x+k[0].x)/2,(W[0].y+k[0].y)/2);for(let e=0;e<=q;e++){let t=e/q;let r=Yr(W[0],k[0],t);let o=1*b;r=createVector(J.x+(r.x-J.x)*o,J.y+(r.y-J.y)*o);let l=map(noise(r.x*.1,r.y*.1),0,1,-p*.5,p*.5);let n=map(noise(r.y*.1,r.x*.1),0,1,-p*.5,p*.5);r.x+=l;r.y+=n;$.push(r)}El({pg:t,pts:$,baseX:r,baseY:o,col:kr(R[0],R[1],R[2],1),branchWidthFunc:_,randomOffset:.5});let j=[];let K=s*2;let Q=createVector((W[W.length-1].x+k[k.length-1].x)/2,(W[W.length-1].y+k[k.length-1].y)/2);for(let e=0;e<=K;e++){let t=e/K;let r=Yr(k[k.length-1],W[W.length-1],t);let o=1*b;r=createVector(Q.x+(r.x-Q.x)*o,Q.y+(r.y-Q.y)*o);let l=map(noise(r.x*.1,r.y*.1),0,1,-p*.5,p*.5);let n=map(noise(r.y*.1,r.x*.1),0,1,-p*.5,p*.5);r.x+=l;r.y+=n;j.push(r)}El({pg:t,pts:j,baseX:r,baseY:o,col:kr(R[0],R[1],R[2],1),branchWidthFunc:_,randomOffset:.5});if(random(0,1)>.3){let e=Dr([3,3,6,12,20,40]);for(let t=0;t<e;t++){let e=floor(random(1,L.length-2));let t=random(0,1);let l=t<.33?"left":t<.66?"middle":"right";let n;if(l==="left"){n=W[e]}else if(l==="right"){n=k[e]}else{n=createVector((W[e].x+k[e].x)/2,(W[e].y+k[e].y)/2)}let a=p5.Vector.dist(W[e],k[e]);let s=a*random(.05,.15);let c=[];if(e>=5){let t;if(l==="left"){t=W[e-5]}else if(l==="right"){t=k[e-5]}else{t=createVector((W[e-5].x+k[e-5].x)/2,(W[e-5].y+k[e-5].y)/2)}c.push([t.x,t.y])}else{c.push([n.x,n.y+5])}c.push([n.x,n.y]);if(e<L.length-5){let t;if(l==="left"){t=W[e+5]}else if(l==="right"){t=k[e+5]}else{t=createVector((W[e+5].x+k[e+5].x)/2,(W[e+5].y+k[e+5].y)/2)}c.push([t.x,t.y])}else{c.push([n.x,n.y-5])}let i=random(.1,.3);let p=random(0,1)>.7?pgL1:pgL0;F.drawSpike({pg:p,baseX:n.x+r,baseY:n.y+o,meta:zt,baseWidth:s,stemPoints:c,branchLengthScale:i})}}if(g===1){let e=e=>{let t=i(e);return createVector(t.x*random(.8,1.2),t.y*random(.8,1.2),0)};let g=random(.1,.3);let y=e=>c(e)*g;let V=n*random(.1,.3);if(random(0,1)<.8){let n=floor(random(1,L.length-2));let c=L[n];let i=W[n];let g=k[n];let C=Dr([.1,.9]);let E=r+lerp(i.x,g.x,C);let T=o+lerp(i.y,g.y,C);let D=l.x+random(-PI/2,PI/2);let A=l.y+random(-PI/2,PI/2);let I=l.z+random(-PI/2,PI/2);let S=createVector(D,A,I);let B=random(0,1)<.3;F.wood({pg:t,baseX:E,baseY:T,baseRotation:S,branchLength:V,branchSegments:max(10,floor(a*.5)),branchSegmentsH:max(3,floor(s*.7)),branchWidthFunc:y,branchBendFunc:e,pointShift:p*.5,strokeStrength:h*.5,strokeNoiseScale:f,lineSegScale:d,lineLimit:m,col:u,depth:0,convexConcaveStrength:b*.8,forceHorizontal:B,enableCracks:x,crackDensity:P,crackDepth:w})}g=random(.2,.4);y=e=>c(e)*g;V=n*random(.2,.4);if(random(0,1)<.5){let n=floor(random(1,L.length-2));let c=W[n];let i=k[n];let g=Dr([.1,.9]);let C=r+lerp(c.x,i.x,g);let E=o+lerp(c.y,i.y,g);let T=l.x+random(-PI/2,PI/2);let D=l.y+random(-PI/2,PI/2);let A=l.z+random(-PI/2,PI/2);let I=createVector(T,D,A);let S=random(0,1)<.3;F.wood({pg:t,baseX:C,baseY:E,baseRotation:I,branchLength:V,branchSegments:max(10,floor(a*.5)),branchSegmentsH:max(3,floor(s*.7)),branchWidthFunc:y,branchBendFunc:e,pointShift:p*.5,strokeStrength:h*.5,strokeNoiseScale:f,lineSegScale:d,lineLimit:m,col:u,depth:0,convexConcaveStrength:b*.8,forceHorizontal:S,enableCracks:x,crackDensity:P,crackDepth:w})}}}}class P{static heart(e={}){let{pg:t,meta:r,baseX:o=0,baseY:l=0,size:n=random(5,20),branchSegments:a=Tr(30,45),baseRotation:s=createVector(PI/2,0,0),branchSegmentsH:c=Tr(4,8),pointShift:i=2,strokeStrength:p=1,strokeNoiseScale:h=1,shapeVariation:f=random(.8,1.2),asymmetry:d=random(-.2,.2),col:m=[90,.2,.3],col2:u=[90,.2,.3],specID:g=0}=e;g=random(0,1)<.8?0:1;let b=wr(Nt);p=p+b.random(0,1)*2;i=10*be;a=30;t.push();let y=[];let x=random(TWO_PI);let F=random(.8,2);let w=random(.8,2);for(let e=0;e<=a;e++){let t=e/a;let r=map(t,0,1,-6,6);let o=2*(r*r+abs(r)-6)*f;let l=3*(r*r+abs(r)+2);let c=o/l;let i=c+sqrt(36-r*r)*(1+d*sin(r));r=r*n*F;i=-i*n*w;let p=createVector(r,i,0);p=yr.applyEulerRotation(p,s);y.push(p)}for(let e=a;e>=0;e--){let t=e/a;let r=map(t,0,1,-6,6);let o=2*(r*r+abs(r)-6)*f;let l=3*(r*r+abs(r)+2);let c=o/l;let i=c-sqrt(36-r*r)*(1+d*sin(r));r=r*n*F;i=-i*n;let p=createVector(r,i,0);p=yr.applyEulerRotation(p,s);y.push(p)}let V=-n*7;let C=createVector(0,V,0);C=yr.applyEulerRotation(C,s);y=y.map((e=>p5.Vector.add(e,C)));let E=[];for(let e=0;e<c;e++){let t=e/(c-1);let r=y.map((e=>p5.Vector.lerp(e,p5.Vector.add(createVector(0,0),C),t)));E.push(r)}let T=random(.8,1.05);let D=Ar(.3,.6);let A=random(0,1)<.5?3:1;let I=0;if(g==0){T=random(.65,.75)+random(-.05,.05);I=1}else if(g==1){T=Dr([1.2,1.2,1.5])+random(-.05,.05);I=.7}for(let e=0;e<E.length-1;e++){let r=E[e];let n=E[e+1];let a=e/(E.length-1);for(let e=0;e<r.length-1;e++){let s=r[e];let c=atan2(s.y,s.x);let i=1-lerp(sin(c)*a,a,a);i+=map(noise(c*20,a*20),0,1,.1,.4);let p=pow(fract(i*A),3);let h=map(p*.5,0,1,.7,1.1);let f=m[0]*h;let d=m[1];let u=m[2]*T;Cl({pg:t,pts:[r[e],r[min(e+2,r.length-1)],n[min(e+2,n.length-1)],n[e]],baseX:o,baseY:l,col:kr(f,d,u,D),randomOffset:1})}}let L=zt.colors.stroke[0];if(de==0)L=zt.colors.stroke[2];let S=zt.colors.stroke[1];let B=y.slice(y.length/4,y.length/4*3).reverse();let W=y.slice(y.length/4*3,y.length-1).concat(y.slice(0,y.length/4+1));let k=y[floor(y.length/4*3)];let X=y[floor(y.length/4)];let Y=[];for(let e=0;e<=30;e++){let t=e/31;let r=p5.Vector.lerp(k,X,t);Y.push(r)}El({pg:t,pts:B.map((e=>{let t=map(noise(e.x*h,e.y*h),0,1,-i,i);let r=map(noise(e.y*h,e.x*h),0,1,-i,i);return createVector(e.x+t,e.y+r)})),baseX:o,baseY:l,col:kr(L[0],L[1],L[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*2*ge,randomOffset:1});El({pg:t,pts:W.map((e=>{let t=map(noise(e.x*h,e.y*h),0,1,-i,i);let r=map(noise(e.y*h,e.x*h),0,1,-i,i);return createVector(e.x+t,e.y+r)})),baseX:o,baseY:l,col:kr(L[0],L[1],L[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*2*ge,randomOffset:1});P.drawLeafVeins({pg:t,baseX:o,baseY:l,debug:true,veinsType:zt.veinsType2,centerPos:Y,leftPos:W,rightPos:B,col:kr(L[0],L[1],L[2],1),col2:zt.colors.flower[1],strokeStrength:.5,specID:g});Pl({pg:pgText,pts:Y,baseX:o,baseY:l});t.pop()}static lotus(e={}){let{pg:t,meta:r,baseX:o=0,baseY:l=0,size:n=random(5,20),branchSegments:a=Tr(30,45),baseRotation:s=createVector(PI/2,0,0),branchSegmentsH:c=Tr(4,8),pointShift:i=2,strokeStrength:p=.8,strokeNoiseScale:h=1,shapeVariation:f=random(.8,1.2),asymmetry:d=random(-.2,.2),col:m=[90,.2,.3]}=e;let u=wr(Nt);p=p+u.random(0,1)*2;i=10*be;a=60;t.push();let g=[];let b=random(TWO_PI);let y=random(.9,1.1);let x=random(.9,1.1);for(let e=0;e<=a;e++){let t=map(e,0,a,0,TWO_PI);let r=n*(1+.05*sin(t*6)+.03*sin(t*10));if(t>PI*.8&&t<PI*1.2){let e=map(t,PI*.8,PI*1.2,0,1,true);let o=e*e*(3-2*e);r*=map(o,0,1,1,.8,true)}let o=cos(t)*r*y;let l=sin(t)*r*x;l-=n*.2;let c=createVector(o,l,0);c=yr.applyEulerRotation(c,s);g.push(c)}let F=0;let P=-n*.2;let w=createVector(F,P,0);w=yr.applyEulerRotation(w,s);let V=[];for(let e=0;e<c;e++){let t=e/(c-1);let r=g.map((e=>{let r=t*t*(3-2*t);return p5.Vector.lerp(e,w,r)}));V.push(r)}let C=random(.5,1);for(let e=0;e<V.length-1;e++){let r=V[e];let n=V[e+1];let a=e/(V.length-1);for(let e=0;e<r.length-1;e++){let a=r[e];let s=atan2(a.y-w.y,a.x-w.x);let c=m[0];let i=m[1];let p=m[2];Cl({pg:t,pts:[r[e],r[min(e+1,r.length-1)],n[min(e+1,n.length-1)],n[e]],baseX:o,baseY:l,col:kr(c,i,p*C,1),randomOffset:1})}}let E=zt.colors.stroke[0];if(de==0)E=zt.colors.stroke[2];El({pg:t,pts:g.map((e=>{let t=map(noise(e.x*h,e.y*h),0,1,-i,i);let r=map(noise(e.y*h,e.x*h),0,1,-i,i);return createVector(e.x+t,e.y+r)})),baseX:o,baseY:l,col:kr(E[0],E[1],E[2],1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*1.5*ge,randomOffset:1});let T=floor(random(8,12));let D=zt.colors.stroke[1];for(let e=0;e<T;e++){let r=map(e,0,T,0,TWO_PI);let a=0;let s=TWO_PI;for(let e=0;e<g.length;e++){let t=g[e];let o=atan2(t.y-w.y,t.x-w.x);let l=abs((o-r+TWO_PI)%TWO_PI-PI);if(l<s){s=l;a=e}}let c=g[a];let i=[];let p=floor(random(15,20));i.push(createVector(w.x,w.y,0));for(let e=1;e<=p;e++){let t=e/p;let o=t*(1+.15*sin(r*2)*(1-t));let l=noise(r*10,t*5)*.08*t*t;let a=-sin(r)*n*l;let s=cos(r)*n*l;let h=lerp(w.x,c.x,o)+a;let f=lerp(w.y,c.y,o)+s;i.push(createVector(h,f,0))}El({pg:t,pts:i,baseX:o,baseY:l,col:kr(D[0],D[1],D[2]*.9,1),branchWidthFunc:e=>(.3*(1-e)+.3)*ge,randomOffset:.3})}t.pop()}static drawLeaf(e={}){let{pg:t,baseX:r=0,baseY:l=0,meta:n,angle:a=0,baseRotation:s,dir:i=0,open:p=0,finalNode:h=1,specID:f=0,lengthProgress:d=0}=e;let m;let u;if(f==0)u=map(d,Xt,1,constrain(a,-1,0),-1.57);else u=map(d,Xt,1,constrain(a,3.4,5),5);if(i==0){m=createVector(s.x+random(-.5,.5),s.y+random(.2,.5),s.z+a+random(-.05,.05))}else if(i==1){m=createVector(s.x+p,s.y+a,s.z+random(-.2,.2))}if(o==1){m=createVector(s.x,s.y,s.z+random(-.2,.2))}else if(o==2){m=createVector(s.x+random(-.3,.3),s.y+random(.2,.5),s.z+u)}let g=Dr([2,2,2.5])*map(d,Xt,1,1,0);let b=n.leafLength*random(.05,.1)*N*h;let y=random(.8,1.2)*M;if(o==2)b=30,y=1.2;let x=F.stem({pg:t,baseX:r,baseY:l,baseRotation:m,branchLength:b,col:n.branchColor,branchWidthFunc:e=>y,branchBendFunc:e=>createVector(.2,.2,0)});if(o==0){let e=F.stem({pg:t,baseX:r,baseY:l,baseRotation:m,branchLength:random(5,10),col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2)*M*1.5,branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0})}let w=floor(x.centerPos.length*.6);let V=x.centerPos[w].x;let C=x.centerPos[w].y;let E=[];let T=random(0,1)>.5?floor(random(5,15)):0;if(o==2)T=0;for(let e=0;e<T;e++){E.push({position:random(.1,.9),isRight:random(0,1)>.5,depth:random(.2,1.1)})}let D,A;if(o==1){A=e=>.5*(1-pow(2*e-1,2))*10*M;D=e=>createVector(random(-.2,.2),random(-1,1),0)}else if(o==2){A=e=>n.leafShape(e)*h*n.leafWidth+.5*pow(1-e,3);D=e=>createVector(random(-.2,.2),random(-.1,.1),0)}else{A=e=>n.leafShape(e)*h*n.leafWidth+.5*pow(1-e,3);D=e=>createVector(map(noise(e*1,PI),0,1,-1,1)*g*2*M,map(noise(e*2,PI+PI),0,1,-1,1)*g*M,map(noise(e*3,PI+PI+PI),0,1,-1,1)*g*2*M)}let I=P.leaf({pg:t,veinsType:n.veinsType,baseX:r+V,baseY:l+C,branchLength:n.leafLength*random(.8,1.2)*h,col:n.leafColorA,col2:n.leafColorB,colorFunction:n.leafColorFn,branchSegments:32,baseRotation:m,notches:E,strokeStrength:.5,specID:f,branchWidthFunc:A,branchBendFunc:D});let L=I.x;let S=I.y;if(c==1){pgText.noStroke();pgText.push();pgText.translate(V+r,C+l);pgText.fill(0,1,1,1);pgText.ellipse(0,0,5);pgText.pop();pgText.push();pgText.translate(L+r,S+l);pgText.fill(120,1,1,1);pgText.ellipse(0,0,5);pgText.text(`${m.x.toFixed(2)}, ${m.y.toFixed(2)}, ${m.z.toFixed(2)}`,0,0);pgText.pop();pgText.push();let e=L+r-(V+r);let t=S+l-(C+l);let o=Math.atan2(t,e)*180/Math.PI;if(o>=45&&o<=135){pgText.stroke(0,1,1,1)}else{pgText.stroke(120,1,1,1)}pgText.line(V+r,C+l,L+r,S+l);pgText.pop()}return I}static drawHeart(e={}){let{pg:t,baseX:r=0,baseY:o=0,meta:l,angle:n=0,baseRotation:a=createVector(PI/2,0,0),dir:s=2}=e;let c;if(s==0){c=createVector(random(-1,1)*PI,random(-1,1)*PI,n)}else if(s==1){c=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1)+n,a.z)}else if(s==2){c=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1),a.z+n)}let i=Dr([2,2,2.5,3]);let p=F.stem({pg:t,baseX:r,baseY:o,baseRotation:c,branchLength:l.leafLength*random(.2,.5)*N,col:l.branchColor,branchWidthFunc:e=>random(.8,1.2)*M,branchBendFunc:e=>createVector(random(-1,1),random(-1,1),0)});let h=F.stem({pg:pgL0,baseX:r,baseY:o,baseRotation:c,branchLength:random(5,10),col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2)*M*1.5,branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let f=p.centerPos[p.centerPos.length-3].x;let d=p.centerPos[p.centerPos.length-3].y;let m=random(-.5,.5);let u=random(-.5,.5);let g=random(-.5,.5);P.heart({pg:pgL2,baseX:r+f,baseY:o+d,size:l.leafHeartSize*random(.5,1),branchSegmentsH:Tr(8,12),branchSegments:24,baseRotation:createVector(c.x+1.05+m,c.y+1+u,c.z+3.14+g),col:l.leafColorA,col2:l.leafColorB})}static drawLotus(e={}){let{pg:t,baseX:r=0,baseY:o=0,meta:l,angle:n=0,baseRotation:a=createVector(PI/2,0,0),dir:s=2}=e;let c;if(s==0){c=createVector(random(-1,1)*PI,random(-1,1)*PI,n)}else if(s==1){c=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1)+n,a.z)}else if(s==2){c=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1),a.z+n)}let i=Dr([2,2,2.5,3]);let p=F.stem({pg:t,baseX:r,baseY:o,baseRotation:c,branchLength:l.leafLength*random(.2,.5)*N,col:l.branchColor,branchWidthFunc:e=>random(.8,1.2)*M,branchBendFunc:e=>createVector(random(-1,1),random(-1,1),0)});let h=F.stem({pg:pgL0,baseX:r,baseY:o,baseRotation:c,branchLength:random(5,10),col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2)*M*1.5,branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let f=p.centerPos[p.centerPos.length-3].x;let d=p.centerPos[p.centerPos.length-3].y;lotus({pg:pgL2,baseX:r+f,baseY:o+d,size:100*random(.8,1.1),branchSegmentsH:3,branchSegments:24,baseRotation:createVector(random(1.8,2.2),random(-.1,.1),random(-.1,.1)),col:l.leafColorA,col2:l.leafColorB})}static addLeaf(e,t,r,l,n="normal",a){if(n==="final"){r.PT.leafGrowType=random(0,1)>.3?ur:dr;if(o==2)r.PT.leafGrowType=dr;if(o==1)r.PT.leafGrowType=mr}switch(r.PT.leafGrowType){case dr:P.selLeaf({pg:pgL1,baseX:e,baseY:t,meta:r.PT,angle:.5,baseRotation:createVector(PI/2+1,PI-1,l),dir:0,specID:0,lengthProgress:a});P.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:r.PT,angle:PI-.5,baseRotation:createVector(PI/2+1,-1,l),dir:0,specID:1,lengthProgress:a});r.PT.leafCount+=2;break;case ur:let o=TWO_PI/Ge;let s=random(.1,1.3);let c=n==="final"?Dr([.3,.3,.5,.7,1,1.2]):1;for(let n=0;n<Ge;n++){P.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:r.PT,angle:n*o+s,baseRotation:createVector(PI/2,0,l+PI/2),dir:1,open:s,finalNode:c,relativePosition:a})}r.PT.leafCount+=Ge;break;case mr:let i=random(-.2,.2);Et=(Et+1)%2;if(Et==0){P.selLeaf({pg:pgL1,baseX:e,baseY:t,meta:r.PT,angle:i,baseRotation:createVector(PI/2+1,PI-1,l),dir:0,specID:0,lengthProgress:a})}else{P.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:r.PT,angle:PI+i,baseRotation:createVector(PI/2+1,-1,l),dir:0,specID:1,lengthProgress:a})}r.PT.leafCount+=1;break}}static selLeaf(e={}){let{pg:t,baseX:r=0,baseY:o=0,meta:l,angle:n=0,baseRotation:a,dir:s=0,finalNode:c=1,relativePosition:i=0,specID:p=0,lengthProgress:h=0}=e;if(He==0){P.drawLeaf(e)}else if(He==1){rt=0;P.drawHeart(e)}else if(He==2){P.drawLotus(e)}else if(He==3){P.drawPlam(e)}}static drawPlam(e={}){let{pg:t=pgL0,baseX:r=0,baseY:o=0,meta:l,angle:n=0,baseRotation:a,dir:s=0,open:c=0,finalNode:i=1,relativePosition:p=0}=e;let h;t=pgL0;if(!a){console.error("drawPlam: baseRotation is undefined");a=createVector(PI/2,0,0)}h=createVector(a.x+c,a.y+n,a.z+random(-.2,.2));let f=max(200,l.leafLength*random(1.5,2)*N*i);if(isNaN(f))f=100;let d=map(p,0,1,1,2);se=[1,1];let m=F.stem({pg:t,baseX:r,baseY:o,baseRotation:h,branchLength:f,col:l.branchColor,branchWidthFunc:e=>(1.2-e*.5)*M,branchBendFunc:e=>createVector(d+random(-.2,.2),0,0)});let u=m.centerPos;let g=u.length;let b=Tr(12,18);let y=f*.6;let x=.15;let w=.92;let V=Dr([-1,-2,-1.5]);for(let e=0;e<b;e++){let n=map(e,0,b-1,x,w);let a=floor(n*g);if(a>=u.length)continue;let s=map(n,x,w,PI/8,PI/2.2);let c=-s+random(-.1,.1);let i=createVector(h.x+random(-.1,.1),h.y+c,h.z+random(-.1,.1));let p=s+random(-.1,.1);let f=createVector(h.x+random(-.1,.1),h.y+p,h.z+random(-.1,.1));let d=t=>{let r=map(noise(e*100,t*10),0,1,-.8,.8);let o=map(noise(e*200,t*10),0,1,-.6,0);let l=map(noise(e*300,t*10),0,1,-.3,.3);return createVector(r,o,l)};se=[1,1];let m=random(1,2);let F=random(1,2);let C=0;let E=e=>{const t=0;const r=.6;const o=1;let l=20;if(e<=r){return.3*M*l}else{return map(e,r,o,.3,0)*M*l}};P.leaf({pg:t,baseX:r+u[a].x,baseY:o+u[a].y,branchLength:y*(1-n*.6),col:l.leafColorA,col2:l.leafColorB,baseRotation:createVector(i.x*V,i.y*1,i.z),branchWidthFunc:E,branchBendFunc:e=>createVector(m,F,C)});P.leaf({pg:t,baseX:r+u[a].x,baseY:o+u[a].y,branchLength:y*(1-n*.6),col:l.leafColorA,col2:l.leafColorB,baseRotation:createVector(f.x*-1,f.y*1,f.z),branchWidthFunc:E,branchBendFunc:e=>createVector(m,F,C)})}}static leaf(e={}){let{pg:t=pgL3,baseX:r=0,baseY:l=0,baseRotation:n=createVector(PI/2,0,0),branchLength:a=400,branchSegments:s=20,veinsType:c=[0,0],notches:i=[],branchWidthFunc:p=e=>40,colorFunction:h=e=>e,branchBendFunc:f=e=>createVector(random(-10,10),0,random(-5,5)),pointShift:d=.5,strokeStrength:m=.8,strokeNoiseScale:u=10,col:g=[90,.2,.3],col2:b=[90,.2,.3],specID:y=0}=e;y=random(0,1)<.8?0:1;let x=wr(Nt);m=m+x.random(0,1)*2;d=5*be;s=constrain(floor(map(a,50,300,20,60)),20,60);s=max(5,floor(s*G));let F=createVector(0,0,0);let w=createVector(0,0,0);let V=[F.copy()];let C=[w.copy()];let E=[];let T=[];let D=e=>yr.applyEulerRotation(e,n);let A=(e,t)=>{let r=p(e);for(let o of i){let l=abs(e-o.position);if(l<.05){if(t==="right"&&o.isRight&&e>o.position||t==="left"&&!o.isRight&&e<o.position){let e=30;let t=pow(1-l/.3,e)*o.depth;return r*(1-t)}}}return r};let I=random(.2,3);let L=random(0,1)>.3?1:0;let S=random(.8,1);let B=1;let W=.5;let k=Ar(.6,.9);if(o==2)k=1,S=random(.7,1.1),W=0;if(y==0){S=random(.65,.75)+random(-.05,.05);B=1}else if(y==1){S=Dr([1.2,1.2,1.5])+random(-.05,.05);B=.7}let X=random(0,1)>.9?5:1;if(o==2)X=1;for(let e=0;e<s;e++){let o=e/(s-1);let n=f(o);w=p5.Vector.add(w,p5.Vector.mult(n,1/s));let c=yr.applyEulerRotation(createVector(0,0,a/s),w);F=p5.Vector.add(F,D(c));let i=A(o,"left");let p=A(o,"right");let h=yr.applyEulerRotation(createVector(-i,0,0),w);let d=yr.applyEulerRotation(createVector(p,0,0),w);let m=p5.Vector.add(F,D(h));let u=p5.Vector.add(F,D(d));E.push(m.copy());T.push(u.copy());let x=0,P=0,I=0;if(qe==1){let e=pow(1-o,2);if(y==1)e=pow(1-o,10);x=lerp(Number(g[0]),Number(b[0]),fract(e*X));P=Number(g[1])*B;I=lerp(Number(g[2]),Number(b[2])*.7,e)*S}else{if(L==1){x=g[0];P=g[1];I=g[2]*S}else{x=g[0];P=g[1];I=g[2]}}if(e<=0){if(E[0]&&E[1]&&T[1]&&T[0]&&rt==0){Cl({pg:t,pts:[E[0],E[1],T[1],T[0]],baseX:r,baseY:l,col:kr(x,P,I,k),randomOffset:W,vertexMode:rt,show:0})}}else{let o=e-1;if(E[e]&&E[o]&&V[o]&&V[e]){Cl({pg:t,pts:[E[e],E[o],V[o],V[e]],baseX:r,baseY:l,col:kr(x,P,I,k),randomOffset:W,vertexMode:rt})}if(T[e]&&T[o]&&V[o]&&V[e]){Cl({pg:t,pts:[T[e],T[o],V[o],V[e]],baseX:r,baseY:l,col:kr(x,P,I,k),randomOffset:W,vertexMode:rt})}}V.push(F.copy());C.push(w.copy())}let Y=zt.colors.stroke[0];if(de==0)Y=zt.colors.stroke[2];let O=zt.colors.stroke[1];let z=e=>{const t=.2;const r=-.35;const o=(noise(e*t,Tr(0,100)*.05)+r)*3*ge;return o>.5?o:random(0,1)>.7?0:0};let R=e=>(.2*(1-e)*map(noise(e*u),0,1,.5,1)+.3)*m*ge;let v=Dr([z,R]);if(ot==1)v=R;else if(ot==2)v=z;if(o==1||o==2){v=e=>.5;d=0;u=0}if(rt==0){El({pg:t,pts:E.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let r=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,col:kr(Y[0],Y[1],Y[2],1),branchWidthFunc:v,randomOffset:W});El({pg:t,pts:T.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let r=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,col:kr(Y[0],Y[1],Y[2],1),branchWidthFunc:v,randomOffset:W});El({pg:t,pts:[E[0],createVector(0,0)],baseX:r,baseY:l,col:kr(Y[0],Y[1],Y[2],1),branchWidthFunc:v,randomOffset:W});El({pg:t,pts:[T[0],createVector(0,0)],baseX:r,baseY:l,col:kr(Y[0],Y[1],Y[2],1),branchWidthFunc:v,randomOffset:W});El({pg:t,pts:[E[0],E[2]],baseX:r,baseY:l,col:kr(Y[0],Y[1],Y[2],1),branchWidthFunc:v,randomOffset:W});El({pg:t,pts:[T[0],T[2]],baseX:r,baseY:l,col:kr(Y[0],Y[1],Y[2],1),branchWidthFunc:v,randomOffset:W})}if(o==0||o==2){P.drawLeafVeins({pg:t,baseX:r,baseY:l,veinsType:c,centerPos:V,leftPos:E,rightPos:T,col:kr(Y[0],Y[1],Y[2],1),col2:zt.colors.flower[1],strokeStrength:.5,specID:y})}Pl({pg:pgText,pts:V,baseX:r,baseY:l});return V[V.length-1]}static drawLeafVeins(e={}){let{pg:t,baseX:r,baseY:l,debug:n=false,veinsType:a=[3,2],centerPos:s,leftPos:c,rightPos:i,col:p,col2:h=zt.colors.flower[1],pointShift:f=.5,strokeStrength:d=1,strokeNoiseScale:m=10,pointMult:u=0,specID:g=0}=e;let b=wr(Nt);d=d+b.random(0,1)*3;f=1*be;u=1*be;p=[hue(p),saturation(p),brightness(p),alpha(p)];let y=zt.colors.leaf[0];let x;if(a[0]==0||a[0]==1||a[0]==2||a[0]==4||a[0]==10||a[0]==12){if(a[0]==2||a[0]==0)x=kr(p[0],p[1],p[2],.7);else x=kr(y[0],y[1],y[2]*10,1);let F=.1;let P=function(e){return(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*ge};let w=function(e){return(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge};if(o==2){if(g==1)x=kr(y[0],y[1],y[2]*10,.2);else if(g==0)x=kr(y[0],y[1],y[2]*10,.8);f=0;P=e=>1.35;w=e=>1.1}if(a[0]==12){El({pg:t,pts:s.slice(1).map((e=>{let t=map(b.noise(e.x*F,e.y*F),0,1,-f,f);let r=map(b.noise(e.y*F,e.x*F),0,1,-f,f);return createVector(e.x+t+1,e.y+r)})),baseX:r,baseY:l,col:kr(p[0],p[1],p[2],.3),branchWidthFunc:P,randomOffset:.2,forceBrush:1})}El({pg:t,pts:s.slice(1).map((e=>{let t=map(b.noise(e.x*F,e.y*F),0,1,-f,f);let r=map(b.noise(e.y*F,e.x*F),0,1,-f,f);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:l,col:x,branchWidthFunc:w,randomOffset:.2,forceBrush:1})}if(a[0]==0&&rt==0){let V;if(s.length>a[1]){V=floor(s.length/a[1])}else{V=floor(s.length/5)}for(let C=V;C<s.length-V;C+=V){let E=(C-V)/(s.length-2*V);let T=.1+.5*sin(E*PI);let D=.2+.2*sin(E*PI);let A=s[C];let I=p5.Vector.lerp(A,c[C+2],T);let L=p5.Vector.lerp(A,I,.5);L.add(Xr(b).mult(3));let S=[];let B=5;for(let Y=0;Y<=B;Y++){let O=Y/B;let z=pow(1-O,2)*A.x+2*(1-O)*O*L.x+pow(O,2)*I.x;let R=pow(1-O,2)*A.y+2*(1-O)*O*L.y+pow(O,2)*I.y;S.push(createVector(z,R).add(Xr(b).mult(.2)))}El({pg:t,pts:S,baseX:r,baseY:l,col:kr(y[0],y[1],y[2]*10.5,1),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*ge,randomOffset:.2,forceBrush:1});let W=p5.Vector.lerp(A,i[C+2],T);let k=p5.Vector.lerp(A,W,.5);k.add(Xr(b).mult(3));let X=[];for(let v=0;v<=B;v++){let _=v/B;let N=pow(1-_,2)*A.x+2*(1-_)*_*k.x+pow(_,2)*W.x;let M=pow(1-_,2)*A.y+2*(1-_)*_*k.y+pow(_,2)*W.y;X.push(createVector(N,M).add(Xr(b).mult(.2)))}El({pg:t,pts:X,baseX:r,baseY:l,col:kr(y[0],y[1],y[2]*10.5,1),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*ge,randomOffset:.2,forceBrush:1})}}else if(a[0]==1&&rt==0){for(let H=2;H<s.length-1;H++){for(let G=1;G<a[1];G++){let U=G/a[1];let $=p5.Vector.lerp(c[H-1],s[H-1],U);let q=p5.Vector.lerp(c[H],s[H],U);let J=p5.Vector.lerp(s[H-1],i[H-1],U);let j=p5.Vector.lerp(s[H],i[H],U);El({pg:t,pts:[J.add(Xr(b).mult(.4)),j.add(Xr(b).mult(.4))],baseX:r,baseY:l,col:kr(y[0],y[1],y[2]*10,.5),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:.5,forceBrush:1});El({pg:t,pts:[$.add(Xr(b).mult(.4)),q.add(Xr(b).mult(.4))],baseX:r,baseY:l,col:kr(y[0],y[1],y[2]*10,.5),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:.5,forceBrush:1})}}}else if(a[0]==2&&rt==0){let K=min(c.length,i.length,s.length);let Q=max(2,floor(K/(a[1]*2)));let Z=floor(s.length/8);for(let ee=Z;ee<s.length-Z;ee+=Q){let te=(ee-Z)/(s.length-2*Z);let re=.3+.4*sin(te*PI);let oe=s[ee];let le=p5.Vector.lerp(oe,c[ee],re);let ne=p5.Vector.lerp(oe,le,.5);let se=createVector(0,5*sin(te*PI),0);ne.add(se);ne.add(Xr(b).mult(2));let ce=[];let ie=5;for(let pe=0;pe<=ie;pe++){let he=pe/ie;let fe=pow(1-he,2)*oe.x+2*(1-he)*he*ne.x+pow(he,2)*le.x;let de=pow(1-he,2)*oe.y+2*(1-he)*he*ne.y+pow(he,2)*le.y;ce.push(createVector(fe,de).add(Xr(b).mult(.2)))}El({pg:t,pts:ce,baseX:r,baseY:l,col:kr(p[0],p[1],p[2],b.random(.2,1)),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*ge,randomOffset:.3,forceBrush:1});if(ee+Q/2<s.length-Z){let me=s[ee+floor(Q/2)];let ue=p5.Vector.lerp(me,i[ee+floor(Q/2)],re);let ye=p5.Vector.lerp(me,ue,.5);ye.add(se);ye.add(Xr(b).mult(2));let xe=[];for(let Fe=0;Fe<=ie;Fe++){let Pe=Fe/ie;let we=pow(1-Pe,2)*me.x+2*(1-Pe)*Pe*ye.x+pow(Pe,2)*ue.x;let Ve=pow(1-Pe,2)*me.y+2*(1-Pe)*Pe*ye.y+pow(Pe,2)*ue.y;xe.push(createVector(we,Ve).add(Xr(b).mult(.2)))}El({pg:t,pts:xe,baseX:r,baseY:l,col:kr(p[0],p[1],p[2],b.random(.2,1)),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*ge,randomOffset:.3,forceBrush:1})}}}else if(a[0]==3){for(let Ce=2;Ce<s.length-1;Ce++){for(let Te=1;Te<a[1];Te++){let De=Te/a[1];let Ae=p5.Vector.lerp(c[Ce-1],s[Ce-1],De);let Ie=p5.Vector.lerp(c[Ce],s[Ce],De);let Le=p5.Vector.lerp(s[Ce-1],i[Ce-1],De);let Se=p5.Vector.lerp(s[Ce],i[Ce],De);let Be=h[0];let We=h[1];let ke=h[2];Cl({pg:t,pts:[Ae,Ie,s[Ce],s[Ce-1]],baseX:r,baseY:l,col:kr(Be,We,ke,.6),randomOffset:.3,vertexMode:rt});Cl({pg:t,pts:[Le,Se,s[Ce],s[Ce-1]],baseX:r,baseY:l,col:kr(Be,We,ke,.6),randomOffset:.3,vertexMode:rt});El({pg:t,pts:[Le.copy().add(Xr(b).mult(u)),Se.copy().add(Xr(b).mult(u))],baseX:r,baseY:l,col:kr(p[0],p[1],p[2],1),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.2)*d*ge,randomOffset:.3,forceBrush:1});El({pg:t,pts:[Ae.copy().add(Xr(b).mult(u)),Ie.copy().add(Xr(b).mult(u))],baseX:r,baseY:l,col:kr(p[0],p[1],p[2],1),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.2)*d*ge,randomOffset:.3,forceBrush:1})}}}else if(a[0]==4){}else if(a[0]==5){let Xe=b.random(-.1,.1);for(let Ye=2;Ye<s.length-1;Ye++){for(let Oe=1;Oe<a[1];Oe++){let ze=Oe/a[1];let Re=2*abs(Ye/s.length-.5);let ve=p5.Vector.lerp(c[Ye-1],s[Ye-1],ze+Xe);let _e=p5.Vector.lerp(c[Ye],s[Ye],ze+Xe);let Ne=p5.Vector.lerp(s[Ye-1],i[Ye-1],ze+Xe);let Me=p5.Vector.lerp(s[Ye],i[Ye],ze+Xe);let He=lerp(zt.colors.leaf[0][0],p[0],Re);let Ge=lerp(zt.colors.leaf[0][1],p[1],Re);let Ue=lerp(zt.colors.leaf[0][2],p[2],Re);He=p[0];Ge=p[1];Ue=p[2];let $e=lerp(0,1,Re);Cl({pg:t,pts:[ve,_e,s[Ye],s[Ye-1]],baseX:r,baseY:l,col:kr(He,Ge,Ue,$e*.6),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[Ne,Me,s[Ye],s[Ye-1]],baseX:r,baseY:l,col:kr(He,Ge,Ue,$e*.6),randomOffset:1,vertexMode:rt})}}}else if(a[0]==6){let qe=b.random(.3,1);let Je=map(qe,.3,1,1.7,1);for(let je=2;je<s.length-1;je++){for(let Ke=1;Ke<a[1];Ke++){let Qe=Ke/a[1];let Ze=p5.Vector.lerp(c[je-1],s[je-1],Qe*qe);let et=p5.Vector.lerp(c[je],s[je],Qe*qe);let tt=p5.Vector.lerp(s[je-1],i[je-1],Qe*Je);let ot=p5.Vector.lerp(s[je],i[je],Qe*Je);let lt=h[0];let nt=h[1];let at=h[2];if(b.noise(je*.5,Ke*.5)>.6){lt=p[0];nt=p[1];at=p[2]}Cl({pg:t,pts:[Ze,et,s[je],s[je-1]],baseX:r,baseY:l,col:kr(lt,nt,at,.6),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[tt,ot,s[je],s[je-1]],baseX:r,baseY:l,col:kr(lt,nt,at,.6),randomOffset:1,vertexMode:rt})}}}else if(a[0]==7){for(let st=2;st<s.length-1;st++){for(let ct=1;ct<a[1];ct++){let it=ct/a[1];let pt=p5.Vector.lerp(c[st-1],s[st-1],it);let ht=p5.Vector.lerp(c[st],s[st],it);let ft=p5.Vector.lerp(s[st-1],i[st-1],it);let dt=p5.Vector.lerp(s[st],i[st],it);let mt=h[0];let ut=h[1];let gt=h[2];let bt=p[0];let yt=p[1];let xt=p[2];let Ft=p5.Vector.lerp(s[st-1],pt,.5);let Pt=p5.Vector.lerp(s[st],ht,.5);let wt=p5.Vector.lerp(s[st-1],ft,.5);let Vt=p5.Vector.lerp(s[st],dt,.5);Cl({pg:t,pts:[pt,ht,Pt,Ft],baseX:r,baseY:l,col:kr(mt,ut,gt,1),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[Ft,Pt,s[st],s[st-1]],baseX:r,baseY:l,col:kr(bt,yt,xt,1),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[ft,dt,Vt,wt],baseX:r,baseY:l,col:kr(mt,ut,gt,1),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[wt,Vt,s[st],s[st-1]],baseX:r,baseY:l,col:kr(bt,yt,xt,1),randomOffset:1,vertexMode:rt});El({pg:t,pts:[ft.copy().add(Xr(b).mult(u)),dt.copy().add(Xr(b).mult(u))],baseX:r,baseY:l,col:kr(p[0],p[1],p[2],p[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:1,forceBrush:1});El({pg:t,pts:[pt.copy().add(Xr(b).mult(u)),ht.copy().add(Xr(b).mult(u))],baseX:r,baseY:l,col:kr(p[0],p[1],p[2],p[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:1,forceBrush:1});El({pg:t,pts:[wt.copy().add(Xr(b).mult(u)),Vt.copy().add(Xr(b).mult(u))],baseX:r,baseY:l,col:kr(p[0],p[1],p[2],p[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:1,forceBrush:1});El({pg:t,pts:[Ft.copy().add(Xr(b).mult(u)),Pt.copy().add(Xr(b).mult(u))],baseX:r,baseY:l,col:kr(p[0],p[1],p[2],p[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:1,forceBrush:1})}}}else if(a[0]==8){let Ct=a[1];let Et=b.random(.1,.35);for(let Tt=2;Tt<s.length-1;Tt++){if(Tt%Ct==0){for(let Dt=1;Dt<6;Dt++){let At=Dt/6;let It=p5.Vector.lerp(c[Tt-1],s[Tt-1],At);let Lt=p5.Vector.lerp(c[Tt],s[Tt],At);let St=p5.Vector.lerp(s[Tt-1],i[Tt-1],At);let Bt=p5.Vector.lerp(s[Tt],i[Tt],At);let Wt=h[0];let kt=h[1];let Xt=h[2];let Yt=p[0];let Ot=p[1];let Rt=p[2];let vt=p5.Vector.lerp(It,Lt,.5);let _t=p5.Vector.lerp(St,Bt,.5);let Mt=p5.Vector.lerp(s[Tt-1],s[Tt],Et);let Ht=p5.Vector.lerp(s[Tt-1],s[Tt],1-Et);Cl({pg:t,pts:[It,vt,Mt,s[Tt-1]],baseX:r,baseY:l,col:kr(Wt,kt,Xt,1),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[St,_t,Mt,s[Tt-1]],baseX:r,baseY:l,col:kr(Wt,kt,Xt,1),randomOffset:1});Cl({pg:t,pts:[vt,Mt,Ht,Lt],baseX:r,baseY:l,col:kr(Yt,Ot,Rt,1),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[_t,Mt,Ht,Bt],baseX:r,baseY:l,col:kr(Yt,Ot,Rt,1),randomOffset:1,vertexMode:rt})}}}}else if(a[0]==9){let Gt=b.random(.3,.7);for(let Ut=2;Ut<s.length-1;Ut++){for(let $t=1;$t<2;$t++){let qt;let Jt=2*abs(Ut/s.length-.5);let jt=p5.Vector.lerp(c[Ut-1],s[Ut-1],.1);let Kt=p5.Vector.lerp(c[Ut],s[Ut],0);let Qt=p5.Vector.lerp(s[Ut-1],i[Ut-1],.5);let Zt=p5.Vector.lerp(s[Ut],i[Ut],0);let er=lerp(zt.colors.bg[0][0],p[0],1-Jt);let tr=lerp(zt.colors.bg[0][1],p[1],1-Jt);let rr=lerp(zt.colors.bg[0][2],p[2],1-Jt);er=h[0];tr=h[1];rr=h[2];Cl({pg:t,pts:[jt,Kt,s[Ut],s[Ut-1]],baseX:r,baseY:l,col:kr(er,tr,rr,Gt),randomOffset:2,vertexMode:rt});Cl({pg:t,pts:[Qt,Zt,s[Ut],s[Ut-1]],baseX:r,baseY:l,col:kr(er,tr,rr,Gt),randomOffset:2,vertexMode:rt})}}}else if(a[0]==10&&rt==0){function or(e,t,r,o,l){let n=[];for(let t=0;t<=r;t++){let a=t/r;let c=floor(l*a);c=max(0,min(c,e.length-1));let i=p5.Vector.lerp(e[c],s[c],o);n.push(i)}n[n.length-1]=t;let a=[];for(let e=0;e<n.length;e++){let t=max(0,e-1);let r=min(n.length-1,e+1);let o=p5.Vector.lerp(p5.Vector.lerp(n[t],n[e],.5),p5.Vector.lerp(n[e],n[r],.5),.5);a.push(o)}return a}function lr(e,color){El({pg:t,pts:e,baseX:r,baseY:l,col:kr(y[0],y[1],y[2]*10,.5),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.6,1)+.3)*d*ge,randomOffset:.1,forceBrush:1})}let nr=[{pathRatio:.6,lerpRatio:.3},{pathRatio:.7,lerpRatio:.5},{pathRatio:.8,lerpRatio:.7}];for(let{pathRatio:ar,lerpRatio:sr}of nr){let cr=floor(c.length*ar);let ir=20;let pr=floor(c.length/10*floor(ar*10));let hr=c[pr];let fr=or(c,hr,ir,sr,cr);lr(fr,y);let dr=i[pr];let mr=or(i,dr,ir,sr,cr);lr(mr,y)}}else if(a[0]==11){let ur=b.random(1.2,2.5);let gr=ur*b.random(1,2.5);let br=new Map;let yr=Tr(150,250);if(ae==1)yr=Tr(20,50);function xr(e,t,r){let o=floor(e.x/r);let l=floor(e.y/r);for(let n=-1;n<=1;n++){for(let a=-1;a<=1;a++){let key=`${o+n},${l+a}`;if(t.has(key)){let o=t.get(key);for(let t of o){let o=p5.Vector.dist(e,t);if(o<r)return false}}}}return true}function Fr(e,t,r){let o=floor(e.x/r);let l=floor(e.y/r);let key=`${o},${l}`;if(!t.has(key)){t.set(key,[])}t.get(key).push(e)}for(let Pr=2;Pr<s.length-1;Pr++){let Vr=c[Pr];let Cr=i[Pr];let Er=s[Pr];let Dr=floor(yr/(s.length-3));let Ar=0;let Ir=0;while(Ir<Dr&&Ar<100){Ar++;let Lr=b.random(0,b.random(0,1));let Sr;if(random(0,1)<.5){Sr=p5.Vector.lerp(Vr,Er,Lr)}else{Sr=p5.Vector.lerp(Er,Cr,Lr)}Sr.add(Xr(b).mult(b.random(.5,2)));if(xr(Sr,br,gr)){Fr(Sr,br,gr);Ir++;t.push();t.translate(r,l);t.noStroke();if(ae==1){t.fill(Tr(0,6)*20,.5,.8,1)}else{if(b.random(0,1)<.7){t.fill(Ee[0][0],Ee[0][1],Ee[0][2]*.7,.3)}else{t.fill(Ee[1][0],Ee[1][1],Ee[1][2]*1.2,.5)}}t.ellipse(Sr.x,Sr.y,ur*b.random(.7,1),ur*b.random(.7,1));t.pop()}}}}else if(a[0]==12){let Br=min(c.length,i.length,s.length);let Wr=max(2,floor(Br/(a[1]*2)));let Yr=floor(s.length/8);let Or=.4;if(g==1)Or=.6;else if(g==0)Or=.1;let zr=1;if(g==1)zr=5;for(let Rr=Yr;Rr<s.length-Yr;Rr+=Wr){let vr=(Rr-Yr)/(s.length-2*Yr);let _r=.48+.48*sin(vr*PI);let Nr=s[Rr];let Mr=p5.Vector.lerp(Nr,c[Rr+5],_r);let Hr=p5.Vector.lerp(Nr,Mr,.5);let Gr=createVector(0,5*sin(vr*PI),0);Hr.add(Gr);Hr.add(Xr(b).mult(2));let Ur=[];let $r=5;for(let Kr=0;Kr<=$r;Kr++){let Qr=Kr/$r;let Zr=pow(1-Qr,2)*Nr.x+2*(1-Qr)*Qr*Hr.x+pow(Qr,2)*Mr.x;let eo=pow(1-Qr,2)*Nr.y+2*(1-Qr)*Qr*Hr.y+pow(Qr,2)*Mr.y;Ur.push(createVector(Zr,eo).add(Xr(b).mult(.2)))}El({pg:t,pts:Ur,baseX:r,baseY:l,col:kr(p[0],p[1],p[2]*zr,Or),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:.3,forceBrush:1});let qr=p5.Vector.lerp(Nr,i[Rr+5],_r);let Jr=p5.Vector.lerp(Nr,qr,.5);Jr.add(Gr);Jr.add(Xr(b).mult(2));let jr=[];for(let to=0;to<=$r;to++){let ro=to/$r;let oo=pow(1-ro,2)*Nr.x+2*(1-ro)*ro*Jr.x+pow(ro,2)*qr.x;let lo=pow(1-ro,2)*Nr.y+2*(1-ro)*ro*Jr.y+pow(ro,2)*qr.y;jr.push(createVector(oo,lo).add(Xr(b).mult(.2)))}El({pg:t,pts:jr,baseX:r,baseY:l,col:kr(p[0],p[1],p[2]*zr,Or),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*ge,randomOffset:.3,forceBrush:1})}}else if(a[0]==13){for(let co=1;co<s.length;co++){for(let io=1;io<a[1];io++){let po=io/a[1];let ho=2*abs(co/s.length-.5);let fo=p5.Vector.lerp(c[co-1],s[co-1],.1);let mo=p5.Vector.lerp(c[co],s[co],.1);let uo=p5.Vector.lerp(s[co-1],i[co-1],.8);let go=p5.Vector.lerp(s[co],i[co],.8);let bo=zt.colors.flower[0][0];let yo=zt.colors.flower[0][1];let xo=zt.colors.flower[0][2]*.8;let Fo=lerp(0,1,ho);Cl({pg:t,pts:[fo,mo,s[co],s[co-1]],baseX:r,baseY:l,col:kr(bo,yo,xo,Fo*1),randomOffset:0,vertexMode:0});Cl({pg:t,pts:[uo,go,s[co],s[co-1]],baseX:r,baseY:l,col:kr(bo,yo,xo,Fo*1),randomOffset:0,vertexMode:0})}}let no=zt.colors.branch[1][0];let ao=zt.colors.branch[1][1];let so=zt.colors.branch[1][2]*.6;if(a[2]==0){for(let Po=2;Po<s.length-1;Po++){for(let wo=1;wo<3;wo++){let Vo=wo/3;let Co=p5.Vector.lerp(c[Po-1],s[Po-1],Vo);let Eo=p5.Vector.lerp(c[Po],s[Po],Vo);let To=p5.Vector.lerp(s[Po-1],i[Po-1],Vo);let Do=p5.Vector.lerp(s[Po],i[Po],Vo);El({pg:t,pts:[To.add(Xr(b).mult(.4)),Do.add(Xr(b).mult(.1))],baseX:r,baseY:l,col:kr(no,ao,so,.5),branchWidthFunc:e=>.5,randomOffset:.1,forceBrush:1});El({pg:t,pts:[Co.add(Xr(b).mult(.4)),Eo.add(Xr(b).mult(.1))],baseX:r,baseY:l,col:kr(no,ao,so,.5),branchWidthFunc:e=>.5,randomOffset:.1,forceBrush:1})}}}}}}class w{static fruitSeed(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,baseRotation:l=createVector(PI/2,0,0),branchLength:n=500,branchSegments:a=30,branchWidthFunc:s=e=>sin(e*PI)*20,col:c=[90,.2,.3],colorFunction:i=e=>e,branchBendFunc:p=e=>createVector(random(-10,10),0,random(-5,5)),pointShift:h=1.5,strokeNoiseScale:f=.2,strokeStrength:d=1}=e;let m=wr(Nt);d=d+m.random(0,1)*2;h=10*be;a=max(5,floor(a*G));let u=createVector(0,0,0);let g=createVector(0,0,0);let b=[u.copy()];let y=[g.copy()];let x=[u.copy()];let F=[u.copy()];let P=e=>yr.applyEulerRotation(e,l);for(let e=0;e<a;e++){let l=e/(a-1);let h=p(l);g=p5.Vector.add(g,p5.Vector.mult(h,1/a));let f=yr.applyEulerRotation(createVector(0,0,n/a),g);u=p5.Vector.add(u,P(f));let d=s(l);let m=yr.applyEulerRotation(createVector(-d,0,0),g);let w=p5.Vector.add(u,P(m));let V=yr.applyEulerRotation(createVector(d,0,0),g);let C=p5.Vector.add(u,P(V));if(e>0){let e=p5.Vector.sub(u,x[x.length-1]);let l=p5.Vector.sub(w,u);let n=p5.Vector.cross(e,l);let a=map(abs(n.angleBetween(createVector(0,1,0))),0,PI,1,0);a=i(a)||0;let s=Lr(c[0],c[0],a);let p=map(a,0,1,c[1],c[1]);let h=map(a,0,1,c[2],c[2]);s=c[0];p=c[1];h=c[2];Cl({pg:t,pts:[w,x[x.length-2],b[b.length-2],u],baseX:r,baseY:o,doFill:true,doStr:false,col:kr(s,p,h,.6),randomOffset:.1});Cl({pg:t,pts:[C,F[F.length-2],b[b.length-2],u],baseX:r,baseY:o,doFill:true,doStr:false,col:kr(s,p,h,.6),randomOffset:.1})}b.push(u.copy());y.push(g.copy());x.push(w.copy());F.push(C.copy())}if(de==0)c=zt.colors.stroke[2];El({pg:t,pts:b.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-h,h);let r=map(noise(e.y*f,e.x*f),0,1,-h,h);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(c[0],c[1],c[2]*.6,1),branchWidthFunc:e=>(.4*(1-e)*map(noise(e*100),0,1,.1,1)+.4)*d*ge*random(.1,.2),randomOffset:.2});El({pg:t,pts:x.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-h,h);let r=map(noise(e.y*f,e.x*f),0,1,-h,h);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(c[0],c[1],c[2]*.6,1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*d*ge*random(.5,1),randomOffset:.1});El({pg:t,pts:F.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-h,h);let r=map(noise(e.y*f,e.x*f),0,1,-h,h);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(c[0],c[1],c[2]*.6,1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*d*ge*random(.5,1),randomOffset:.1});return b}static pinecone(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,baseRotation:l=createVector(0,0,0),col:n,PT:a}=e;let s=a.fruitSize*random(.6,1);let c=a.fruitColors["pinecone"][0];let i=a.fruitColors["pinecone"][1];let p=a.fruitColors["pinecone"][2];let h=int(a.layers*random(.5,1.2));let f=int(a.scalesPerLayer*random(.8,1.2));let d=a.coneHeight*random(.8,1.2);let m=a.coneRadius*random(.8,1.2);let u=createVector(random(-.3,.3)*PI+PI/2,random(1.8,1.95)*PI+PI/2,0);let g=s*random(.4,1);let b=F.stem({pg:t,baseX:r,baseY:o,baseRotation:u,branchLength:g,col:Ot.branchColor,branchWidthFunc:e=>1,branchBendFunc:e=>createVector(0,0,0)});let y=jr();let x=random(.2,.6);for(let e=h-1;e>=0;e--){let l=(h-1-e)/(h-1);let n=exp(-pow((l-.5)*2,2)/3);let a=m*n;let g=a;let F=d*l-d*.9;let P=random(.8,1);for(let e=0;e<f;e++){let a=(e/f+l*.5)*TWO_PI;let h=s*x*n*random(.9,1.1);let d=createVector(g*cos(a),g*sin(a),F);let m=yr.applyEulerRotation(d,u);let V=r+b.centerPos[b.centerPos.length-1].x+m.x;let C=o+b.centerPos[b.centerPos.length-1].y+m.y;let E=createVector(u.x,u.y,u.z+a);let T=y(l,P);w.fruitSeed({pg:t,baseX:V,baseY:C,baseRotation:E,branchLength:h*.6,branchWidthFunc:e=>h*.45*sin(e*PI),col:[c,i,p*random(.5,1),random(.8,1)],colorFunction:e=>e,strokeStrength:.4,branchBendFunc:e=>createVector(0,-T*(1-e),0)})}}}static drawFruit(e={}){let{pg:t=pgL3,baseX:r=0,baseY:l=0,type:n="pinecone",size:a=50,meta:s={},PT:c,branchEnd:i=createVector(r,l,0),currentWidth:p=1}=e;let h=i.x;let f=i.y;let d=p5.Vector.sub(createVector(h,f),createVector(r,l)).normalize();let m=atan2(d.y,d.x);if(o==2)Me=6;if(Me==0)n="pinecone";else if(Me==1)n="apple";else if(Me==2)n="raspberry";else if(Me==3)n="buddhahand";else if(Me==4)n="melon";else if(Me==5)n="melon";else if(Me==6)n="SP2Fruit";switch(n){case"pinecone":w.pinecone({pg:t,baseX:h,baseY:f,col:s.branchColor,baseRotation:createVector(0,0,m),PT:c});break;case"apple":let e=Dr([1,1,2,2,3,4]);if(c.appleSize<8)e=e*2;let o=PI/e;se=[1,1];for(let r=0;r<e;r++){let e=random(1,2);let r=random(-PI/4,PI/4);let o=h+cos(m+r)*e;let l=f+sin(m+r)*e;let n=random(.8,1.2);let a=Dr([-1.5,1.5]);w.apple({pg:t,baseX:o,baseY:l,baseRotation:createVector(PI/2+n,a,n),PT:c,size:c.appleSize*random(.6,1.2),stemLength:c.fruitstem})}break;case"raspberry":let a=1.5;if(p>=a){w.raspberry({pg:t,baseX:h,baseY:f,baseRotation:createVector(0,0,m),PT:c,size:c.raspberrySize,stemLength:c.fruitstem})}break;case"buddhahand":let i={branchColor:c.colors.branch[0],flowerColorA:c.colors.fruit[2],flowerPetal:Dr([5,7,9]),flowerLengthA:c.flowerLengthA*random(.8,1),flowerWidthA:c.flowerWidthA*random(.8,1),flowerLengthC:c.flowerLengthC,flowerShape:e=>e>.5?1-e+.1:.4,petalfType:[5,2],branchBendFunc:e=>{let t=5;let r=Dr([1,-1]);return createVector(sin(e*PI)*t*r,cos(e*PI)*.5,sin(e*PI*2)*2)}};b.drawFlowerB({pg:t,baseX:h,baseY:f,direction:createVector(random(-1,1),random(-1,1),0),rot:random(0,TWO_PI),op:.95,meta:i});break;case"melon":let d=1;let u=PI/d;se=[1,1];let g;if(Me==4)g=c.melonSize*random(.6,1.2),d=Tr(2,5);else if(Me==5)g=c.melonSize*3*random(.6,1.2),d=1;for(let e=0;e<d;e++){let e=random(1,2);let r=random(-PI/4,PI/4);let o=h+cos(m+r)*e;let l=f+sin(m+r)*e;let n=random(.8,1.2);let a=Dr([0,3])+random(.1,.4);w.melon({pg:t,baseX:o,baseY:l,baseRotation:createVector(PI/2+n,a,0),PT:c,size:g,length:g*random(.8,1.2),stemLength:c.fruitstem})}break;case"SP2Fruit":let y=createVector(0,1,Dr([-1,1]));{let e={branchColor:c.colors.branch[0],flowerColorA:[c.colors.flower[0][0],c.colors.flower[0][1],Number(c.colors.flower[0][2])*random(.8,1.1)],flowerColorB:[random(45,65),random(.8,1),random(.8,1)],flowerPetal:12,flowerLengthA:110*random(.9,1.1),flowerWidthA:9*random(.6,1.2),flowerLengthC:30*random(.8,1.2),flowerShape:e=>{if(e<.4)return map(e,0,.5,.8,1);else if(e>=.4&&e<.6)return map(e,.4,.6,1,.5);else return map(e,.6,1,.5,.2)},petalfType:[13,2,0],spType:1};b.drawFlowerG({pg:pgL0,baseX:r,baseY:l,direction:y,op:1,meta:e,doFruit:1})}break;default:console.warn("Unknown fruit type:",n);break}}static apple(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,baseRotation:l=createVector(0,0,0),PT:n,size:a=20,stemLength:s=30,pointShift:c=.01,strokeStrength:i=1,strokeNoiseScale:p=.1}=e;let h=wr(Nt);i=i+h.random(0,1)*2;c=c*be;let f={base:{hue:n.colors.fruit[1][0],saturation:n.colors.fruit[1][1],brightness:n.colors.fruit[1][2]}};let d=[Number(f.base.hue)+Ar(-20,20),Number(f.base.saturation)+Ar(-.1,.1),Number(f.base.brightness)+Ar(-.1,.1),1];let m={pg:t,baseX:r,baseY:o,baseRotation:l,branchLength:s*random(2,5),col:Ot.branchColor,branchBendFunc:e=>createVector(random(1,2),random(1,2),0),branchWidthFunc:e=>1,strokeStrength:1};let u=F.stem(m);let g=u.centerPos[u.centerPos.length-1];let b=p5.Vector.sub(u.centerPos[u.centerPos.length-1],u.centerPos[u.centerPos.length-2]).normalize();let y=20;let x={pg:t,baseX:g.x+r,baseY:g.y+o,baseRotation:l,branchLength:y,col:Ot.branchColor,branchBendFunc:e=>createVector(1,0,0),branchWidthFunc:e=>3,strokeStrength:1};let w=F.stem(x);let V=w.centerPos[round(w.centerPos.length/2)];let C=g.x+V.x+r;let E=g.y+V.y+o;g=V;let T=p5.Vector.cross(createVector(0,-1,0),b);let D=yr.angle(createVector(0,-1,0),b);let A=e=>{let t=createVector(e.x,e.y-a,e.z);let r=T.mag()>.001?yr.rotateVectorAroundAxis(t,T,D):t.copy();return createVector(r.x+C,r.y+E,r.z)};let I=40;let L=[];for(let e=0;e<=I;e++){let t=e/I;let r=-a*(2*t-1);L.push(createVector(0,r))}let S=e=>{let t=2*e-1;return a*sqrt(1-pow(t,2))};let[B,W]=wl({pts:L,branchWidthFunc:S});function k(e,r){const o=L.length-1;const l=X-1;const n=e/o;const a=r/l;const s=(r+1)/l;const c={Pos0_0:p5.Vector.lerp(B[e],W[e],a),Pos0_1:p5.Vector.lerp(B[e+1],W[e+1],a),Pos1_0:p5.Vector.lerp(B[e],W[e],s),Pos1_1:p5.Vector.lerp(B[e+1],W[e+1],s)};let i=sin(s*PI)*n;i+=map(noise(s*20,n*20),0,1,.2,.5);const p={h:Lr(d[0],d[0],i),s:lerp(d[1],d[1],i),b:lerp(d[2],d[2]*.7,i),a:lerp(d[3],d[3]*.8,i)};Cl({pg:t,pts:[c.Pos0_0,c.Pos0_1,c.Pos1_1,c.Pos1_0].map(A),doFill:true,col:kr(p.h,p.s,p.b,p.a),randomOffset:.5})}const X=8;const Y=L.length-1;const O=X-1;for(let e=0;e<Y;e++){for(let t=0;t<O;t++){k(e,t)}}let z=zt.colors.stroke[0];if(de==0)z=zt.colors.stroke[2];let R=(e,r=1.2)=>{El({pg:t,pts:e.map((e=>{let t=map(noise(e.x*p,e.y*p),0,1,-c,c);let r=map(noise(e.y*p,e.x*p),0,1,-c,c);let o=A(e);return createVector(o.x+t,o.y+r)})),baseX:0,baseY:0,col:kr(z[0],z[1],z[2],1),randomOffset:0,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*i*ge})};R(B);R(W);let v=(e,r,o=10,l=1.1)=>{let n=[];for(let t=0;t<=o;t++){let l=t/o;n.push(p5.Vector.lerp(e,r,l))}El({pg:t,pts:n.map(A),baseX:0,baseY:0,col:kr(d[0],d[1],d[2]*l,1),randomOffset:0,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*i*ge})};v(B[0],W[0],10,1.1);v(B[B.length-1],W[W.length-1],10,1.2);let _=floor(random(2,4));for(let e=0;e<_;e++){let e=Dr([-1,1]);let r=e*random(1,2);r=e*r;let o=createVector(l.x+random(1,2),l.y+r,1);o=createVector(l.x+3,l.y+r,1);let s={leafLength:a*random(1,2),leafWidth:a,color:[n.colors.leaf[0][0],n.colors.leaf[0][1],n.colors.leaf[0][2],1]};P.leaf({pg:t,baseX:C,baseY:E,baseRotation:o,branchLength:s.leafLength,pointShift:.2,strokeNoiseScale:.05,strokeStrength:.2,branchWidthFunc:e=>sin(e*PI)*s.leafWidth*.5,branchBendFunc:e=>createVector(random(-2,2),random(-1,1),0),col:n.colors.leaf[1],strokeType:1})}return{center:g,size:a,rotation:l}}static raspberry(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,baseRotation:l=createVector(0,0,0),PT:n,size:a=15,stemLength:s=30,drupeletCount:c=Tr(5,15),layer:i=Tr(3,10)}=e;let p=F.stem({pg:t,baseX:r,baseY:o,baseRotation:l,branchLength:s,col:Ot.branchColor,branchBendFunc:e=>createVector(random(-.5,.5),random(-.5,.5),0),branchWidthFunc:e=>.8,strokeStrength:0});let h=p.centerPos[p.centerPos.length-1];let f=p5.Vector.sub(p.centerPos[p.centerPos.length-1],p.centerPos[p.centerPos.length-2]).normalize();let d=p5.Vector.cross(createVector(0,-1,0),f);let m=yr.angle(createVector(0,-1,0),f);let u=e=>{let t=d.mag()>.001?yr.rotateVectorAroundAxis(e,d,m):e.copy();return createVector(t.x+h.x+r,t.y+h.y+o,t.z)};let g=[];for(let e=0;e<c;e++){let t=1-e/(c-1)*2;let r=sqrt(1-t*t);let o=PI*2*e*(3-sqrt(5));let l=cos(o)*r;let n=sin(o)*r;let s=a*M;let i=1.2*(random(random(0,1))+.2);let p=createVector(l*s*i,t*s*i,n*s*i);g.push(p)}g.forEach((e=>{let t=e.mag()/a;let r=M*a*random(.2,.4)*(1-.2*t);let o=u(e);let l=e.copy().normalize();w.drawGradientFlowerCenter(o.x,o.y,r,l,i)}));return{center:h,size:a,rotation:l}}static drawGradientFlowerCenter(e,t,r,o,l=8){let n=2;let a=3;let s=wr(Nt);a=a+s.random(0,1)*2;n=10*be;let c=yr.vectorToEulerAngles(o);let i=l;let p=16;let h=[];for(let o=0;o<i;o++){let l=r*(1-o/i);let n=r*(1-(o+1)/i);let a=[];let s=[];for(let e=0;e<=p;e++){let t=e/p*TWO_PI;let r=createVector(cos(t)*l,sin(t)*l,0);let i=createVector(cos(t)*n,sin(t)*n,0);r=yr.applyEulerRotation(r,c);i=yr.applyEulerRotation(i,c);a.push(r);s.push(i);if(o===0){h.push(r.copy())}}let f=random(.9,1);let d=random(0,.2);for(let r=0;r<p;r++){let l=o/(i-1);let n=lerp(zt.colors.fruit[2][0],zt.colors.fruit[2][0],l);let c=lerp(d,zt.colors.fruit[2][1],l);let p=lerp(f,zt.colors.fruit[2][2],l);Cl({pg:pgL4,pts:[a[r],a[r+1],s[r+1],s[r]],baseX:e,baseY:t,doFill:true,doStr:false,col:kr(n,c,p,1),randomOffset:.5})}}let f=zt.colors.stroke[0];if(de==0)f=zt.colors.stroke[2];let d=zt.colors.fruit[1];El({pg:pgL4,pts:h.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-n,n);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-n,n);return createVector(e.x+t,e.y+r)})),baseX:e,baseY:t,col:kr(f[0],f[1],f[2],1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*a*ge*random(.3,.5)});let m=r*.2;let u=[];for(let e=0;e<=p;e++){let t=e/p*TWO_PI;let r=createVector(cos(t)*m,sin(t)*m,0);r=yr.applyEulerRotation(r,c);u.push(r)}El({pg:pgL4,pts:u.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-n,n);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-n,n);return createVector(e.x+t,e.y+r)})),baseX:e,baseY:t,col:kr(d[0],d[1],d[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*a*ge*random(.3,.5)})}static addFruit(e,t,r,o){let l=r.PT.lastFruitPos||{x:-Infinity,y:-Infinity};let n={x:e,y:t};let a=50;let s=dist(n.x,n.y,l.x,l.y);if(s>a){let e=Dr(r.PT.fruitTypes);let t=r.PT.fruitColors[e];w.drawFruit({pg:pgL1,id:r.fruitCount,baseX:n.x,baseY:n.y,type:e,col:t,PT:r.PT,currentWidth:o});r.PT.fruitCount++;r.PT.lastFruitPos=n;return true}}static melon(e={}){let{pg:t=pgL3,baseX:r=0,baseY:l=0,baseRotation:n=createVector(0,0,0),PT:a,size:s=20,length:length=40,stemLength:c=30,pointShift:i=.01,strokeStrength:p=1,strokeNoiseScale:h=.1,branchLength:f=50,stemBend:d}=e;let m=wr(Nt);p=p+m.random(0,1)*2;i=i*be;let u={base:{hue:a.colors.fruit[1][0],saturation:a.colors.fruit[1][1],brightness:a.colors.fruit[1][2]}};let g=[Number(u.base.hue)+Ar(-20,20),Number(u.base.saturation)+Ar(-.1,.1),Number(u.base.brightness)+Ar(-.1,.1),1];d=d||createVector(m.random(1,2),m.random(1,2),0);let b={pg:t,baseX:r,baseY:l,baseRotation:n,branchLength:f,col:kr(0,0,0,.8),branchBendFunc:e=>d,branchWidthFunc:e=>2,strokeStrength:1};let y=F.stem(b);let x=y.centerPos[y.centerPos.length-1];let P=p5.Vector.sub(y.centerPos[y.centerPos.length-1],y.centerPos[y.centerPos.length-2]).normalize();let w=x.x+r;let V=x.y+l;let C=p5.Vector.cross(createVector(0,-1,0),P);let E=yr.angle(createVector(0,-1,0),P);let T=e=>{let t=createVector(e.x,e.y-length*2.3,e.z);let r=C.mag()>.001?yr.rotateVectorAroundAxis(t,C,E):t.copy();return createVector(r.x+w,r.y+V,r.z)};let D=40;let A=[];for(let e=0;e<=D;e++){let t=e/D;let r=-length*2.5*(2*t-1);A.push(createVector(0,r))}let I=(e,t,r,o=false)=>{let l=2*e-1;let n=s*.3*sqrt(1-pow(l,2));let a=t+1e3;let c=t+2e3;let i=o?a:c;let p=noise(e*1+i)*.2+m.random(-.03,.03);let h=sin(e*(r+(o?2:-2)))*.1;let f=noise(e*3+i)*.1;return n*(1+p+h+f)};let L=m.random(1,2);let S=Vr(m,6,12);let[B,W]=wl({pts:A,branchWidthFunc:e=>I(e,L,S,true)});let k=12;let X=zt.colors.branch[0].map(Number);let Y=zt.colors.flower[0].map(Number);function O(e,r){const l=A.length-1;const n=k-1;const a=e/l;const s=r/n;const c=(r+1)/n;const i={Pos0_0:p5.Vector.lerp(B[e],W[e],s),Pos0_1:p5.Vector.lerp(B[e+1],W[e+1],s),Pos1_0:p5.Vector.lerp(B[e],W[e],c),Pos1_1:p5.Vector.lerp(B[e+1],W[e+1],c)};let p=1-lerp(sin(c*PI)*a,a,a);p+=map(noise(c*20,a*20),0,1,.2,.5);const h=sin(c*PI*8)>0?1:.95;const f=pow(p,2.5);const d=1-f*.4;let m;if(o===2){const e=1-p;m={h:Lr(X[0],Y[0],e),s:lerp(X[1],Y[1],e),b:lerp(X[2],Y[2],e)*d,a:1}}else{m={h:Lr(g[0],g[0],p),s:lerp(g[1],g[1]*.9,p),b:lerp(g[2],g[2],p)*d*(h*.3+.7),a:lerp(g[3],g[3],p)}}Cl({pg:t,pts:[i.Pos0_0,i.Pos0_1,i.Pos1_1,i.Pos1_0].map(T),doFill:true,col:kr(m.h,m.s,m.b,m.a),randomOffset:.5})}const z=A.length-1;const R=k-1;for(let e=0;e<z;e++){for(let t=0;t<R;t++){O(e,t)}}let v=Vr(m,100,200);let _=kr(g[0],g[1]*.5,g[2]*1.2,.5);for(let e=2;e<A.length-1;e++){let r=B[e];let o=W[e];let l=A[e];let n=floor(v/(A.length-3));for(let e=0;e<n;e++){let e=m.random(0,m.random(0,1));e=map(e,0,1,.2,.8);let n;if(random(0,1)<.5){n=p5.Vector.lerp(r,l,e)}else{n=p5.Vector.lerp(l,o,e)}n.add(Xr(m).mult(random(.2,.8)));let a=m.random(0,1)<.95?m.random(1,1.5):2.5;a=a*1.2;let s=color(_);t.push();t.noStroke();s.setAlpha(m.random(.1,.4));t.fill(s);let c=T(n);t.ellipse(c.x,c.y,a,a);t.pop()}}let N=zt.colors.stroke[0];if(de==0)N=zt.colors.stroke[2];let M=(e,r=1.2)=>{El({pg:t,pts:e.map((e=>{let t=map(noise(e.x*h,e.y*h),0,1,-i,i);let r=map(noise(e.y*h,e.x*h),0,1,-i,i);let o=T(e);return createVector(o.x+t,o.y+r)})),baseX:0,baseY:0,col:kr(N[0],N[1],N[2],1),randomOffset:0,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*p*ge})};M(B);M(W);return{center:x,size:s,rotation:n}}}var V=new URLSearchParams(window.location.search).get("payload");var C=JSON.parse(V?atob(V):"{}");var hash=C.hash||(Math.random()+1).toString(16).substring(2);var E=C.editionNumber||0;const T=function(e){var t,r,o,l,n=function e(t){for(var r=0,o=1779033703^t.length;r<t.length;r++)o=(o=Math.imul(o^t.charCodeAt(r),3432918353))<<13|o>>>19;return function(){return o=Math.imul((o=Math.imul(o^o>>>16,2246822507))^o>>>13,3266489909),(o^=o>>>16)>>>0}}(e),a={rand:(t=n(),r=n(),o=n(),l=n(),function(){o|=0;var e=((t|=0)+(r|=0)|0)+(l|=0)|0;return l=l+1|0,t=r^r>>>9,r=o+(o<<3)|0,o=(o=o<<21|o>>>11)+e|0,(e>>>0)/4294967296}),randInt:function(e,t){return e+Math.floor((t-e)*a.rand())}};return a};const D=T(hash);let A=D.randInt(1e8,9e8);if(new URLSearchParams(window.location.search).get("hashSeed")!==null){A=new URLSearchParams(window.location.search).get("hashSeed")}else{}function I(){dispatchEvent(new Event("capture-preview"));console.info("###verse-preview-capture")}function L(){var e=navigator.userAgent||navigator.vendor||window.opera;if(/Mac/i.test(e)){specialAlpha=.8;return"Mac"}else if(/Win/i.test(e)){specialAlpha=.2;return"PC"}else{return"Unknown"}}var S=L();const B=new URLSearchParams(window.location.search).get("machine");const W=new URLSearchParams(window.location.search).get("hires");console.log("hires:"+W);console.log("isMachine:"+B);function k(e,t,r){const o=Math.pow(10,t-1);const l=Math.floor(e/o)%Math.pow(10,r);return l}let X=0,Y=0,O=30,z;let R=false,v=false;let _=.3,N=.7,M=0,H=1;let G=1,U=.1;let $=1.2,q=1,J={};let j,K;let Q=0,Z=0,ee=0,te;let re={x:0,y:0,height:0};let oe=0,le=0;let ne=[],ae=0,se=[1,1];let ce=0,ie;let pe=1,he=1,fe=1,de=1;let me=1,ue=0;let ge=0,be,ye;let xe=0,Fe=0;let Pe=0;let we=[1,1,1];let Ve=[1,1,1];let Ce,Ee,Te=0,De;let Ae={pgL0:null,pgL1:null,pgL2:null,pgL3:null,pgL4:null,pgText:null,pgTex:null,pgFinal:null,snapShotImg:null,pgFrame:null};let Ie,Le;let Se,Be,We,ke,Xe,Ye,Oe,ze,Re,ve;let _e,Ne;let Me=1,He=3;let Ge=0,Ue;let $e=false;let qe,Je,je=0;let Ke=0,Qe,Ze;let et=0,tt=0;let rt=0;let ot=0,lt=0;let nt=0,at=0;let st=0,ct=0;let it=0,pt=true;let ht=0;let ft="";let dt;let mt=.001,ut=.01;let gt=0,bt=false;const yt=1e3;let xt=[],Ft=[],Pt=[];let wt=[],Vt=[];let Ct=new Set;let Et=0,Tt=0;let Dt,At,It=0;let Lt=.995,St=.995,Bt=.995;let Wt=1,kt=.9,Xt=.1;let Yt="A";let Ot={},zt={},Rt={},vt={},_t={};let Nt;let Mt,Ht,Gt,Ut;let $t=null,qt="#";let Jt=0,jt=0;let Kt=0;let Qt=new URLSearchParams(window.location.search);let Zt=Qt.has("paperType")?parseInt(Qt.get("paperType")):null;let er=/^\?\d+/.test(window.location.search);let tr={},rr;const or={0:{colors:{vine:[Br("#F6F5F9")],fruit:[Br("#CD8A6F"),Br("#E3AA5F"),Br("#EAB29B")],flower:[Br("#A75065"),Br("#F6F5F9")],leaf:[Br("#677079"),Br("#FFE7F6")],branch:[Br("#444440"),Br("#BF8463"),Br("#9A6A4F")],grass:[Br("#335D80")],mushroom:[Br("#DED5C6"),Br("#C5885F"),Br("#E3D65F"),Br("#FAFEFF"),Br("#856F5F"),Br("#A75065")],butterfly:[Br("#FAFEFF"),Br("#DFD25C")],stone:[Br("#67645F")],bg:[Br("#DED5C6")],stroke:[Br("#434240"),Br("#CD8A6F"),Br("#DED5C6")]}},1:{colors:{vine:[Br("#FEFFFD")],fruit:[Br("#94342A"),Br("#BFAF94"),Br("#DFD25C")],flower:[Br("#FAFEFF"),Br("#BFAF94")],leaf:[Br("#B93737"),Br("#FAFEFF")],branch:[Br("#604726"),Br("#FAFEFF"),Br("#1E414E")],grass:[Br("#3E322F")],mushroom:[Br("#FAFEFF"),Br("#FEFFFD"),Br("#DFD25C"),Br("#688CE3"),Br("#DFAC5C"),Br("#FAFEFF")],butterfly:[Br("#DFD25C"),Br("#FAFEFF")],stone:[Br("#2C4F58")],bg:[Br("#BFAF94")],stroke:[Br("#5B5B5B"),Br("#688CE3"),Br("#DFAC5C")]}},2:{colors:{vine:[Br("#FEFFFD")],fruit:[Br("#95AADE"),Br("#C8C9BB"),Br("#4761A0")],flower:[Br("#E89B65"),Br("#D87D5D")],leaf:[Br("#63AEA1"),Br("#B7D1A9")],branch:[Br("#FEFFFD"),Br("#B7D1A9"),Br("#94B08A")],grass:[Br("#B7D1A9")],mushroom:[Br("#FEFFFD"),Br("#E89B65"),Br("#B7D1A9"),Br("#B7D1A9"),Br("#63AEA1"),Br("#63AEA1")],butterfly:[Br("#63AEA1"),Br("#B7D1A9")],stone:[Br("#63AEA1")],bg:[Br("#CCC6B3")],stroke:[Br("#373733"),Br("#8D4D21"),Br("#F8C32B")]}},3:{colors:{vine:[Br("#708075")],fruit:[Br("#3F4A45"),Br("#708075"),Br("#FAD2A8")],flower:[Br("#FAC9C4"),Br("#FDFDEB")],leaf:[Br("#718175"),Br("#474F52")],branch:[Br("#B3B0A8"),Br("#E5E1D5"),Br("#B3B0A8")],grass:[Br("#A89C69")],mushroom:[Br("#FDFDEB"),Br("#E5E1D5"),Br("#FAC9C4"),Br("#E5E1D5"),Br("#6E7850"),Br("#E5E1D5")],butterfly:[Br("#597356"),Br("#597356")],stone:[Br("#858179")],bg:[Br("#D1CDC2")],stroke:[Br("#514D45"),Br("#FAC9C4"),Br("#4C5752")]}},4:{colors:{vine:[Br("#396782")],fruit:[Br("#D2D2E1"),Br("#CB97B0"),Br("#FCC911")],flower:[Br("#FDFDEB"),Br("#FBE282")],leaf:[Br("#89A9AD"),Br("#D6D494")],branch:[Br("#D2C09C"),Br("#FDF8C2"),Br("#C2B08A")],grass:[Br("#BCD0D0")],mushroom:[Br("#FDFDEB"),Br("#F7E39D"),Br("#F4E972"),Br("#FBF8F4"),Br("#AF7FAB"),Br("#DEC9DC")],butterfly:[Br("#FBE282"),Br("#EFC09E")],stone:[Br("##858179")],bg:[Br("#FFFCD8")],stroke:[Br("#5F4C26"),Br("#396782"),Br("#D2C09C")]}},5:{colors:{vine:[Br("#394D4B")],fruit:[Br("#BA6E50"),Br("#3A5856"),Br("#E9DEC6")],flower:[Br("#FFFDFF"),Br("#3A5856")],leaf:[Br("#394D4B"),Br("#B6866B")],branch:[Br("#A58F75"),Br("#F8F6F7"),Br("#8C7A65")],grass:[Br("#D7745A")],mushroom:[Br("#E9DEC6"),Br("#D7745A"),Br("#DEDCDD"),Br("#3A5856"),Br("#A58F75"),Br("#30312C")],butterfly:[Br("#FCBFD5"),Br("#D1A4D8")],stone:[Br("#937C63")],bg:[Br("#DEDCDD")],stroke:[Br("#271F18"),Br("#D7745A"),Br("#A58F75")]}},6:{colors:{vine:[Br("#090607")],fruit:[Br("#5578B2"),Br("#F4BFAA"),Br("#9A3724")],flower:[Br("#FCF0E1"),Br("#F07E56")],leaf:[Br("#A9A589"),Br("#D2B26E")],branch:[Br("#DADCD0"),Br("#625135"),Br("#EBD8A4")],grass:[Br("#3D271F")],mushroom:[Br("#5578B2"),Br("#FFF1B4"),Br("#F4BFAA"),Br("#625135"),Br("#F4BFAA"),Br("#F8F6F7")],butterfly:[Br("#898773"),Br("#D2B26E")],stone:[Br("#7A6952")],bg:[Br("#A79470")],stroke:[Br("#080807"),Br("#F8F6F7"),Br("#CA4F28")]}},7:{colors:{vine:[Br("#5A5B3F")],fruit:[Br("#C4A498"),Br("#99794C"),Br("#6D8D29")],flower:[Br("#EFEDEB"),Br("#F8C32B")],leaf:[Br("#7E7F49"),Br("#F6F7E5")],branch:[Br("#2C1C05"),Br("#E67A29"),Br("#677348")],grass:[Br("#9B9968")],mushroom:[Br("#F1F2E0"),Br("#A8A99B"),Br("#545146"),Br("#E1E2D1"),Br("#545146"),Br("#E1E2D1")],butterfly:[Br("#727BB4"),Br("#F4F3F2")],stone:[Br("#664822")],bg:[Br("#D8CFC2")],stroke:[Br("#393519"),Br("#677348"),Br("#E5DDCF")]}},8:{colors:{vine:[Br("#82955C")],fruit:[Br("#FCC911"),Br("#DC5B55"),Br("#F1F2E0")],flower:[Br("#F6F7E5"),Br("#F7B515")],leaf:[Br("#C5B26E"),Br("#231716")],branch:[Br("#B96942"),Br("#F7B515"),Br("#A15A3A")],grass:[Br("#6D7C51")],mushroom:[Br("#F1F2E0"),Br("#DC5B55"),Br("#F1F2E0"),Br("#C5B26E"),Br("#F1F2E0"),Br("#82955C")],butterfly:[Br("#FA74B2"),Br("#5FAAA6")],stone:[Br("#545146")],bg:[Br("#F2DDB4")],stroke:[Br("#465753"),Br("#F7B515"),Br("#B96942")]}},9:{colors:{vine:[Br("#E6DBC4")],fruit:[Br("#36342E"),Br("#F6F7E5"),Br("#E6DBC4")],flower:[Br("#F6F7E5"),Br("#E6DBC4")],leaf:[Br("#E6DBC4"),Br("#E6DBC4")],branch:[Br("#CE5C6B"),Br("#E9DEC6"),Br("#403737")],grass:[Br("#403737")],mushroom:[Br("#F6F7E5"),Br("#E6DBC4"),Br("#F6F7E5"),Br("#E6DBC4"),Br("#F6F7E5"),Br("#E6DBC4")],butterfly:[Br("#FFFFFF"),Br("#F1F2E0")],stone:[Br("#FFFFFF")],bg:[Br("#E6DBC4")],stroke:[Br("#36342E"),Br("#36342E"),Br("#CE5C6B")]}},10:{colors:{vine:[Br("#ECBDC0")],fruit:[Br("#DEA643"),Br("#ECBDC0"),Br("#8A8FC6")],flower:[Br("#FDF7F0"),Br("#FDF7F0")],leaf:[Br("#899BB3"),Br("#A3A776")],branch:[Br("#A3A776"),Br("#F8E1AE"),Br("#8C7A65")],grass:[Br("#5E8262")],mushroom:[Br("#FDF7F0"),Br("#D1BC63"),Br("#F1F2E0"),Br("#D1BC63"),Br("#F1F2E0"),Br("#D1BC63")],butterfly:[Br("#FFFFFF"),Br("#D1BC63")],stone:[Br("#FDF7F0")],bg:[Br("#FDF7F0")],stroke:[Br("#414141"),Br("#8A8FC6"),Br("#D1BC63")]}},11:{colors:{vine:[Br("#FDF8EA")],fruit:[Br("#C2B08A"),Br("#8F3F34"),Br("#8F3F34")],flower:[Br("#E7DED3"),Br("#FFFBF7")],leaf:[Br("#6B716D"),Br("#A3A776")],branch:[Br("#45311C"),Br("#E9DEC6"),Br("#C2B08A")],grass:[Br("#BB9F97")],mushroom:[Br("#F1F2E0"),Br("#C2B08A"),Br("#F1F2E0"),Br("#A3A776"),Br("#5B76A8"),Br("#8F3F34")],butterfly:[Br("#7E887F"),Br("#5B76A8")],stone:[Br("#FDF7F0")],bg:[Br("#A6AEA8")],stroke:[Br("#565656"),Br("#D1CBCB"),Br("#E1D7CB")]}},12:{colors:{vine:[Br("#7B5226")],fruit:[Br("#E3DFC5"),Br("#DCAAA9"),Br("#D8A296")],flower:[Br("#D8A296"),Br("#F2D5B7")],leaf:[Br("#202427"),Br("#202427")],branch:[Br("#2E3137"),Br("#EBE6D9"),Br("#B3A8A1")],grass:[Br("#D89088")],mushroom:[Br("#EBE6D9"),Br("#D89088"),Br("#F1F2E0"),Br("#7B5226"),Br("#DCD7C0"),Br("#BAB2B6")],butterfly:[Br("#DCD7C0"),Br("#484148")],stone:[Br("#2E3137")],bg:[Br("#E3DFC5")],stroke:[Br("#000000"),Br("#D89088"),Br("#F2D5B7")]}},13:{colors:{vine:[Br("#8BA780")],fruit:[Br("#F2F2E6"),Br("#A94E5C"),Br("#985562")],flower:[Br("#FFFFFF"),Br("#57896E")],leaf:[Br("#708F68"),Br("#F2F2E6")],branch:[Br("#F2F2E6"),Br("#8BA780"),Br("#6E8A6A")],grass:[Br("#412F2B")],mushroom:[Br("#F2F2E6"),Br("#E8E9D5"),Br("#FFFFFF"),Br("#CAD6BC"),Br("#F2F2E6"),Br("#CAD6BC")],butterfly:[Br("#232F20"),Br("#F2F2E6")],stone:[Br("#F2F2E6")],bg:[Br("#E8E9D5")],stroke:[Br("#4E4E4E"),Br("#A94E5C"),Br("#F8C32B")]}},14:{colors:{vine:[Br("#FEFDF9")],fruit:[Br("#9EB745"),Br("#8F6C37"),Br("#EEE3C8")],flower:[Br("#FFFFFF"),Br("#6E8A6A")],leaf:[Br("#6E8A6A"),Br("#EEE3C8")],branch:[Br("#262710"),Br("#5E5F5A"),Br("#8A806A")],grass:[Br("#47872B")],mushroom:[Br("#F2F2E6"),Br("#6B6858"),Br("#34302A"),Br("#EEE3C8"),Br("#B89340"),Br("#6E8A6A")],butterfly:[Br("#232F20"),Br("#F2F2E6")],stone:[Br("#6B6858")],bg:[Br("#EEE3C8")],stroke:[Br("#34302A"),Br("#B89340"),Br("#E1CA96")]}},15:{colors:{vine:[Br("#E8E3D5")],fruit:[Br("#302D00"),Br("#8A8371"),Br("#B05D1F")],flower:[Br("#E4D077"),Br("#302D00")],leaf:[Br("#74727B"),Br("#E8E3D5")],branch:[Br("#E8E3D5"),Br("#E8E3D5"),Br("#E8E3D5")],grass:[Br("#E4D077")],mushroom:[Br("#EFE4C4"),Br("#E8E3D5"),Br("#EFE4C4"),Br("#E8E3D5"),Br("#EFE4C4"),Br("#E8E3D5")],butterfly:[Br("#E8E3D5"),Br("#E8E3D5")],stone:[Br("#E8E3D5")],bg:[Br("#E8E3D5")],stroke:[Br("#080807"),Br("#73C3EC"),Br("#C44287")]}},16:{colors:{vine:[Br("#1F1200")],fruit:[Br("#425C7C"),Br("#8A8371"),Br("#7B5469")],flower:[Br("#9C8895"),Br("#506066")],leaf:[Br("#E4D2BE"),Br("#EFE4C4")],branch:[Br("#B39C86"),Br("#E4D2BE"),Br("#293B4A")],grass:[Br("#5A4C3A")],mushroom:[Br("#EFE4C4"),Br("#E4D2BE"),Br("#EFE4C4"),Br("#E4D2BE"),Br("#EFE4C4"),Br("#E4D2BE")],butterfly:[Br("#506066"),Br("#EFE4C4")],stone:[Br("#E4D2BE")],bg:[Br("#EFE4C4")],stroke:[Br("#1F1200"),Br("#FEFDF9"),Br("#293B4A")]}},17:{colors:{vine:[Br("#A9493E")],fruit:[Br("#C49852"),Br("#A9493E"),Br("#E8B05E")],flower:[Br("#D7B170"),Br("#5D8A66")],leaf:[Br("#FDFDEB"),Br("#D6D494")],branch:[Br("#077B8C"),Br("#C8785F"),Br("#A9493E")],grass:[Br("#BCBFD0")],mushroom:[Br("#FDFDEB"),Br("#C49852"),Br("#D7B170"),Br("#A9493E"),Br("#C2B08A"),Br("#537477")],butterfly:[Br("#A9493E"),Br("#CCA981")],stone:[Br("##858179")],bg:[Br("#EDCFB7")],stroke:[Br("#32321F"),Br("#396782"),Br("#D2C09C")]}},18:{colors:{vine:[Br("#512A0F")],fruit:[Br("#355189"),Br("#EAEEE9"),Br("#5A8874")],flower:[Br("#A1351C"),Br("#FFC4C4")],leaf:[Br("#625642"),Br("#D6D494")],branch:[Br("#A2917C"),Br("#56846C"),Br("#63BBB9")],grass:[Br("#5A8874")],mushroom:[Br("#FDFDEB"),Br("#63BBB9"),Br("#FFAD4C"),Br("#DD4537"),Br("#C2B08A"),Br("#537477")],butterfly:[Br("#253437"),Br("#FEF8EB")],stone:[Br("##FEF8EB")],bg:[Br("#BD9E67")],stroke:[Br("#150B0B"),Br("#396782"),Br("#D2C09C")]}},19:{colors:{vine:[Br("#B5A4A0")],fruit:[Br("#5C3A15"),Br("#658072"),Br("#1A1874")],flower:[Br("#DCB5B5"),Br("#AD9794")],leaf:[Br("#5A5C4D"),Br("#D6D494")],branch:[Br("#8B542B"),Br("#54593D"),Br("#A0703B")],grass:[Br("#1E1D26")],mushroom:[Br("#FDFDEB"),Br("#D2C09C"),Br("#7D8160"),Br("#D2C09C"),Br("#C2B08A"),Br("#AC9691")],butterfly:[Br("#1A1874"),Br("#FEF8EB")],stone:[Br("#BDC2B4")],bg:[Br("#DFE3DA")],stroke:[Br("#2C2517"),Br("#DCB5B5"),Br("#D2C09C")]}},20:{colors:{vine:[Br("#17181A")],fruit:[Br("#EDCEE1"),Br("#AB6958"),Br("#DBE4E5")],flower:[Br("#CFCAC9"),Br("#868074")],leaf:[Br("#4D4433"),Br("#030305")],branch:[Br("#3F3929"),Br("#3F3929"),Br("#F2EDD8")],grass:[Br("#EDCEE1")],mushroom:[Br("#9D8D7B"),Br("#D2C09C"),Br("#9D8D7B"),Br("#D4D5D6"),Br("#C2B08A"),Br("#9C998E")],butterfly:[Br("#5D4D3C"),Br("#D4D5D6")],stone:[Br("#EEEADE")],bg:[Br("#BBB29D")],stroke:[Br("#262013"),Br("#AB6958"),Br("#D2C09C")]}},21:{colors:{vine:[Br("#BBCDAD")],fruit:[Br("#F97247"),Br("#EAD1AE"),Br("#F97247")],flower:[Br("#F6EEE5"),Br("#F9AF7B")],leaf:[Br("#A3B78E"),Br("#BBCDAD")],branch:[Br("#9E6E33"),Br("#A77D37"),Br("#F2EDD8")],grass:[Br("#F9CF7D")],mushroom:[Br("#F97247"),Br("#F9CF7D"),Br("#F6EEE5"),Br("#F9CF7D"),Br("#F6DFC7"),Br("#A3B78E")],butterfly:[Br("#F6EEE5"),Br("#BBCDAD")],stone:[Br("#F7C973")],bg:[Br("#F9CF7D")],stroke:[Br("#60503B"),Br("#D4855A"),Br("#F9CF7D")]}},22:{colors:{vine:[Br("#E7E2D8")],fruit:[Br("#161616"),Br("#F1EEE7"),Br("#E7E2D8")],flower:[Br("#FFFFFF"),Br("#FEF8EB")],leaf:[Br("#FEF8EB"),Br("#E7E2D8")],branch:[Br("#161616"),Br("#E7E2D8"),Br("#F2EDD8")],grass:[Br("#E7E2D8")],mushroom:[Br("#E7E2D8"),Br("#E7E2D8"),Br("#E7E2D8"),Br("#E7E2D8"),Br("#E7E2D8"),Br("#E7E2D8")],butterfly:[Br("#E7E2D8"),Br("#E7E2D8")],stone:[Br("#E7E2D8")],bg:[Br("#E9E9E9")],stroke:[Br("#161616"),Br("#161616"),Br("#FFFFFF")]}},23:{colors:{vine:[Br("#6A904B")],fruit:[Br("#DCDDCD"),Br("#DCDDCD"),Br("#DBE4E5")],flower:[Br("#F2EDD8"),Br("#F2D147")],leaf:[Br("#6A904B"),Br("#030305")],branch:[Br("#6A904B"),Br("#3F3929"),Br("#F2EDD8")],grass:[Br("#6A904B")],mushroom:[Br("#DCDDCD"),Br("#DCDDCD"),Br("#DCDDCD"),Br("#DCDDCD"),Br("#DCDDCD"),Br("#DCDDCD")],butterfly:[Br("#F2EDD8"),Br("#F2EDD8")],stone:[Br("#DCDDCD")],bg:[Br("#DCDDCD")],stroke:[Br("#262013"),Br("#465F32"),Br("#E5F2D8")]}},24:{colors:{vine:[Br("#6A904B")],fruit:[Br("#556843"),Br("#556843"),Br("#556843")],flower:[Br("#BD2D2D"),Br("#EED628")],leaf:[Br("#8BA260"),Br("#030305")],branch:[Br("#595347"),Br("#3F3929"),Br("#7E524A")],grass:[Br("#899F5E")],mushroom:[Br("#DCDDCD"),Br("#FFFFFD"),Br("#DCDDCD"),Br("#FFFFFD"),Br("#DCDDCD"),Br("#FFFFFD")],butterfly:[Br("#E2DDD3"),Br("#FFFFFD")],stone:[Br("#E2DDD3")],bg:[Br("#E2DDD3")],stroke:[Br("#262013"),Br("#465F32"),Br("#E5F2D8")]}},25:{colors:{vine:[Br("#303030")],fruit:[Br("#000000"),Br("#303030"),Br("#303030")],flower:[Br("#FF0000"),Br("#FFFFFF")],leaf:[Br("#303030"),Br("#030305")],branch:[Br("#000000"),Br("#303030"),Br("#303030")],grass:[Br("#000000")],mushroom:[Br("#303030"),Br("#000000"),Br("#303030"),Br("#000000"),Br("#303030"),Br("#000000")],butterfly:[Br("#FF0000"),Br("#D3D3D3")],stone:[Br("#303030")],bg:[Br("#272727")],stroke:[Br("#D3D3D3"),Br("#303030"),Br("#FFD900")]}},26:{colors:{vine:[Br("#DCC902")],fruit:[Br("#000000"),Br("#F6FCDE"),Br("#303030")],flower:[Br("#DCC902"),Br("#FFFFFF")],leaf:[Br("#23708C"),Br("#030305")],branch:[Br("#15486C"),Br("#303030"),Br("#303030")],grass:[Br("#303D38")],mushroom:[Br("#D0B06C"),Br("#23708C"),Br("#FFD900"),Br("#D0B06C"),Br("#303030"),Br("#D0B06C")],butterfly:[Br("#F6FCDE"),Br("#AA6B46")],stone:[Br("#F6FCDE")],bg:[Br("#D0B06C")],stroke:[Br("#685A3D"),Br("#303030"),Br("#FFD900")]}},27:{colors:{vine:[Br("#C853FD")],fruit:[Br("#5E7FE3"),Br("#89D7FC"),Br("#C853FD")],flower:[Br("#FF3A5D"),Br("#FFFFFE")],leaf:[Br("#05FCD5"),Br("#06ED95")],branch:[Br("#688EFF"),Br("#7ECAFF"),Br("#FF3A5D")],grass:[Br("#06ED95")],mushroom:[Br("#FF2771"),Br("#00FFDE"),Br("#7ECAFF"),Br("#A463FF"),Br("#FF99AA"),Br("#FFFFFE")],butterfly:[Br("#FFFFFE"),Br("#865B4B")],stone:[Br("#8A5E4F")],bg:[Br("#000000")],stroke:[Br("#E7E7E7"),Br("#00E791"),Br("#FF3A5D")]}}};const lr={SIMPLE:"基礎橢圓形",QUILL:"羽毛",WAVE:"波浪NOISE",GOURD:"葫蘆形",TRIANGLE:"三角",HEART:"心形",JAGGED:"鋸齒邊",ROUND:"圓形",BAMBOO:"竹葉",FERN:"蕨葉",BRUG:"紅茄苳"};const nr={[lr.SIMPLE]:e=>t=>pow(sin(PI*t),e.leafPointyness),[lr.QUILL]:e=>t=>pow(atan(PI*(1-t)),e.leafPointyness)*.5,[lr.WAVE]:e=>t=>{let r=pow(sin(PI*t),e.leafPointyness);let o=map(noise(t*.5),0,1,.05,.1)*cos(12*PI*t);return r*(1+o)},[lr.GOURD]:e=>t=>{let r=t-.35;return pow(1-4*r*r,e.leafPointyness)*(.5+.2*sin(t*6*PI))},[lr.TRIANGLE]:e=>e=>{if(e<.2){return e*5}else if(e>.8){return(1-e)*5}else{return 1}},[lr.HEART]:e=>t=>{let r=(t-.5)*2;let o=sqrt(1-abs(r))*sqrt(abs(r));o*=1.2-.3*pow(abs(r),.5);if(t<.4){o*=map(t,0,.4,0,1)}return o*1.5*e.leafPointyness},[lr.JAGGED]:e=>t=>noise(t*e.leafShapeEdge,e.leafShapeN)*pow(sin(PI*t),e.leafPointyness),[lr.ROUND]:e=>e=>{let t=(e-.5)*2;return sqrt(1-t*t)},[lr.BAMBOO]:e=>{let t=.5;return e=>{if(e<.1){let r=e/.05;return pow(r,.6)*.7*t}else if(e<.3){let r=(e-.05)/.15;return(.7+.3*r)*t}else{let r=(e-.3)/.7;return(1-pow(r,1.5))*(1+.1*sin(r*PI*2))*t}}},[lr.FERN]:e=>t=>{let r=1.5-pow(t,.7);let o=.3*(.5+.5*sin(t*10*PI));let l=1-pow(t,.1);let width=.2;return(r+o*l)*width*e.leafPointyness},[lr.BRUG]:e=>e=>pow(sin(PI*e),.7)};const ar={NATURAL:"自然花瓣",HEART:"心形花瓣",SLENDER:"細長花瓣",ROUND:"圓形花瓣"};const sr={[ar.NATURAL]:e=>t=>{if(t<.5){return.3+noise(t*e.flowerShapeEdge,e.flowerShapeN)*e.flowerShapeFn(t)}else{return.2+noise(t*e.flowerShapeEdge,e.flowerShapeN)*e.flowerShapeFn(t)}},[ar.HEART]:e=>e=>{let t=(e-.5)*2;if(e<.5){return.2+pow(1-abs(t),2)*(1+Math.sin(e*Math.PI*2))*.9}else{return.3+pow(1-abs(t),2)*(1+Math.sin(e*Math.PI*2))}},[ar.SLENDER]:e=>e=>{if(e<.5){return.2+.8*pow(sin(PI*e),1.5)}else{return.05+.95*pow(sin(PI*e),3)}},[ar.ROUND]:e=>e=>{let t=(e-.5)*2;let r=sqrt(1-t*t);return r*1.5}};const cr={SHARP_UP:"急劇上揚",SHARP_DOWN:"急劇下垂"};const ir={NOISE:"noise",EDGE_GRADIENT:"邊緣漸層",REVERSE_EDGE_GRADIENT:"反轉邊緣漸層",PEAK_GRADIENT:"010漸層",SOLID_COLOR:"純色"};const pr={[cr.SHARP_UP]:e=>e=>{let t=random(.1,.3);return e<t?0:e*8},[cr.SHARP_DOWN]:e=>e=>{let t=random(.1,.3);return e<t?2:e*Dr([-7,-12,-15])}};const hr={[ir.NOISE]:e=>{let t=random(5,15);return e=>pow(noise(e*t),.7)},[ir.EDGE_GRADIENT]:e=>{let t=random(.3,.4);let r=random(.4,.6);return e=>{if(e<t){return 0}else{let o=(e-t)/r;o=isNaN(o)?0:constrain(o,0,1);return pow(o,1.5)}}},[ir.REVERSE_EDGE_GRADIENT]:e=>{let t=random(.7,.8);let r=random(.2,.4);return e=>{if(e>t){return 0}else{let o=(t-e)/r;o=constrain(o,0,1);return pow(o,2)}}},[ir.PEAK_GRADIENT]:e=>{let t=random(.45,.55);let r=random(.1,.2);return e=>{let o=abs(e-t)/r;o=constrain(o,0,1);return pow(1-o,3)}},[ir.SOLID_COLOR]:e=>e=>1};const fr={UPRIGHT:"直立",CURVED:"彎曲"};const dr="對生";const mr="互生";const ur="輪生";const gr={branchFork:5,branchDepth:2,branchWidth:1.2,leafGrowType:mr,leafWidth:3,leafLength:30,spikeProb:1,flowerProb:.5,leafProb:.5,sunflowerPetalCount:12,flowerWidthA:10,sunSize:30,veinsType:[3,0],petalfType:[1,3],flowerLengthC:60,leafShape:nr[lr.ROUND]({leafPointyness:1})};const br={veinsType:[12,8],leafShape:nr[lr.BRUG]({leafPointyness:1}),leafGrowType:mr,branchDepth:2,branchFork:2,branchWidth:1.2,spikeProb:1,flowerProb:.9,leafProb:.5,leafLength:130,leafWidth:30};class yr{static getEulerFromPoints(e,t){if(t<=0||t>=e.length){console.error("getEulerFromPoints 中的無效索引");return createVector(0,0,0)}var r=p5.Vector.sub(e[t],e[t-1]);return this.vectorToEulerAngles(r)}static vectorToEulerAngles(e){if(!e||!this.isValidVector(e)){console.error("Invalid input vector in vectorToEulerAngles");return createVector(0,0,0)}let t=e.copy().normalize();if(!this.isValidVector(t)){console.error("Normalization failed in vectorToEulerAngles");return createVector(0,0,0)}let r=asin(constrain(-t.y,-1,1));let o=atan2(t.x,t.z);let l=0;return createVector(r,o,l)}static rotateVectorAroundAxis(e,t,r){if(!e||!t||typeof r!=="number"){console.error("Invalid parameters in rotateVectorAroundAxis");return createVector(0,0,0)}if(!this.isValidVector(e)){console.error("Invalid input vector:",e);return createVector(0,0,0)}if(!this.isValidVector(t)){console.error("Invalid rotation axis:",t);return e.copy()}let o=t.mag();if(o<1e-4){console.error("Zero magnitude rotation axis");return e.copy()}r=r%TWO_PI;let l=t.copy().mult(1/o);let n=cos(r);let a=sin(r);try{let t=e.copy().mult(n);let r=l.cross(e);let o=r.mult(a);let s=l.dot(e);let c=l.copy().mult(s*(1-n));return t.add(o).add(c)}catch(t){console.error("Error in rotation calculation:",t);return e.copy()}}static isValidVector(e){return e&&typeof e.x==="number"&&isFinite(e.x)&&typeof e.y==="number"&&isFinite(e.y)&&typeof e.z==="number"&&isFinite(e.z)}static applyEulerRotation(e,t){if(!e||!t){console.error("Invalid parameters in VectorUtils.applyEulerRotation");return createVector(0,0,0)}let r=e.copy();try{if(t.x!==0&&isFinite(t.x)){r=this.rotateVectorAroundAxis(r,createVector(1,0,0),t.x)}if(t.y!==0&&isFinite(t.y)){r=this.rotateVectorAroundAxis(r,createVector(0,1,0),t.y)}if(t.z!==0&&isFinite(t.z)){r=this.rotateVectorAroundAxis(r,createVector(0,0,1),t.z)}r.x=round(r.x*100)/100;r.y=round(r.y*100)/100;r.z=round(r.z*100)/100;return r}catch(t){console.error("Error in VectorUtils.applyEulerRotation:",t);return e.copy()}}static angle(e,t){var r=e.dot(t);var o=e.mag()*t.mag();var l=constrain(r/o,-1,1);return acos(l)}}class xr{constructor(e=1,t=0,r=0,o=0){this.w=e;this.x=t;this.y=r;this.z=o}static fromEuler(e){let t=cos(e.x*.5);let r=sin(e.x*.5);let o=cos(e.y*.5);let l=sin(e.y*.5);let n=cos(e.z*.5);let a=sin(e.z*.5);return new xr(t*o*n+r*l*a,r*o*n-t*l*a,t*l*n+r*o*a,t*o*a-r*l*n)}toEuler(){this.normalize();let e,t,r;let o=2*(this.w*this.x+this.y*this.z);let l=1-2*(this.x*this.x+this.y*this.y);e=atan2(o,l);let n=2*(this.w*this.y-this.z*this.x);if(abs(n)>=1){t=(n>=0?1:-1)*PI/2}else{t=asin(n)}let a=2*(this.w*this.z+this.x*this.y);let s=1-2*(this.y*this.y+this.z*this.z);r=atan2(a,s);return createVector(e,t,r)}normalize(){let e=sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);if(e===0)return this;this.w/=e;this.x/=e;this.y/=e;this.z/=e;return this}multiply(e){return new xr(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.w*e.x+this.x*e.w+this.y*e.z-this.z*e.y,this.w*e.y-this.x*e.z+this.y*e.w+this.z*e.x,this.w*e.z+this.x*e.y-this.y*e.x+this.z*e.w)}static combineRotations(e,t){let r=xr.fromEuler(e);let o=xr.fromEuler(t);return o.multiply(r).toEuler()}}class Fr{static createWidthFunction(e,t,r,l){return function(n){let[a,s]=Fr.calculateJointDistance(n,r,l);let c;if(a<1){c=e*(3+5*(1-n))}else{if(o==2){c=e*(2+7*(1-n)*map(noise(n*.001),0,1,.8,1))}else{c=e*(2+7*(1-n)*map(noise(n*10),0,1,.5,1))}}return min(c,t)}}static createbranchBendFunction(e,t){return function(r){let[o,l]=Fr.calculateJointDistance(r,e,t);if(typeof te==="undefined"||!Array.isArray(te)||te.length<2){te=[0,0]}if(o<1){return createVector(0,l*te[0],0)}else{return createVector(0,random(-te[1],te[1]),0)}}}static createJoints(e,t){let r=[];for(let o=0;o<e;o++){r.push([floor(random(0,1)*t),random(-.2,.2)])}return r}static calculateJointDistance(e,t,r){let o=r;let l=0;if(!t||t.length===0){return[o,0]}for(let n=0;n<t.length;n++){let a=abs(e*r-t[n][0]);if(a<o){o=a;l=n}}return[o,t[l][1]]}}function Pr(e){if(or[e]){PT.colorsID=e;PT.colors=or[e].colors;Ot.colorsID=e;Ot.colors=or[e].colors;return or[e].colors}return null}function wr(e){return{_seed:e,_state:new Uint32Array(4),_initialized:false,_init:function(){if(this._initialized)return;let e=this._seed;this._state[0]=e>>>0;this._state[1]=e*1597>>>0;this._state[2]=e*3571>>>0;this._state[3]=e*6011>>>0;for(let e=0;e<20;e++){this._next()}this._initialized=true},_next:function(){const e=this._state[1]*5>>>0;const t=this._state[1]<<9;this._state[2]^=this._state[0];this._state[3]^=this._state[1];this._state[1]^=this._state[2];this._state[0]^=this._state[3];this._state[2]^=t;this._state[3]=(this._state[3]<<11|this._state[3]>>>21)>>>0;return e},random:function(min=0,max=1){if(!this._initialized)this._init();const e=this._next()/4294967296;return min+e*(max-min)},noise:function(e,t=0){let r=Math.sin(e*12.9898+t*78.233)*43758.5453;return r-Math.floor(r)},randomGaussian:function(e=0,t=1){let r=this.random();let o=this.random();let l=Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*o);return e+l*t}}}function Vr(e,t,r){return floor(e.random(t,r))}function Cr(e,t){return t[floor(e.random(0,t.length*.99))]}function Er(e,min,max){if(arguments.length===1){max=min;min=0}return parseFloat(e.random(min,max).toFixed(2))}function Tr(e,t){return floor(random(e,t))}function Dr(e){return e[floor(random(0,e.length*.99))]}function Ar(min,max){if(arguments.length===1){max=min;min=0}return parseFloat(random(min,max).toFixed(2))}function Ir(e){let t=e.random(0,Math.PI*2);let r=Math.acos(e.random(-1,1));let o=Math.sin(r)*Math.cos(t);let l=Math.sin(r)*Math.sin(t);let n=Math.cos(r);return createVector(o,l,n)}function Lr(e,t,r){let o=((t-e)%360+540)%360-180;return(e+o*r+360)%360}function Sr(e){return noise(e)*2-1}function Br(e){e=e.replace("#","");let t=parseInt(e.substring(0,2),16)/255;let r=parseInt(e.substring(2,4),16)/255;let o=parseInt(e.substring(4,6),16)/255;let max=Math.max(t,r,o);let min=Math.min(t,r,o);let l,n,a=max;let s=max-min;n=max===0?0:s/max;if(max===min){l=0}else{switch(max){case t:l=(r-o)/s+(r<o?6:0);break;case r:l=(o-t)/s+2;break;case o:l=(t-r)/s+4;break}l/=6}return[(l*360).toFixed(2),n.toFixed(2),a.toFixed(2)]}function Wr(e,t){t=t!=undefined?t:4;let r=1/(1+exp(-t*(e-.4)));let o=1/(1+exp(-t*(e-.6)));return(r+o)/2}function kr(e,t,r,o=1){let l=e;let n=t;let a=r;let s=o;return color(l,n,a,s)}function Xr(e){let t=e.random(TWO_PI);return createVector(cos(t),sin(t))}function Yr(e,t,r){let o=p5.Vector.lerp(e,t,.5);let l=p5.Vector.dist(e,t)/2;let n=atan2(e.y-o.y,e.x-o.x);let a=atan2(t.y-o.y,t.x-o.x);if(a>n){a-=TWO_PI}let s=lerp(n,a,r);let c=o.x+cos(s)*l;let i=o.y+sin(s)*l;return createVector(c,i)}const Or=new Map;function zr(e){if(e instanceof p5.Color){return e}if(typeof e==="string"){if(Or.has(e)){return Or.get(e)}const t=color(e);Or.set(e,t);return t}return color("black")}function Rr(e,t,r,o=1){const l=`hsv_${e}_${t}_${r}_${o}`;if(Or.has(l)){return Or.get(l)}const n=kr(e,t,r,o);Or.set(l,n);return n}function vr(){PT={};PT.plantType="woody";PT.container={type:"",height:120,maxBranchWidthidth:45};ce=Tr(0,28);if(o==1){ce=23}else if(o==2){ce=24}l.顏色組=ce;Pr(ce);Mt=PT.colors.bg[0];PT.leafGrowType=Dr([dr,mr,ur]);PT={...PT,...$r(),...Mr(),...Hr(),...Gr(),..._r(),spiral:Nr()};if(o==1){PT={...PT,...gr}}else if(o==2){PT={...PT,...br}}return PT}function _r(){let e={};e.maxBranchWidth=300*M;e.branchWidth=Ar(.7,.9)*H;e.stemTexLine=random(0,1)>.9?1:0;e.branchColor=PT.colors.branch[0].map(Number);e.stemWidth=Ar(2,11);e.stemBend=Ar(3,8);e.stemLength=Ar(300,500);e.stemCount=Dr([2,3,4,5]);if(random(0,1)>.5)e.branchFork=Dr([1,2]);else e.branchFork=Dr([2,2,3,3,4,5]);e.branchDepth=Dr([0,1,1,2,2,3,4]);return e}function Nr(){let e={baseRadius:Ar(4.5,6.5),baseFrequency:10,baseWidth:Ar(2,4),widthVariation:Ar(3.5,6),bendStrength:Ar(.5,1),twistFactor:Ar(.3,.6),noiseScale:Ar(.05,.15),noiseStrength:Ar(.5,2),color:PT.colors.vine[0].map(Number),maxLength:Ar(.5,1),radiusVariation:Ar(1,1.5),spiralTightness:Ar(.6,1),glowProbability:Ar(.05,.3),detailLevel:Ar(2,20),smoothness:Ar(1,10),leaf:{pointyness:Ar(.5,1.5),frequency:Ar(5,10),amplitude:Ar(.05,.1),shape:t=>{let r=pow(sin(PI*t),e.leaf.pointyness);let o=e.leaf.amplitude*cos(e.leaf.frequency*PI*t);return r*(1+o)},color:PT.colors.vine[0].map(Number),size:{length:Ar(30,70)*1.5*M,width:Ar(15,25)*M},veins:{type:Tr(2,2),density:Tr(2,5),spacing:Tr(2,4)}}};return e}function Mr(){let e={fruitSize:Ar(80,130)*M,fruitProb:Ar(.5,.9),fruitTypes:["apple","apple","apple","pinecone","raspberry","raspberry","buddhahand","buddhahand"],appleSize:Ar(4,22)*M,raspberrySize:Ar(20,80)*M,melonSize:Ar(15,20)*M,buddhahandSize:Ar(20,25)*M,buddhahandFingers:Tr(12,16),buddhahandCurvature:Ar(.5,1.5),buddhaHandTextureDetail:Tr(3,6),fruitColors:{pinecone:PT.colors.fruit[0].map(Number),apple:PT.colors.fruit[1].map(Number),raspberry:PT.colors.fruit[2].map(Number),buddhahand:[60,.8,.9]},layers:Tr(6,10),scalesPerLayer:Tr(5,10)};e.fruitstem=e.appleSize*Ar(3,5)*N;if(Ar(0,1)<.5){e.coneHeight=e.fruitSize*Ar(.7,1);e.coneRadius=e.fruitSize*Ar(.2,.3)}else{e.coneHeight=e.fruitSize*Ar(.5,1);e.coneRadius=e.fruitSize*.02}return e}function Hr(){let e={flowerProb:Ar(.5,.9),flowerPetal:Dr([4,5,6,9]),sunflowerPetalCount:Dr([6,8,12]),flowerWidthA:Ar(10,20)*M,flowerLengthA:Ar(80,120)*M,flowerLengthC:Ar(120,300)*.3*M,flowerShapeEdge:Ar(5,10),flowerShapeN:Ar(0,PI)*.01,flowerShapeFn:e=>pow(sin(PI*e),.3)};let t=Dr([ar.NATURAL,ar.HEART,ar.SLENDER,ar.ROUND]);if(t==ar.ROUND)e.flowerLengthA=e.flowerLengthA/2;e.flowerShape=sr[t](e);let r=[Ar(-.5,.5),Ar(5,10)];let o=[Ar(0,1)*PI,Ar(1,5)];let l=[Ar(0,1)*PI,Ar(5,15)];let n=[Ar(0,1)*.5,Ar(.8,1.2)];e.sunSize=Dr([24,28,32])*M;e.flowerLengthB=max(Ar(5,15),e.flowerWidthA*.3)*M;e.flowerWidthB=max(Dr([3,Ar(2,8)]),e.flowerWidthA*.4)*M;let a=Tr(0,PT.colors.flower.length/2)*2;_t.flowerColorId=a;e.flowerColorA=PT.colors.flower[0].map(Number);e.flowerColorB=PT.colors.flower[1].map(Number);e.petalfType=Dr([[1,1],[1,2],[3,2],[6,2],[7,2],[8,Tr(1,5)],[9,2],[10,4]]);let s=Dr([ir.NOISE,ir.EDGE_GRADIENT,ir.REVERSE_EDGE_GRADIENT,ir.PEAK_GRADIENT,ir.SOLID_COLOR]);let c={seed:Ar(0,PI),frequency:Ar(1,5),amplitude:Ar(.5,1.5)};e.flowerColorFn=hr[s](c);_t.flowerColorType=s;return e}function Gr(){let e={leafProb:Dr([.2,.4,.6,.9]),veinsType:random(0,1)<.5?Dr([[0,Tr(8,16)],[1,Tr(2,5)],[2,Tr(5,12)],[11,2]]):Dr([[3,2],[4,0],[6,2],[5,2],[7,2],[8,Tr(1,5)],[9,2],[10,4],[11,2]]),veinsType2:Dr([[10,2],[0,Tr(5,10)],[11,2],[4,2]]),leafLength:random(0,1)<.8?Ar(120,250)*M:Ar(250,400)*M,leafWidth:Ar(20,40)*M,leafHeartSize:Ar(6,12)*M,leafPointyness:Ar(.5,1.5),leafShapeEdge:Ar(10,20),leafShapeN:Ar(0,1)*PI};e.leafLength=constrain(e.leafLength,100,500);e.leafWidth=constrain(e.leafWidth,20,50);e.shapeName=Dr([lr.SIMPLE,lr.QUILL,lr.TRIANGLE,lr.WAVE,lr.JAGGED,lr.HEART,lr.GOURD,lr.BAMBOO,lr.FERN,lr.HEART]);e.leafShape=nr[e.shapeName](e);Ue=e.veinsType;e.leafColorA=PT.colors.leaf[0].map(Number);e.leafColorB=PT.colors.leaf[1].map(Number);let t=[Ar(-.1,.1),Ar(3,5)];e.leafColorFn=e=>{let r=Wr(pow(e,1.5)+t[0],t[1]);return constrain(r,.1,.9)};return e}function Ur(){return{plantType:"grass",grassProb:Ar(.2,.7),grassLength:random(0,1)<.9?Ar(300,400)*M:Ar(400,600)*M,grassWidth:Ar(3,6)*M,grassShape:Dr([e=>pow(atan(PI*(1-e)*map(noise(e*1e3),0,1,.5,1)),2),e=>pow(cos(PI*e/2),2)]),grassColor:PT.colors.grass[0].map(Number),stembenScale:Dr([8,10,12])}}function $r(){let e={};e.spikeProb=Ar(.5,.95);e.spikeCountRange=Dr([1,3,5,8]);e.hasSpikesW=Ar(2,5);e.hasSpikesL=Ar(0,1)>.1?Ar(.2,.8):Ar(1,1.5);e.spikeColor=PT.colors.branch[1].map(Number);e.spikeColor2=PT.colors.branch[2].map(Number);return e}function qr(){let e=Tr(0,5);return{plantType:"mushroom",mushroomProb:Ar(.3,.6),mushroomColor:{cap:PT.colors.mushroom[e].map(Number),stem:PT.colors.mushroom[e].map(Number)},mushroomWidth:Dr([Ar(1.5,3),Ar(1.5,3),Ar(1.5,3),Ar(3,5)]),mushroomHeight:Tr(60,160),capWidth:null,capHeight:Tr(10,30),mushroomLimit:J.mushroom,mushroomCount:0}}function Jr(){let e=Dr([cr.SHARP_UP,cr.SHARP_DOWN]);let t={seed:Ar(0,PI),frequency:Ar(1,5),amplitude:Ar(.5,1.5)};Ot.flowerOpenCurve=pr[e](t);_t.flowerOpenType=e}function jr(){let e=[Ar(-.5,.5),Ar(5,10)];let t=[Ar(0,1)*PI,Ar(1,5)];let r=[Ar(0,1)*PI,Ar(5,15)];let o=[Ar(0,1)*PI,Ar(1,5)];let l=[Ar(0,1)*.5,Ar(.8,1.2)];let n=[function(e,t){return e<.1?2+t*r[1]:noise(e*10,r[0])},function(e,t){return e<l[0]?0:10-e*map(t,0,1,16,20)*l[1]},function(e,r){return sin(e*PI*t[1])*r*l[1]}];return Dr(n)}function Kr(){const e={width:p.dim*p.ratio,height:p.dim};const t={pgL4:{needsFont:false},pgL3:{needsFont:false},pgL1:{needsFont:false},pgL2:{needsFont:false},pgL0:{needsFont:false},pgBg:{needsFont:true,fontSize:60},pgText:{needsFont:true,fontSize:10,align:[LEFT,TOP]},pgFinal:{needsFont:false},pgTex:{needsFont:false},pgFrame:{needsFont:false},snapShotImg:{needsFont:false}};Object.entries(t).forEach((([t,r])=>{let o;o=createGraphics(e.width,e.height);Ae[t]=o;o.colorMode(HSB,360,1,1,1);o.strokeJoin(ROUND);o.strokeCap(SQUARE);o.noStroke();window[t]=o}));Ft=Array.from({length:z},(()=>createGraphics(e.width,e.height)))}function Qr(){let e={};e.leafColorA=[PT.colors.leaf[0][0],PT.colors.leaf[0][1],PT.colors.leaf[0][2]];e.leafColorB=[PT.colors.leaf[1][0],PT.colors.leaf[1][1],PT.colors.leaf[1][2]];e.branchColor=[PT.colors.branch[0][0],PT.colors.branch[0][1],PT.colors.branch[0][2]];e.vineColor=[PT.colors.vine[0][0],PT.colors.vine[0][1],PT.colors.vine[0][2]];e.fruitColors={pinecone:[PT.colors.fruit[0][0],PT.colors.fruit[0][1],PT.colors.fruit[0][2]],apple:[PT.colors.fruit[1][0],PT.colors.fruit[1][1],PT.colors.fruit[1][2]],raspberry:[PT.colors.fruit[2][0],PT.colors.fruit[2][1],PT.colors.fruit[2][2]],buddhahand:[60,.8,.9]};e.flowerColorA=[PT.colors.flower[0][0],PT.colors.flower[0][1],PT.colors.flower[0][2]];e.flowerColorB=[PT.colors.flower[1][0],PT.colors.flower[1][1],PT.colors.flower[1][2]];e.grassColor=[PT.colors.grass[0][0],PT.colors.grass[0][1],PT.colors.grass[0][2]];if(PT.colors&&PT.colors.branch){e.spikeColor=[PT.colors.branch[1][0],PT.colors.branch[1][1],PT.colors.branch[1][2]];e.spikeColor2=[PT.colors.branch[2][0],PT.colors.branch[2][1],PT.colors.branch[2][2]]}else{e.spikeColor=[0,0,0];e.spikeColor2=[0,0,0]}return e}function Zr(e){let t=Gr();Ot.leafShape=t.leafShape;Ot.leafProb=t.leafProb;Ot.veinsType=t.veinsType;Ot.leafLength=t.leafLength;Ot.leafWidth=t.leafWidth;Ot.leafHeartSize=t.leafHeartSize;Ot.leafPointyness=t.leafPointyness;Ot.leafShapeEdge=t.leafShapeEdge;Ot.leafShapeN=t.leafShapeN;Ot.leafColorA=t.leafColorA;Ot.leafColorB=t.leafColorB;Ot.leafColorFn=t.leafColorFn}function eo(e){let t=Hr();Ot.flowerProb=t.flowerProb;Ot.flowerPetal=t.flowerPetal;Ot.flowerWidthA=t.flowerWidthA;Ot.flowerLengthA=t.flowerLengthA;Ot.flowerWidthB=t.flowerWidthB;Ot.flowerLengthB=t.flowerLengthB;Ot.flowerLengthC=t.flowerLengthC;Ot.flowerShapeEdge=t.flowerShapeEdge;Ot.flowerShapeN=t.flowerShapeN;Ot.flowerShapeFn=t.flowerShapeFn;Ot.flowerShape=t.flowerShape;Ot.flowerColorA=t.flowerColorA;Ot.flowerColorB=t.flowerColorB;Ot.flowerColorFn=t.flowerColorFn;Ot.sunflowerPetalCount=t.sunflowerPetalCount;Ot.sunSize=t.sunSize}function to(e){let t=Mr();Ot.fruitSize=t.fruitSize;Ot.fruitColors=t.fruitColors;Ot.fruitProb=t.fruitProb;Ot.fruitTypes=t.fruitTypes;Ot.seedType=t.seedType;Ot.appleSize=t.appleSize;Ot.fruitstem=t.fruitstem;Ot.layers=t.layers;Ot.scalesPerLayer=t.scalesPerLayer;Ot.coneHeight=t.coneHeight;Ot.coneRadius=t.coneRadius;Ot.buddhaHandSize=t.buddhaHandSize;Ot.buddhaHandFingers=t.buddhaHandFingers;Ot.buddhaHandCurvature=t.buddhaHandCurvature;Ot.buddhaHandTextureDetail=t.buddhaHandTextureDetail}function ro(){let e=_r();Ot.branchWidth=e.branchWidth;Ot.branchDepth=e.branchDepth;Ot.branchColor=e.branchColor;Ot.branchFork=e.branchFork}function oo(){let e=$r();Ot.spikeProb=e.spikeProb;Ot.hasSpikesW=e.hasSpikesW}function lo(){let e=wr(Nt);if(Ht==0||Ht==3)Te=Cr(e,[0,1,2,3,4]);else Te=Cr(e,[0,1,2]);if(Ht==0&&ct)Te=5;l.外框類型=Te;Jt=e.random(.105,.12);pgFrame.rectMode(CENTER);pgFrame.noFill();if(Te==0||Te==1||Te==3)pgFrame.stroke(Ce[0][0],Ce[0][1],Ce[0][2],1);else if(Te==2||Te==4)pgFrame.stroke(Ce[0][0],Ce[0][1]*.8,Ce[0][2]*.9,1);if(Te==0)Jt=.1,pgFrame.strokeWeight(width*(Jt+.02));else if(Te==1)Jt=.1,pgFrame.strokeWeight(width*Jt);else if(Te==2)Jt=.08,pgFrame.strokeWeight(width*Jt);else if(Te==3)Jt=.1,jt=.51,pgFrame.strokeWeight(width*Jt);else if(Te==4)Jt=.1,jt=.505,pgFrame.strokeWeight(width*Jt);pgFrame.rect(width/2,height/2,width,height);pgFrame.strokeWeight(2);if(Te==0){pgFrame.stroke(Ee[0],Ee[1],Ee[2],.8);co(width/2,height/2,width-width*Jt,height-width*Jt,-.15,1.5);co(width/2,height/2,width-width*(Jt+.02),height-width*(Jt+.02),-.2,3)}else if(Te==1){pgFrame.stroke(Ee[0],Ee[1],Ee[2],.8);co(width/2,height/2,width-width*.1,height-width*.1,-.2,3)}else if(Te==2){pgFrame.stroke(Ee[0],Ee[1],Ee[2],.8);co(width/2,height/2,width-width*Jt,height-width*Jt,-.2,3)}else if(Te==3){pgFrame.translate(height/2,height/2);pgFrame.fill(Ce[0][0],Ce[0][1],Ce[0][2],1);pgFrame.push();bo(.9);pgFrame.rotate(HALF_PI);bo(.9);pgFrame.rotate(HALF_PI);bo(.9);pgFrame.rotate(HALF_PI);bo(.9);pgFrame.pop();pgFrame.strokeWeight(2);pgFrame.stroke(Ee[0],Ee[1],Ee[2],.8);ao(height*.9*.5,-.1,2);ao(height*.9*jt,-.2,3.5)}else if(Te==4){pgFrame.translate(height/2,height/2);pgFrame.fill(Ce[0][0],Ce[0][1]*.8,Ce[0][2]*.9,1);pgFrame.push();bo(.9);pgFrame.rotate(HALF_PI);bo(.9);pgFrame.rotate(HALF_PI);bo(.9);pgFrame.rotate(HALF_PI);bo(.9);pgFrame.pop();pgFrame.strokeWeight(2);pgFrame.stroke(Ee[0],Ee[1],Ee[2],.8);pgFrame.strokeWeight(2);pgFrame.stroke(Ee[0],Ee[1],Ee[2],.8);ao(height*.9*.5,-.15,3.5);ao(height*.9*jt,-.2,2)}io(Jt);mo(jt)}function no(e=100){const t=[];const r=.005;for(let o=0;o<TAU;o+=r){const r=1;t.push(new createVector(cos(o)*e*r,sin(o)*e*r))}return t}function ao(e,t=-.15,r=3){let o=no(e);pgFrame.push();const l=1;for(let e=0;e<o.length-1;e++){const n=t;const a=(noise(e*l,random(0,500)*.05)+n)*r;const s=o[e];const c=o[e+1];pgFrame.strokeWeight(a>.5?a:random(0,1)>.8?0:0);pgFrame.line(s.x,s.y,c.x,c.y)}pgFrame.pop()}function so(e,t){const r=[];const o=.5;for(let l=-e/2;l<=e/2;l+=o){r.push(new createVector(l,-t/2))}for(let l=-t/2;l<=t/2;l+=o){r.push(new createVector(e/2,l))}for(let l=e/2;l>=-e/2;l-=o){r.push(new createVector(l,t/2))}for(let l=t/2;l>=-t/2;l-=o){r.push(new createVector(-e/2,l))}return r}function co(e,t,r,o,l=-.15,n=3){let a=so(r,o);pgFrame.push();pgFrame.translate(e,t);const s=1;for(let e=0;e<a.length-1;e++){const t=l;const r=(noise(e*s,frameCount*.05)+t)*n;const o=a[e];const c=a[e+1];pgFrame.strokeWeight(r>.5?r:random(0,1)>.8?0:0);pgFrame.line(o.x,o.y,c.x,c.y)}pgFrame.pop()}function io(){if(Te>2)return;pgFrame.push();pgFrame.stroke(Ee[0],Ee[1],Ee[2],.3);let e=z;let t=5;let r=width*(Jt/2);let o=width*(1-Jt/2);let l=(o-r)/e;for(let e=0;e<=z;e++){let o=r+e*l;let n=height-width*(Jt/2)+2;if(e%5==0)pgFrame.strokeWeight(1),pgFrame.line(o,n+2,o,n+4+t);else pgFrame.strokeWeight(.5),pgFrame.line(o,n+2,o,n+2+t)}pgFrame.pop()}function po(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Ee[0],Ee[1],Ee[2],random(.05,.15));let e=width*(1-Jt/4)/z;let t=height-width*Jt/4;let r=X/z;let o=width*Jt/3+e*X;let l=o+e;pgFrame.ellipse(o,t,2)}function ho(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Ee[0],Ee[1],Ee[2],random(.05,.15));let e=width*(1-Jt/4)/z;let t=height-width*Jt/4;let r=X/z;let o=width*Jt/3+e*X;let l=o+e;pgFrame.ellipse(o,t,2)}function fo(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Ee[0],Ee[1],Ee[2],random(.05,.15));let e=width*(1-Jt)/z;let t=height-width*(Jt/2)+7;let r=X/z;let o=width*Jt/2+e*X;let l=o+e;go(o,t,l,t)}function mo(){if(Te<3)return;pgFrame.push();pgFrame.translate(0,0);let e=height*.91*jt;let t=PI/2;let r=PI*2*.75;for(let o=0;o<z;o++){let l=map(o,0,z-1,t,r);let n=cos(l)*e;let a=sin(l)*e;let s=cos(l)*(e-(o%5==0?9:5));let c=sin(l)*(e-(o%5==0?9:5));pgFrame.stroke(Ee[0],Ee[1],Ee[2],.01);pgFrame.line(n,a,s,c)}pgFrame.pop()}function uo(){if(Te<3)return;pgFrame.push();pgFrame.translate(0,0);pgFrame.stroke(0,0,0,.5);let e=height*.91*jt;let t=X/(z-1);let r=PI*2*.75;let o=map(t,0,1,PI*2*.75,PI/2);let l=.03;for(let t=r;t>o;t-=l){let r=cos(t)*e;let o=sin(t)*e;let n=cos(t-l)*e;let a=sin(t-l)*e;go(r,o,n,a,-.2,2)}pgFrame.pop()}function go(e,t,r,o,l=-.1,n=2){pgFrame.push();const a=1;const s=[];const c=dist(e,t,r,o);const i=1;for(let l=0;l<=c;l+=i){const n=l/c;const a=lerp(e,r,n);const i=lerp(t,o,n);s.push(createVector(a,i))}for(let e=0;e<s.length;e++){const t=l;const r=(noise(e*a,frameCount*.05)+t)*n;if(r>.5){pgFrame.strokeWeight(r);pgFrame.point(s[e].x,s[e].y)}}pgFrame.pop()}function bo(e=.95){let t=height/2*e;pgFrame.noStroke();pgFrame.beginShape();pgFrame.vertex(-t,-t);pgFrame.vertex(0,-t);let r=-t*.552284749831;pgFrame.bezierVertex(r,-t,-t,r,-t,0);pgFrame.endShape()}async function yo(){if(!Ml||!Ml.paths||!Array.isArray(Ml.paths)||!Ml.dots||!Array.isArray(Ml.dots)){console.error("JSON 数据格式错误，缺少必要的 paths 或 dots 数组");return}const e=Ml;allPaths=[];$t={segments:[],dots:[]};for(let t=0;t<e.paths.length;t++){let r=e.paths[t];if(!Array.isArray(r)||r.length<2){console.warn(`路径 ${t} 无效或点数不足，跳过此路径`);continue}let o=true;for(let e of r){if(e.x===undefined||e.y===undefined){console.warn(`路径 ${t} 中有无效点，跳过此路径`);o=false;break}}if(!o)continue;allPaths.push(r.map((e=>createVector(e.x,e.y))));let l=0;for(let e=0;e<r.length-1;e++){let t=r[e];let o=r[e+1];let n=dist(t.x,t.y,o.x,o.y);l+=n}l=map(l,0,500,0,width);let n=[];for(let e=0;e<r.length;e++){if(e===0){n.push(0)}else{let t=r[e-1];let o=r[e];let l=atan2(o.y-t.y,o.x*p.ratio-t.x*p.ratio);n.push(l)}}for(let e=0;e<r.length-1;e++){let o=r[e];let n=r[e+1];let a=atan2(n.y-o.y,n.x*p.ratio-o.x*p.ratio);let s=dist(o.x*p.ratio,o.y,n.x*p.ratio,n.y);s=map(s,0,500,0,p.dim)*random(.95,1.05);let c=a+1.57;let i=zt.branchWidth*random(.8,1.2);$t.segments.push({startPoint:o,endPoint:n,baseX:o.x,baseY:o.y,baseRotation:createVector(PI/2,0,c),branchLength:s,branchWidthFunc:i,maxBranchDepth:zt.branchDepth,col:zt.branchColor,forkCount:zt.branchFork,maxBranchWidth:zt.maxBranchWidth,meta:zt,twistIntensity:0,stemTexLine:1,pathIndex:t,pathTotal:l})}}let t=e.dots;let r=t.filter((e=>e.x!==undefined&&e.y!==undefined));if(r.length!==t.length){console.warn(`有 ${t.length-r.length} 个无效点被过滤`)}singlePoints=r.map((e=>createVector(e.x,e.y)));for(let e=0;e<r.length;e++){$t.dots.push({baseX:r[e].x,baseY:r[e].y})}}function xo(){if(window.location.hash){return}const e=new URLSearchParams(window.location.search);if(!e.has("useCommentData")){return}const t=document.getElementsByTagName("script");for(let e=0;e<t.length;e++){const r=t[e];if(!r.src||!r.src.includes("sketch.js")){continue}const o=new XMLHttpRequest;o.open("GET",r.src,false);o.send();if(o.status!==200){console.error("无法加载脚本内容");return}const l=o.responseText;const n=l.match(/\/\/#data_([^\r\n]+)/);if(!n){return}const a=n[1].trim().split(" ")[0];window.location.hash="#data_"+a;return}}window.onload=function(){xo()};function Fo(){try{const e=window.location.hash;if(e&&e.includes("#data_")){let t=e.split("#data_")[1];if(t.includes("&")){t=t.split("&")[0]}if(t.includes("#")){t=t.split("#")[0]}if(t.includes("?")){t=t.split("?")[0]}t=decodeURIComponent(t);console.log("成功解码URL参数，数据为:",t);const r=wo(t);if(r){const e={paths:r.paths.map((e=>e.map((e=>({x:e.x,y:e.y}))))),dots:r.dots.map((e=>({x:e.x,y:e.y})))};console.log("最终JSON结构:",JSON.stringify(e,null,2));return e}try{let e;try{e=atob(t)}catch(r){console.error("base64解码失败，尝试直接解析JSON:",r);e=t}const r=JSON.parse(e);console.log("使用标准JSON格式解码");if(r.p&&Array.isArray(r.p)){const e=r.p.map(Po);const t=e.map((e=>e.map((e=>({x:e.x,y:e.y})))));console.log(`已加载 ${e.length} 条路径 (JSON格式)`);let o=[];if(r.d&&Array.isArray(r.d)){o=r.d.map((e=>({x:e[0],y:e[1]})));console.log(`已加载 ${o.length} 个点`)}const l={paths:t,dots:o};console.log("最终JSON结构:",JSON.stringify(l,null,2));return l}else if(r.paths&&Array.isArray(r.paths)){console.log(`已加载 ${r.paths.length} 条旧格式路径`);console.log("最终JSON结构:",JSON.stringify(r,null,2));return r}}catch(e){console.warn("JSON解析失败")}}}catch(e){console.warn("解析URL数据失败:",e)}return null}function Po(e){if(!e.length)return[];const t=[];let r=e[0][0];let o=e[0][1];t.push(createVector(r,o));for(let l=1;l<e.length;l++){r+=e[l][0];o+=e[l][1];t.push(createVector(r,o))}return t}function wo(e){try{if(!e||e.length<5){console.log("数据太短，无法解析为有效的二进制格式");return null}let t;try{const r=e.replace(/-/g,"+").replace(/_/g,"/");t=atob(r)}catch(e){console.error("二进制解码失败",e);return null}if(t.length<2){console.log("解码后数据太短，无法包含有效信息");return null}let r=0;const o=t.charCodeAt(r++);if(o===undefined||r>=t.length){console.log("无法读取路径数量或数量为0");return null}const l=[];for(let e=0;e<o;e++){if(r>=t.length){console.log("数据不完整，无法读取所有路径");return{paths:l,dots:[]}}const e=t.charCodeAt(r++);if(e===undefined||e<1||r>=t.length){console.log("无效的点数量");continue}let o=[];let n=0,a=0;let s=e>2;let c=true;let i=null;for(let p=0;p<e;p++){if(r+1>=t.length){console.log("数据不完整，无法读取所有点");if(o.length>0){l.push(o)}return{paths:l,dots:[]}}if(p===0){const e=t.charCodeAt(r++)*2;const l=t.charCodeAt(r++)*2;n=e;a=l;o.push(createVector(e,l))}else{const e=t.charCodeAt(r++);const l=t.charCodeAt(r++);const h=e-128;const f=l-128;if(s&&p>1){const e=o[p-1].x-o[p-2].x;const t=o[p-1].y-o[p-2].y;if(p===2){i={dx:e,dy:t}}if(i){const e=Math.sign(h)===Math.sign(i.dx)&&Math.sign(f)===Math.sign(i.dy);if(!e){c=false}}}n+=h;a+=f;o.push(createVector(n,a))}}if(o.length>=2){if(s&&c&&o.length>2){const e=o[0].copy();const t=o[o.length-1].copy();o=[e,t]}l.push(o)}else{console.log("路径点数不足，已忽略")}}const n=[];if(r<t.length){try{const e=t.charCodeAt(r++);if(e>0&&e<100){console.log(`开始解析${e}个独立点`);for(let o=0;o<e;o++){if(r+1>=t.length){console.log(`数据不足，无法解析第${o+1}个点`);break}const e=t.charCodeAt(r++)*2;const l=t.charCodeAt(r++)*2;if(e>0&&e<500&&l>0&&l<500){n.push(createVector(e,l));console.log(`添加有效独立点: (${e}, ${l})`)}else{console.log(`忽略超出画布范围的点: (${e}, ${l})`)}}}}catch(e){console.error("解析独立点时出错",e)}}if(l.length>0||n.length>0){const e={paths:l,dots:n};const t={paths:l.map((e=>({length:e.length,first:e.length>0?{x:e[0].x,y:e[0].y}:null,last:e.length>0?{x:e[e.length-1].x,y:e[e.length-1].y}:null}))),dots:n.map((e=>({x:e.x,y:e.y})))};return e}else{console.log("解压结果无有效数据");return null}}catch(e){console.error("二进制解码失败",e);return null}}{function Vo(){pgL0.clear();pgL1.clear();pgL2.clear();pgL3.clear();pgL4.clear();pgText.clear();pgFinal.clear()}function Co(){if(!xt||xt.length===0){console.warn("yPositions 為空或未定義");return}Vt=[...xt].sort(((e,t)=>{if(abs(e.y-t.y)<.001){return e.index-t.index}return e.y-t.y}));vl();if(!Le){Le=createGraphics(p.dim*p.ratio,p.dim)}Le.clear();for(let e of Vt){if(Ft[e.index]){Le.image(Ft[e.index],0,0)}}}function Eo(){pgFinal.image(pgL0,0,0);if(rr==0){pgFinal.image(pgL1,0,0);pgFinal.image(pgL2,0,0)}else if(rr==1){pgFrame.push();if(Te==3||Te==4)pgFrame.translate(-width/2,-height/2);pgFrame.image(pgL1,0,0);pgFrame.image(pgL2,0,0);pgFrame.pop()}pgFinal.image(pgL3,0,0);pgFinal.image(pgL4,0,0);pgFinal.image(pgText,0,0);if(!Ft[X]){Ft[X]=createGraphics(p.dim*p.ratio,p.dim);Ft[X].PLANT=vt.PLANT}Ft[X].image(pgFinal,0,0);xt[X]={y:constrain(K,0,p.dim),index:X};Co()}function To(){for(let e of Ft){if(e){e.remove()}}Ft=[];wt=[];Ct.clear();xt=[];Pt=[];Vt=[];X=0;Y=0;R=false;v=false;if(Ie){Ie.remove()}if(Le){Le.remove()}}}{function Do(e={}){let{pg:t=pgL0,baseX:r=0,baseY:o=0,meta:l=e.PT||{},benScale:n=10}=e;let a=[];let s=Dr([[3,2],[4,2],[5,2],[8,2],[9,2],[8,2]]);let c=0;for(let e=0;e<J.grass;e++){if(random(0,1)<l.grassProb&&l.grassCount<J.grass){l.grassCount++;let a=random(1.2,3)*M;let i=r+random(-15,15);let p=o+random(-15,15);let h=(e,0,J.grass,2,n);c++;P.leaf({pg:t,veinsType:s,baseX:i,baseY:p,col:[l.grassColor[0],l.grassColor[1],l.grassColor[2],1],baseRotation:createVector(PI/2+random(-.5,.5),random(-1,1)*PI,0),branchLength:l.grassLength*random(.8,1.5),branchWidthFunc:function(e){return l.grassShape(e)*l.grassWidth*a},branchBendFunc:function(t){return createVector(map(noise(t*2,e),0,1,-1,1)*h,0,map(noise(t*2,e+PI),0,1,-1,1)*h)}})}}return a}function Ao(e={}){let{pg:t=pgL0,baseX:r=0,baseY:o=0,PT:l=e.PT||{},capWidth:n=e.capWidth}=e;if(!vt||!vt.PT){console.error("eachPlant or eachPlant.PT is undefined");return[]}let a=[];for(let e=0;e<J.mushroom;e++){if(random(0,1)<vt.PT.mushroomProb&&vt.PT.mushroomCount<J.mushroom){Io({pg:t,baseX:r+random(-5,5),baseY:o+random(-5,5),M:l,capWidth:n});vt.PT.mushroomCount++}}return a}function Io(e={}){let{pg:t,baseX:r,baseY:o,M:l=e.M||{},capWidth:n=l.capWidth,capHeight:a=l.capHeight,baseWidth:s=l.mushroomWidth,mushroomHeight:c=l.mushroomHeight,col:i=l.mushroomColor,strokeStrength:p=1,lineSegScale:h=Dr([.05,.2,1,5]),lineLimit:f=Dr([.4,.95,.1]),pointShift:d=3}=e;let m=wr(Nt);p=p+m.random(0,1)*2;d=10*be;let u=[];let g=c-a;let b=random(0,1)>.5;let y=[random(-1,1),random(-2,2),random(-1,1)];const x=(e=true)=>{const l={pg:t,baseX:r,baseY:o,baseRotation:createVector(PI/2,y[0],0),branchLength:g,col:[zt.colors.mushroom[0][0],zt.colors.mushroom[0][1],zt.colors.mushroom[0][2],1],branchWidthFunc:e=>{let t=1-pow(1-e,.2);let r=noise(e*3)*2+.5;let o=sin(e*PI*3)*.1+1;return s*(1.2-t)*r*o},branchBendFunc:e=>createVector(y[1],y[2],0),branchSegmentsH:3,closeS:true,curveS:false,mushroomStroke:true};return F.stem(l)};let P=x();let w=P.centerPos[P.centerPos.length-1];let V=random(.5,3);let C=random(0,1)>.5;let E=createVector(0,0,0);let T=[];let D=16;for(let e=0;e<D;e++){T.push({x:random(-2,2),y:random(1,2),z:random(-2,2)})}let A;if(random(0,1)<Wt)A=zt.colors.stroke[2];else A=zt.colors.stroke[0];if(de==0)A=[0,0,1];const I=(e,l=false)=>{let s=createVector(e.x,e.y+7,e.z);let c=createVector(0,0,0);let h=[s.copy()];let f=[];let m=[];let u=D;let g=e=>createVector(sin(e*PI)*random(-2,2)*V,-cos(e*PI)*random(1,2),cos(e*PI)*random(-2,2)*V);let b=(e,t)=>{let r=n*sin(e*PI);let o=noise(e*5)*.3;if(C){t=t==="left"?"right":"left"}return t==="left"?r*(1-o):r*(1+o)};for(let e=0;e<u;e++){let n=e/(D-1);let p=createVector(sin(n*PI)*T[e].x,-cos(n*PI)*T[e].y,cos(n*PI)*T[e].z);c.add(p5.Vector.mult(p,1/D));let d=createVector(0,-a/D,0);let u=yr.applyEulerRotation(d,c);s.add(u);let g=b(n,"left");let y=b(n,"right");if(l){if(n<.5){let e=map(n,0,.5,-.5,1);let t=sin(map(e,0,1,PI/2,PI));g*=t;y*=t}if(n>.5)continue}let x=yr.applyEulerRotation(createVector(-g,0,0),c);let F=yr.applyEulerRotation(createVector(y,0,0),c);f.push(p5.Vector.add(s,x));m.push(p5.Vector.add(s,F));h.push(s.copy());if(e>0){let n;let a;let s;if(l){n=i.cap[0];a=i.cap[1];s=i.cap[2]}else{n=i.cap[0];a=i.cap[1];s=i.cap[2]*.7}Cl({pg:t,pts:[f[e],f[max(e-2,0)],h[max(e-2,0)],h[e]],baseX:r,baseY:o,doFill:true,doStr:false,col:kr(n,a,s,1),randomOffset:1,vertexMode:rt});Cl({pg:t,pts:[m[e],m[max(e-2,0)],h[max(e-2,0)],h[e]],baseX:r,baseY:o,doFill:true,doStr:false,col:kr(n,a,s,1),randomOffset:1,vertexMode:rt})}}if(!l){El({pg:t,pts:f.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-d,d);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(A[0],A[1],A[2],1),branchWidthFunc:e=>(.15*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*ge});El({pg:t,pts:m.map((e=>{let t=map(noise(e.x*U,e.y*U,frameCount),0,1,-d,d);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(A[0],A[1],A[2],1),branchWidthFunc:e=>(.15*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*ge})}else if(l){let l=5;for(let n=0;n<l;n++){let a=floor(map(n,0,l-1,f.length*.1,f.length*.9));if(a>=0&&a<f.length){let l=f[a];let s=m[a];let c=createVector(e.x,e.y-5,e.z);let i=[];let p=[];let h=10;for(let e=0;e<=h;e++){let t=e/h;let r=lerp(l.x,c.x,t);let o=lerp(l.y,c.y,t);let a=lerp(l.z,c.z,t);let s=sin(t*PI)*noise(t*5+n)*5;r+=s*noise(t*3+n*10);o+=s*noise(t*3+n*20);i.push(createVector(r,o,a))}for(let e=0;e<=h;e++){let t=e/h;let r=lerp(s.x,c.x,t);let o=lerp(s.y,c.y,t);let l=lerp(s.z,c.z,t);let a=sin(t*PI)*noise(t*5+n+100)*5;r+=a*noise(t*3+n*10+100);o+=a*noise(t*3+n*20+100);p.push(createVector(r,o,l))}El({pg:t,pts:i,branchWidthFunc:e=>{let t=1;let r=noise(e*5+n*10)*.5+.5;let o=sin(e*PI);let l=1-pow(abs(e-.5)*2,2);return t*o*r*l},doFill:true,baseX:r,baseY:o,col:kr(A[0],A[1],A[2],.5)});El({pg:t,pts:p,branchWidthFunc:e=>{let t=1;let r=noise(e*5+n*10+100)*.5+.5;let o=sin(e*PI);let l=1-pow(abs(e-.5)*2,2);return t*o*r*l},doFill:true,baseX:r,baseY:o,col:kr(A[0],A[1],A[2],.5)})}}El({pg:t,pts:f.map((e=>{let t=map(noise(e.x*U,e.y*U),0,1,-d,d);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,doFill:true,col:kr(A[0],A[1],A[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*ge});El({pg:t,pts:m.map((e=>{let t=map(noise(e.x*U,e.y*U),0,1,-d,d);let r=map(noise(e.y*U,e.x*U,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,doFill:true,col:kr(A[0],A[1],A[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*ge})}return{leftPos:f,rightPos:m,centerPos:h}};if(b){t.push();x(true);let e=I(w);Wo(t,r,o,n,a,e.leftPos,e.rightPos,e.centerPos,i.cap);t.pop()}else{t.push();let e=x(false);let l=e.centerPos[e.centerPos.length-1];let s=I(l,false);Wo(t,r,o,n,a,s.leftPos,s.rightPos,s.centerPos,i.cap);I(l,true);x(true);t.pop()}return u}function Lo(e,t){let r=false;for(let o=0,l=t.length-1;o<t.length;l=o++){let n=t[o].x,a=t[o].y;let s=t[l].x,c=t[l].y;let i=a>e.y!==c>e.y&&e.x<(s-n)*(e.y-a)/(c-a)+n;if(i)r=!r}return r}function So(e,t){let r=null;let o=Infinity;for(let l=0,n=t.length-1;l<t.length;n=l++){let a=t[n];let s=t[l];let c=createVector(s.x-a.x,s.y-a.y);let i=createVector(e.x-a.x,e.y-a.y);let p=c.magSq();if(p===0){let t=dist(e.x,e.y,a.x,a.y);if(t<o){o=t;r=createVector(a.x,a.y)}continue}let h=i.dot(c);let f=constrain(h/p,0,1);let d=createVector(a.x+f*c.x,a.y+f*c.y);let m=dist(e.x,e.y,d.x,d.y);if(m<o){o=m;r=d}}return r||createVector(e.x,e.y)}function Bo(e,t){for(let r of e){if(!Lo(r,t)){let e=So(r,t);r.x=e.x;r.y=e.y}}return e}function Wo(e,t,r,o,l,n,a,s,c){const i=random(10,15);let p=[];for(let o=0;o<i;o++){let o,i,h,f,d,m,u;let g=20;let b=50;let y=0;let x=false;while(!x&&y<b){o=floor(random(1,s.length-1));i=s[o];h=random(-l*2,l*2);f=random(-l*.5,l*.5);d=random(1,6);m=t+i.x+h;u=r+i.y+f;x=true;for(let e of p){let t=dist(m,u,e.x,e.y);if(t<g){x=false;break}}y++}if(!x)continue;p.push({x:m,y:u});let F=[];let P=random(.5,1.5);let w=random(.5,1.5);for(let e=0;e<60;e++){let t=e/60*TWO_PI;let r=noise(cos(t)*1.5,sin(t)*1.5)*.2+.9;let o=m+cos(t)*d*r*P;let l=u+sin(t)*d*r*w;F.push(createVector(o,l))}let V=[];for(let e=0;e<n.length;e++){V.push({x:t+n[e].x,y:r+n[e].y})}for(let e=a.length-1;e>=0;e--){V.push({x:t+a[e].x,y:r+a[e].y})}F=Bo(F,V);Cl({pg:e,pts:F,doFill:true,col:kr(c[0],c[1]*random(.8,1.2),c[2]*random(.8,1.2),1),randomOffset:2,n:5});let C;if(random(0,1)<Wt)C=zt.colors.stroke[2];else C=zt.colors.stroke[0];El({pg:e,pts:F,doFill:true,col:kr(C[0],C[1],C[2],1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*ge,randomOffset:1,n:5})}}function ko(e,t,r){let o=random(.1,.5);let l=random(random(0,1))*Dr([1,-1])*width*.4;let n=random(random(0,1))*Dr([1,-1])*height*.4;Ro({pg:pgL4,baseX:e+l,baseY:t+n,size:o,bodyColor:[r.colors.butterfly[0][0],r.colors.butterfly[0][1],r.colors.butterfly[0][2]*random(.6,1.2),1],wingColor:[r.colors.butterfly[1][0]*random(.9,1.1),r.colors.butterfly[1][1],r.colors.butterfly[1][2]*random(.9,1.1),1]})}function Xo(e,t,r){let o=random(.1,.5);let l=random(random(0,1))*Dr([1,-1])*width*.4;let n=random(random(0,1))*Dr([1,-1])*height*.4;vo({pg:pgL4,baseX:e+l,baseY:t+n,size:o,bodyColor:[r.colors.butterfly[0][0],r.colors.butterfly[0][1]*.8,r.colors.butterfly[0][2]*random(.8,1.2),1],wingColor:[0,0,random(.6,1),.3]})}function Yo(e,t,r){let o=random(.2,.4);let l=random(random(0,1))*Dr([1,-1])+random(-10,10);let n=random(random(0,1))*Dr([1,-1])+random(-10,10);Oo({pg:pgText,baseX:e+l,baseY:t+n,size:o,bodyColor:Dr([zt.colors.stroke[1],zt.colors.stroke[2]]),spotColor:zt.colors.stroke[0],rotation:TWO_PI*.75+random(-1.5,1.5),ratio:random(.4,.8)})}function Oo(e={}){const{pg:t,baseX:r,baseY:o,size:l=1,bodyColor:n=[0,1,.5,1],spotColor:a=[0,0,.1,1],rotation:s=TWO_PI*.75,ratio:c=.5}=e;let i=30*l;let p=i*2*c;let h=r;let f=o;let d=s;let m=100;let u=100;let g=random(.05,.4);let b=Dr([.02,.15,.25,.4]);let y=int(map(b,.02,.15,90,80));let x=random(.8,1.2);let F=l<1?1/l*1:1;let P=p*1.2;let w=c*2;function V(e,t,r,o=0){let n=[];let a=o;let s=0;for(let o=0;o<t.length;o++){let c=e+r[o];a+=cos(c)*t[o]*(i/30)*l*F;s+=sin(c)*t[o]*(i/30)*l*F;n.push([a,s])}return n}function C(e,t,r,o=0){let n=[];let a=o;let s=0;for(let o=0;o<t.length;o++){let c=e+r[o];a+=cos(c)*t[o]*(i/30)*l*F;s+=sin(c)*t[o]*(i/30)*l*F;n.push([a,s])}return n}let E=[{baseAngle:-PI*.45,lengths:[10,10*w,10*w],angles:[0,PI*.25,-PI*.15],offsetX:P*1.6},{baseAngle:-PI*.5,lengths:[20,7*w,5*w],angles:[0,PI*.2,-PI*.1],offsetX:P*1.2},{baseAngle:-PI*.65,lengths:[18,6*w,4*w],angles:[0,PI*.15,-PI*.1],offsetX:P*.8}];let T=[{baseAngle:-PI*.3,lengths:[5,8*w,6*w],angles:[0,PI*.15,-PI*.2],offsetX:P*1.7},{baseAngle:PI*.3,lengths:[5,8*w,6*w],angles:[0,-PI*.15,PI*.2],offsetX:P*1.7}];let D=E.map((e=>V(e.baseAngle,e.lengths,e.angles,e.offsetX)));t.push();{t.push();t.stroke(a[0],a[1],a[2],.8);t.strokeWeight(.5*l);t.translate(h,f);t.rotate(d);t.translate(-i*.1,i*0);t.noFill();let e=100;let r=.8;T.forEach(((e,r)=>{let o=C(e.baseAngle,e.lengths,e.angles,e.offsetX);for(let e=0;e<o.length-1;e++){let r=e+1;zo(t,o[e][0],o[e][1],o[r][0],o[r][1],100,1,0)}}));t.pop()}{t.push();t.stroke(a[0],a[1],a[2],.8);t.strokeWeight(.6*l);t.translate(h,f);t.rotate(d);t.translate(-i*.2,i*-.3);t.noFill();let e=100;let r=1;D.forEach((e=>{for(let r=0;r<e.length-1;r++){let o=r+1;zo(t,e[r][0],e[r][1],e[o][0],e[o][1],100,1,0);t.push();t.scale(1,-1);t.translate(0,-i*.6);zo(t,e[r][0],e[r][1],e[o][0],e[o][1],100,1,0);t.pop()}}));t.pop();for(let e=0;e<200;e++){let r=e+1;let o,s;let c,F;let P=noise(e*.1+random(1e3));let w=map(P,0,1,-2,2)*l;if(e<m){o=p*cos(e/200*6.28)+p;c=pow(e/m,g)*sin(e/200*6.28)*i+w}else if(e>=m&&e<u){o=p*cos(e/200*6.28)+p;c=sin(e/200*6.28)*i+w}else if(e>=u){o=p*cos(e/200*6.28)+p;c=pow(1-(e-u)/m,g)*sin(e/200*6.28)*i+w}if(r<m){s=p*cos(r/200*6.28)+p;F=pow(r/m,g)*sin(r/200*6.28)*i+w}else if(r>=m&&r<u){s=p*cos(r/200*6.28)+p;F=sin(e/200*6.28)*i+w}else if(r>=u){s=p*cos(e/200*6.28)+p;F=pow(1-(r-u)/m,g)*sin(r/200*6.28)*i+w}t.push();t.translate(h,f);t.rotate(d);if(e<30){t.strokeWeight(.2);t.stroke(a[0],a[1],a[2],.8);let e=5;for(let r=0;r<e;r++){let e=o+random(-1,1)*l;let r=random(-1,1)*l;zo(t,e,r,e+random(-.5,.5),r+random(-.5,.5),40,c*.3,0)}zo(t,o,0,s,0,40,c,0,0)}else if(e>30&&e<100){t.strokeWeight(.15);t.stroke(n[0],n[1],n[2]*x,1);let e=3;for(let r=0;r<e;r++){let e=lerp(o,s,random(0,1));let r=lerp(0,c,random(0,1))+random(-1,1)*l;zo(t,e,r,e+random(-.3,.3),r+random(-.3,.3),30,c*.2,0)}zo(t,o,0,s,0,80,c,0)}if(e>32&&e<y){t.strokeWeight(.15);t.stroke(a[0],a[1],a[2],.6);let r=4;for(let n=0;n<r;n++){let r=lerp(o,s,random(0,1));let n=random(-.5,.5)*l;zo(t,r,n,r+random(-.2,.2),n+random(-.2,.2),30,map(e,32,y,p*.005,p*b)*random(.8,1.2))}zo(t,o,0,s,0,30,map(e,32,y,p*.005))}t.pop()}}t.pop()}function zo(e,t,r,o,l,n=20,a=2,s=1){for(let c=0;c<n;c++){let n=random(0,1);let c=lerp(t,o,n)+random(-a,a)*s;let i=lerp(r,l,n)+random(-a,a);e.point(c,i)}}function Ro(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,size:l=1,bodyColor:n=[20,.5,.8,1],wingColor:a=[100,.7,.7,1],wingPattern:s=0,pointShift:c=1.5,strokeNoiseScale:i=.2,strokeStrength:p=1}=e;let h=wr(Nt);p=p+h.random(0,1)*2;c=10*be;let f=50*l;let d=30*l;let m=15*l;let u=createVector(PI/2,0,random(-2,2));let g=b.petal2({pg:t,baseX:r,baseY:o,baseRotation:u,branchLength:f,branchSegments:10,branchSegmentsH:3,branchWidthFunc:e=>sin(e*PI)*1,branchBendFunc:e=>createVector(0,0,0),col:n,closeS:true,closeE:true});let y=map(l,.4,1.6,12,24);let x=g.centerPoints;let F=5;let P=x[F];let w=x[F-Tr(1,4)];let V=x[F+1]||x[F];let C=x[F-1]||x[F];let E=p5.Vector.sub(V,C).normalize();let T=createVector(-E.y,E.x,0).normalize();function D(e,t){if(e>.7){return sin(e*PI)*t*(1-e)*0}else{return sin(e*PI)*t*(1-e)*.8}}let A=random(1,2);b.petal({pg:t,baseX:r+P.x,baseY:o+P.y,direction:T.copy().mult(-1).rotate(-PI/3.5),branchLength:d*3,branchSegments:y,branchWidthFunc:e=>D(e,d*A),col:a,branchBendFunc:e=>createVector(0,sin(e*PI)*.8,-sin(e*PI)*.3),drawOutLine:1,strokeStrength:.4});b.petal({pg:t,baseX:r+w.x,baseY:o+w.y,direction:T.copy().mult(-1).rotate(PI/3),branchLength:d*2,branchSegments:y-10,branchWidthFunc:e=>D(e,d*.8),col:a,branchBendFunc:e=>createVector(0,-sin(e*PI)*.3,sin(e*PI)*.2),drawOutLine:1,strokeStrength:.4});b.petal({pg:t,baseX:r+P.x,baseY:o+P.y,direction:T.copy().rotate(PI/3.5),branchLength:d*3,branchSegments:y,branchWidthFunc:e=>D(e,d*A),col:a,branchBendFunc:e=>createVector(0,sin(e*PI)*.8,-sin(e*PI)*.3),drawOutLine:1,strokeStrength:.2});b.petal({pg:t,baseX:r+w.x,baseY:o+w.y,direction:T.copy().rotate(-PI/3),branchLength:d*2,branchSegments:y-10,branchWidthFunc:e=>D(e,d*.8),col:a,branchBendFunc:e=>createVector(0,-sin(e*PI)*.3,sin(e*PI)*.2),drawOutLine:1,strokeStrength:.2});let I=x[0];let L=[];let S=createVector(I.x-d*.1,I.y);let B=T.copy().mult(-1).rotate(-PI/2.5).normalize();for(let e=0;e<=20;e++){let t=e/20;let r=p5.Vector.add(S,p5.Vector.mult(B,t*d));let o=createVector(-B.y,B.x,0);r.add(p5.Vector.mult(o,sin(t*PI*.5)*d*.2));L.push(r)}let W=[];let k=createVector(I.x+d*.1,I.y);let X=T.copy().rotate(PI/2.5).normalize();for(let e=0;e<=20;e++){let t=e/20;let r=p5.Vector.add(k,p5.Vector.mult(X,t*d));let o=createVector(-X.y,X.x,0);r.add(p5.Vector.mult(o,-sin(t*PI*.5)*d*.2));W.push(r)}El({pg:t,pts:L,baseX:r,baseY:o,doFill:true,col:kr(0,0,0,1),branchWidthFunc:e=>.5*(sin(e*PI)*.5+.5),randomOffset:1});El({pg:t,pts:W,baseX:r,baseY:o,doFill:true,col:kr(0,0,0,1),branchWidthFunc:e=>.5*(sin(e*PI)*.5+.5),randomOffset:1})}function vo(e={}){let{pg:t=pgL3,baseX:r=0,baseY:o=0,size:l=1,bodyColor:n=[20,.5,.8,1],wingColor:a=[0,0,.9,.3],dir:s=0,pointShift:c=1.5,strokeNoiseScale:i=.2,strokeStrength:p=1}=e;let h=wr(Nt);c=10*be;let f=80*l;let d=40*l;let m=createVector(PI/2,0,random(-3,3));s=10;let u=b.petal2({pg:t,baseX:r,baseY:o,baseRotation:m,branchLength:f,branchSegments:12,branchSegmentsH:4,branchWidthFunc:e=>sin(e*PI)*l*.8,branchBendFunc:e=>createVector(random(-3,3),random(0,2),2),col:n,closeS:true,closeE:true});let g=u.centerPoints;let y=floor(g.length*random(.3,.4));let x=g[y];let F=g[y+Dr([0,1])];let P=p5.Vector.sub(g[y+1]||g[y],g[y-1]||g[y]).normalize();let V=p5.Vector.sub(g[y+1]||g[y],g[y-1]||g[y]).normalize();let C=createVector(-P.y,P.x,0).normalize();let E=sin(s*.2)*PI*.1;E+=noise(s*.05)*PI*.05;function T(e,length,width,l,n){b.petal({pg:t,baseX:r+l.x,baseY:o+l.y,direction:e,branchLength:length,branchSegments:12,branchWidthFunc:e=>{let t=sin(e*PI)*width;if(e<.2)return t*e*5;if(e>.8)return t*(1-e)*5;return t},col:a,branchBendFunc:e=>createVector(sin(e*PI)*n,0,0),drawOutLine:1,strokeStrength:.1})}T(C.copy().mult(-1).rotate(-PI/6+E),d*1.4,d*.2,x,1);T(C.copy().mult(-1).rotate(-PI/12+E),d*1.1,d*.1,F,-1);T(C.copy().rotate(PI/6-E),d*1.4,d*.2,x,1);T(C.copy().rotate(PI/12-E),d*1.1,d*.1,F,-1);let D=g[0];let A=p5.Vector.sub(g[1],g[0]).normalize();let I=l*6;let L=l*random(2,3);let S=createVector(D.x-I*C.x,D.y-I*C.y,D.z);let B=createVector(D.x+I*C.x,D.y+I*C.y,D.z);w.drawGradientFlowerCenter(r+S.x,o+S.y,L,createVector(0,0,1),4);w.drawGradientFlowerCenter(r+B.x,o+B.y,L,createVector(0,0,1),4)}}{function _o(e={}){let{pg:t,baseX:r=0,baseY:o=0,size:l=random(5,20),roughness:n=1.3,detail:a=2,rotation:s=createVector(0,0,0),branchSegmentsH:c=Tr(3,6),stoneH:i=random(.6,1.1),pointShift:p=2,strokeStrength:h=1.2,strokeNoiseScale:f=.1}=e;let d=wr(Nt);h=h+d.random(0,1)*2;p=10*be;function m(e){const t=10.1;const r=-.2;const o=(noise(e*t,Tr(0,100)*.05)+r)*random(3,6)*ge;return o>.5?o:random(0,1)>.8?0:0}t.push();let u=[];let g=random(TWO_PI);let b=floor(120*G);let y=random(-.4,.4);let x=random(.4,-.4);for(let e=0;e<=b;e++){let t=e/b;let r=TWO_PI*t;let o=map(noise(cos(r)*a,sin(r)*a,g),0,1,1,1.1)*n;let s=map(noise(cos(r)*2,sin(r)*2,g+1e3),0,1,-.3,.3);let c=l*o;let p=cos(r)*c;let h=sin(r)*c;if(h>0){h*=.2}else{h*=i}p+=y*l+h*x;p+=s*l;p+=map(noise(p*.1,h*.1,g+2e3),0,1,-l*.1,l*.1);h+=map(noise(p*.1,h*.1,g+3e3),0,1,-l*.05,l*.05);u.push(createVector(p,h))}u.push(u[0]);let F=random(-PI/3,-PI/6);let P=random(.5,.8);let w=[];for(let e=0;e<c;e++){let t=e/(c-1);let r=u.map((e=>{let r=createVector(cos(F)*l*.2,sin(F)*l*.2);let o=p5.Vector.mult(r,1-t);return p5.Vector.lerp(e,o,t)}));w.push(r)}for(let e=0;e<w.length-1;e++){let l=w[e];let n=w[e+1];let a=e/(w.length-1);for(let e=0;e<l.length-1;e++){let a=l[e];let s=atan2(a.y,a.x);let c=zt.colors.stone[0][0];let i=zt.colors.stone[0][1];let p=zt.colors.stone[0][2];Cl({pg:t,pts:[l[e],l[min(e+2,l.length-1)],n[min(e+2,n.length-1)],n[e]],baseX:r,baseY:o,doFill:true,doFillBrush:true,doStr:false,col:kr(c,i,p,.8),randomOffset:1,vertexMode:0})}}let V=zt.colors.stroke[Dr([0,0,0,2])];let C=zt.colors.stroke[1];let E=Tr(2,6);let T=Dr([.4,.5,.6,.7]);for(let e=1;e<w.length;e++){let l=w[e];let n=l.filter((e=>{if(e.y>=0)return false;let t=abs(atan2(e.y,e.x));return t>.2&&t<3}));for(let l=0;l<n.length-E;l+=E){let a=n.slice(l,l+E+1);if(noise(e*100,l*100)<T){El({pg:t,pts:a,baseX:r,baseY:o,col:kr(C[0],C[1]*0,C[2]*random(.8,1),1),branchWidthFunc:e=>(.5*(1-e)*map(noise(e*10+l),0,1,.5,1)+.5)*h*ge*random(1,2),randomOffset:.5,sameWidth:1,forceBrush:1})}}}for(let e=0;e<u.length-E;e+=E){let l=u.slice(e,e+E+1);El({pg:t,pts:l.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-p,p);let r=map(noise(e.y*f,e.x*f),0,1,-p,p);return createVector(e.x+t,e.y+r)})),baseX:r,baseY:o,col:kr(V[0],V[1],V[2],1),branchWidthFunc:m,randomOffset:.5,sameWidth:1})}let D=zt.colors.stone[0][0];let A=zt.colors.stone[0][1];let I=zt.colors.stone[0][2];let L=Tr(5,20);let S=0,B=0;u.forEach((e=>{S+=e.x;B+=e.y}));S/=u.length;B/=u.length;let W=0;u.forEach((e=>{let dist=sqrt(pow(e.x-S,2)+pow(e.y-B,2));W=max(W,dist)}));let k=zt.colors.stroke[0];let X=zt.colors.stroke[1];for(let e of w){for(let e=0;e<L;e++){let e=random(TWO_PI);let n=(1-random(random(0,1)))*W;let a=S+cos(e)*n;let s=B+sin(e)*n;if(Lo(createVector(a,s),u)){let e=random(-l*.05,l*.05);let n=random(-l*.05,l*.05);let c=createVector(a+e,s+n);let i=random(1,2);t.push();t.noStroke();if(random(0,1)<.5)t.fill(kr(X[0],X[1],X[2],.8));else t.fill(kr(k[0],k[1],k[2],.5));t.ellipse(c.x+r,c.y+o,i,i);t.pop()}}}t.pop()}function Lo(e,t){let r=false;for(let o=0,l=t.length-1;o<t.length;l=o++){let n=t[o].x,a=t[o].y;let s=t[l].x,c=t[l].y;let i=a>e.y!=c>e.y&&e.x<(s-n)*(e.y-a)/(c-a)+n;if(i)r=!r}return r}function No(e={}){let{pg:t=pgL0,baseX:r=0,baseY:o=0,size:l=random(5,20)}=e;let n=ol({size:l,shapeCount:floor(random(3,6))});function a(e){const t=10.1;const r=-.2;const o=(noise(e*t,Tr(0,100)*.05)+r)*random(3,6)*ge;return o>.5?o:random(0,1)>.8?0:0}n=ul(n);if(n.length===0){console.error("Invalid stone points generated");return}let s=zt.colors.stone[0][0];let c=zt.colors.stone[0][1];let i=zt.colors.stone[0][2];let p=Infinity,h=-Infinity;let f=Infinity,d=-Infinity;n.forEach((e=>{if(e&&e.x!==undefined&&e.y!==undefined){p=min(p,e.y);h=max(h,e.y);f=min(f,e.x);d=max(d,e.x)}}));let m=[];let u=l>30?Tr(2,8):Tr(1,3);let g=l>30?Tr(8,12):Tr(4,8);let b=[];for(let e=0;e<u;e++){b.push({x:random(f+l*.3,d-l*.3),y:random(p+l*.3,h-l*.3),size:l*random(.12,.25)*map(e,0,u-1,1,.7)})}for(let e of b){let t=$o({centerX:e.x,centerY:e.y,holeSize:e.size,shapeCount:Tr(2,5)});if(t&&Array.isArray(t)&&t.length>0){t=ul(t);if(t.length>0){let e=gl(t,n);if(e.length>=3){m.push(e)}}}}for(let e=0;e<g;e++){let t=l*random(.03,.08)*map(e,0,g-1,1,.6);let r=random(b);let o=random(TWO_PI);let a=random(l*.1,l*.3);let s=r.x+cos(o)*a;let c=r.y+sin(o)*a;if(Ko(s,c,t,m,n,f,d,p,h)){let e=$o({centerX:s,centerY:c,holeSize:t});if(e&&Array.isArray(e)&&e.length>0){e=ul(e);if(e.length>0){let t=gl(e,n);if(t.length>=3){m.push(t)}}}}}let y=al(m);for(let e=0;e<3;e++){let l=n.map((e=>ml(e)));if(l.length>0){let n=kr(s,c*map(e,0,2,1,.7),i*map(e,0,2,.9,.5),map(e,0,2,.9,.7));let p=30;let h=8;let f=[];let d=0,m=0;l.forEach((e=>{d+=e.x;m+=e.y}));d/=l.length;m/=l.length;for(let t=0;t<=h;t++){let r=t/h;let o=[];for(let t=0;t<=p;t++){let n=t/p;let a=TWO_PI*n;let s=null;let c=Infinity;for(let e=0;e<l.length;e++){let t=l[e];let r=l[(e+1)%l.length];let o=createVector(d+cos(a)*1e3,m+sin(a)*1e3);let n=bl(d,m,o.x,o.y,t.x,t.y,r.x,r.y);if(n){let dist=il({x:d,y:m},n);if(dist<c){c=dist;s=n}}}if(s){let t=d+(s.x-d)*r;let l=m+(s.y-m)*r;let n=random(-2,2)*map(e,0,2,1,.5)*(1-r);t+=n*cos(a);l+=n*sin(a);o.push(createVector(t,l))}}f.push(o)}for(let e=0;e<f.length-1;e++){let l=f[e];let a=f[e+1];for(let e=0;e<l.length-1;e++){let s=[l[e],l[e+1],a[e+1],a[e]];Cl({pg:t,pts:s,baseX:r,baseY:o,col:n,randomOffset:1})}}if(y&&Array.isArray(y)){y.forEach((l=>{if(l&&Array.isArray(l)&&l.length>2){let n=createVector(0,0);l.forEach((e=>{n.add(e)}));n.div(l.length);let a=[];let s=4;p=15;for(let t=0;t<=s;t++){let r=t/s;let o=[];for(let t=0;t<=p;t++){let a=t/p;let s=TWO_PI*a;let c=null;let i=Infinity;for(let e=0;e<l.length;e++){let t=l[e];let r=l[(e+1)%l.length];let o=createVector(n.x+cos(s)*1e3,n.y+sin(s)*1e3);let a=bl(n.x,n.y,o.x,o.y,t.x,t.y,r.x,r.y);if(a){let dist=il({x:n.x,y:n.y},a);if(dist<i){i=dist;c=a}}}if(c){let t=n.x+(c.x-n.x)*r;let l=n.y+(c.y-n.y)*r;let a=random(-1,1)*map(e,0,2,.5,.2)*(1-r);t+=a*cos(s);l+=a*sin(s);o.push(createVector(t,l))}}a.push(o)}let c=zt.colors.bg[0][0];let i=zt.colors.bg[0][1];let h=zt.colors.bg[0][2];let f=random(0,1)>.5?1:.5;for(let e=0;e<a.length-1;e++){let l=a[e];let n=a[e+1];for(let e=0;e<l.length-1;e++){let a=[l[e],l[e+1],n[e+1],n[e]];Cl({pg:t,pts:a,baseX:r,baseY:o,col:kr(c,i,h*f,.8),randomOffset:1})}}}}))}let u=l.map((t=>{let r=random(-.5,.5)*map(e,0,2,1,.5);let o=t.copy();o.add(createVector(r,r));return o}));El({pg:t,pts:u,baseX:r,baseY:o,col:kr(s,c,i*.5,1),branchWidthFunc:a,randomOffset:.3,sameWidth:1});if(y&&Array.isArray(y)){y.forEach((l=>{if(l&&Array.isArray(l)&&l.length>2){let n=l.map((t=>{let r=random(-.3,.3)*map(e,0,2,1,.5);let o=t.copy();o.add(createVector(r,r));return o}));El({pg:t,pts:n,baseX:r,baseY:o,col:kr(s,c*.9,i*.4,1),branchWidthFunc:a,randomOffset:.2})}}))}}}let x=l>30?12:8;for(let e=0;e<x;e++){try{let n=isFinite(f)&&isFinite(d)?random(f,d):0;let a=isFinite(p)&&isFinite(h)?random(p,h):0;if(!isFinite(n)||!isFinite(a)){continue}let m=random(-PI/4,PI/4);if(isFinite(h)&&isFinite(p)&&isFinite(d)&&isFinite(f)){m+=atan2(h-p,d-f)}let length=l*random(.2,.5);if(!isFinite(length)){continue}let u=n+cos(m)*length;let g=a+sin(m)*length;if(!isFinite(u)||!isFinite(g)){continue}let b=(n+u)/2;let y=(a+g)/2;let x=length*.2;if(isFinite(x)){let e=m+PI/2;b+=cos(e)*random(-x,x);y+=sin(e)*random(-x,x)}if(!isFinite(b)||!isFinite(y)){continue}let F=[createVector(n,a),createVector(b,y),createVector(u,g)];if(F.every((e=>e&&isFinite(e.x)&&isFinite(e.y)))){F=F.map((e=>{if(!(e instanceof p5.Vector)){return createVector(e.x,e.y)}return e}));F=F.map((e=>{if(typeof e.copy!=="function"){e.copy=function(){return createVector(this.x,this.y)}}if(typeof e.add!=="function"){e.add=function(e){this.x+=e.x;this.y+=e.y;return this}}return e}));try{El({pg:t,pts:F,baseX:r,baseY:o,col:kr(s,c*.8,i*.5,.3),branchWidthFunc:e=>.2*ge*(1-e),randomOffset:.5})}catch(t){console.error(`Error in texture line ${e}:`,t)}}}catch(t){console.error(`Error creating texture line ${e}:`,t)}}try{let e=n.filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined")).map((e=>{let t=random(-.5,.5);let r=e instanceof p5.Vector?e:createVector(e.x,e.y);let o=r.copy();o.add(createVector(t,t));return o})).filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined"));if(e.length>2){e=e.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));El({pg:t,pts:e,baseX:r,baseY:o,col:kr(s,c,i*.7,1),branchWidthFunc:a,randomOffset:.5})}}catch(e){console.error("Error creating stone outline:",e)}if(y&&Array.isArray(y)){y.forEach((e=>{try{if(e&&Array.isArray(e)){let l=e.filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined")).map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));if(l.length>2){El({pg:t,pts:l,baseX:r,baseY:o,col:kr(s,c,i*.4,.8),branchWidthFunc:a,randomOffset:.5})}}}catch(e){console.error("Error creating hole outline:",e)}}))}}function Mo(e,t){pgBg.push();let r=Tr(1,3);let o=[];for(let e=0;e<r;e++){o.push({size:random(0,1)>.2?random(20,30):random(40,80)})}o.sort(((e,t)=>t.size-e.size));let l=t;o.forEach(((t,r)=>{t.x=e+random(-t.size,t.size);t.y=l+r*t.size*.5;let o=random(0,1);_o({pg:pgL0,baseX:t.x,baseY:t.y,size:t.size*M,branchSegmentsH:Tr(6,13)})}));pgBg.pop()}function Ho(e,t){let r=Tr(1,3);let o=[];for(let e=0;e<r;e++){o.push({size:random(0,1)>.2?random(20,30):random(40,80)})}o.sort(((e,t)=>t.size-e.size));let l=t;o.forEach(((t,r)=>{t.x=e+random(-t.size,t.size);t.y=l+r*t.size*.5;No({pg:pgL0,baseX:t.x,baseY:t.y,size:t.size*M})}))}function Go(e={}){let{size:t=random(5,20),roughness:r=1.3,detail:o=2,stoneH:l=random(.6,1.1),globalOffset:n=random(-.4,.4),tilt:a=random(.4,-.4),centerX:s=0,centerY:c=0}=e;let i=[];let p=random(TWO_PI);let h=floor(120*G);for(let e=0;e<=h;e++){let f=e/h;let d=TWO_PI*f;let m=map(noise(cos(d)*o,sin(d)*o,p),0,1,.85,1.15);let u=map(noise(cos(d)*o*2,sin(d)*o*2,p+1e3),0,1,.92,1.08);let g=(m*.7+u*.3)*r;let b=t*g;let y=s+cos(d)*b;let x=c+sin(d)*b;let F=x>c?map(x-c,0,b,1,.15):map(x-c,-b,0,l*1.2,1);x=c+(x-c)*F;y+=n*t+(x-c)*a;i.push(createVector(y,x))}i=Jo(i,2);i=Jo(i,1);i.push(i[0].copy());return i}function Uo(e={}){let{size:t=random(5,20),roughness:r=1.3,detail:o=2,stoneH:l=random(.6,1.1),globalOffset:n=random(-.4,.4),tilt:a=random(.4,-.4),direction:s=random(TWO_PI)}=e;let c=[];let i=random(TWO_PI);let p=floor(120*G);for(let e=0;e<=p;e++){let h=e/p;let f=TWO_PI*h;let d=map(noise(cos(f)*o,sin(f)*o,i),0,1,.85,1.15);let m=map(noise(cos(f)*o*2,sin(f)*o*2,i+1e3),0,1,.92,1.08);let u=1+cos(f-s)*.5;let g=(d*.7+m*.3)*r*u;let b=map(noise(cos(f)*2,sin(f)*2,i+2e3),0,1,-.3,.3);let y=t*g;let x=cos(f)*y;let F=sin(f)*y;let P=F>0?map(F,0,y,1,.15):map(F,-y,0,l*1.2,1);F*=P;x+=n*t+F*a;x+=b*t;let w=noise(x*.05,F*.05,i+3e3);x+=map(w,0,1,-t*.08,t*.08)*u;F+=map(w,0,1,-t*.05,t*.05)*u;c.push(createVector(x,F))}c=Jo(c,2);c=Jo(c,1);c.push(c[0].copy());return c}function $o(e={}){let{centerX:t=0,centerY:r=0,holeSize:o=10,shapeCount:l=floor(random(2,6))}=e;let n=qo({centerX:t,centerY:r,holeSize:o,detail:2,elongation:random(1.2,1.8)});let a=[n];for(let e=1;e<l;e++){let e=random(-o*.3,o*.3);let l=random(-o*.3,o*.3);let n=o*random(.2,.6);let s=qo({centerX:t+e,centerY:r+l,holeSize:n,detail:random(1.8,2.2),elongation:random(1.1,1.6)});a.push(s)}let s=[];a.forEach((e=>{if(e&&Array.isArray(e)){s=s.concat(e)}}));let c=ll(s);let i=[];for(let e=0;e<c.length;e++){let t=c[e];let r=noise(t.x*.1,t.y*.1);let l=o*.05*r;i.push(createVector(t.x+random(-l,l),t.y+random(-l,l)))}i=Jo(i,2);i=Jo(i,1);i=jo(i);return i}function qo(e={}){let{centerX:t=0,centerY:r=0,holeSize:o=10,detail:l=2,elongation:n=random(1,2)}=e;let a=[];let s=random(TWO_PI);let c=floor(40*G);let i=.2;let p=random(0,1e3);let h=.9;let f=.5;let d=.3;for(let e=0;e<=c;e++){let l=e/c;let m=TWO_PI*l;let u=noise(cos(m)*i+p,sin(m)*i+p)*h;let g=noise(cos(m)*i*2+p+1e3,sin(m)*i*2+p+1e3)*f;let b=noise(cos(m)*i*4+p+2e3,sin(m)*i*4+p+2e3)*d;let y=.6+u+g+b;let x=1+sin(m*2)*.2;let F=1+(n-1)*abs(cos(m));let P=o*y*x*F;let w=t+cos(m)*P;let V=r+sin(m)*P;let C=o*.15;w+=noise(w*.1,V*.1,s)*C;V+=noise(w*.1,V*.1,s+1e3)*C;a.push(createVector(w,V))}a=Jo(a,3);a=Jo(a,2);a=jo(a);a=Jo(a,1);return a}function Jo(e,t){let r=[];let o=e.length;for(let l=0;l<o;l++){let n=createVector(0,0);let a=0;for(let r=-t;r<=t;r++){let s=(l+r+o)%o;let c=exp(-r*r/(2*t));n.add(p5.Vector.mult(e[s],c));a+=c}n.div(a);r.push(n.copy())}return r}function jo(e){let t=0;for(let r=0;r<e.length;r++){let o=e[r];let l=e[(r+1)%e.length];t+=(l.x-o.x)*(l.y+o.y)}if(t<0){return e.reverse()}return e}function Ko(e,t,r,o,l,n,a,s,c){let i=r*2;if(e-r<n+i||e+r>a-i||t-r<s+i||t+r>c-i){return false}for(let l of o){let o=(l[0].x+l[floor(l.length/2)].x)/2;let n=(l[0].y+l[floor(l.length/2)].y)/2;let a=(r+r)*1.5;let s=dist(e,t,o,n);if(s<a){return false}}return true}function Qo(e,t){e=e.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));t=t.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));let r=Zo(e).concat(Zo(t));for(let o of r){if(!tl(el(e,o),el(t,o))){return false}}return true}function Zo(e){if(!e||e.length===0){console.error("Invalid polygon in getAxes");return[]}let t=[];for(let r=0;r<e.length;r++){if(!e[r]||typeof e[r].x==="undefined"||typeof e[r].y==="undefined"){console.error("Invalid point in getAxes:",e[r]);continue}let o=e[r];let l=e[(r+1)%e.length];let n=createVector(o.x-l.x,o.y-l.y);let a=createVector(-n.y,n.x);let length=a.mag();if(length!==0){a.div(length);t.push(a)}}return t}function el(e,t){let min=Infinity,max=-Infinity;for(let r=0;r<e.length;r++){let o=e[r].dot(t);if(o<min)min=o;if(o>max)max=o}return{min:min,max:max}}function tl(e,t){return!(e.max<t.min||t.max<e.min)}function rl(e){let t=[];const r=1e-6;for(let o=0;o<e.length;o++){let l=false;for(let n=0;n<t.length;n++){if(abs(e[o].x-t[n].x)<r&&abs(e[o].y-t[n].y)<r){l=true;break}}if(!l){t.push(e[o])}}return t}function ol(e={}){let{size:t=random(5,20),shapeCount:r=floor(random(2,6))}=e;let o=Uo({size:t,roughness:1.3,detail:2,stoneH:random(.6,1.1)});let l=[o];for(let e=1;e<r;e++){let e=random(-t*.3,t*.3);let r=random(-t*.3,t*.3);let o=t*random(.6,1.2);let n=Uo({size:o,roughness:random(1.1,1.4),detail:random(1.8,2.2),stoneH:random(.6,1.1),direction:random(TWO_PI)}).map((t=>createVector(t.x+e,t.y+r)));l.push(n)}let n=[];l.forEach((e=>{n=n.concat(e)}));let a=ll(n);let s=[];for(let e=0;e<a.length;e++){let r=a[e];let o=noise(r.x*.1,r.y*.1);let l=t*.1*o;s.push(createVector(r.x+random(-l,l),r.y+random(-l,l)))}s=Jo(s,2);s=Jo(s,1);s.push(s[0].copy());return s}function ll(e){let t=e.reduce(((e,t)=>t.y>e.y||t.y===e.y&&t.x<e.x?t:e));let r=e.filter((e=>e!==t)).sort(((e,r)=>{let o=atan2(e.y-t.y,e.x-t.x);let l=atan2(r.y-t.y,r.x-t.x);return o-l}));let o=[t];for(let e of r){while(o.length>=2){let t=o[o.length-1];let r=o[o.length-2];if(nl(r,t,e)>0){break}o.pop()}o.push(e)}return o}function nl(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)}function al(e){if(!e||e.length===0){return[]}e=e.filter((e=>{if(!e||!Array.isArray(e)||e.length<3){return false}let t=e.map((e=>{if(!e||typeof e.x==="undefined"||typeof e.y==="undefined"){return null}return e instanceof p5.Vector?e:createVector(e.x,e.y)})).filter((e=>e!==null));return t.length>=3}));if(e.length===0){return[]}let t=[];let r=true;while(r){r=false;let o=new Array(e.length).fill(false);for(let l=0;l<e.length;l++){if(o[l])continue;let n=e[l].slice();o[l]=true;for(let t=0;t<e.length;t++){if(l!==t&&!o[t]){if(Qo(n,e[t])){n=n.concat(e[t]);o[t]=true;r=true}}}let a=rl(n);if(a.length>=3){let e=sl(a);if(e.length>=3){e=jo(e);e=hl(e,4);let r=fl(e);if(r.length>=3){t.push(r)}}}}if(t.length===0){break}e=t.filter((e=>e.length>=3));t=[];if(e.length===0){break}}return e}function sl(e){e=ul(e);if(e.length<3){return e}e.sort(cl);let t=e[0];e.sort(((e,r)=>{let o=atan2(e.y-t.y,e.x-t.x);let l=atan2(r.y-t.y,r.x-t.x);if(o===l){return il(t,r)-il(t,e)}return o-l}));let r=[t];for(let t=0;t<e.length;t++){while(r.length>1&&pl(r[r.length-2],r[r.length-1],e[t])<=0){r.pop()}r.push(e[t])}return r}function cl(e,t){if(e.y===t.y)return e.x-t.x;return e.y-t.y}function il(e,t){return sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function pl(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)}function hl(e,t=4){let r=[];for(let o=0;o<e.length;o++){let l=e[o];let n=e[(o+1)%e.length];for(let e=0;e<t;e++){let o=e/t;let a=l.x*(1-o)+n.x*o;let s=l.y*(1-o)+n.y*o;r.push(createVector(a,s))}}return r}function fl(e){return e.map((e=>{let t=dl(e.x,e.y);return createVector(e.x+t.dx,e.y+t.dy)}))}function dl(e,t){const r=1;return{dx:noise(e)*r,dy:noise(t)*r}}function ml(e,t=createVector(0,0)){if(!e||typeof e.x==="undefined"||typeof e.y==="undefined"){console.error("Invalid point:",e);return t}return e instanceof p5.Vector?e:createVector(e.x,e.y)}function ul(e){if(!e||!Array.isArray(e)){console.error("Invalid points array:",e);return[]}return e.map((e=>ml(e)))}function gl(e,t){e=ul(e);t=ul(t);if(e.length<3||t.length<3){return[]}let r=[...e];for(let e=0;e<t.length;e++){let o=t[e];let l=t[(e+1)%t.length];let n=[...r];r=[];for(let e=0;e<n.length;e++){let t=n[e];let a=n[(e+1)%n.length];let s=(l.x-o.x)*(t.y-o.y)-(l.y-o.y)*(t.x-o.x);let c=(l.x-o.x)*(a.y-o.y)-(l.y-o.y)*(a.x-o.x);if(s>=0){r.push(t)}if(s*c<0){let e=s/(s-c);let o=t.x+(a.x-t.x)*e;let l=t.y+(a.y-t.y)*e;r.push(createVector(o,l))}}}if(r.length<3){return[]}r=Jo(r,2);r=jo(r);return r}function bl(e,t,r,o,l,n,a,s){let c=(e-r)*(n-s)-(t-o)*(l-a);if(c===0)return null;let i=((e-l)*(n-s)-(t-n)*(l-a))/c;let p=-((e-r)*(t-n)-(t-o)*(e-l))/c;if(i>=0&&i<=1&&p>=0&&p<=1){return createVector(e+i*(r-e),t+i*(o-t))}return null}function yl(e,t){let r=[];for(let o=0;o<e.length-1;o++){for(let l=0;l<t.length-1;l++){let n=bl(e[o].x,e[o].y,e[o+1].x,e[o+1].y,t[l].x,t[l].y,t[l+1].x,t[l+1].y);if(n){r.push(n)}}}return r}function Lo(e,t){let r=false;for(let o=0,l=t.length-1;o<t.length;l=o++){let n=t[o].x,a=t[o].y;let s=t[l].x,c=t[l].y;let i=a>e.y!=c>e.y&&e.x<(s-n)*(e.y-a)/(c-a)+n;if(i)r=!r}return r}function xl(e){let t=0;for(let r=0;r<e.length;r++){let o=(r+1)%e.length;t+=e[r].x*e[o].y;t-=e[o].x*e[r].y}return abs(t)/2}function Fl(e,t){for(let r=0;r<t.length-1;r++){if(abs(t[r].x-e.x)<.001&&abs(t[r].y-e.y)<.001){return t[r+1]}}return t[0]}}{function Pl(e={}){let{pts:t=[],pg:r=pgText,baseX:o=0,baseY:l=0,minPoints:n=50}=e;if(ne[3]==0)return;if(t.length<n){let e=[];if(t.length>=2){for(let r=0;r<t.length-1;r++){let o=t[r];let l=t[r+1];let a=hl(o,l,ceil(n/(t.length-1)));if(r===0){e=e.concat(a)}else{e=e.concat(a.slice(1))}}t=e}}r.strokeWeight(.5);r.stroke(ne[0],ne[1],ne[2],ne[3]);r.noFill();for(let e=0;e<t.length-1;e++){if(e%1===0){r.ellipse(t[e].x+o,t[e].y+l,1)}}}function hl(e,t,r=20){let o=[];for(let l=0;l<r;l++){let n=l/(r-1);let a=lerp(e.x,t.x,n);let s=lerp(e.y,t.y,n);a+=Sr(n*10)*.5;s+=Sr(n*10+100)*.5;o.push(createVector(a,s))}return o}function wl(e={}){let{pts:t=[],branchWidthFunc:r=e=>10,widthMultiplier:l=1}=e;let n=[];let a=[];let s=se[0];let c=se[1];if(t.length<3){return[[],[]]}for(let e=1;e<t.length-1;e++){l=map(noise(e*s,t.length*s),0,1,1/c,1*c);if(o==2)l=1;let i=r(e/t.length)*l;let p=t[e-1];let h=t[e];let f=t[e+1];let d=atan2(h.y-p.y,h.x-p.x);let m=atan2(h.y-f.y,h.x-f.x);let u=(d+m)/2;if(u<m){u+=PI}n.push(createVector(h.x+i*cos(u),h.y+i*sin(u)));a.push(createVector(h.x-i*cos(u),h.y-i*sin(u)))}if(o==2)l=1;let i=t.length-1;let p=t[0];let h=t[i];let f=atan2(t[1].y-p.y,t[1].x-p.x)-PI/2;let d=atan2(h.y-t[i-1].y,h.x-t[i-1].x)-PI/2;let m=r(0)*l;let u=r(1)*l;n.unshift(createVector(p.x+m*cos(f),p.y+m*sin(f)));a.unshift(createVector(p.x-m*cos(f),p.y-m*sin(f)));n.push(createVector(h.x+u*cos(d),h.y+u*sin(d)));a.push(createVector(h.x-u*cos(d),h.y-u*sin(d)));return[n,a]}function Vl(e,t=1,r=1,o=1){push();let l=hue(e);let n=saturation(e);let a=brightness(e);let s=alpha(e);let c=abs(l+ue)%360;if(t>0)c=t;let i=n*r;let p=a*o;if(r>9)i=1;if(o>9)p=1;let h=color(c,i,p,s);pop();return h}function Cl(e={}){let{pts:t=[],pg:r=pgL3,doFill:o=true,col:l=color("black"),baseX:n=0,baseY:a=0,randomOffset:s=0,vertexMode:c=0}=e;const i=t.length*1e3+n*10+a+random(0,1e4)^Nt;const p=wr(i);if(c==1)s=0;else s=s*ye;function h(){return random(-s,s)}if(Ke==1&&c==0){l=color(Mt[0],Mt[1],Mt[2]*et,1)}if(c==0)l=Vl(l,we[0],we[1],we[2]);r.beginShape();if(t.length>-1){if(o){let e=noise(t.length*10)>.3?2:1;if(c==0){r.fill(hue(l),saturation(l)*pe,brightness(l)*he,alpha(l)*fe)}else if(c==1){r.fill(hue(l),saturation(l)*pe,brightness(l)*he*random(.8,1),alpha(l)*constrain(random(-.2,.5*e),.5,.9)*fe)}else{r.fill(hue(l),saturation(l)*pe,brightness(l)*he*random(.9,1),alpha(l)*constrain(random(-.2,.5*e),.7,.9)*fe)}r.noStroke()}else{r.noFill()}if(c==0){for(let e=0;e<t.length;e++){r.vertex(t[e].x+n+h(),t[e].y+a+h())}}else if(c==1){for(let e=0;e<t.length;e++){r.curveVertex(t[e].x+n+h(),t[e].y+a+h())}}else if(c==2){let e=t[0];r.curveVertex(e.x+n+h(),e.y+a+h());r.curveVertex(e.x+n+h(),e.y+a+h());for(let e=1;e<t.length-2;e+=3){let o=t[e];let l=t[e+1];let s=t[e+2];let c=lerp(o.x,l.x,random(.2,.4));let i=lerp(o.y,l.y,random(.2,.4));r.curveVertex(c+n+h(),i+a+h());let p=lerp(o.x,l.x,random(.4,.6));let f=lerp(o.y,l.y,random(.4,.6));r.curveVertex(p+n+h()*1.2,f+a+h()*1.2);let d=lerp(l.x,s.x,random(.2,.4));let m=lerp(l.y,s.y,random(.2,.4));r.curveVertex(d+n+h(),m+a+h());r.curveVertex(s.x+n+h(),s.y+a+h())}for(let e=floor(t.length/3)*3;e<t.length;e++){let o=t[e];r.curveVertex(o.x+n+h(),o.y+a+h())}let o=t[t.length-1];r.curveVertex(o.x+n+h(),o.y+a+h())}}r.endShape(CLOSE)}function El(e={}){let{pts:t=[],pg:r=pgL3,baseX:o=0,baseY:l=0,col:n="black",branchWidthFunc:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:c=0,vertexMode:i=1,minPoints:p=10,sameWidth:h=0,forceBrush:f=0}=e;if(f==1){return Dl(e)}if(st==0){return Dl(e)}else if(st==1){return Dl(e),Tl(e)}}function Tl(e={}){let{pts:t=[],pg:r=pgL3,baseX:o=0,baseY:l=0,col:n="black",branchWidthFunc:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:c=0,vertexMode:i=1,minPoints:p=10,sameWidth:h=0}=e;let f=wr(Nt);let d;if(Ke==1){let e=zt.colors.stroke[0];let t=zt.colors.stroke[1];if(tt==0)d=kr(e[0],e[1],e[2],.4);else if(tt==1)d=kr(t[0],t[1],t[2],.3);else if(tt==2)d=kr(0,0,1,.5)}else{d=n;d.levels[3]=.5;if(d.levels[3]===0)return}let m=1;let[u,g]=wl({pts:t,branchWidthFunc:e=>a(e)*m});r.push();r.noStroke();let b=u.concat(g.reverse());if(b.length<2){r.pop();return[u,g]}let y=[];for(let e=0;e<b.length-1;e++){let t=b[e];let r=b[e+1];let o=dist(t.x,t.y,r.x,r.y);let l=floor(map(o,0,20,2,6));l=constrain(l,2,6);y.push(t);for(let e=1;e<=l;e++){let o=e/(l+1);let n=lerp(t.x,r.x,o);let a=lerp(t.y,r.y,o);y.push({x:n,y:a})}}y.push(b[b.length-1]);let x=y.length;for(let e=0;e<x;e++){if(Er(f,0,1)>.2){let t=hue(d);let n=saturation(d);let s=Er(f,0,1)<.9?Er(f,.7,1.3):Cr(f,[.8,2]);let c=brightness(d)*s;let i=y[e];let p=noise(i.x*.1,i.y*.1);let h=Vr(f,1,3);for(let s=0;s<h;s++){let s=Er(f,0,1)<.9?Er(f,.8,1.8):Er(f,2,3);s*=a(e/x);let p=Er(f,0,1)>.05?random(.7,.98):Er(f,1.2,2);let h=Er(f,-s,s)*p;let d=Er(f,-s,s)*p;r.fill(t,n,c,.3);s=constrain(s,0,4);if(s>=3)s=s*random(.1,.5);r.ellipse(i.x+h+o,i.y+d+l,s)}}}r.pop();return[u,g]}function Dl(e={}){let{pts:t=[],pg:r=pgL3,baseX:o=0,baseY:l=0,col:n="black",branchWidthFunc:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:c=0,vertexMode:i=1,minPoints:p=10,sameWidth:h=0}=e;if(t.length<4){let e=[];for(let r=0;r<t.length-1;r++){let o=t[r];let l=t[r+1];e.push(o);let n=ceil((5-t.length)/(t.length-1));for(let t=1;t<=n;t++){let r=t/(n+1);let a=lerp(o.x,l.x,r);let s=lerp(o.y,l.y,r);e.push(createVector(a,s))}}e.push(t[t.length-1]);t=e}let f;if(Ke==1){let e=zt.colors.stroke[0];let t=zt.colors.stroke[1];if(tt==0)f=kr(e[0],e[1],e[2],.8);else if(tt==1)f=kr(t[0],t[1],t[2],.5);else if(tt==2)f=kr(0,0,1,.9)}else{f=n;if(f.levels[3]===0)return}f=Vl(f,Ve[0],Ve[1],Ve[2]);let d=1;if(tt==2){d=random(0,1)<.05?random(5,10):random(0,1)<.5?random(2,3):random(.8,1.2)}if(Ke==1&&nt==1){d=random(0,1)<.2?random(1.5,2.2):random(.8,1.2)}if(h==1)d=1;let[m,u]=wl({pts:t,branchWidthFunc:e=>a(e)*d});if(nt==1&&random(0,1)<.2){let[e,n]=wl({pts:t,branchWidthFunc:e=>noise(e*10)*Dr([2,2,1,1,0])});let a=zt.colors.stroke[2];r.push();r.noFill();r.strokeWeight(random(.5,2));r.stroke(a[0],a[1],a[2],.5);if(random(0,1)>.95){let e=o+random(-10,10);let t=l+random(-10,10);let n=random(1,3);r.ellipse(e,t,n)}r.pop();Cl({pts:e.map((e=>({x:e.x+noise(e.x*.1,e.y*.1)*5,y:e.y+noise(e.y*.1,e.x*.1)*5}))).concat(n.reverse().map((e=>({x:e.x+noise(e.x*.1,e.y*.1)*5,y:e.y+noise(e.y*.1,e.x*.1)*5})))),pg:r,col:kr(a[0],1,a[2]*Dr([.6,1,1.2]),1),baseX:o,baseY:l,randomOffset:c,vertexMode:1})}Cl({pts:m.concat(u.reverse()),pg:r,col:f,baseX:o,baseY:l,randomOffset:c,vertexMode:1});return[m,u]}}{function Al(e){padfactor=10;let t=1e4;pgTex.push();let r=wr(Nt);while(t--){x=r.random(0,pgTex.width);y=r.random(0,pgTex.height);pgTex.strokeWeight(r.random(.1,.2));pgTex.stroke(0,0,0,r.random(.1,.2)*e);pgTex.noFill();pgTex.curve(r.random(-padfactor,pgTex.width+padfactor),r.random(-padfactor,pgTex.height+padfactor),r.random(-padfactor,pgTex.width+padfactor),r.random(-padfactor,pgTex.height+padfactor),r.random(-padfactor,pgTex.width+padfactor),r.random(-padfactor,pgTex.height+padfactor),r.random(-padfactor,pgTex.width+padfactor),r.random(-padfactor,pgTex.height+padfactor))}pgTex.pop()}function Il(e,t=1){let r=e*255;pgTex.noStroke();let o=wr(Nt);for(var l=0;l<pgTex.width-1;l+=2){for(var n=0;n<pgTex.height-1;n+=2){if(ce==25)pgTex.fill(0,0,.5,.5);else pgTex.fill(0,0,o.random(180,265)/255,r/255);pgTex.rect(l,n,o.random(1.5,2)*t,o.random(1,1.5)*t)}}for(var l=0;l<30;l++){if(ce==25)pgTex.fill(0,0,.5,1);else pgTex.fill(0,0,o.random(60,170)/255,o.random(r,r*2)/255);pgTex.rect(o.random(0,pgTex.width-2),o.random(0,pgTex.height-2),o.random(1.5,2.5),o.random(1.5,2.5))}}function Ll(e){let t=zt.colors.bg[0][0];let r=zt.colors.bg[0][1];let o=zt.colors.bg[0][2];pgTex.push();let l=wr(Nt);Ol(1e4);Yl(6e4);pgTex.pop()}function Sl(){margin=0;let e=wr(Nt);let t=e.random(0,1)>.5?e.random(pgTex.width*.3,pgTex.width*.4)+pgTex.width/2:-1*e.random(pgTex.width*.3,pgTex.width*.4)+pgTex.width/2;let r=e.random(0,1)>.5?e.random(pgTex.height*.3,pgTex.height*.4)+pgTex.height/2:-1*e.random(pgTex.height*.3,pgTex.height*.4)+pgTex.height/2;for(i=0;i<1e3;i++){pgTex.noStroke();pgTex.fill(0,0,e.random(0,.5),e.random(.005,.01)*1);let t=e.random(margin,pgTex.width-margin);let r=e.random(margin,pgTex.height-margin);pgTex.ellipse(t,r,e.random(pgTex.width*.02,pgTex.width*.2),e.random(pgTex.width*.02,pgTex.width*.2));t=e.random(margin,pgTex.width-margin);r=e.random(margin,pgTex.height-margin);pgTex.rect(t,r,e.random(pgTex.width*.02,pgTex.width*.2),e.random(pgTex.width*.02,pgTex.width*.2))}}function Bl(e=1){brushSize=100;let t=wr(Nt);brushSpan=Vr(t,3,16);brushDist=Vr(t,10,30);brushSpan=3;brushDist=10;const r=createGraphics(brushSize,brushSize);r.noFill();r.translate(brushSize/2,brushSize/2);for(let o=0;o<100;o++){r.stroke(t.random(.5,1)*255,10*e);const o=t.random(0,1)*brushSize/2;const l=t.random(0,1)*TAU;const n=o*cos(l);const a=o*sin(l);r.point(n,a)}for(let e=-brushSize;e<pgTex.width+brushSize;e+=pgTex.width/1e3){for(let t=-brushSize;t<pgTex.height+brushSize;t+=brushSpan){pgTex.image(r,e,t+(noise(e/10,t/10)-.5)*brushDist)}}}function Wl(e=1500,t=1){pgTex.push();let r=wr(Nt);for(let o=0;o<e;o++){let e=r.random(0,pgTex.width);let o=r.random(0,pgTex.height);let l=r.random(3,15);let n=r.random(.5,2);let a=r.random(0,TWO_PI);pgTex.push();pgTex.translate(e,o);pgTex.rotate(a);pgTex.noFill();pgTex.strokeWeight(n);let s=r.random(.05,.3);let c=zt.colors.bg[0];if(r.random(0,1)>.5)pgTex.stroke(c[0],c[1]*1.5,c[2],t*s);else pgTex.stroke(c[0],c[1],c[2]*2,t*s);let i=r.random(-2,2);let p=r.random(-2,2);pgTex.bezier(-l/2,0,-l/4+i,i,l/4+p,p,l/2,0);if(r.random(0,1)<.3){let e=l*r.random(.3,.6);let t=r.random(-PI/6,PI/6);pgTex.push();pgTex.rotate(t);pgTex.strokeWeight(n*.7);pgTex.bezier(0,0,e/4,r.random(-1,1),e/2,r.random(-1,1),e,0);pgTex.pop()}pgTex.pop()}pgTex.pop()}function kl(shift=-3){const e=createGraphics(pgTex.width,pgTex.height);let t=min(pgTex.width,pgTex.height);t=t-t%10;e.colorMode(HSB,1);if(ce==25||ce==27)e.stroke(0,0,.5,.9);else e.stroke(.8,.3);e.noFill();const r=pgTex.width*pgTex.height;const o=sqrt(r);let l=map(p.pix,2,5.5,1,1.6);const n=int(o*l*.8);e.strokeWeight(t/1200/l);let a=wr(Nt);for(let t=n;t--;){e.point(a.randomGaussian(pgTex.width/2,pgTex.width/4),a.randomGaussian(pgTex.height/2,pgTex.height/4))}for(let t=n;t--;){pgTex.push();const t=a.random(-shift,shift);const r=a.random(-shift,shift);pgTex.translate(t*pgTex.width/2/exp(abs(t)),r*pgTex.height/2/exp(abs(r)));pgTex.image(e,0,0);pgTex.pop()}e.remove()}function Xl(){let e=zt.colors.bg[0];let t=1;pgTex.push();let r=wr(Nt);let o=[[1,1.5],[1,2]];let l=Cr(r,o);l[1]=l[1]+.2;for(let o=0;o<width+1;o+=l[1]){for(let n=0;n<height+1;n+=l[1]){let a=.8;let s=e[0];let c=e[1];let i=e[2]*1.5;let p=r.random(l[0],l[1]);let h=p;if(noise(o*.04,n*.04,2)*r.random(0,1)*t>.8||r.random(0,1)<.01*t){s=0;c=0;i=1;p=r.random(.5,5);h=r.random(.5,5)}pgTex.noStroke();pgTex.fill(s,c,i,1);pgTex.rect(o,n,p,h)}}pgTex.pop()}function Yl(e){let t=zt.colors.bg[0][0];let r=zt.colors.bg[0][1];let o=zt.colors.bg[0][2];let l=wr(Nt);for(let t=0;t<e;t++){pgTex.stroke(0,0,1,l.random(.05,.1)+.15);pgTex.strokeWeight(l.random(.8,1.8));let e=l.random(0,1)*pgTex.width;let t=l.random(0,1)*pgTex.height;let r=l.random(0,1)*2*PI;let o=l.random(0,1)*10+5;let n=cos(r)*o+e;let a=sin(r)*o+t;let s=e+(l.random(0,1)-.5)*10;let c=t+(l.random(0,1)-.5)*10;let i=n+(l.random(0,1)-.5)*10;let p=a+(l.random(0,1)-.5)*10;pgTex.noFill();pgTex.curve(s,c,e,t,n,a,i,p)}}function Ol(e){const t=1e3;const r=e;let o=wr(Nt);for(let e=0;e<r;e++){let e=o.random(-t,pgTex.width+t);let r=o.random(-t,pgTex.height+t);let l=o.random(-t,pgTex.width+t);let n=o.random(-t,pgTex.height+t);let a=o.random(-t,pgTex.width+t);let s=o.random(-t,pgTex.height+t);let c=o.random(-t,pgTex.width+t);let i=o.random(-t,pgTex.height+t);pgTex.push();pgTex.strokeWeight(o.random(.05,.13));pgTex.stroke(0,0,0,o.random(.04,.08));pgTex.noFill();pgTex.bezier(e,r,l,n,a,s,c,i);pgTex.pop()}}function zl(e){let t=wr(Nt);if(!e){e=Cr(t,[4,5,6]);if(ce==25||ce==27)e=7}l.紙張類別=e;if(e==1){Bl(.6);Wl(500,1)}else if(e==2){Sl();Bl(.5);Wl(300,2)}else if(e==3){Bl(2);kl(.1);Wl(300,2)}else if(e==4){Il(.3);Wl(500,2)}else if(e==5){kl();Wl(1e3,1);Ll()}else if(e==6){Xl();kl(.2);Wl(300,2)}else if(e==7){Bl(2);kl(.1);Wl(1e3,1);Ll()}}}function draw(){ortho(-width/2,width/2,-height/2,height/2,-1e4,1e4);if(X>=z&&v==false){v=true;if(e==1){setTimeout((()=>{saveCanvas(ft,"png")}),500);setTimeout((()=>{Nt=Tr(3e6,99e5);let e=window.location.hash;let t="";if(e.includes("data_")){t="#data_"+e.split("data_")[1].split("#")[0]}window.location.hash=t+(t?"#":"")+"seed_"+Nt}),3500)}if(B)I();console.log("");console.log("== 生成完成 ==");return}if(v==false){dt.setState({distance:1e3,center:[0,0,0],rotation:[1,0,0,0]});if(!R)f();else d()}if(v==true){if(t==false)noLoop();let e=frameCount*.005;let r=dt.getState();if(!bt){gt=millis();bt=true}let o=constrain((millis()-gt)/yt,0,1);let l=1;let n=.01*cos(e);let a=.06*sin(e);let s=-.01;let c=sqrt(l*l+n*n+a*a+s*s);l/=c;n/=c;a/=c;s/=c;let i=r.rotation;let p=[l,n,a,s];r.rotation=[lerp(i[0],p[0],o*.1),lerp(i[1],p[1],o*.1),lerp(i[2],p[2],o*.1),lerp(i[3],p[3],o*.1)];dt.setState(r);vl()}if(ht){save("plant_"+frameCount+".png")}if(v&&!bt){wt=[]}}function Rl(e){randomSeed(e);noiseSeed(e)}function vl(){rectMode(CENTER);clear();stroke(1,0,1,1);noFill();dt.beginHUD();push();translate(0,0,-1e3);image(pgBg,width/2,height/2);pop();dt.endHUD();for(let e=0;e<Vt.length;e++){let t=Vt[e];if(!Ft[t.index]){console.warn(`圖層 ${t.index} 不存在`);continue}push();let r=constrain(t.y,0,p.dim);let o=map(e,0,Vt.length,-700,-200);o+=e*.001;translate(0,0,o);image(Ft[t.index],0,0,width,height);pop()}dt.beginHUD();push();blendMode(BLEND);image(pgFrame,width/2,height/2);blendMode(MULTIPLY);image(pgTex,width/2,height/2);blendMode(BLEND);pop();dt.endHUD()}function keyPressed(){if(keyCode===ENTER){console.log("儲存圖片:"+ft);saveCanvas(ft,"png")}if(keyCode===SHIFT){let hash=window.location.hash;let e="";if(hash.includes("data_")){e=decodeURIComponent(hash)}let t;try{t=JSON.parse(e)}catch(r){t=e}let r={"hash值":t,"植物統計":a,"路徑資料":s};let o=JSON.stringify(r,null,2);saveJSON(r,ft+".json")}if(key==="g"||key==="G"){console.log("開始儲存圖層...");console.log("總圖層數量:",Ft.length);console.log("yPositions 數量:",xt.length);if(!xt||xt.length===0){console.warn("沒有可儲存的圖層");return}let e=[...xt].sort(((e,t)=>e.y-t.y));console.log("圖層位置信息：");e.forEach(((e,t)=>{console.log(`圖層 ${t}: index=${e.index}, y=${e.y}, 是否存在=${!!Ft[e.index]}`)}));e.forEach(((e,t)=>{if(Ft[e.index]){let r=Nt+`_layer_${t+1}_${e.index}.png`;Ft[e.index].save(r);console.log(`儲存圖層: ${r}`)}else{console.warn(`無法儲存圖層 ${e.index}: 圖層不存在`)}}))}}function mousePressed(){window.location.reload()}function _l(){window.location.reload()}function Nl(){const e=document.querySelector("canvas");if(!e)return;const t=window.innerWidth;const r=window.innerHeight;const o=p.dim*p.ratio;const l=p.dim;if(t/r>o/l){e.style.height=r+"px";e.style.width=r*o/l+"px"}else{e.style.width=t+"px";e.style.height=t*l/o+"px"}}window.addEventListener("resize",Nl);window.setup=setup;window.draw=draw;let Ml={},Hl=0;let Gl={paths:[[{x:244,y:170},{x:110,y:239}],[{x:109,y:253},{x:228,y:332}],[{x:251,y:334},{x:361,y:275}],[{x:358,y:265},{x:249,y:176}],[{x:220,y:246},{x:112,y:381}],[{x:266,y:275},{x:369,y:347}],[{x:272,y:222},{x:381,y:220}],[{x:170,y:246},{x:171,y:49}],[{x:241,y:294},{x:224,y:432}],[{x:289,y:243},{x:409,y:157}],[{x:305,y:391},{x:391,y:301}]],dots:[{x:295,y:352},{x:130,y:300},{x:135,y:170},{x:313,y:248},{x:304,y:180}]};let Ul={paths:[[{x:70,y:418},{x:15,y:340}],[{x:47,y:357},{x:119,y:266}],[{x:130,y:352},{x:71,y:291}],[{x:125,y:395},{x:228,y:299}],[{x:171,y:406},{x:294,y:336}],[{x:270,y:413},{x:235,y:336}],[{x:330,y:380},{x:310,y:252}],[{x:312,y:453},{x:404,y:341}],[{x:436,y:415},{x:346,y:321}],[{x:466,y:367},{x:423,y:243}]],dots:[{x:170,y:283},{x:140,y:454},{x:272,y:317},{x:402,y:293},{x:236,y:397},{x:442,y:479},{x:375,y:317},{x:57,y:485},{x:242,y:445}]};let $l={paths:[[{x:471,y:100},{x:66,y:105}],[{x:44,y:120},{x:296,y:125}],[{x:472,y:249},{x:213,y:251}],[{x:45,y:225},{x:350,y:229}],[{x:36,y:387},{x:224,y:384}],[{x:114,y:406},{x:293,y:409}],[{x:450,y:378},{x:310,y:378}]],dots:[]};let ql={paths:[[{x:249,y:483},{x:226.28,y:425.04},{x:184.74,y:377.74},{x:145.58,y:328.11},{x:122.15,y:269.87},{x:116,y:207}],[{x:213,y:367},{x:199,y:283.17},{x:210.83,y:198.68},{x:240.26,y:118.47},{x:251,y:35}],[{x:254,y:433},{x:282.65,y:376.35},{x:333.84,y:332.16},{x:366.24,y:274.16},{x:374,y:207}],[{x:248,y:393},{x:266,y:300.23},{x:298.7,y:211.53},{x:317,y:119}]],dots:[{x:194,y:442},{x:301,y:396},{x:318,y:451},{x:227,y:334},{x:308,y:332}]};let Jl={paths:[[{x:455,y:245},{x:409.73,y:135.67},{x:318.71,y:60},{x:204.1,y:40.3},{x:98.42,y:96.58},{x:35.44,y:200.4},{x:41.71,y:318.82},{x:116.74,y:413.83},{x:221.71,y:465.71},{x:338.62,y:455.38},{x:423.31,y:370.39},{x:464,y:260}],[{x:103,y:449},{x:232,y:372}],[{x:402,y:430},{x:342,y:338}],[{x:53,y:109},{x:91,y:241}],[{x:448,y:180},{x:307,y:187}]],dots:[{x:392,y:355},{x:320,y:423},{x:206,y:428},{x:393,y:219},{x:100,y:350}]};let jl={paths:[[{x:62,y:535},{x:4,y:391}],[{x:63,y:535},{x:71,y:276}],[{x:145,y:528},{x:98,y:434}],[{x:163,y:537},{x:169,y:336}],[{x:290,y:517},{x:227,y:420}],[{x:302,y:522},{x:364,y:375}],[{x:440,y:522},{x:417,y:312}],[{x:472,y:511},{x:480,y:400}],[{x:364,y:517},{x:300,y:392}],[{x:449,y:502},{x:450,y:441}],[{x:207,y:515},{x:215,y:247}],[{x:0,y:214},{x:94,y:281}],[{x:0,y:328},{x:182,y:387}]],dots:[{x:386,y:493},{x:236,y:492},{x:292,y:493},{x:84,y:492},{x:416,y:481},{x:19,y:487},{x:142,y:493}]};let Kl={paths:[[{x:270,y:508},{x:255,y:300}],[{x:344,y:522},{x:314,y:144}],[{x:518,y:63},{x:335,y:301}],[{x:506,y:209},{x:414,y:330}],[{x:173,y:532},{x:189,y:226}],[{x:2,y:222},{x:92,y:334}],[{x:100,y:522},{x:94,y:391}],[{x:438,y:516},{x:430,y:356}],[{x:529,y:394},{x:223,y:443}],[{x:57,y:526},{x:32,y:349}]],dots:[{x:138,y:528},{x:234,y:488},{x:327,y:486},{x:405,y:479},{x:475,y:490},{x:9,y:491},{x:159,y:491},{x:62,y:541}]};let Ql={paths:[[{x:87,y:476},{x:85,y:299}],[{x:86,y:263},{x:89,y:104}],[{x:154,y:432},{x:155,y:176}],[{x:233,y:478},{x:243,y:299}],[{x:246,y:271},{x:251,y:56}],[{x:340,y:482},{x:345,y:197}],[{x:345,y:153},{x:345,y:101}],[{x:423,y:411},{x:421,y:290}],[{x:423,y:99},{x:423,y:182}]],dots:[]};let Zl={paths:[[{x:27,y:445},{x:436,y:426}],[{x:445,y:441},{x:198,y:420}],[{x:28,y:265},{x:221,y:271}],[{x:143,y:282},{x:358,y:244}],[{x:272,y:257},{x:470,y:274}],[{x:21,y:92},{x:322,y:105}],[{x:162,y:109},{x:466,y:83}],[{x:64,y:382},{x:285,y:387}],[{x:443,y:211},{x:295,y:221}]],dots:[]};let en={paths:[[{x:57,y:53},{x:472,y:86}],[{x:51,y:89},{x:341,y:56}],[{x:50,y:253},{x:224,y:199}],[{x:144,y:207},{x:417,y:237}],[{x:457,y:282},{x:373,y:215}],[{x:36,y:426},{x:232,y:394}],[{x:82,y:407},{x:367,y:411}],[{x:462,y:425},{x:306,y:390}]],dots:[{x:263,y:431},{x:115,y:240},{x:384,y:251},{x:179,y:82},{x:395,y:66},{x:466,y:99},{x:262,y:245}]};const tn="f1cfa9850908263f2b05";const rn="ap3";const on="postbotany";const ln="reload";if(!window.Pusher){console.error("Pusher SDK 未加载，请确保已引入 https://cdn.jsdelivr.net/npm/pusher-js@7.3.0/dist/pusher.min.js")}window.pusherInstance=window.pusherInstance||new Pusher(tn,{cluster:rn});window.pusherChannel=window.pusherChannel||window.pusherInstance.subscribe(on);window.sendReloadEvent=function(hash){alert("请用后端或 Pusher REST API 触发 reload 事件，前端无法直接 trigger。")};window.onReloadEvent=function(e){window.pusherChannel.bind(ln,(function(t){e&&e(t.hash)}))};</script></body></html>
