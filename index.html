<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><title>Polypaths</title><meta name="viewport" content="width=device-width,initial-scale=1"><script src="lib/p5.min.js"></script><script src="lib/p5.easycam.js"></script><link rel="stylesheet" type="text/css" href="style.css"></head><body><img src="project.png" class="project-image" alt="project"><div id="canvas-container"><div id="canvas-border"></div></div><script>let e=0,t=0,o=1,r=0;let l={},n=0,a=[];let s,c,p,f,d,m;let h=0,g=0,u,b=0;let F,w,P=[];let V=false,T=0,C,E=0,D=0,A=0;let S=[],I=0,L=1;window.debugMode1=0;window.debugMode2=0;window.debugMode3=0;window.debugMode4=0;window.debugMode5=0;window.debugMode6=0;window.debugMode7=0;window.textureReady=false;window.finalReady=false;let B={dim:1024,pix:2,ratio:1};function preload(){const e=window.location.hash;const o=e.match(/&pix_(\d+(\.\d+)?)/);if(o){const e=parseFloat(o[1]);if(!isNaN(e)){B.pix=e}}if(window.hires==true){B.pix=4;console.log("***hires mode activated")}Ur();window.addEventListener("hashchange",(function(e){const t=new URL(e.newURL);const o=new URL(e.oldURL);const r=t.hash.includes("data_")?t.hash.split("data_")[1].split("#")[0]:"";const l=o.hash.includes("data_")?o.hash.split("data_")[1].split("#")[0]:"";const n=t.hash.includes("seed_")?t.hash.split("seed_")[1].split("#")[0]:"";const a=o.hash.includes("seed_")?o.hash.split("seed_")[1].split("#")[0]:"";if(r!==l||n!==a){window.location.reload()}}));if(e&&e.includes("#data_")){hashPart=e.split("&")[0];n=1}else if(pathData){hashPart=pathData;n=1;const e=new URL(window.location);e.hash=pathData;history.replaceState(null,"",e);console.log("***pathData from verse.js:"+pathData)}ho=ee;if(e.includes("&sp2")){r=2;console.log("***special plant mode 2 activated")}else if(e.includes("&sp1")){r=1;console.log("***special plant mode 1 activated")}if(e.includes("&3d")){t=1;console.log("***3D mode activated")}if(e.includes("&oneshot")){h=1;console.log("***oneShot mode activated")}for(let e=1;e<=9;e++)window["debugMode"+e]=0;const l=e.match(/&debug_(\d+)/g);if(l){l.forEach((e=>{const t=e.match(/\d+/)[0];for(const e of t){window["debugMode"+e]=1;console.log(`***debug mode ${e} activated`)}}))}if(e.includes("&puta")){for(const e of[1,2,3,4,5,6,7]){window["debugMode"+e]=1;console.log(`***debug mode ${e} activated`)}}if(e.includes("&view")){I=1;t=1;console.log("***view mode activated (3D mode also enabled)")}Tl(ho)}function v(){a=[];pixelDensity(B.pix);if(Yt)frameRate(1);l.seed=ho;uo=Zo([0,1,2,3,3,4,5,6]);if(n==1)uo=Zo([1,3,3,4,6]);l.layout=uo;vt=random(0,1)>.6?1:0;l.specialLayout=vt;ce=Zo([11,13,15,17,19,21]);if(uo==2)B.ratio=.7;else if(uo==1||uo==5)B.ratio=1.33;else if(uo==4)B.ratio=.7;else if(uo==6)B.ratio=.5;else B.ratio=1;if(uo==1||uo==3||uo==4||uo==6)Bl=1;if(Bl==1){if(n==1){let e=$r();window.pathData=e;if(e){Ll=e;Fo="url"}else{console.log("***URL 数据解析失败，使用默认数据");Ll=zl;Fo="預設圓形"}}else{if(uo==3||uo==6)Ll=Zo([vl,Yl,zl,Xl,_l,Ml]);else if(uo==1)Ll=Zo([kl,Xl,zl,Ol,_l,Ml]);else if(uo==4)Ll=Zo([Ol,Rl,Wl,_l,Ml]);if(Ll===vl)Fo="0";else if(Ll===kl)Fo="1";else if(Ll===Xl)Fo="2";else if(Ll===Yl)Fo="3";else if(Ll===zl)Fo="4";else if(Ll===Ol)Fo="5";else if(Ll===Rl)Fo="6";else if(Ll===Wl)Fo="7";else if(Ll===_l)Fo="8";else if(Ll===Ml)Fo="9"}let e=0;for(let t=0;t<Ll.paths.length;t++){e+=Ll.paths[t].length-1}ce=Ll.paths.length+Ll.dots.length;console.table({"json path group":Fo,"total objetc number":ce,"path segment number":e,"dot number":Ll.dots.length});a.push({"json path group":Fo,"total object number":ce,"path segment number":e,"dot number":Ll.dots.length})}const e=createCanvas(B.dim*B.ratio,B.dim,WEBGL);e.canvas.willReadFrequently=true;e.elt.id="snap2Verse";Ot=new Dw.EasyCam(this._renderer);ortho(-width/2,width/2,-height/2,height/2,-1e4,1e4);Ot.setDistanceMin(100);Ot.setDistanceMax(2e3);Ot.setDistance(1e3);Ot.setRotationConstraint(false,false,false);if(I==0){Ot.removeMouseListeners()}textSize(24);colorMode(HSB,360,1,1,1);imageMode(CENTER);Tr();particles=[];he=.7;if(Bl==0){if(ce>16){Kt=random(0,1)<.7?0:random(0,1)<.4?1:3;ce=Math.floor(ce*1.3);if(Kt==3)uo=5}else{Kt=random(0,1)<.5?0:2}l.plantType=Kt;l.plantNum=ce}else{let e=0;for(let t=0;t<Ll.paths.length;t++){let o=Ll.paths[t];if(o.length<2)continue;let r=o[0],l=o[o.length-1];let n=l.x-r.x;let a=l.y-r.y;let dist=Math.round(Math.sqrt(n*n+a*a));if(dist>450)e++}if(e>9){E=1;l.forestMode=1}else{E=0;l.forestMode=0}let t=0;for(let e=0;e<Ll.paths.length;e++){let o=Ll.paths[e];if(o.length<2)continue;let r=o[0],l=o[o.length-1];let n=Math.atan2(l.y-r.y,l.x-r.x)*180/Math.PI;if(n>30&&n<150)t++}if(t>7)D=1;l.vineMode=D}co=mr();po={...yr()};typeC={...wr()};qe=co.colors.bg;Je=co.colors.stroke;let t=new URLSearchParams(window.location.search);let o=t.has("paperType")?parseInt(t.get("paperType")):null;tn(o);if(window.debugMode5==0)pgBg.background(co.colors.bg[0][0],co.colors.bg[0][1],co.colors.bg[0][2],1);else pgBg.background(0,0,.8,1);Al()}function setup(){v();pgVerse.elt.id="pgVerse";Ie=[1,1,1,0];C=random(0,1)>.95?1:0;if(Bl==1){if(Ll.dots.length==6&&Ll.paths.length==6)C=1}l.dazeMode=C;l.plantType=Kt;At=random(0,1)<.9?0:Zo([1,2]);l.strokeType=At;It=random(0,1)<.5?1:0;l.wildMode=It;Le=0;dt=random(0,1)>.05?Zo([0,1,2,3]):4;l.flowerTypes=dt;mt=Zo([0,1]);l.pistilTypes=mt;ht=random(0,1)<.85?Zo([0,1,2,3,6]):4;l.fruitTypes=ht;wt=random(0,1)>.9?Zo([.4,.6,.8]):1;if(n==1)wt=1;l.dropLeafProb=wt;Me=random(0,1)<.8?er(.3,1.2):.2;Ne=random(0,1)<.8?er(.3,1.2):.2;A=random(0,1)>.1?0:1;if(Bl==1){if(Ll.dots.length>15&&Ll.paths.length>15)A=random(0,1)>.5?0:1}if(A==0){be=.1;l.looseMode=0}else if(A==1){Ne=6;Me=3;be=.03;l.looseMode=1}He=Me;Ge=Ne;l.noiseScale=be;l.strokeShift=Me;l.fillShift=Ne;Vt=random(0,1)>.95?.1:random(0,1)>.2?.8:random(0,1)>.3?.3:1;l.sketchProb=Vt;if(random(0,1)>Vt)Pt=1;else Pt=0;Ft=random(0,1)<.1?1.1:random(0,1)<.3?0:Zo([.3,.6,.8]);l.lerpLeafProb=Ft;Ct=Zo([.8,.9,1,1.1,1.2]);l.sketchFillColor=Ct;gt=random(0,1)<.1?3:random(0,1)<.9?0:1;l.leafType=gt;Ee=[Qo(10,20),Qo(10,25)];Tt=Zo([1,.9]);l.vertexModProb=Tt;Lt=random(0,1)>.3?0:1;l.depthColor=Lt;if(Bl==1){if(Ll.dots.length>20)g=random(0,1)>.4?1:0;else if(Ll.dots.length>25)g=random(0,1)>.3?1:0;else if(Ll.dots.length>30)g=random(0,1)>.2?1:0}l.oneObjectMode=g;u=Zo(["B","D","D","E"]);xe=er(.8,1.2);if(E==1)xe=er(1.2,2);if(uo!=3)he=1;if(uo==0)de=.35;else if(uo==2)de=.6;else if(uo==1||uo==6)de=.35,Ee=[20,25];else if(uo==5)de=.6,Ee=[25,30];Qt=Zo([.1,.33,.5,.7,.8,.9,.95]);Zt=Zo([.1,.33,.5,.7,.8,.9,.95,1,1,1]);l.branchUpdateProb=Qt;l.plantParamUpdateProb=Zt;lo=.8;Re=random(0,1)<.05?0:random(0,1)<.3?.7:1;l.changeColorProb=Re;ao=.2;to=random(0,1)<.95?Zo([.96,.98,.995,.995,1,1,1,1,1,1]):.8;oo=random(0,1)<.95?Zo([.96,.98,.995,.995,1,1,1,1,1,1]):.8;ro=random(0,1)>.5?.985:1;l.butterflyProb=to;l.dragonflyProb=oo;l.ladyBugProb=ro;ye=random(0,1)<.8?Zo([0,1,2,3,4,5]):6;l.objectGroup=ye;if(ye==0){Fe={leaf:80,flower:30,fruit:20,grass:20,mushroom:5}}else if(ye==1){Fe={leaf:6,flower:30,fruit:0,grass:20,mushroom:10}}else if(ye==2){Fe={leaf:40,flower:0,fruit:20,grass:20,mushroom:10}}else if(ye==3){Fe={leaf:15,flower:5,fruit:10,grass:5,mushroom:5}}else if(ye==4){Fe={leaf:0,flower:0,fruit:3,grass:5,mushroom:3};ce=floor(ce*1.5);Ee=[Qo(20,30),Qo(20,30)];Qt=.6;Zt=1}else if(ye==5){Fe={leaf:20,flower:0,fruit:2,grass:20,mushroom:2};ge=1;he=.6}else if(ye==6){Fe={leaf:constrain(Qo(-10,40),0,40),flower:constrain(Qo(-10,40),0,40),fruit:constrain(Qo(-10,40),0,40),grass:constrain(Qo(-10,40),0,40),mushroom:constrain(Qo(-10,40),0,40)}}if(D==1){Fe.leaf=0;Fe.flower=0;Fe.fruit=0}if(Bl==1){Fe.grass=Qo(4,10);Fe.mushroom=Qo(2,6)}if(Ll==Xl||Ll==Wl){Re=er(.8,1.05);Qt=er(.8,1.05);Zt=er(.8,1.1);console.log("");console.log("****特殊模式")}if(r==1){Fe={leaf:200,flower:5,fruit:0,grass:10,mushroom:3};ao=.4;de=.4;ge=1;he=1;dt=2;It=0;gt=0;to=1;oo=1;ro=1;Re=1;Qt=1;Zt=1;Lt=1;Vt=1;Ne=.2;Me=.5;xe=1;me=.1}else if(r==2){Fe={leaf:20,flower:2,fruit:1,grass:0,mushroom:0};ao=.7;de=.4;ge=1;he=1;dt=4;It=0;gt=0;to=1;oo=1;ro=1;Re=1;Qt=1;Zt=1;Lt=1;Vt=1;Ne=.2;Me=.5;Ee=[12,12];xe=.8;me=1}bo=random(height*.45,height*.55);We=Qo(-1,5)*5;let e=random(0,1)>.1?0:5;if(r==2)We=0,e=0;l.specialColorMode=e;l.hueShift=We;b=random(0,1)<.5?0:1;l.randomType=b;if(e==0){$e=[0,1,1];je=[0,1,1]}else if(e==5){It=1;$e=[Zo([0,er(0,120)]),Zo([er(0,1),er(1,5)]),Zo([er(0,1),er(1,5)])];je=[Zo([0,er(0,120)]),Zo([er(0,1),er(1,5)]),Zo([er(0,1),er(1,5)])];Ie=[0,0,Zo([0,1]),Zo([0,1])]}if(window.debugMode3==1){$e=[0,0,0];je=[0,0,0]}if(window.debugMode4==1){Ie=[0,1,1,1]}if(Bl==1)Gr();let t=window.location.href;let baseUrl=t.split("#")[0];window.addEventListener("beforeunload",Zr);zt="seed_"+ho;let o=decodeURIComponent(window.location.hash);let s="";const i=o.match(/data_([^#]*)/);if(i){s="#data_"+i[1]}if(s){window.location.hash=s}S[0]=nr(io.colors.branch[0][0],io.colors.branch[0][1]*random(.8,1.2),constrain(io.colors.branch[0][2]*random(.8,1.2),.3,1));S[1]=nr(io.colors.flower[0][0],io.colors.flower[0][1]*random(.8,1.2),constrain(io.colors.flower[0][2]*random(.8,1.2),.3,1));S[2]=nr(io.colors.bg[0][0],io.colors.bg[0][1]*random(.8,1.2),constrain(io.colors.bg[0][2]*random(.8,1.2),.3,1));S[3]=nr(io.colors.leaf[0][0],io.colors.leaf[0][1]*random(.8,1.2),constrain(io.colors.leaf[0][2]*random(.8,1.2),.3,1));let c=random(0,1)>2;console.table(l,["Parameters"]);console.table(Fe,["單株數量限制"]);a.push(l);a.push(Fe);console.log("");Lr();Br()}function k(){Jr();if(Ke==5)Or(wo);if(Ke==0||Ke==1||Ke==2)Wr(wo);if(Ke==3||Ke==4)Mr(wo,Po);if(Ke==0)Ao=random(0,1)>.95?1:0;else if(Ke==1)Ao=random(0,1)>.95?1:0;else if(Ke==2)Ao=random(0,1)>.95?1:0;else if(Ke==3)Ao=random(0,1)>1?1:0;else if(Ke==4)Ao=random(0,1)>1?1:0;if(uo==1||uo==4||Ke==5)Ao=0;ho=ho+100;Tl(ho);if(Bl==0){if(Ae<8){if(Kt==0)so=random(0,1)<.5?"A":Zo(["B","B","C","D","D","E"]);else if(Kt==1)so=random(0,1)>.9?"A":Zo(["C","B","B","D","D","E"]);else if(Kt==2)so=Zo(["A","B","B","C","E"]);else if(Kt==3)so=random(0,1)>.9?"A":random(0,1)>.3?"E":"D";else so="A";if(so=="A")Ae++;else Se++}else{so=Zo(["B","B","C","D","D","E"]);Se++}}yt=random(0,1)<Ft?1:0;if(r==2)yt=1,de=random(.3,.45);if(r==0){Bt=random(0,1)<.5?0:1;Ee=random(0,1)<.3?[5,5]:[Qo(10,20),Qo(10,25)];ue=random(0,1)<.1?Zo([.2,.3,.6,.8]):Zo([.9,1,1,1,1,1.2])}De={x:0,y:0,height:Infinity};if(uo==0||uo==6){we=random(width*.3,width*.7);bo=bo+random(height*.04,height*.1);if(bo>height*.95)bo=random(height*.45,height*.55);Pe=bo;if(vt==1){we=width/2+random(-50,50);Pe=height*.8+random(-50,50)}}else if(uo==4){we=random(width*.15,width*.85);bo=bo+random(height*.02,height*.07);if(bo>height*.9)bo=random(height*.2,height*.3);Pe=bo}else if(uo==2){we=random(0,1)<.8?random(width*.35,width*.65):random(width*.1,width*.9);if(so=="A")Pe=random(height*.95,height*1.1);else Pe=random(height*.92,height*.97)}else if(uo==5){we=random(width*.1,width*.9);bo=bo+random(height*.04,height*.1);if(bo>height*.9)bo=random(height*.25,height*.35);Pe=bo}if(Bl==1){if(ae<yo.segments.length){const e=ae%yo.segments.length;const t=yo.segments[e];we=int(map(Number(t.baseX.toFixed(2)),0,500,0,width));Pe=int(map(Number(t.baseY.toFixed(2)),0,500,0,height));so="A";if(e===0||t.pathIndex!==yo.segments[e-1].pathIndex){Vo=1}else{Vo=0}}else{const e=ae-yo.segments.length;if(e<yo.dots.length){const t=yo.dots[e];we=int(map(Number(t.baseX.toFixed(2)),0,500,0,width));Pe=int(map(Number(t.baseY.toFixed(2)),0,500,0,height));so=Zo(["B","C","D","E"]);if(g==1)so=u;Vo=0}else{we=random(width*.1,width*.9);Pe=random(height*.1,height*.9);so=Zo(["B","C","D","E"]);if(g==1)so=u;Vo=0}}}if(ae<1||ae>6){ke=random(0,1)>Re?Qo(0,28):ve}if(so!="B"){const e=$o(ve);io={...co};if(ke!==ve){console.log("newTheme:"+ke);ve=ke;co.colors=e;co.colorsID=ve;const t=Cr();Object.assign(io,t)}}else{const e=$o(ve);io={...po};if(ke!==ve){console.log("newTheme:"+ke);ve=ke;po.colors=e;po.colorsID=ve;const t=Cr();Object.assign(io,t)}}if(Lt==0){if(Pe<height*.6&&random(0,1)>.7){_e=.7;if(E==1)_e=_e*2;Xe=.4;Ye=Zo([.6,2]);ze=.4;Oe=1}else{_e=.6;if(E==1)_e=_e*2;Xe=1;Ye=1;ze=1;Oe=1}if(random(0,1)>.9){_e=.7;if(E==1)_e=_e*2;Xe=.4;Ye=Zo([.6,2]);ze=.4;Oe=1}Ct=Zo([.8,.9,1,1.1,1.2])}else if(Lt==1){_e=.5;if(E==1)_e=_e*2;Xe=1;Ye=1;ze=1;Oe=1}if(random(0,1)>Vt)Pt=1;else Pt=0;if(C==1)Pt=1;if(Pt==1){Xe=1;Ye=1;ze=1;Oe=1;Dt=random(0,1)<Tt?0:2;Me=He*random(1,1.5);Ne=Ge*random(1,1.5);let e=Zo([[11,2],[1,4],[2,12],[4,2]]);io.lTp=e;Et=Zo([0,1,2]);if(Et==2)_e=random(1.2,2.2);else _e=random(.8,1.2);if(C==1)_e=random(0,1)>.1?random(2,4):random(4,8);if(E==1)_e=_e*2}else{if(r==0){Dt=random(0,1)<Tt?0:2;Me=He;Ne=Ge;io.lTp=bt}}ut=Qo(3,4);if(so=="A"){io.plantType="woody";if(random(0,1)>Qt){Be=Zo([[1,1],[1,1.1],[1,1.2],[.5,1.5],[20,2]]);ao=random(.1,.4);de=Zo([.3,.35,.4,.45,.5,.65]);he=random(0,1)>.9?er(1.15,1.3):Zo([.6,.8,.9]);me=Zo([.6,.8,.7]);if(D==1)me=me*2;ge=random(0,1)>.95?4:Zo([.5,.6,.8,.7,1.2,1.5,2]);Ir();Sr()}if(random(0,1)>Zt&&ae<=15){he=random(0,1)>.9?er(1.15,1.3):Zo([.6,.8,.9]);Le=random(0,1)<.2?1:0;dt=Zo([0,1,2,3]);mt=Zo([0,1]);ht=random(0,1)<.85?Zo([0,1,2,3]):random(0,1)<.7?4:5;At=random(0,1)<.9?0:Zo([1,2]);gt=random(0,1)<.1?3:random(0,1)<.9?0:1;Er(Do);Dr(Do);Ar(Do)}if(random(0,1)>wt)_.drawLoseLeaves(we,Pe,Qo(0,1));if(ht==4||ht==5)ht=random(0,1)>.2?4:5}else if(so=="B"){io.plantType="grass";ie=1;if(random(0,1)>wt)_.drawLoseLeaves(we,Pe,Qo(0,1))}else if(so=="C"){let e=wr();e.capWidth=Qo(5,20)+int(map(e.mushroomWidth,1.5,3,10,40));io={...e};io.plantType="mushroom";ie=1;if(random(0,1)>wt)_.drawLoseLeaves(we,Pe,Qo(0,1))}else if(so=="D"){ie=1;io.plantType="stone";let e=Zo([0,1,2,3,0,1]);if(e==0)on.stoneAGroup(we,Pe);else if(e==1)on.stoneBGroup(we,Pe);else if(e==2)on.stoneCGroup(we,Pe);else if(e==3)on.stoneDGroup(we,Pe);if(random(0,1)>wt)_.drawLoseLeaves(we,Pe,Qo(0,1))}else if(so=="E"){ie=1;io=co;io.plantType="woodBlock"}else if(so=="F"){ie=1;io.plantType="loseLeaves";if(random(0,1)>wt)_.drawLoseLeaves(we,Pe,1);else{ie=1;io=co;io.plantType="woodBlock"}}let e=`plant_${ae}_${we}_${Pe}`;fo={pg:pgL3,baseX:we,baseY:Pe,PT:io,plantId:e,branchCounter:0,widthFunc:e=>1,lastLeafNode:0,hasDrawnFlower:false};if(!qt.has(e)){Y(fo);qt.add(e)}pe=true;se=0}function X(){if(se==0&&io.branchFork==1&&!io.vineDrawn&&io.branchDepth<3){if(io.branchWidth<=2){M.drawAllPath(io);if(De.path){h=1;M.drawVines({...io,widthFunc:fo.widthFunc,path:De.path,spiral:io.spiral});io.vineDrawn=true;if(window.debugMode7==1){let e=De&&De.path;if(Array.isArray(e)&&e.length>1&&typeof e[0]==="object"){e=e.map((e=>[e.x,e.y]))}if(Array.isArray(e)&&e.length>1){Sl(e)}}}}}else{h=0}if(h==1){if(io.vineDrawn){Qr()}}else{Qr()}if(io.plantType==="woody"&&fo&&fo.PLANT&&fo.PLANT.length>0){ie=fo.PLANT.length}if(se<ie){doleafDirection=random(0,1)>.85?1:0;Qe=random(0,1)>.5?1:0;let e=z(se);if(e){se++}}else{if(h==1){console.log("plantCountDone")}else{if(io.plantType!="woody")Jr()}ae++;pe=false}}function Y(e){De={x:e.baseX,y:e.baseY,height:Infinity,plantId:e.plantId,segmentIndex:ae};currentPath=[];e.vineDrawn=false;e.PT.leafCount=0;e.PT.flowerCount=0;e.PT.fruitCount=0;e.PT.grassCount=0;e.PT.leaflimit=Fe.leaf;e.PT.flowerlimit=Fe.flower;e.PT.fruitlimit=Fe.fruit;e.PT.grasslimit=Fe.grass;if(e.PT.plantType==="woody"){let t=null;if(Bl==0){let o=0;if(uo==0)o=random(-.5,.5);else if(uo==2)o=random(-.3,.3);else if(uo==5)o=random(-2,2);e.PLANT=t=M.drawWoody({pg:pgL1,baseX:e.baseX,baseY:e.baseY,bRt:createVector(PI/2,0,o),bLe:B.dim*de,bwF:e.PT.branchWidth*random(.7,1),mBD:e.PT.branchDepth,col:[e.PT.branchColor[0],e.PT.branchColor[1],e.PT.branchColor[2]*random(.7,1),1],forkCount:e.PT.branchFork,mBW:e.PT.mBW,meta:e.PT,stemTexLine:e.PT.stemTexLine});if(typeof fo!=="undefined"&&t&&t.widthFunc){fo.widthFunc=t.widthFunc}}else if(Bl==1){const o=ae%yo.segments.length;const l=yo.segments[o];if(Ll==Xl||Ll==Wl){Ee=[Qo(5,15),Qo(5,15)]}else{Ee=[Qo(5,20),Qo(5,30)]}if(n==1){if(random(0,1)>.1)Ee=[Qo(3,10),Qo(3,10)];else Ee=[Qo(8,20),Qo(8,20)]}if(D==1){Ee=[Qo(10,20),Qo(15,30)]}if(r!=0){Ee=[Qo(8,16),Qo(8,16)]}e.PLANT=t=M.drawWoody({pg:pgL1,baseX:e.baseX,baseY:e.baseY,bRt:l.bRt,bLe:l.bLe,bwF:l.bwF,mBD:l.mBD,col:l.col,forkCount:l.forkCount,mBW:l.mBW,meta:l.meta,twI:l.twI,stemTexLine:l.stemTexLine});if(typeof fo!=="undefined"&&t&&t.widthFunc){fo.widthFunc=t.widthFunc}}console.log(ce+":"+ae+":wood plant")}else if(e.PT.plantType==="grass"){if(g==1){let t=random(1,2);e.PLANT=el({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,bLe:e.PT.sLe,bwF:e.PT.stemWidth,col:e.PT.stemColor,benScale:e.PT.stembenScale,bBF:t=>createVector(map(noise(t*1),0,1,-1,1)*t*e.PT.sBn,0,0),meta:e.PT,kk:t})}else{e.PLANT=el({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,bLe:e.PT.sLe,bwF:e.PT.stemWidth,col:e.PT.stemColor,benScale:e.PT.stembenScale,bBF:t=>createVector(map(noise(t*1),0,1,-1,1)*t*e.PT.sBn,0,0),meta:e.PT,kk:1})}console.log(ce+":"+ae+":grass plant")}else if(e.PT.plantType==="mushroom"){e.PLANT=tl({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,capWidth:e.PT.capWidth||30});console.log(ce+":"+ae+":mushroom")}else if(e.PT.plantType==="woodBlock"){Be=[.5,1.1];let t=Zo([1,2,3,4,6,8,15,20]);let o;if(g==1){o=random(0,1)<.33?e=>2*(5*(1-e)*map(noise(e*5),0,1,.5,1)+t):random(0,1)<.5?e=>2*(5*sin(e*PI)*map(noise(e*10),0,1,.5,1.2)+t*.8):e=>2*(5*cos(e*PI*2)*map(noise(e*20),0,1,.3,.6)+t);e.PLANT=M.wood({pg:pgL0,baseX:e.baseX,baseY:e.baseY,bLe:random(150,450),bwF:o,bSg:Qo(60,80),bSh:Qo(6,16),strokeStrength:random(.8,1.2),forceHorizontal:random(0,1)<.3?true:false,depth:1})}else{o=random(0,1)<.33?e=>5*(1-e)*map(noise(e*5),0,1,.5,1)+t:random(0,1)<.5?e=>5*sin(e*PI)*map(noise(e*10),0,1,.5,1.2)+t*.8:e=>5*cos(e*PI*2)*map(noise(e*20),0,1,.3,.6)+t;e.PLANT=M.wood({pg:pgL0,baseX:e.baseX,baseY:e.baseY,bLe:random(50,300),bwF:o,bSg:Qo(60,80),bSh:Qo(6,16),strokeStrength:.8,forceHorizontal:random(0,1)<.3?true:false,depth:1})}console.log(ce+":"+ae+":wood block")}e.stepIndex=0}function z(e){if(!fo||!fo.PLANT||e>=fo.PLANT.length)return true;let t;let o=io.branchDepth===0&&io.branchFork===1;if(o&&io.branchWidth>5){o=false}let r=0;let l=0;if(o){if(!fo.PLANT[0]||!fo.PLANT[0][1]){console.log("vine point array invalid, step="+e);return true}t=fo.PLANT[0][1]}else{if(!fo.PLANT[e]||!fo.PLANT[e][1]){console.log("branch point array invalid, step="+e+", maybe current branch has no point data");return true}t=fo.PLANT[e][1]}if(!t||t.length===0){console.log("point array is empty, step="+e);return true}for(let e=1;e<t.length;e++){r+=dist(t[e][0],t[e][1],t[e-1][0],t[e-1][1])}const n=width*1.05;const a=height*1.05;const s=-width*.05;const i=-height*.05;let c=ao;let p=o?e/ie:e/fo.PLANT.length;if(typeof fo.currentPointIndex==="undefined"){fo.currentPointIndex=0}const f=10;const d=fo.currentPointIndex;const m=min(d+f,t.length-1);l=0;for(let e=1;e<=d;e++)l+=dist(t[e][0],t[e][1],t[e-1][0],t[e-1][1]);if(fo.branchFinished&&fo.branchFinished[e]){console.log("branch finished, skip processing, step="+e);fo.currentPointIndex=0;return true}for(let f=d;f<m;f++){if(t[f][0]>n||t[f][0]<s||t[f][1]>a||t[f][1]<i){continue}if(f>0)l+=dist(t[f][0],t[f][1],t[f-1][0],t[f-1][1]);let d=(l/r).toFixed(2);if(o){let o=f/t.length;if(d>=.9){let o=t[t.length-1];fo.PT.leafGrowType=_o;ut=4;let r=atan2(t[t.length-1][1]-t[t.length-2][1],t[t.length-1][0]-t[t.length-2][0]);if(random(0,1)>.5&&D==0){N.addLeaf(o[0],o[1],fo,r,"final",1)}if(!fo.branchFinished){fo.branchFinished={}}fo.branchFinished[e]=true;fo.currentPointIndex=0;return true}if(o>p||d<c)continue}else{let o=ao;if(e>=2){o=Math.max(.05,ao-e*.05)}if(d>=o){if(!fo.branchFinished){fo.branchFinished={}}if(!fo.branchFinished[e]){O(t,f,fo,d,e,gt)}}else{}}}if(m>=t.length-1){if(!fo.branchFinished){fo.branchFinished={}}fo.branchFinished[e]=true;fo.currentPointIndex=0;return true}fo.currentPointIndex=m;return false}function O(e,t,o,l,n,a){let s=o.PT.branchDepth===0&&o.PT.branchFork===1;let i=o.PLANT[n][0]==o.PT.branchDepth;let c=t/(e.length-1);let p=o.widthFunc?o.widthFunc(c):1;let f=atan2(e[t-1][1]-e[t][1],e[t-1][0]-e[t][0]);let d=o.PT.leafProb;let m=random(0,1)>d&&o.PT.leafCount<o.PT.leaflimit;let h=l>=.9;if(m){if(h){if(r==2){if(!o.branchPetalDrawn){o.branchPetalDrawn={}}if(!o.branchPetalDrawn[n]){let t=e[e.length-1];let r=e[e.length-2];let l=r[0]-t[0];let a=r[1]-t[1];let s=atan2(a,l)-1.57;if(random(0,1)>.1){_.petal2({pg:pgL0,baseX:e[e.length-1][0],baseY:e[e.length-1][1],bRt:createVector(PI/2,0,s),strokeStrength:1,bLe:random(15,30),bwF:e=>p*(1-e*.8)*2,bBF:e=>createVector(0,random(-.3,.3),0),col:[io.flowerColorA[0],io.flowerColorA[1]*1.2,io.flowerColorA[2]*1.2],col2:[io.branchColor[0],io.branchColor[1],io.branchColor[2]*1.2],bSg:10,bSh:3,closeS:true,closeE:true,doLeafVeins:false,meta:io,stemMode:3})}o.branchPetalDrawn[n]=true}}else if(r==1){if(!o.branchFlowerDrawn){o.branchFlowerDrawn={}}if(!o.branchFlowerDrawn[n]){me=.1;_.drawFlowerC({pg:pgL3,id:io.flowerCount,baseX:e[e.length-1][0],baseY:e[e.length-1][1],meta:io});o.branchFlowerDrawn[n]=true}}else{if(!o.branchPetalDrawn){o.branchPetalDrawn={}}if(!o.branchPetalDrawn[n]){if(random(0,1)>.5){o.PT.leafGrowType=_o;ut=3;if(r==0)N.addLeaf(e[e.length-1][0],e[e.length-1][1],o,f,"final",1)}o.branchPetalDrawn[n]=true}}}else{if(a==3){d=.3;let e=10;let t=o.lastLeafNode||0;o.PT.leafGrowType=_o;ut=3}if(r==1){o.PT.leafGrowType=Wo;let r=createVector(e[t][0]-e[t-1][0],e[t][1]-e[t-1][1]);r.normalize();let n=atan2(r.y,r.x)+PI/2;let a=e[t][3]||1;if(i==false){pgText.noFill();pgText.strokeWeight(1);pgText.ellipse(e[t][0],e[t][1],7);Bt=0;N.addLeaf(e[t][0],e[t][1],o,n,"normal",l);o.lastLeafNode=t}}else if(r==2){o.PT.leafGrowType=Ro;let r=5;if(!o.branchLeafNodes){o.branchLeafNodes={}}if(o.branchLeafNodes[n]===undefined){o.branchLeafNodes[n]=0}let a=o.branchLeafNodes[n];let s=e[t][3]||1;if(s<=5&&t-a>=r){Bt=0;pgText.noFill();pgText.stroke(Ie[0],Ie[1],Ie[2],Ie[3]);pgText.strokeWeight(1);pgText.ellipse(e[t][0],e[t][1],7);N.addLeaf(e[t][0],e[t][1],o,f,"normal",l);if(random(0,1)>.1){if(random(0,1)>.2)_.addFlower(e[t+1][0],e[t+1][1],o);else H.addFruit(e[t+1][0],e[t+1][1],o)}o.branchLeafNodes[n]=t}}else{let r=createVector(e[t][0]-e[t-1][0],e[t][1]-e[t-1][1]);r.normalize();let n=3.14;if(doleafDirection){if(Qe)n=PI/2;else n=-PI/2}if(o.PT.leafGrowType==_o)n=0;let s=atan2(r.y,r.x)+n;if(a==3){if(t%12==0){N.addLeaf(e[t][0],e[t][1],o,s,"normal",l);o.lastLeafNode=t}}else{if(o.PT.leafGrowType==_o){if(t%5==0)N.addLeaf(e[t][0],e[t][1],o,s,"normal",l)}else if(o.PT.leafGrowType==Ro){if(t%3==0)N.addLeaf(e[t][0],e[t][1],o,s,"normal",l)}else if(o.PT.leafGrowType==Wo){if(t%2==0)N.addLeaf(e[t][0],e[t][1],o,s,"normal",l)}o.lastLeafNode=t}}}}if(random(0,1)>o.PT.fruitProb&&r==0){if(o.PT.fruitCount<o.PT.fruitlimit)H.addFruit(e[t][0],e[t][1],o,p)}if(random(0,1)>o.PT.flowerProb&&r!=2){if(r==1)me=.5;if(o.PT.flowerCount<o.PT.flowerlimit)_.addFlower(e[t][0],e[t][1],o)}if(random(0,1)>o.PT.spikeProb){let r=floor(random(1,o.PT.spikeCountRange));for(let l=0;l<r;l++){let r=[];let l=o.widthFunc(c);let a=l*.3;let s=constrain(l*.3*o.PT.hasSpikesW,.1,l*.6);if(t>=5){r.push([e[t-5][0],e[t-5][1]])}else if(n>=5&&o.PLANT[n-5][1].length>0){let e=o.PLANT[n-5][1].length-1;r.push([o.PLANT[n-5][1][e][0],o.PLANT[n-5][1][e][1]])}else{r.push([e[t][0],e[t][1]+5])}r.push([e[t][0],e[t][1]]);if(t<e.length-1){r.push([e[t+1][0],e[t+1][1]])}else{r.push([e[t][0],e[t][1]-5])}if(random(0,1)>.7){M.drawSpike({pg:pgL15,baseX:e[t][0]+random(-a,a),baseY:e[t][1],meta:o.PT,baseWidth:s*.9,stemPoints:r,branchLengthScale:o.PT.hasSpikesL})}else{M.drawSpike({pg:pgL0,baseX:e[t][0]+random(-a,a),baseY:e[t][1],meta:o.PT,baseWidth:s*1.1,stemPoints:r,branchLengthScale:o.PT.hasSpikesL})}}}if(random(0,1)>to){sl(e[t][0],e[t][1],o.PT)}if(random(0,1)>oo){il(e[t][0],e[t][1],o.PT)}if(random(0,1)>ro){if(eo<20&&Pt==0)cl(e[t][0],e[t][1],o.PT),eo++}}async function R(e){const t=[{obj:pgL0,name:"pgL0"},{obj:pgL1,name:"pgL1"},{obj:pgL15,name:"pgL15"},{obj:pgL2,name:"pgL2"},{obj:pgL3,name:"pgL3"},{obj:pgL4,name:"pgL4"},{obj:pgText,name:"pgText"},{obj:pgFinal,name:"pgFinal"}];for(let o=0;o<t.length;o++){const{obj:r,name:l}=t[o];if(r){let t=e+`_layer_${l}.png`;r.save(t);console.log(`儲存圖層: ${t}`);await new Promise((e=>setTimeout(e,500)))}else{console.warn(`無法儲存圖層 ${l}: 圖層不存在`)}}let o=e+"_layer_path.json";saveJSON(P,o);console.log("已儲存路徑座標 JSON:",o)}async function W(e,t,o){if(pgBg){let e=o+"_layer_bg.png";pgBg.save(e);console.log(`儲存背景圖層: ${e}`);await new Promise((e=>setTimeout(e,500)))}for(let r=0;r<e.length;r++){const l=e[r];if(t[l.index]){let e=o+`_layer_${r+1}_${l.index}.png`;t[l.index].save(e);console.log(`儲存圖層: ${e}`);await new Promise((e=>setTimeout(e,500)))}else{console.warn(`無法儲存圖層 ${l.index}: 圖層不存在`)}}if(F){let e=o+"_layer_texture.png";F.save(e);console.log(`儲存材質圖層: ${e}`);await new Promise((e=>setTimeout(e,500)))}if(pgFrame){let e=o+"_layer_frame.png";pgFrame.save(e);console.log(`儲存框架圖層: ${e}`);await new Promise((e=>setTimeout(e,500)))}if(pgTex){let e=o+"_layer_tex.png";pgTex.save(e);console.log(`儲存特效圖層: ${e}`);await new Promise((e=>setTimeout(e,500)))}}class _{static petal2(e={}){let{pg:t,baseX:o=0,baseY:l=0,bRt:n=createVector(0,0,0),bLe:a=100,col:s=[0,0,0,1],col2:i=[0,0,0,1],bwF:c=e=>1,bBF:p=e=>createVector(0,0,0),bSg:f=10,bSh:d=4,strokeStrength:m=1,closeS:h=false,closeE:g=false,doLeafVeins:u=false,meta:b=e.meta||{},stemMode:x=0}=e;if(x==3){}let y=jo(ho);m=m+y.random(0,1)*2;let F=5*Me;d=random(0,1)<.9?3:4;f=max(10,floor(a/4));f=max(5,floor(f*ue));let w=createVector(0,0,0);let P=createVector(0,0,0);let V=[w.copy()];let T=[P.copy()];let C=[];let E=e=>Ho.applyEulerRotation(e,n);let D;for(let e=0;e<f;e++){let t=e/(f-1);let o=p(t);P=p5.Vector.add(P,o.copy().mult(1/f));let r=createVector(0,0,a/f);let l=Ho.applyEulerRotation(r,P);w=p5.Vector.add(w,E(l));T.push(P.copy());V.push(w.copy());D=c(e/f);C.push(D)}let[A,S]=bl({pts:V,bwF:c});function I(e,r){const n=V.length-1;const a=d-1;const c=(r-1)/a;const p=r/a;let f=e/n;const m=.5;const h=constrain(map(f,m,1,0,1),0,1);let g,u,b,y;if(h===0){g=cr(A[e-1],S[e-1],c);u=cr(A[e],S[e],c);b=cr(A[e-1],S[e-1],p);y=cr(A[e],S[e],p)}else if(h===1){g=p5.Vector.lerp(A[e-1],S[e-1],c);u=p5.Vector.lerp(A[e],S[e],c);b=p5.Vector.lerp(A[e-1],S[e-1],p);y=p5.Vector.lerp(A[e],S[e],p)}else{const t=cr(A[e-2],S[e-2],c);const o=cr(A[e],S[e],c);const r=cr(A[e-2],S[e-2],p);const l=cr(A[e],S[e],p);const n=p5.Vector.lerp(A[e-1],S[e-1],c);const a=p5.Vector.lerp(A[e],S[e],c);const s=p5.Vector.lerp(A[e-1],S[e-1],p);const i=p5.Vector.lerp(A[e],S[e],p);g=p5.Vector.lerp(t,n,h);u=p5.Vector.lerp(o,a,h);b=p5.Vector.lerp(r,s,h);y=p5.Vector.lerp(l,i,h)}const F=1;let w=sin(p*PI)*f;let P=s[0];let T=s[1];let C=s[2];if(d==2){P=or(s[0],s[0],e*r/V.length/d)}else{P=or(s[0],s[0],f)}T=lerp(s[1],s[1],w)*map(noise(f*F,c*F,p*F),0,1,.5,1);C=lerp(s[2],s[2],w)*map(noise(f*F,c*F,p*F),0,1,.5,1);if(x===1){P=or(i[0],s[0],f);T=lerp(i[1],s[1],f);C=lerp(i[2],s[2],f)}else if(x===2){if(f<.5)f=0;else f=map(f,.5,1,0,1.2);P=or(i[0],s[0],pow(1-f,.6));T=lerp(i[1],s[1],pow(1-f,.6));C=lerp(i[2],s[2],pow(1-f,.6))}else if(x===3){P=or(i[0],s[0],f);T=lerp(i[1],s[1],f);C=lerp(i[2],s[2],f)}yl({pg:t,pts:[g,u,y,b],baseX:o,baseY:l,doFill:true,col:sr(P,T,C,constrain(random(.8,1.2),.8,1)),randomOffset:1,vertexMode:Dt})}for(let e=1;e<V.length;e++){for(let t=1;t<d;t++){I(e,t)}}let L=co.colors.stroke[0];if(Oe==0)L=co.colors.stroke[2];let B=co.colors.stroke[1];let v=e=>{const t=.2;const o=-.35;const r=(noise(e*t,Qo(0,100)*.05)+o)*2*_e;return r>.5?r:random(0,1)>.7?0:0};let k=e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*m*_e;let X=Zo([v,k]);if(At==1)X=k;else if(At==2)X=v;if(r==0||x==1||x==3){Fl({pg:t,pts:A.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-F,F);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-F,F);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,doFill:true,col:sr(L[0],L[1],L[2],1),bwF:X,randomOffset:1,forceBrush:1});Fl({pg:t,pts:S.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-F,F);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-F,F);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,doFill:true,col:sr(L[0],L[1],L[2],1),bwF:X,randomOffset:1,forceBrush:1})}if(u){N.drawLeafVeins({pg:t,baseX:o,baseY:l,lTp:b.petalfType,centerPos:V,leftPos:A,rightPos:S,col:sr(L[0],L[1],L[2],.5),strokeStrength:.5})}if(h==true){let e=[];for(let t=0;t<=d-1;t++){let o=t/(d-1);e.push(cr(A[0],S[0],o))}Fl({pg:t,pts:e,baseX:o,baseY:l,doFill:true,col:sr(L[0],L[1],L[2],1),bwF:e=>(.5*(1-e)*map(noise(e*10),0,1,.5,1)+.5)*m*_e*random(1,1.5),randomOffset:1,forceBrush:1})}if(g==true){let e=[];for(let t=0;t<=d;t++){let o=t/d;e.push(p5.Vector.lerp(A[A.length-1],S[S.length-1],o))}Fl({pg:t,pts:e,baseX:o,baseY:l,doFill:true,col:sr(L[0],L[1],L[2],1),bwF:e=>(1-e)*map(noise(e*10),0,1,.1,.2)+.1,forceBrush:1})}return{centerPos:V,widths:C,centerPoints:V}}static stamen(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,bRt:l=createVector(0,0,0),PT:n,size:a=20,eachL:s=random(.8,2),sLe:i=i,doFruit:c=1}=e;let p=n.fruitColors["apple"][0];let f=n.fruitColors["apple"][1];let d=n.fruitColors["apple"][2];let m=l;let h=M.stem({pg:t,baseX:o,baseY:r,bRt:m,bLe:i+random(-5,5),col:io.branchColor,bBF:e=>createVector(random(1,2),random(1,2),0),strokeStrength:0});let g=h.centerPos[h.centerPos.length-1];let u=p5.Vector.sub(h.centerPos[h.centerPos.length-1],h.centerPos[h.centerPos.length-2]).normalize();let b=p5.Vector.cross(createVector(0,-1,0),u);let x=Ho.angle(createVector(0,-1,0),u);let y=e=>{let t;if(b.mag()>.001){t=Ho.rotateVectorAroundAxis(e,b,x)}else{t=e.copy()}return createVector(t.x+o+g.x,t.y+r+g.y,t.z)};let F=[p,f,d,1];let w=12;let P=[];let V=10;for(let e=0;e<=V;e++){let t=e/V;let o=-a*(2*t-1);P.push(createVector(0,o))}let T=e=>{let t=2*e-1;return a*sqrt(1-pow(t,2))};let[C,E]=bl({pts:P,bwF:T});function D(e,o){const r=P.length-1;const l=w-1;const n=(o-1)/l;const a=o/l;const s=e/r;const i=p5.Vector.lerp(C[e-1],E[e-1],n);const c=p5.Vector.lerp(C[e],E[e],n);const p=p5.Vector.lerp(C[e-1],E[e-1],a);const f=p5.Vector.lerp(C[e],E[e],a);const d=F[0];const m=F[1];const h=F[2];yl({pg:t,pts:[i,c,f,p].map(y),doFill:true,doFillStroke:true,doStr:false,col:sr(d,m,h,1),randomOffset:.5})}for(let e=1;e<P.length;e++){for(let t=1;t<w;t++){D(e,t)}}Fl({pg:t,pts:C.map(y),baseX:0,baseY:0,doFill:true,col:sr(F[0],F[1],F[2]*1.2,1),randomOffset:1,bwF:e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1)+.05});Fl({pg:t,pts:E.map(y),baseX:0,baseY:0,doFill:true,col:sr(F[0],F[1],F[2]*1.2,1),randomOffset:1,bwF:e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1)+.05})}static drawFlowerA(e={}){let{pg:t,id:o,baseX:r=0,baseY:l=0,meta:n}=e;let a=random(.6,1);Pr();let s=0;let i=random(0,1)>.9?random(.5,1.2):random(0,.5)*1;let c=random(0,1)>.5?random(1,2):random(1,1.5)*-1;let p=createVector(PI/2+i,PI/2+c,0);let f=M.stem({pg:pgL1,baseX:r,baseY:l,bRt:p,bLe:n.flowerLengthC*me,col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]],bwF:e=>1,bBF:e=>createVector(1,0,0),pointShift:2});let d=M.stem({pg:pgL1,baseX:r,baseY:l,bRt:p,bLe:random(5,10),col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]*.8],bwF:e=>random(1,3),bBF:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let m=random(0,1)>.2?true:false;let h=f.centerPos[f.centerPos.length-1];let g=f.centerPos[f.centerPos.length-3];let u=p5.Vector.sub(g,h).normalize();let b=u;let x=createVector(1,0,0);if(abs(p5.Vector.dot(x,b))>.9){x=createVector(0,1,0)}x=p5.Vector.cross(b,createVector(0,1,0)).normalize();let y=p5.Vector.cross(b,x);let F=createVector(atan2(-y.z,b.z),asin(x.z),atan2(-x.y,x.x));let w=random(0,PI);let P=random(.9,1.1);let V=Zo([.1,.3,.5,.7,.9]);if(m==true){for(let e=0;e<n.flowerPetal;e++){let t=[n.flowerColorA[0],n.flowerColorA[1],n.flowerColorA[2]];let o=[n.flowerColorB[0],n.flowerColorB[1],n.flowerColorB[2]];let s=e/n.flowerPetal*TWO_PI;let i=createVector(cos(s),sin(s),0);let c=createVector(i.x*x.x+i.y*y.x+i.z*b.x,i.x*x.y+i.y*y.y+i.z*b.y,i.x*x.z+i.y*y.z+i.z*b.z).normalize();let p=0;let f=createVector(h.x+c.x*p,h.y+c.y*p,h.z+c.z*p);let d=createVector(-c.x,-c.y,-c.z).normalize();let m=createVector(d.x,d.y+.5,d.z);let g,u,w;if(random(0,1)>.5){g=t[0];u=t[1];w=t[2]}else{g=t[0];u=t[1]*.95;w=t[2]*.95}_.petal({pg:pgL3,baseX:r+f.x,baseY:l+f.y,bLe:a*n.flowerLengthA*random(.9,1.1),bSg:24,col:[g,u,w,1],cFn:n.flowerColorFn,strokeStrength:.5,direction:d,bwF:e=>a*n.fSh(e)*n.flowerWidthA,bBF:e=>createVector(n.flowerOpenCurve(e)*Zo([1,-.1,-.2,-.3,-1]),P,0)});if(mt==0){if(random(0,1)>.5){g=o[0];u=o[1];w=o[2]}else{g=o[0];u=o[1]*.95;w=o[2]*.95}_.petal({pg:pgL4,baseX:r+h.x,baseY:l+h.y,bSg:12,bLe:n.flowerLengthA*random(.3,.6),col:[g,u,w,1],cFn:n.flowerColorFn,direction:m,strokeStrength:.3,bwF:e=>n.fSh(e)*n.flowerWidthA*.3+1,bBF:e=>createVector(n.flowerOpenCurve(e)*Zo([-.1,-.2,-.3,-1]),P,0)})}else if(mt==1){let e=createVector(r+h.x,l+h.y);let t=floor(random(-1,5));for(let o=0;o<t;o++){let t=random(3,6);let o=random(TWO_PI);let r=cos(o)*t;let l=sin(o)*t;let a=createVector(F.x+random(-3,3),F.y+random(-3,3),0);_.stamen({pg:pgL4,baseX:e.x,baseY:e.y,bRt:a,PT:n,size:random(2,4)*he,sLe:random(10,30),doFruit:0})}}}}else if(m==false){for(let e=0;e<n.flowerPetal;e++){let t=e/n.flowerPetal*TWO_PI;let o=[n.flowerColorA[0],n.flowerColorA[1],n.flowerColorA[2]];let a=[n.flowerColorA[0],n.flowerColorA[1],n.flowerColorA[2]];_.petal2({pg:pgL2,baseX:r+f.centerPos[f.centerPos.length-2].x,baseY:l+f.centerPos[f.centerPos.length-2].y,bRt:F,bLe:n.flowerLengthA*random(.6,.9),col:[o[0]*P,o[1],o[2]*random(.8,.9),1],bwF:e=>n.fSh(e)*n.flowerWidthA*.3+2,bBF:e=>createVector(sin(e*PI)*-1*random(1,2),0,0),bSg:8,closeS:true})}}}static drawFlowerB(e={}){let{baseX:t=0,baseY:o=0,direction:l=createVector(0,0,1),rot:n=0,op:a=0,meta:s=e.meta,petalfType:i=s.petalfType||[10,2]}=e;let c=Ho.vectorToEulerAngles(l);let p=_.petal2({pg:pgL1,baseX:t,baseY:o,bRt:c,bLe:s.flowerLengthC*me,col:[s.branchColor[0],s.branchColor[1],s.branchColor[2]],bwF:e=>1,bSg:10,bSh:4,bBF:e=>createVector(1,0,0),closeS:true,meta:{...s,petalfType:i}});let f=M.stem({pg:pgL1,baseX:t,baseY:o,bRt:c,bLe:random(5,10),col:[s.branchColor[0],s.branchColor[1],s.branchColor[2]*.8],bwF:e=>random(2,3),bBF:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let d=p.centerPoints[p.centerPoints.length-1];for(let e=0;e<s.flowerPetal;e++){let l=e/s.flowerPetal*TWO_PI+n;let i=createVector(0,-1,0);let p=createVector(0,-.1,.8);let f=p5.Vector.lerp(i,p,a);let m=Ho.rotateVectorAroundAxis(f,createVector(0,0,1),l);let h=Ho.applyEulerRotation(m,c);let g=Ho.vectorToEulerAngles(h);let u=[s.flowerColorA[0],s.flowerColorA[1],s.flowerColorA[2]];let b,x,y;if(random(0,1)>.5){b=u[0];x=u[1];y=u[2]}else{b=u[0];x=u[1]*.95;y=u[2]*.95}let F=e<s.flowerPetal/2?-1:1;let w=e=>{if(s.bBF==undefined)return createVector(0,0,0);let t=s.bBF(e);return createVector(t.x,t.y*F,t.z)};let P=random(.5,.7);if(r==2)P=.5;let V=random(.8,1.2);if(r==2)V=.8;let T=true;if(s.spType==0)T=1;if(T)_.petal2({pg:pgL4,baseX:t+d.x,baseY:o+d.y,bRt:g,strokeStrength:.5,bLe:s.flowerLengthA*V,col:[b,x,y,1],bwF:e=>s.fSh(e)*s.flowerWidthA*P,bBF:w,bSg:18,bSh:3,closeS:true,closeE:true,doLeafVeins:true,meta:s})}if(a<.5){_.drawCalyx({pg:pgL4,baseX:t+d.x,baseY:o+d.y,direction:l,baseEuler:c,flowerPetal:s.flowerPetal,flowerLengthA:s.flowerLengthA,flowerWidthA:s.flowerWidthA*.3,op:a,stemColor:s.flowerColorB})}}static drawFlowerC(e={}){let{pg:t,id:o,baseX:l=0,baseY:n=0,meta:a,bRt:s=createVector(0,0,0),ll:i=1}=e;Pr();let c=random(3,7);let f=e=>{while(e>PI)e-=TWO_PI;while(e<-PI)e+=TWO_PI;return e};let d=map(n,0,B.dim,1,2);let m=createVector(f(random(-.6*PI,.6*PI)+PI/2),f(random(-.6*PI,.6*PI)),0);if(r==1){m=createVector(PI/2+random(-1,1),0,random(-1,1));d=1.5}let h=Go.combineRotations(s,m);let g=M.stem({pg:t,baseX:l,baseY:n,bRt:h,bLe:a.flowerLengthC*me*random(.5,1)*i,col:[a.branchColor[0],a.branchColor[1],a.branchColor[2]*.8],bwF:e=>random(.8,1.2),bBF:e=>createVector(d,random(1,2)*Zo([-1,1]),random(1,2)*Zo([-1,1])),strokeStrength:1});let u=M.stem({pg:t,baseX:l,baseY:n,bRt:h,bLe:random(5,10),col:[a.branchColor[0],a.branchColor[1],a.branchColor[2]*.7],bwF:e=>random(2,3),bBF:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let b=g.centerPos[g.centerPos.length-1];let x=p5.Vector.sub(g.centerPos[g.centerPos.length-1],g.centerPos[g.centerPos.length-2]).normalize();t.push();t.translate(l+b.x,n+b.y);let y=c*1;let F=20;let w=[];for(let e=0;e<F;e++){let t=TWO_PI*e/F;let o=cos(t)*y;let r=sin(t)*y;w.push(createVector(o,r,0))}let P=w.map((e=>Ho.applyEulerRotation(e,h)));t.fill(a.flowerColorB[0],a.flowerColorB[1],a.flowerColorB[2]);t.beginShape();P.forEach((e=>{if(p!=1)t.vertex(e.x,e.y)}));t.endShape(CLOSE);t.pop();let V=a.sunflowerPetalCount;for(let e=0;e<9;e++){let t=e/9*TWO_PI;let o=createVector(c*1*cos(t),c*1*sin(t),0);let r=Ho.applyEulerRotation(o,h);let s=createVector(cos(t),sin(t),0);s=Ho.applyEulerRotation(s,h);let i=map(n,0,B.dim,3,.5);let p=map(n,B.dim*.2,B.dim,1.2,.8);let f=map(noise(l*100,n*100),0,1,.8,1.2);let d=noise(l*500,n*500)>.7?[0,2]:[1,1];let m=[a.flowerColorA[0],a.flowerColorA[1],a.flowerColorA[2]];let g,u,x;g=m[0];u=m[1]*.8*f;x=m[2]*.8*f;_.petal({pg:pgL2,baseX:l+b.x+r.x,baseY:n+b.y+r.y,bLe:a.sunSize*.8,col:[g,u,x,1],cFn:a.flowerColorFn,direction:s,strokeStrength:.3,bwF:e=>pow(sin(PI*(1-e)),.5)*a.flowerWidthA*.3,bBF:e=>createVector(i,0,0)})}for(let e=0;e<V;e++){let t=e/V*TWO_PI;let o=createVector(c*1*cos(t),c*1*sin(t),0);let r=Ho.applyEulerRotation(o,h);let s=createVector(cos(t),sin(t),0);s=Ho.applyEulerRotation(s,h);let i=map(n,0,B.dim,3,.5);let p=map(n,B.dim*.2,B.dim,1.2,.8);let f=map(noise(l*100,n*100),0,1,.8,1.2);let d=noise(l*500,n*500)>.7?[0,2]:[1,1];let m=[a.flowerColorA[0],a.flowerColorA[1],a.flowerColorA[2]];let g,u,x;if(random(0,1)>.5){g=m[0];u=m[1]*f*d[0];x=m[2]*f*d[1]}else{g=m[0];u=m[1]*.95*f*d[0];x=m[2]*.95*f*d[1]}_.petal({pg:pgL3,baseX:l+b.x+r.x,baseY:n+b.y+r.y,bLe:a.sunSize,col:[g,u,x,1],cFn:a.flowerColorFn,direction:s,strokeStrength:.3,bwF:e=>pow(sin(PI*(1-e)),.5)*a.flowerWidthA*.4,bBF:e=>createVector(i,0,0)})}let T=random(0,1);for(let e=0;e<10;e++){let t=e/10*TWO_PI;let o=createVector(c*.4*cos(t),c*.4*sin(t),0);let r=Ho.applyEulerRotation(o,h);let s=createVector(cos(t),sin(t),0);s=Ho.applyEulerRotation(s,h);_.petal({pg:pgL4,baseX:l+b.x+r.x,baseY:n+b.y+r.y,bLe:20*he,col:a.flowerColorB,cFn:a.flowerColorFn,direction:s,bSg:10,strokeStrength:.5,bwF:e=>.5,bBF:e=>createVector(a.flowerOpenCurve(e),sin(e*PI)*2,0)})}}static drawFlowerD(e={}){let{pg:t,id:o,baseX:r=0,baseY:l=0,meta:n}=e;const a=random(0,1)>.1?Qo(30,150):Qo(150,300);const s=Zo([1.4,1.4,1.4,2.8]);const i=M.stem({pg:pgL1,baseX:r,baseY:l,bRt:createVector(PI/2,0,random(-2,2)),bLe:a*.5,col:n.branchColor,bwF:e=>constrain(s*a/25,.5,3),bBF:()=>createVector(1,1,0),pointShift:1});const c=i.centerPos[i.centerPos.length-1];const p=6;const f=137.5;const d=a*random(.05,.08);const m=f*PI/180;const h=random(TWO_PI);const[g,u,b]=n.flowerColorA;for(let e=0;e<p;e++){const t=7;const o=e*d;const s=map(e,0,p-1,.4,.3+random(-.1,.2));const i=map(e,0,p-1,.8,1.2);for(let p=0;p<t;p++){const f=p*TWO_PI/t+e*m+h;const d=createVector(cos(f),sin(f),0).normalize();const x=createVector(c.x+d.x*o,c.y+d.y*o,0);const y=createVector(d.x*.3,d.y*.3,-1).normalize();const F=Ho.vectorToEulerAngles(y);_.petal2({pg:pgL3,baseX:r+x.x,baseY:l+x.y,bRt:createVector(F.x,F.y,random(-2,2)),bLe:a*s,col:[g,u,b*i,1],bwF:e=>n.fSh(e)*n.flowerWidthA*s*.5,bBF:e=>createVector(sin(e*PI)*.9,0,0),bSg:6,strokeStrength:.6,closeS:true})}}}static drawFlowerG(e={}){let{pg:t,baseX:o=0,baseY:l=0,direction:n=createVector(0,0,1),rot:a=random(0,1),op:s=0,meta:i=e.meta,petalfType:c=i.petalfType||[10,2],doFruit:p=0}=e;a=0;i.bBF=e=>{if(e<random(.55,.65)){return createVector(.6,0,0)}else{return createVector(0,cos(e*PI*2)*2,0)}};if(i.spType==0)i.bBF=e=>createVector(sin(e*PI)*-2,cos(e*PI)*.3,0);let f=Ho.vectorToEulerAngles(n);let d=Zo([-1,1]);let m=_.petal2({pg:t,baseX:o,baseY:l,bRt:createVector(PI/2,0,1*d),bLe:i.flowerLengthC*me*random(.5,1.2),col:[i.flowerColorA[0],i.flowerColorA[1],i.flowerColorA[2]*.7],col2:[i.branchColor[0],i.branchColor[1],i.branchColor[2]*.8],bwF:e=>1.5,bSg:10,bSh:4,bBF:e=>createVector(0,random(1.5,3)*d,0),closeS:true,meta:{...i,petalfType:c},stemMode:1});if(p){let e=m.centerPoints[m.centerPoints.length-1];H.melon({pg:t,baseX:o+e.x,baseY:l+e.y-10,bRt:createVector(0,0,0),PT:PT,size:30,length:30*random(.8,1.2),sLe:PT.fruitstem,bLe:80,sBn:createVector(-1,0,0)})}let h=m.centerPoints[m.centerPoints.length-1];let g=0;for(let e=0;e<i.flowerPetal;e++){if(e>3&&e<10)g=1;else g=0;let n=e/i.flowerPetal*TWO_PI+a;let c=createVector(0,-1,0);let p=createVector(0,-.1,.8);let d=p5.Vector.lerp(c,p,s);let m=Ho.rotateVectorAroundAxis(d,createVector(.05,.05,1),n);let u=Ho.applyEulerRotation(m,f);let b=Ho.vectorToEulerAngles(u);let x,y,F;let w=map(e,0,i.flowerPetal,.8,1.5);let P=map(e,0,i.flowerPetal,.8,1.5);let V=0;x=V;y=i.flowerColorA[1]*P;F=i.flowerColorA[2]*w;let T=e<7?-1:1;let C=e=>{let t=i.bBF(e);return createVector(t.x,t.y*T,t.z)};let E=random(.5,.7);if(r==2)E=.5;let D=random(.8,1.2);if(r==2)D=.8;if(i.spType==0)g=1;if(g)_.petal2({pg:t,baseX:o+h.x,baseY:l+h.y,bRt:b,strokeStrength:.5,bLe:i.flowerLengthA*D,col:[x,y,F,1],bwF:e=>i.fSh(e)*i.flowerWidthA*E,bBF:C,col:[i.flowerColorA[0],i.flowerColorA[1],i.flowerColorA[2]*.8],col2:[i.flowerColorB[0],i.flowerColorB[1],i.flowerColorB[2]*1.1],bSg:18,bSh:3,closeS:true,closeE:true,doLeafVeins:false,stemMode:2,meta:i})}}static drawCalyx(e={}){let{baseX:t=0,baseY:o=0,direction:r=createVector(0,0,1),baseEuler:l=Ho.vectorToEulerAngles(r),flowerPetal:n=5,flowerLengthA:a=20,flowerWidthA:s=8,op:i=0,stemColor:c=[100,.7,.8,1]}=e;let p=a*.3;let f=s*.8;let d=createVector(0,0,1);for(let e=0;e<n;e++){let r=e/n*TWO_PI;let a=i;let s=createVector(cos(r)*.1,sin(r)*.1,-.3);let m=createVector(cos(r)*.3,sin(r)*.3,-.1);let h=p5.Vector.lerp(m,s,a).normalize();let g=Ho.applyEulerRotation(h,l);let u=g.angleBetween(d);let b;if(i>.5){b=u<PI/2?pgL1:pgL3}else{b=pgL3}let x=Ho.vectorToEulerAngles(g);let y=map(a,0,1,3,1);_.petal2({pg:b,baseX:t,baseY:o,bRt:x,bLe:-p,strokeStrength:.2,col:[c[0],c[1],c[2],1],bwF:e=>{let t=f*(1-e*.7);return t*(a>.7?.2:map(a,0,.7,.5,.1))},bBF:e=>{let t=sin(e*PI)*(1-a)*y;let o=cos(e*PI)*y;let l=noise(r*10,e*10)*.4;return createVector(t+l,0,o+l)},bSg:16,bSh:3,closeS:false,strokeStrength:.3})}}static drawLoseLeaves(e,t,o=0){Dt=0;Pt=0;It=0;let r=[co.colors.leaf[1][0],co.colors.leaf[1][1]*.5,co.colors.leaf[1][2]];let l=[co.colors.leaf[0][0],co.colors.leaf[0][1]*.5,co.colors.leaf[0][2]];r=r.map((e=>constrain(e,0,360)));l=l.map((e=>constrain(e,0,360)));pgBg.push();let n=5;if(o==0)n=Qo(10,30);else if(o==1)random(0,1)>.3?n=Qo(50,80):n=Qo(150,300);let a=[];for(let e=0;e<n;e++){a.push({size:random(0,1)<.9?random(40,60):random(70,120)})}let s=t-20;function i(e,t){if(e>.7){return sin(e*PI)*t*(1-e)*0}else{return sin(e*PI)*t*(1-e)*.8}}let c=1;if(o==0)c=random(0,1)<.7?random(2,3):random(3.5,4.5);else if(o==1)c=random(3.5,5.5);a.forEach(((t,o)=>{let n=0;if(random(0,1)>.95)n=c*3;else n=c;t.x=e+random(random(-t.size*n,t.size*n),random(-t.size*n,t.size*n));t.y=s+o*t.size*random(.01,.02);let a=random(0,1);let p=createVector(PI/2*Zo([1,-1]),-random(-.3,.3),0).normalize();let f=random(0,1)<.8?.1:.2;let d=random(.9,1.1);let m=constrain(random(-.3,1.3),0,1);let h=[lerp(r[0],l[0],m),lerp(r[1],l[1],m),lerp(r[2],l[2],m),random(.1,.8)];_.petal({pg:pgBg,baseX:t.x,baseY:t.y,direction:p,bLe:t.size,col:[h[0],h[1],h[2]*d,h[3]],bSg:12,bwF:e=>i(e,t.size*f),bBF:e=>createVector(0,-sin(e*PI)*.4,sin(e*PI)*.3),drawOutLine:1,strokeStrength:.2,downLeaf:1})}));pgBg.pop()}static petal(e={}){let{pg:t=pgBg,baseX:o=0,baseY:l=0,direction:n=createVector(0,0,1),bLe:a=100,bSg:s=12,bwF:i=e=>sin(e*PI)*20,col:c=e.col||{},cFn:p=e=>e,bBF:f=e=>createVector(0,0,0),pcc:d=false,drawOutLine:m=1,pointShift:h=0,strokeStrength:g=1,downLeaf:u=0,sameWidth:b=0}=e;let x=jo(ho);g=g+x.random(0,1)*2;h=5*Me;s=max(5,floor(s*ue));let y=createVector(0,0,1);let F=p5.Vector.cross(y,n);let w=y.angleBetween(n);if(F.magSq()<1e-6){if(y.dot(n)<0){F=createVector(1,1,1);w=PI}else{F=createVector(1,0,0);w=0}}else{F.normalize()}let P=createVector(0,0,0);let V=createVector(0,0,0);let T=[];let C=[];let E=[];for(let e=0;e<s;e++){let r=e/(s-1);let d=f(r);V=p5.Vector.add(V,p5.Vector.mult(d,1/s));let m=createVector(0,0,a/s);m=Ho.applyEulerRotation(m,V);P=p5.Vector.add(P,m);let h=i(r);let g=createVector(-n.y,n.x,0).normalize().mult(h);let u=p5.Vector.add(P,g);let b=p5.Vector.add(P,p5.Vector.mult(g,-1));let x=Ho.rotateVectorAroundAxis(P,F,w);let y=Ho.rotateVectorAroundAxis(u,F,w);let D=Ho.rotateVectorAroundAxis(b,F,w);T.push(x.copy());C.push(y.copy());E.push(D.copy());if(e>0){let r=p5.Vector.sub(T[e],C[e-2]);let n=p5.Vector.sub(C[e],T[e]);let a=p5.Vector.cross(r,n);let s=map(abs(a.angleBetween(createVector(PI/2,PI/2,0))),0,PI,1,0);s=p(s);let i=c[0];let f=c[1];let d=c[2];let m=constrain(random(.8,1.2),.8,1);yl({pg:t,pts:[C[e],C[e-1],T[e-1],T[e]],baseX:o,baseY:l,col:sr(i,f,d,m),doFill:true,randomOffset:.3,vertexMode:Dt});yl({pg:t,pts:[E[e],E[e-1],T[e-1],T[e]],baseX:o,baseY:l,doFill:true,col:sr(i,f,d,m),randomOffset:.3,vertexMode:Dt})}}let D=co.colors.stroke[0];if(Oe==0)D=co.colors.stroke[2];let A=co.colors.stroke[1];let S=e=>{const t=.01;const o=-.35;const r=(noise(e*t,Qo(0,100)*.05)+o)*g*_e;return r>.5?r:random(0,1)>.7?0:0};let I=e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.4)*g*_e;let L=e=>(.5*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*g*_e;let B=Zo([S,I]);if(At==1)B=I;else if(At==2)B=S;if(r==1||r==2){B=e=>.5}let v=1;let k=.7;if(u==1){B=L;b=1;D=c;v=.7;k=.4}if(m>0){Fl({pg:t,pts:T.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-h,h);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-h,h);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,doFill:true,col:sr(D[0],D[1],D[2]*v,k),bwF:B,randomOffset:1,sameWidth:b,forceBrush:1});Fl({pg:t,pts:C.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-h,h);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-h,h);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,doFill:true,col:sr(D[0],D[1],D[2]*v,k),bwF:B,randomOffset:1,sameWidth:b,forceBrush:1});Fl({pg:t,pts:E.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-h,h);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-h,h);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,doFill:true,col:sr(D[0],D[1],D[2]*v,k),bwF:B,randomOffset:1,sameWidth:b,forceBrush:1});let e=C[C.length-1];let r=E[E.length-1];let n=[e,r];Fl({pg:t,pts:n,baseX:o,baseY:l,doFill:true,col:sr(D[0],D[1],D[2]*v,k),bwF:B,randomOffset:1,sameWidth:b,forceBrush:1})}return T}static addFlower(e,t,o){if(!o||!o.PT){console.warn("meta or meta.PT is undefined");return false}if(!o.PT.flowerPositions){o.PT.flowerPositions=[]}let l=false;for(let r of o.PT.flowerPositions){let o=dist(e,t,r.x,r.y);let n=dt==2?10:50;if(o<n){l=true;break}}if(!l){o.PT.flowerPositions.push({x:e,y:t});if(r==2)dt=4;switch(dt){case 0:_.drawFlowerA({pg:pgL3,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT});break;case 1:let r=jo(ho);_.drawFlowerB({pg:pgL2,baseX:e,baseY:t,direction:tr(r),rot:random(0,TWO_PI),op:Zo([.1,.1,.3,.6]),meta:o.PT});break;case 2:_.drawFlowerC({pg:pgL2,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT,ll:random(3,6)});break;case 3:_.drawFlowerD({pg:pgL2,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT});break;case 4:_.drawSpecialFlower({pg:pgL2,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT});break}o.PT.flowerCount++;return true}return false}static drawSpecialFlower({pg:e,baseX:t,baseY:o,meta:r}){let l={branchColor:r.branchColor,flowerColorA:[r.flowerColorA[0],r.flowerColorA[1],r.flowerColorA[2]*random(1.1,1.2)],flowerColorB:[r.flowerColorA[0],r.flowerColorA[1],r.flowerColorA[2]*random(.5,.7)],flowerPetal:1,flowerLengthA:80*random(.8,1.4),flowerWidthA:10*random(.6,1.2),flowerLengthC:30*random(.8,1.2),fSh:e=>{if(e<.5){return 2*pow(sin(e*3.14),1.5)+.3}else{return 2*pow(sin(e*3.14),1.5)+.2}},petalfType:[13,2,0],spType:0};let n={branchColor:r.branchColor,flowerColorA:[r.flowerColorA[0],r.flowerColorA[1],r.flowerColorA[2]*random(.8,1)],flowerColorB:[r.flowerColorB[0],r.flowerColorB[1],r.flowerColorB[2]*random(.9,1.1)],flowerPetal:12,flowerLengthA:110*random(.9,1.1),flowerWidthA:9*random(.6,1.2),flowerLengthC:30*random(.8,1.2),fSh:e=>{if(e<.4)return map(e,0,.5,.8,1);else if(e>=.4&&e<.6)return map(e,.4,.6,1,.5);else return map(e,.6,1,.5,.2)},petalfType:[13,2,0],spType:1};let a=createVector(0,1,Zo([-1,1]));let s;let i=random(0,1)>.7?l:n;if(i==l)s=createVector(0,1,a.z*-10);else s=createVector(0,1,a.z*-1);_.drawFlowerG({pg:pgL0,baseX:t,baseY:o,direction:a,op:1,meta:i});if(random(0,1)>.5){_.drawFlowerG({pg:pgL3,baseX:t,baseY:o,direction:s,op:1,meta:i})}}}class M{static drawWoody(e={}){let{meta:t=e.meta||{},pg:o=pgL1,baseX:l=0,baseY:n=0,bRt:a=createVector(PI/2,0,0),bLe:s=B.dim*de,bSg:i=30,bwF:c=1,twI:p=5,mBW:f=4,col:d=[50,.2,.8],stemTexLine:m=e.stemTexLine||0,mBD:g=3,forkCount:u=4,branchStats:b=e.branchStats||{mainStemLength:0,branchCount:0,branchesByDepth:{},totalLength:0,highestBranch:null},currentDepth:x=e.currentDepth||0,currentPath:currentPath=e.currentPath||[],isMainStem:y=x===0,parentStartPoint:F=null,branchId:w=e.branchId||"main"}=e;if(r==2)m=1;if(ot)console.log("drawWoody - 樹枝深度:"+x+" branchId:"+w);let V=new Set;let T=Go.combineRotations(a,createVector(Ve,Te,Ce));let C=s;b.totalLength+=C;if(x===0)b.mainStemLength=C;const E=Uo.createJoints(p,i);const D=Uo.createWidthFunction(c,f,E,i);const A=Uo.createbranchBendFunction(E,i);let{centerPos:S,widths:I}=M.stem({pg:pgL1,baseX:l,baseY:n,bRt:T,bLe:C,bSg:i,bwF:D,col:d,bBF:A,closeS:y,stemTexLine:m,currentDepth:x});let L=0;for(let X=1;X<S.length;X++){L+=dist(S[X].x,S[X].y,S[X-1].x,S[X-1].y)}if(y){if(!b.branchesByDepth[0]){b.branchesByDepth[0]=1}}else{if(!b.branchesByDepth[x]){b.branchesByDepth[x]=0}b.branchesByDepth[x]++}let v=[];if(g>0){let Y=Qo(max(1,u-2),u+1);b.branchCount+=Y;const z=width*1.05;const O=height*1.05;const R=-width*.05;const W=-height*.05;for(let _=0;_<Y;_++){let N=floor(S.length*.1);let H=floor(S.length*.9);let G=floor(random(N,H));const U=l+(S[G]?S[G].x:0);const $=n+(S[G]?S[G].y:0);let j=false;for(let q of V){if(abs(q-G)<10){j=true;break}}if(j)continue;if(G>=0&&G<S.length){let J=I[G];let K=random(.3,.7);if(r!=0)K=random(.6,.8);V.add(G);let Q=`${w}_${_}`;let Z={x:S[G].x+l,y:S[G].y+n,depth:x+1,branchId:Q,parentBranchId:w,plantId:fo.plantId};let ee=Xt?[...currentPath.slice(0,G+1),Z]:[];if(uo==3&&x>0)Ee=[Qo(0,10),Qo(0,15)];if(U>=R&&U<=z&&$>=W&&$<=O){let te=M.drawWoody({...e,pg:o,baseX:U,baseY:$,bSg:i,bLe:s*random(.5,xe),bwF:c*K,twI:p*.7,mBD:g-1,col:[t.branchColor[0],t.branchColor[1],t.branchColor[2]*random(.9,1),1],forkCount:t.branchFork,mBW:J*K,branchStats:b,currentDepth:x+1,currentPath:ee,isMainStem:false,parentStartPoint:Z,branchId:Q,stemTexLine:m});if(te&&te.length>0){v=v.concat(te)}}}}}if(Xt){let oe;if(V.size>0){let le=max(...Array.from(V));oe=S.slice(0,le+1).map(((e,t)=>({x:round(e.x+l),y:round(e.y+n),depth:x,isMainStem:y,branchId:w,parentBranchId:F?.branchId||null,isStartbranch:V.has(t),plantId:fo.plantId,segmentIndex:ae,doTimestamp:Date.now()})))}else{oe=S.map(((e,t)=>({x:round(e.x+l),y:round(e.y+n),depth:x,isMainStem:y,branchId:w,parentBranchId:F?.branchId||null,isStartbranch:false,plantId:fo.plantId,segmentIndex:ae,doTimestamp:Date.now()})))}if(!De.path){De.path=[]}De.path=[...De.path,...oe];let re=S[S.length-1];if(re.y+n<De.height){De={x:re.x+l,y:re.y+n,height:re.y+n,path:De.path,plantId:fo.plantId,segmentIndex:ae}}}let k=[[g,S.map(((e,t)=>[e.x+l,e.y+n,e.z,I[t]]))]].concat(v);k.widthFunc=D;k.baseWidth=c;k.maxBranchWidthidth=f;if(window.debugMode2==1||h==1){if(typeof P==="undefined")window.globalPathDebugData=[];function ne(e,t,o,r,l){const n=e.length;let a=[];let s=0;for(let i=0;i<n;i++){if(i%20===0||i===0||i===n-1){s++;const n=e[i].map((e=>Number(e.toFixed(2))));if(!n)continue;const c=n[0]+(t||0);const p=n[1]+(o||0);pgText.push();pgText.stroke(0,0,0,1);pgText.strokeWeight(.5);let f,d;if(l==="left"){f=c-100;d=c-100-66}else{f=c+100;d=c+105}pgText.noStroke();if(s==5)pgText.fill(0,0,1,1);else pgText.fill(0,0,0,1);if(window.debugMode2==1)pgText.ellipse(c,p,3);if(window.debugMode2==1)pgText.ellipse(f,p,3);if(s==5)pgText.stroke(0,0,1,1);else pgText.stroke(0,0,0,1);if(window.debugMode2==1)pgText.line(c,p,f,p);pgText.noStroke();if(s==5){let text=`${r} (${Math.round(c)}, ${Math.round(p)})`;let e=pgText.textWidth(text);let t=12;pgText.fill(0,0,0,1);if(window.debugMode2==1)pgText.rect(d-2,p-2,e+4,t+4)}if(s==5)pgText.textSize(12),pgText.fill(0,0,1,1);else pgText.textSize(10),pgText.fill(0,0,0,1);pgText.textAlign(LEFT,CENTER);if(window.debugMode2==1)pgText.text(`${r} (${Math.round(c)}, ${Math.round(p)})`,d,p+5);pgText.pop();a.push(n)}}P.push({name:r,count:a.length,first:a[0],last:a[a.length-1],points:a})}let se,ie;if(x===0){se="M";ie="right"}else{let pe=w.replace(/^main_?/,"").replace(/_/g,"-");se=`C${x}`;ie="left";if(x%2==0)ie="right"}const ce=S.map(((e,t)=>[e.x+l,e.y+n]));ne(ce,0,0,se,ie)}return k}static stem(e={}){let{pg:t=pgL3,baseX:o=0,baseY:l=0,bRt:n=createVector(PI/2,0,0),bLe:a=400,bSg:s=20,bSh:i=4,bwF:c=e=>.5*(1-e)*map(noise(e*10),0,1,.5,1)+.2,bBF:p=e=>createVector(random(-10,10),0,random(-5,5)),mushroomStroke:f=false,branchStats:d=null,closeS:m=false,curveS:h=true,stemTexLine:g=0,pointShift:u=10,strokeStrength:b=.8,strokeNoiseScale:x=10,lineSegScale:y=Zo([.05,.2,1,5]),lineLimit:F=Zo([.7,.5,.3]),col:w=[250,.5,.4],jointCount:P=Qo(10,30),currentDepth:V=0}=e;let T=jo(ho);b=b+T.random(0,1)*2;b=b*map(he,.2,5,1,2);u=5*Me;s=max(5,floor(min(80,max(30,floor(a/6)))*ue));let C=createVector(0,0,0);let E=createVector(0,0,0);let D=[C.copy()];let A=[E.copy()];let S=[];let I=e=>Ho.applyEulerRotation(e,n);let L;let B=map(V,0,4,1,2)+random(-.2,.2);for(let e=0;e<s;e++){let t=e/(s-1);let o=p(t);E=p5.Vector.add(E,o.copy().mult(1/s));let r=createVector(0,0,a/s);let l=Ho.applyEulerRotation(r,E);C=p5.Vector.add(C,I(l));A.push(E.copy());D.push(C.copy());L=c(e/s);S.push(L)}let[v,k]=bl({pts:D,bwF:c});let X=v.map(((e,t)=>cr(v[t],k[t],.3+random(-.05,.15))));let Y=v.map(((e,t)=>cr(v[t],k[t],.7+random(-.15,.05))));if(i!=null){i=i}else{i=L<1.5?5:Zo([6,8,10])}function z(e,n){const a=D.length-1;const s=i-1;const c=e/a;const p=n/s;const f=(n+1)/s;const d={Pos0_0:cr(v[e],k[e],p),Pos0_1:cr(v[e+1],k[e+1],p),Pos1_0:cr(v[e],k[e],f),Pos1_1:e>a-5?cr(v[e+1],k[e+1],1):cr(v[e+1],k[e+1],f)};const m=pow(1-c,1);const h={h:w[0],s:lerp(w[1],w[1]*.8,m),b:lerp(w[2]*B,w[2]*.8,m),alpha:1};let g=.6;if(r==2)g=0;yl({pg:t,pts:[d.Pos0_0,d.Pos0_1,d.Pos1_1,d.Pos1_0],baseX:o,baseY:l,col:sr(h.h,h.s,h.b,h.alpha),randomOffset:g})}for(let e=0;e<D.length-1;e++){for(let t=0;t<i-1;t++){z(e,t)}}let O;O=co.colors.stroke[0];if(Oe==0)O=co.colors.stroke[2];let R=co.colors.stroke[1];let W=co.colors.vine[0];if(f){y=10;F=.8}let _=e=>{const t=.01;const o=-.35;const r=(noise(e*t,Qo(0,100)*.05)+o)*b*_e;return r>.5?r:random(0,1)>.8?0:0};let M=e=>(.2*(1-e)*map(noise(e*x),0,1,.5,1)+.3)*b*_e;let N=e=>.5;let H=.5;if(g==0&&L>1){for(let e=0;e<X.length-1;e++){let r=X[e];let n=X[e+1];if(noise(e*y)<F){let e=createVector(r.x,r.y);let a=createVector(n.x,n.y);let s=[];for(let t=0;t<=4;t++){let o=t/4;let r=lerp(e.x,a.x,o);let l=lerp(e.y,a.y,o);s.push(createVector(r,l))}Fl({pg:t,pts:s,baseX:o,baseY:l,col:sr(R[0],R[1],R[2],1),bwF:M,randomOffset:.2,forceBrush:1})}}for(let e=0;e<Y.length-1;e++){let r=Y[e];let n=Y[e+1];if(noise(e*y+1e3)<F){let e=createVector(r.x,r.y);let a=createVector(n.x,n.y);let s=[];for(let t=0;t<=4;t++){let o=t/4;let r=lerp(e.x,a.x,o);let l=lerp(e.y,a.y,o);s.push(createVector(r,l))}Fl({pg:t,pts:s,baseX:o,baseY:l,col:sr(R[0],R[1],R[2],1),bwF:M,randomOffset:.2,forceBrush:1})}}}gl({pg:pgText,pts:D,baseX:o,baseY:l});let G=Zo([_,M]);if(At==1)G=M;else if(At==2)G=_;if(r==2)G=N,be=0,u=0;Fl({pg:t,pts:v.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-u,u);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-u,u);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,col:sr(O[0],O[1],O[2],H),bwF:G,randomOffset:.5});Fl({pg:t,pts:k.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-u,u);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-u,u);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,col:sr(O[0],O[1],O[2],H),bwF:G,randomOffset:.5});let U=[];let $=i;for(let e=0;e<=$;e++){let t=e/$;U.push(cr(v[0],k[0],t))}if(m==true){Fl({pg:t,pts:U,baseX:o,baseY:l,col:sr(O[0],O[1],O[2],H),bwF:G,randomOffset:.5})}if(L>1.5){let e=[];let r=i;for(let t=0;t<=r;t++){let o=t/r;e.push(p5.Vector.lerp(v[v.length-1],k[k.length-1],o))}Fl({pg:t,pts:e,baseX:o,baseY:l,col:sr(O[0],O[1],O[2],H),bwF:G,randomOffset:0})}if(g==1&&L<5){let e=0;if(r==2)e=floor(P*ao);for(let r=e;r<P;r++){let e=r/P;let n=floor(e*D.length);let a=D[n];let s=c(e)*2;let i=max(0,n-1);let p=min(D.length-1,n+1);let f=p5.Vector.sub(D[p],D[i]).normalize();let d=createVector(-f.y,f.x);let m=[];let h=[];let g=8;for(let e=0;e<=g;e++){let t=map(e,0,g,-s*random(.5,.65),s*random(.5,.65));let o=p5.Vector.add(a,p5.Vector.mult(d,t));m.push(o)}for(let e=0;e<=g;e++){let t=map(e,0,g,-s*.45,s*.45);let o=p5.Vector.add(a,p5.Vector.mult(d,t));h.push(o)}Fl({pg:t,pts:h,baseX:o,baseY:l,col:sr(O[0],O[1],O[2]*.5,.8),bwF:e=>M(e)*4,randomOffset:0,forceBrush:1});Fl({pg:t,pts:h,baseX:o,baseY:l,col:sr(0,0,1,.8),bwF:e=>M(e)*2,randomOffset:0,forceBrush:1})}}const j=D.reduce(((e,t)=>t.y<e.y?t:e),D[0]);const q={centerPos:D,widths:S,highestPoint:j};return q}static drawSpike(e={}){let{pg:t=pgL3,meta:o,baseX:r=0,baseY:l=0,bLe:n=random(20,50),bSg:a=10,baseWidth:s,branchLengthScale:i,bwF:c=e=>4*(1-e*.8),col:p=o.spikeColor,bBF:f=e.bBF||(e=>createVector(random(.5,1.5),random(1,3),0)),stemPoints:d=e.stemPoints||[],pointShift:m=5,strokeStrength:h=.2,strokeNoiseScale:g=10,sp2Mode:u=0}=e;let b=jo(ho);h=h+b.random(0,1)*2;m=10*Me;s=min(s,30);p=random(0,1)>.1?o.spikeColor:o.spikeColor2;c=e=>min(s*(1-e*.95),8);let x=createVector(0,-1);n=random(s*30,s*60)*me*i;f=e=>createVector(random(-.5,2),random(-1,3),0);if(d.length>=2){let e=createVector(d[0][0],d[0][1]);let t=createVector(d[2][0],d[2][1]);x=p5.Vector.sub(t,e).normalize();let o=random(0,1)>.5?PI/2:PI/4;let r=random(-PI/12,PI/12);let l=random(-PI/9,-PI/4.5);x.rotate(o+r);x.rotate(l)}let y=atan2(x.y,x.x);let F=createVector(0,0,y);a=4;let w=createVector(0,0,0);let P=createVector(0,0,0);let V=[w.copy()];let T=[P.copy()];let C=[];let E=e=>Ho.applyEulerRotation(e,F);for(let e=0;e<a;e++){let t=e/(a-1);let o=f(t);P=p5.Vector.add(P,o.copy().mult(1/a));let r=createVector(0,0,n/a);let l=Ho.applyEulerRotation(r,P);w=p5.Vector.add(w,E(l));T.push(P.copy());V.push(w.copy());C.push(c(e/a))}let[D,A]=bl({pts:V,bwF:c});let S=6;let I=random(0,1)>.3?1:0;function L(e,o){const n=V.length-1;const a=S-1;const s=o/a;const i=(o+1)/a;const c=(e+1)/n;const f={Pos0_0:cr(D[e],A[e],s),Pos0_1:cr(D[e+1],A[e+1],s),Pos1_0:cr(D[e],A[e],i),Pos1_1:cr(D[e+1],A[e+1],i)};const d=map(i/c,0,1,1,.5)+noise(e,o)*.2;const m=I===1?{h:p[0],s:p[1]*d,b:p[2]*d}:{h:p[0],s:p[1]*.7,b:p[2]*.7};yl({pg:t,pts:[f.Pos0_0,f.Pos0_1,f.Pos1_1,f.Pos1_0],baseX:r,baseY:l,col:sr(m.h,m.s,m.b,1),randomOffset:1})}for(let e=0;e<V.length-1;e++){for(let t=0;t<S-1;t++){L(e,t)}}let B=co.colors.stroke[0];if(Oe==0)B=co.colors.stroke[2];let v=co.colors.stroke[1];Fl({pg:t,pts:D.map((e=>{let t=map(noise(e.x*g,e.y*g),0,1,-m,m);let o=map(noise(e.y*g,e.x*g),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:l,col:sr(B[0],B[1],B[2]*.8,1),bwF:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*h*_e,randomOffset:1});Fl({pg:t,pts:A.map((e=>{let t=map(noise(e.x*g,e.y*g),0,1,-m,m);let o=map(noise(e.y*g,e.x*g),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:l,col:sr(B[0],B[1],B[2]*.8,1),bwF:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*h*_e,randomOffset:1});return{centerPos:V,widths:C}}static drawAllPath(e){if(!De.path)return;let t=De.path.filter((e=>e.isMainStem));let o=De.path.filter((e=>!e.isMainStem));let r=o.reduce(((e,t)=>{if(!e[t.depth]){e[t.depth]=[]}e[t.depth].push(t);return e}),{})}static drawVines(e){if(!De.path)return;let t=2;let o=1;let r=1;let l=jo(ho);r=r+l.random(0,1)*2;t=10*Me;_e=.6;const n=e.spiral;const a={maxRadiusMultiplier:1,minRadius:.5,maxNoiseEffect:.15,maxBendEffect:.3,maxTwistEffect:PI/2};pgL0.strokeCap(ROUND);pgL15.strokeCap(ROUND);let s=De.path.filter((e=>e.isMainStem));let i=De.path.filter((e=>!e.isMainStem));let c=[];c=[...s];let p={};i.forEach((e=>{if(!p[e.parentBranchId]){p[e.parentBranchId]=[]}p[e.parentBranchId].push(e)}));Object.keys(p).forEach((e=>{let t=s.find((t=>t.branchId===e||e.startsWith(t.branchId)));if(t){c=c.concat(p[e])}}));const f=floor(c.length*n.maxLength);let d=c.slice(0,f);let m=random(1e3);let h=random(1e3);let g=.2;let u=d.map(((t,o)=>{let r=o/(d.length-1);let l=r;let s=e.widthFunc(l);let i=constrain(s*n.baseRadius*a.maxRadiusMultiplier,a.minRadius,s*1.2);let p=noise(m+r*g)*n.noiseStrength*a.maxNoiseEffect;let f=1.3*i*(1+p*.5)*(n.radiusVariation*.8);let h=map(t.y,c[0].y,c[c.length-1].y,0,1);let u=sin(h*PI)*n.bendStrength*a.maxBendEffect;f*=1+u*.8;let b=frameCount*.003;let x=sin(b+r*PI*.8)*.4+.6;let y=noise(b*g*.8,r*g*.8);let F=lerp(x,y,.2);let w=map(F,0,1,.2,1.5);n.spiralTightness=lerp(n.spiralTightness,w,.1);let P=n.baseFrequency*TWO_PI*n.spiralTightness;let V=noise(m)*n.twistFactor*a.maxTwistEffect;let T=P+V;let C=t.x+cos(T)*f;let E=t.y;let D=sin(T)*f;m+=n.noiseScale;return{x:C,y:E,z:D,baseRadius:i}}));let b=u.map(((e,t)=>{let o=t/(d.length-1);let r=1;if(e&&typeof e.baseRadius==="number"&&isFinite(e.baseRadius)){r=n.baseWidth*e.baseRadius*.2}let l=h+t*n.smoothness||0;let a=noise(l)*(n.widthVariation||.1)*.6;r=isFinite(r)?r:1;a=isFinite(a)?a:0;let s=constrain((r+a)/2,max(.1,r*.3),max(.2,r*1));s=isFinite(s)?s:1;let i=min(t+1,u.length-1);let c;if(t<u.length-1){let t=u[i];if(t&&e){c=createVector(t.x-e.x,t.y-e.y).normalize()}else{c=createVector(0,-1)}}else{if(t>0&&u[t-1]&&e){let o=u[t-1];c=createVector(e.x-o.x,e.y-o.y).normalize()}else{c=createVector(0,-1)}}if(!c){c=createVector(0,-1)}let p=createVector(-c.y,c.x).mult(s);return{x:e.x,y:e.y,z:e.z,widthVector:p,strokeWeight:s*2}}));pgL0.push();pgL15.push();let x=n.glowChance*random(.6,1.2);let y=80;for(let e=0;e<b.length-1;e++){let t=b[e];let o=b[e+1];let l=dist(t.x,t.y,o.x,o.y);if(l>y)continue;let a=e/(b.length-1);let s=n.detailLevel;let i=or(n.color[0],n.color[0],a);let c=map(a,0,1,n.color[1],n.color[1])*map(noise(a*s),0,1,.8,1);let p=map(a,0,1,n.color[2],n.color[2])*map(noise(a*s),0,1,.5,1);let f=sr(i,c,p,1);let d=sr(i,c*.8,p*.6,1);let m=createVector(t.x-t.widthVector.x,t.y-t.widthVector.y);let h=createVector(t.x+t.widthVector.x,t.y+t.widthVector.y);let g=createVector(o.x-o.widthVector.x,o.y-o.widthVector.y);let u=createVector(o.x+o.widthVector.x,o.y+o.widthVector.y);let x=random(.5,1.5)+2;if(t.z<0&&o.z<0){yl({pg:pgL0,pts:[m,g,u,h],col:f,randomOffset:.5});Fl({pg:pgL0,pts:[m,g],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});Fl({pg:pgL0,pts:[h,u],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5})}else if(t.z>=0&&o.z>=0){yl({pg:pgL15,pts:[m,g,u,h],col:f,randomOffset:.5});Fl({pg:pgL15,pts:[m,g],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});Fl({pg:pgL15,pts:[h,u],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5})}else{let e=abs(t.z)/(abs(t.z)+abs(o.z));let l=lerp(t.x,o.x,e);let n=lerp(t.y,o.y,e);let a=p5.Vector.lerp(t.widthVector,o.widthVector,e);let s=createVector(l-a.x,n-a.y);let i=createVector(l+a.x,n+a.y);if(t.z<0){yl({pg:pgL0,pts:[m,s,i,h],col:f,randomOffset:.5});Fl({pg:pgL0,pts:[m,s],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});Fl({pg:pgL0,pts:[h,i],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});yl({pg:pgL15,pts:[s,g,u,i],col:f,randomOffset:.5});Fl({pg:pgL15,pts:[s,g],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});Fl({pg:pgL15,pts:[i,u],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5})}else{yl({pg:pgL15,pts:[m,s,i,h],col:f,randomOffset:.5});Fl({pg:pgL15,pts:[m,s],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});Fl({pg:pgL15,pts:[h,i],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});yl({pg:pgL0,pts:[s,g,u,i],col:f,randomOffset:.5});Fl({pg:pgL0,pts:[s,g],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5});Fl({pg:pgL0,pts:[i,u],col:d,bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*_e*random(.5,1),randomOffset:.5})}}}u.forEach(((t,o)=>{let r=o/(u.length-1);if(random(0,1)>.8){let o=createVector(random(-.5,.5),random(-.5,.5),random(-3,3));let r=N.leaf({pg:pgL0,outline:false,baseX:t.x,baseY:t.y,bLe:n.leaf.size.length*random(.7,1),col:n.leaf.color,cFn:e.leafColorFn,bSg:10,bRt:createVector(o.x,o.y,o.z+PI/2),bwF:e=>n.leaf.shape(e)*n.leaf.size.width,bBF:e=>createVector(map(noise(e*1,PI),0,1,-1,1)*5,0,map(noise(e*1,PI+PI),0,1,-1,1)*5),lTp:[n.leaf.veins.type,n.leaf.veins.density,n.leaf.veins.spacing]});N.leaf({pg:pgL15,outline:false,baseX:t.x,baseY:t.y,bLe:n.leaf.size.length*random(.7,1),col:n.leaf.color,cFn:e.leafColorFn,bSg:10,bRt:createVector(o.x,o.y,o.z-PI/2),bwF:e=>n.leaf.shape(e)*n.leaf.size.width,bBF:e=>createVector(map(noise(e*1,PI+100),0,1,-1,1)*4,0,map(noise(e*1,PI+PI+100),0,1,-1,1)*4),lTp:[n.leaf.veins.type,n.leaf.veins.density,n.leaf.veins.spacing]})}}));pgL0.pop();pgL15.pop()}static wood(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,bRt:l=createVector(PI/2,0,0),bLe:n=400,bSg:a=20,bSh:s=4,bwF:i=e=>.5*(1-e)*map(noise(e*10),0,1,.5,1)+.2,bBF:c=e=>createVector(random(-10,10),0,random(-10,10)),pointShift:p=10,strokeStrength:f=.8,strokeNoiseScale:d=10,lineSegScale:m=Zo([.05,.2,1,5]),lineLimit:h=Zo([.7,.5,.3]),col:g=[250,.5,.4],depth:u=1,convexConcaveStrength:b=random(.2,1.3),forceHorizontal:x=false,enableCracks:y=random(0,1)>.7,crackDensity:F=random(.05,.3),crackDepth:w=random(.1,.3),enableHoles:P=random(0,1)>.7,holeDensity:V=random(.05,.3),holeSize:T=random(.1,.3),holeDepth:C=random(.1,.3)}=e;let E=jo(ho);f=f*map(he,.2,5,1,1.8);p=3*Me;g=co.colors.branch[2];if(x){l=createVector(PI/2,random(0,.2),Zo([-1*random(1.3,1.8),random(1.3,1.8)]))}else{l=createVector(PI/2,random(0,.2),random(0,.2))}let D=createVector(0,0,0);let A=createVector(0,0,0);let S=[D.copy()];let I=[A.copy()];let L=e=>Ho.applyEulerRotation(e,l);for(let e=0;e<a;e++){let t=e/(a-1);let o=c(t);A=p5.Vector.add(A,o.copy().mult(1/a));let r=createVector(0,0,n/a);let l=Ho.applyEulerRotation(r,A);D=p5.Vector.add(D,L(l));I.push(A.copy());S.push(D.copy())}let[B,v]=bl({pts:S,bwF:i});for(let e=1;e<S.length;e++){for(let t=1;t<s;t++){const o=k(e,t);const r={h:g[0],s:u==1?g[1]:g[1]*.8,b:u==1?g[2]:g[2]*.8,alpha:u==1?.7:1};X(o,r);Y(o,r);z(o,r)}}function k(e,t){const o=S.length-1;const r=s-1;const l=e/o;const n=(t-1)/r;const a=t/r;const i=.02;const c=.48;const p=.52;const f=.98;let d=0;if(l<=i){d=1*b}else if(l<c){d=(1-(l-i)/(c-i))*b}else if(l>=f){d=-1*b}else if(l>p){d=-((l-p)/(f-p))*b}const m=d>0;const h=d<0;let g,u,x,y;const F=e;if(m||h){const e=m?cr:(e,t,o)=>cr(t,e,1-o);const t=e(B[F-1],v[F-1],n);const o=e(B[F],v[F],n);const r=e(B[F-1],v[F-1],a);const s=e(B[F],v[F],a);const i=p5.Vector.lerp(B[F-1],v[F-1],n);const f=p5.Vector.lerp(B[F],v[F],n);const b=p5.Vector.lerp(B[F-1],v[F-1],a);const w=p5.Vector.lerp(B[F],v[F],a);const P=abs(d);g=p5.Vector.lerp(i,t,P);u=p5.Vector.lerp(f,o,P);x=p5.Vector.lerp(b,r,P);y=p5.Vector.lerp(w,s,P);const V=m&&l<c||h&&l>p?1+.2*P:1;if(V>1){const e=(g.x+y.x)/2;const t=(g.y+y.y)/2;const o=o=>createVector(e+(o.x-e)*V,t+(o.y-t)*V);g=o(g);u=o(u);x=o(x);y=o(y)}}else{g=p5.Vector.lerp(B[F-1],v[F-1],n);u=p5.Vector.lerp(B[F],v[F],n);x=p5.Vector.lerp(B[F-1],v[F-1],a);y=p5.Vector.lerp(B[F],v[F],a)}const w=(g.x+u.x+y.x+x.x)/4;const P=(g.y+u.y+y.y+x.y)/4;const V=random(1,1.2);const T=e=>createVector(w+(e.x-w)*V,P+(e.y-P)*V);return{Pos0_0:T(g),Pos0_1:T(u),Pos1_1:T(y),Pos1_0:T(x),center:createVector(w,P)}}function X(e,l){const{Pos0_0:n,Pos0_1:a,Pos1_1:s,Pos1_0:i}=e;const{h:c,s:p,b:f,alpha:d}=l;yl({pg:t,pts:[n,a,s,i],baseX:o,baseY:r,col:sr(c,p,f,d),randomOffset:.5})}function Y(e,l){if(!y||random(0,1)>=F)return;const n=[e.Pos0_0,e.Pos0_1,e.Pos1_1,e.Pos1_0];const a=floor(random(4));let s;do{s=floor(random(4))}while(s===a);const i=n[a];const c=n[s];const p=p5.Vector.sub(c,i);const f=p.mag()*random(.3,.9);p.setMag(f);const d=p5.Vector.add(i,p5.Vector.mult(p,random(.3,.7)));const m=createVector(-p.y,p.x);m.setMag(f*w*random(.1,.3));d.add(m);const h=[];const g=floor(random(3,7));for(let e=0;e<=g;e++){let t=e/g;let o;if(e===0){o=i.copy()}else if(e===g){const e=p5.Vector.add(i,p5.Vector.mult(p,random(.7,1)));o=e.copy()}else{const e=t;const r=(1-e)**2*i.x+2*(1-e)*e*d.x+e**2*(i.x+p.x);const l=(1-e)**2*i.y+2*(1-e)*e*d.y+e**2*(i.y+p.y);const n=createVector(random(-5,5)*w,random(-5,5)*w);o=createVector(r,l).add(n)}h.push(o)}const{h:u,s:b,b:x,alpha:P}=l;const V=x*.5;const T=P*.9;for(let e=1;e<h.length;e++){const l=h[e-1];const n=h[e];const a=p5.Vector.sub(n,l);const s=createVector(-a.y,a.x);s.setMag(random(1,3)*w);const i=[p5.Vector.add(l,s),p5.Vector.add(n,s),p5.Vector.sub(n,s),p5.Vector.sub(l,s)];yl({pg:t,pts:i,baseX:o,baseY:r,col:sr(u,b*.9,V,T),randomOffset:.3})}}function z(e,l){if(!P||random(0,1)>=V)return;const{Pos0_0:n,Pos0_1:a,Pos1_1:s,Pos1_0:i}=e;const c=[n,a,s,i];const p=createVector((n.x+a.x+s.x+i.x)/4,(n.y+a.y+s.y+i.y)/4);const f=c.reduce(((e,t)=>e+p5.Vector.dist(p,t)),0)/4;const d=f*T*random(.3,.7);const m=createVector(random(-f,f)*.3,random(-f,f)*.3);const h=p5.Vector.add(p,m);const g=floor(random(8,16));const u=[];for(let e=0;e<g;e++){const t=e/g*TWO_PI;const o=noise(e*.3)*.5+.5;const r=map(o,0,1,.7,1.3);const l=d*r;u.push(createVector(h.x+cos(t)*l,h.y+sin(t)*l))}const{h:b,s:x,b:y,alpha:F}=l;const w=y*(.3-C*.2);const E=F*.95;yl({pg:t,pts:u,baseX:o,baseY:r,col:sr(b,x*.9,w,E),randomOffset:.2});const D=d*.15;for(let e=0;e<g;e++){const l=u[e];const n=u[(e+1)%g];const a=p5.Vector.sub(l,h);a.setMag(D);const s=p5.Vector.add(l,a);const i=p5.Vector.add(n,p5.Vector.sub(n,h).setMag(D));yl({pg:t,pts:[l,n,i,s],baseX:o,baseY:r,col:sr(b,x*.9,lerp(w,y,.3),E),randomOffset:.3})}const A=floor(random(3,8));for(let e=0;e<A;e++){const e=random(TWO_PI);const dist=random(d*.1,d*.7);const l=createVector(h.x+cos(e)*dist,h.y+sin(e)*dist);const n=d*random(.05,.15);const a=floor(random(5,8));const s=[];for(let e=0;e<a;e++){const t=e/a*TWO_PI;const o=n*random(.8,1.2);s.push(createVector(l.x+cos(t)*o,l.y+sin(t)*o))}yl({pg:t,pts:s,baseX:o,baseY:r,col:sr(b,x*.9,w*.7,E),randomOffset:.1})}}let O=co.colors.stroke[0];let R=co.colors.stroke[1];let W=e=>(.6*(1-e)*map(noise(e*10),0,1,.5,1)+.5)*f*_e;let _=Qo(10,15);if(u==0)_=Qo(1,4);const N=[];let H=.5;for(let e=0;e<_;e++){const t=.2+.8/(_-1)*e;let o;const line=[];for(let e=0;e<B.length;e++){let r=e/(B.length-1);o=t+map(noise(e*.1),0,1,-.2,.1);let l;if(r<=.48){let t=r<=.02?1:1-(r-.02)/(.48-.02);t*=b;let n=cr(B[e],v[e],o);let a=createVector(lerp(B[e].x,v[e].x,o),lerp(B[e].y,v[e].y,o));let s=(B[e].x+v[e].x)/2;let i=(B[e].y+v[e].y)/2;l=createVector(lerp(a.x,n.x,t),lerp(a.y,n.y,t));if(r>.02&&r<.48){let e=1+.2*b*(1-(r-.02)/(.48-.02));l=createVector(s+(l.x-s)*e,i+(l.y-i)*e)}}else if(r>=.52){let t=r>=.98?-1:-(r-.52)/(.98-.52);t*=b;let n=cr(v[e],B[e],1-o);let a=createVector(lerp(B[e].x,v[e].x,o),lerp(B[e].y,v[e].y,o));let s=(B[e].x+v[e].x)/2;let i=(B[e].y+v[e].y)/2;l=createVector(lerp(a.x,n.x,-t),lerp(a.y,n.y,-t));if(r>.52&&r<.98){let e=1+.2*b*((r-.52)/(.98-.52));l=createVector(s+(l.x-s)*e,i+(l.y-i)*e)}}else{l=createVector(lerp(B[e].x,v[e].x,o),lerp(B[e].y,v[e].y,o))}line.push(l)}N.push(line)}N.forEach(((line,e)=>{for(let l=0;l<line.length-1;l++){let n=line[l];let a=line[l+1];if(l%100==0)H=random(.1,.5);const s=l>line.length-5?.9:.6;if(noise(l*10+e*1e3)<s){let e=createVector(n.x,n.y);let l=createVector(a.x,a.y);let s=[];for(let t=0;t<=4;t++){let o=t/4;let r=lerp(e.x,l.x,o);let n=lerp(e.y,l.y,o);s.push(createVector(r,n))}Fl({pg:t,pts:s,baseX:o,baseY:r,col:sr(R[0],R[1],R[2],1),bwF:e=>W(e)*H,randomOffset:0})}}}));Fl({pg:t,pts:B.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-p,p);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-p,p);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(O[0],O[1],O[2],1),bwF:W,randomOffset:.5});Fl({pg:t,pts:v.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-p,p);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-p,p);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(O[0],O[1],O[2],1),bwF:W,randomOffset:.5});let G=[];let U=s*2;let $=createVector((B[0].x+v[0].x)/2,(B[0].y+v[0].y)/2);for(let e=0;e<=U;e++){let t=e/U;let o=cr(B[0],v[0],t);let r=1*b;o=createVector($.x+(o.x-$.x)*r,$.y+(o.y-$.y)*r);let l=map(noise(o.x*.1,o.y*.1),0,1,-p*.5,p*.5);let n=map(noise(o.y*.1,o.x*.1),0,1,-p*.5,p*.5);o.x+=l;o.y+=n;G.push(o)}Fl({pg:t,pts:G,baseX:o,baseY:r,col:sr(O[0],O[1],O[2],1),bwF:W,randomOffset:.5});let j=[];let q=s*2;let J=createVector((B[B.length-1].x+v[v.length-1].x)/2,(B[B.length-1].y+v[v.length-1].y)/2);for(let e=0;e<=q;e++){let t=e/q;let o=cr(v[v.length-1],B[B.length-1],t);let r=1*b;o=createVector(J.x+(o.x-J.x)*r,J.y+(o.y-J.y)*r);let l=map(noise(o.x*.1,o.y*.1),0,1,-p*.5,p*.5);let n=map(noise(o.y*.1,o.x*.1),0,1,-p*.5,p*.5);o.x+=l;o.y+=n;j.push(o)}Fl({pg:t,pts:j,baseX:o,baseY:r,col:sr(O[0],O[1],O[2],1),bwF:W,randomOffset:.5});if(random(0,1)>.3){let e=Zo([3,3,6,12,20,40]);for(let t=0;t<e;t++){let e=floor(random(1,S.length-2));let t=random(0,1);let l=t<.33?"left":t<.66?"middle":"right";let n;if(l==="left"){n=B[e]}else if(l==="right"){n=v[e]}else{n=createVector((B[e].x+v[e].x)/2,(B[e].y+v[e].y)/2)}let a=p5.Vector.dist(B[e],v[e]);let s=a*random(.05,.15);let i=[];if(e>=5){let t;if(l==="left"){t=B[e-5]}else if(l==="right"){t=v[e-5]}else{t=createVector((B[e-5].x+v[e-5].x)/2,(B[e-5].y+v[e-5].y)/2)}i.push([t.x,t.y])}else{i.push([n.x,n.y+5])}i.push([n.x,n.y]);if(e<S.length-5){let t;if(l==="left"){t=B[e+5]}else if(l==="right"){t=v[e+5]}else{t=createVector((B[e+5].x+v[e+5].x)/2,(B[e+5].y+v[e+5].y)/2)}i.push([t.x,t.y])}else{i.push([n.x,n.y-5])}let c=random(.1,.3);let p=random(0,1)>.7?pgL1:pgL0;M.drawSpike({pg:p,baseX:n.x+o,baseY:n.y+r,meta:co,baseWidth:s,stemPoints:i,branchLengthScale:c})}}if(u===1){let e=e=>{let t=c(e);return createVector(t.x*random(.8,1.2),t.y*random(.8,1.2),0)};let u=random(.1,.3);let x=e=>i(e)*u;let P=n*random(.1,.3);if(random(0,1)<.8){let n=floor(random(1,S.length-2));let i=S[n];let c=B[n];let u=v[n];let V=Zo([.1,.9]);let T=o+lerp(c.x,u.x,V);let C=r+lerp(c.y,u.y,V);let E=l.x+random(-PI/2,PI/2);let D=l.y+random(-PI/2,PI/2);let A=l.z+random(-PI/2,PI/2);let I=createVector(E,D,A);let L=random(0,1)<.3;M.wood({pg:t,baseX:T,baseY:C,bRt:I,bLe:P,bSg:max(10,floor(a*.5)),bSh:max(3,floor(s*.7)),bwF:x,bBF:e,pointShift:p*.5,strokeStrength:f*.5,strokeNoiseScale:d,lineSegScale:m,lineLimit:h,col:g,depth:0,convexConcaveStrength:b*.8,forceHorizontal:L,enableCracks:y,crackDensity:F,crackDepth:w})}u=random(.2,.4);x=e=>i(e)*u;P=n*random(.2,.4);if(random(0,1)<.5){let n=floor(random(1,S.length-2));let i=B[n];let c=v[n];let u=Zo([.1,.9]);let V=o+lerp(i.x,c.x,u);let T=r+lerp(i.y,c.y,u);let C=l.x+random(-PI/2,PI/2);let E=l.y+random(-PI/2,PI/2);let D=l.z+random(-PI/2,PI/2);let A=createVector(C,E,D);let I=random(0,1)<.3;M.wood({pg:t,baseX:V,baseY:T,bRt:A,bLe:P,bSg:max(10,floor(a*.5)),bSh:max(3,floor(s*.7)),bwF:x,bBF:e,pointShift:p*.5,strokeStrength:f*.5,strokeNoiseScale:d,lineSegScale:m,lineLimit:h,col:g,depth:0,convexConcaveStrength:b*.8,forceHorizontal:I,enableCracks:y,crackDensity:F,crackDepth:w})}}}}class N{static heart(e={}){let{pg:t,meta:o,baseX:r=0,baseY:l=0,size:n=random(5,20),bSg:a=Qo(30,45),bRt:s=createVector(PI/2,0,0),bSh:i=Qo(4,8),pointShift:c=2,strokeStrength:p=1,strokeNoiseScale:f=1,shapeVariation:d=random(.8,1.2),asymmetry:m=random(-.2,.2),col:h=[90,.2,.3],col2:g=[90,.2,.3],specID:u=0}=e;u=random(0,1)<.8?0:1;let b=jo(ho);p=p+b.random(0,1)*2;c=10*Me;a=30;t.push();let x=[];let y=random(TWO_PI);let F=random(.8,2);let w=random(.8,2);for(let e=0;e<=a;e++){let t=e/a;let o=map(t,0,1,-6,6);let r=2*(o*o+abs(o)-6)*d;let l=3*(o*o+abs(o)+2);let i=r/l;let c=i+sqrt(36-o*o)*(1+m*sin(o));o=o*n*F;c=-c*n*w;let p=createVector(o,c,0);p=Ho.applyEulerRotation(p,s);x.push(p)}for(let e=a;e>=0;e--){let t=e/a;let o=map(t,0,1,-6,6);let r=2*(o*o+abs(o)-6)*d;let l=3*(o*o+abs(o)+2);let i=r/l;let c=i-sqrt(36-o*o)*(1+m*sin(o));o=o*n*F;c=-c*n;let p=createVector(o,c,0);p=Ho.applyEulerRotation(p,s);x.push(p)}let P=-n*7;let V=createVector(0,P,0);V=Ho.applyEulerRotation(V,s);x=x.map((e=>p5.Vector.add(e,V)));let T=[];for(let e=0;e<i;e++){let t=e/(i-1);let o=x.map((e=>p5.Vector.lerp(e,p5.Vector.add(createVector(0,0),V),t)));T.push(o)}let C=random(.8,1.05);let E=er(.3,.6);let D=random(0,1)<.5?3:1;let A=0;if(u==0){C=random(.65,.75)+random(-.05,.05);A=1}else if(u==1){C=Zo([1.2,1.2,1.5])+random(-.05,.05);A=.7}for(let e=0;e<T.length-1;e++){let o=T[e];let n=T[e+1];let a=e/(T.length-1);for(let e=0;e<o.length-1;e++){let s=o[e];let i=atan2(s.y,s.x);let c=1-lerp(sin(i)*a,a,a);c+=map(noise(i*20,a*20),0,1,.1,.4);let p=pow(fract(c*D),3);let f=map(p*.5,0,1,.7,1.1);let d=h[0]*f;let m=h[1];let g=h[2]*C;yl({pg:t,pts:[o[e],o[min(e+2,o.length-1)],n[min(e+2,n.length-1)],n[e]],baseX:r,baseY:l,col:sr(d,m,g,E),randomOffset:1})}}let S=co.colors.stroke[0];if(Oe==0)S=co.colors.stroke[2];let I=co.colors.stroke[1];let L=x.slice(x.length/4,x.length/4*3).reverse();let B=x.slice(x.length/4*3,x.length-1).concat(x.slice(0,x.length/4+1));let v=x[floor(x.length/4*3)];let k=x[floor(x.length/4)];let X=[];for(let e=0;e<=30;e++){let t=e/31;let o=p5.Vector.lerp(v,k,t);X.push(o)}Fl({pg:t,pts:L.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-c,c);let o=map(noise(e.y*f,e.x*f),0,1,-c,c);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:l,col:sr(S[0],S[1],S[2],1),bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*2*_e,randomOffset:1});Fl({pg:t,pts:B.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-c,c);let o=map(noise(e.y*f,e.x*f),0,1,-c,c);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:l,col:sr(S[0],S[1],S[2],1),bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*2*_e,randomOffset:1});N.drawLeafVeins({pg:t,baseX:r,baseY:l,debug:true,lTp:co.veinsType2,centerPos:X,leftPos:B,rightPos:L,col:sr(S[0],S[1],S[2],1),col2:co.colors.flower[1],strokeStrength:.5,specID:u});gl({pg:pgText,pts:X,baseX:r,baseY:l});t.pop()}static lotus(e={}){let{pg:t,meta:o,baseX:r=0,baseY:l=0,size:n=random(5,20),bSg:a=Qo(30,45),bRt:s=createVector(PI/2,0,0),bSh:i=Qo(4,8),pointShift:c=2,strokeStrength:p=.8,strokeNoiseScale:f=1,shapeVariation:d=random(.8,1.2),asymmetry:m=random(-.2,.2),col:h=[90,.2,.3]}=e;let g=jo(ho);p=p+g.random(0,1)*2;c=10*Me;a=60;t.push();let u=[];let b=random(TWO_PI);let x=random(.9,1.1);let y=random(.9,1.1);for(let e=0;e<=a;e++){let t=map(e,0,a,0,TWO_PI);let o=n*(1+.05*sin(t*6)+.03*sin(t*10));if(t>PI*.8&&t<PI*1.2){let e=map(t,PI*.8,PI*1.2,0,1,true);let r=e*e*(3-2*e);o*=map(r,0,1,1,.8,true)}let r=cos(t)*o*x;let l=sin(t)*o*y;l-=n*.2;let i=createVector(r,l,0);i=Ho.applyEulerRotation(i,s);u.push(i)}let F=0;let w=-n*.2;let P=createVector(F,w,0);P=Ho.applyEulerRotation(P,s);let V=[];for(let e=0;e<i;e++){let t=e/(i-1);let o=u.map((e=>{let o=t*t*(3-2*t);return p5.Vector.lerp(e,P,o)}));V.push(o)}let T=random(.5,1);for(let e=0;e<V.length-1;e++){let o=V[e];let n=V[e+1];let a=e/(V.length-1);for(let e=0;e<o.length-1;e++){let a=o[e];let s=atan2(a.y-P.y,a.x-P.x);let i=h[0];let c=h[1];let p=h[2];yl({pg:t,pts:[o[e],o[min(e+1,o.length-1)],n[min(e+1,n.length-1)],n[e]],baseX:r,baseY:l,col:sr(i,c,p*T,1),randomOffset:1})}}let C=co.colors.stroke[0];if(Oe==0)C=co.colors.stroke[2];Fl({pg:t,pts:u.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-c,c);let o=map(noise(e.y*f,e.x*f),0,1,-c,c);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:l,col:sr(C[0],C[1],C[2],1),bwF:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*1.5*_e,randomOffset:1});let E=floor(random(8,12));let D=co.colors.stroke[1];for(let e=0;e<E;e++){let o=map(e,0,E,0,TWO_PI);let a=0;let s=TWO_PI;for(let e=0;e<u.length;e++){let t=u[e];let r=atan2(t.y-P.y,t.x-P.x);let l=abs((r-o+TWO_PI)%TWO_PI-PI);if(l<s){s=l;a=e}}let i=u[a];let c=[];let p=floor(random(15,20));c.push(createVector(P.x,P.y,0));for(let e=1;e<=p;e++){let t=e/p;let r=t*(1+.15*sin(o*2)*(1-t));let l=noise(o*10,t*5)*.08*t*t;let a=-sin(o)*n*l;let s=cos(o)*n*l;let f=lerp(P.x,i.x,r)+a;let d=lerp(P.y,i.y,r)+s;c.push(createVector(f,d,0))}Fl({pg:t,pts:c,baseX:r,baseY:l,col:sr(D[0],D[1],D[2]*.9,1),bwF:e=>(.3*(1-e)+.3)*_e,randomOffset:.3})}t.pop()}static drawLeaf(e={}){let{pg:t,baseX:o=0,baseY:l=0,meta:n,angle:a=0,bRt:s,dir:i=0,open:c=0,finalNode:p=1,specID:f=0,lengthProgress:d=0}=e;let m;let h;if(f==0)h=map(d,ao,1,constrain(a,-1,0),-1.57);else h=map(d,ao,1,constrain(a,3.4,5),5);if(i==0){m=createVector(s.x+random(-.5,.5),s.y+random(.2,.5),s.z+a+random(-.05,.05))}else if(i==1){m=createVector(s.x+c,s.y+a,s.z+random(-.2,.2))}if(r==1){m=createVector(s.x,s.y,s.z+random(-.2,.2))}else if(r==2){m=createVector(s.x+random(-.3,.3),s.y+random(.2,.5),s.z+h)}let g=Zo([2,2,2.5])*map(d,ao,1,1,0);let u=n.leafLength*random(.05,.1)*me*p;let b=random(.8,1.2)*he;if(r==2)u=30,b=1.2;let x=M.stem({pg:t,baseX:o,baseY:l,bRt:m,bLe:u,col:n.branchColor,bwF:e=>b,bBF:e=>createVector(.2,.2,0)});if(r==0){let e=M.stem({pg:t,baseX:o,baseY:l,bRt:m,bLe:random(5,10),col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]*.8],bwF:e=>random(.8,1.2)*he*1.5,bBF:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0})}let y=floor(x.centerPos.length*.6);let F=x.centerPos[y].x;let w=x.centerPos[y].y;let P=[];let V=random(0,1)>.5?floor(random(5,15)):0;if(r==2)V=0;for(let e=0;e<V;e++){P.push({position:random(.1,.9),isRight:random(0,1)>.5,depth:random(.2,1.1)})}let T,C;if(r==1){C=e=>.5*(1-pow(2*e-1,2))*10*he;T=e=>createVector(random(-.2,.2),random(-1,1),0)}else if(r==2){C=e=>n.leafShape(e)*p*n.leafWidth+.5*pow(1-e,3);T=e=>createVector(random(-.2,.2),random(-.1,.1),0)}else{C=e=>n.leafShape(e)*p*n.leafWidth+.5*pow(1-e,3);T=e=>createVector(map(noise(e*1,PI),0,1,-1,1)*g*2*he,map(noise(e*2,PI+PI),0,1,-1,1)*g*he,map(noise(e*3,PI+PI+PI),0,1,-1,1)*g*2*he)}let E=N.leaf({pg:t,lTp:n.lTp,baseX:o+F,baseY:l+w,bLe:n.leafLength*random(.8,1.2)*p,col:n.leafColorA,col2:n.leafColorB,cFn:n.leafColorFn,bSg:32,bRt:m,notches:P,strokeStrength:.5,specID:f,bwF:C,bBF:T});let D=E.x;let A=E.y;if(window.debugMode1==1){console.log("***debugMode1:do");pgText.noStroke();pgText.push();pgText.translate(F+o,w+l);pgText.fill(0);pgText.ellipse(0,0,4);pgText.fill(0,0,1,1);pgText.ellipse(0,0,3);pgText.pop();pgText.push();pgText.translate(D+o,A+l);pgText.fill(0);pgText.ellipse(0,0,4);pgText.fill(0,0,1,1);pgText.ellipse(0,0,3);pgText.textSize(8);pgText.stroke(0);pgText.strokeWeight(2);pgText.fill(255);pgText.text(`${m.x.toFixed(2)}, ${m.y.toFixed(2)}, ${m.z.toFixed(2)}`,0,0);pgText.noStroke();pgText.fill(0,0,1,1);pgText.text(`${m.x.toFixed(2)}, ${m.y.toFixed(2)}, ${m.z.toFixed(2)}`,0,0);pgText.pop();pgText.push();let e=D+o-(F+o);let t=A+l-(w+l);let r=Math.atan2(t,e)*180/Math.PI;pgText.stroke(0);pgText.strokeWeight(2);pgText.line(F+o,w+l,D+o,A+l);if(r>=45&&r<=135){pgText.stroke(1,1,1,1)}else{pgText.stroke(0,0,1,1)}pgText.strokeWeight(1);pgText.line(F+o,w+l,D+o,A+l);pgText.pop()}return E}static drawHeart(e={}){let{pg:t,baseX:o=0,baseY:r=0,meta:l,angle:n=0,bRt:a=createVector(PI/2,0,0),dir:s=2}=e;let i;if(s==0){i=createVector(random(-1,1)*PI,random(-1,1)*PI,n)}else if(s==1){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1)+n,a.z)}else if(s==2){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1),a.z+n)}let c=Zo([2,2,2.5,3]);let p=M.stem({pg:t,baseX:o,baseY:r,bRt:i,bLe:l.leafLength*random(.2,.5)*me,col:l.branchColor,bwF:e=>random(.8,1.2)*he,bBF:e=>createVector(random(-1,1),random(-1,1),0)});let f=M.stem({pg:pgL0,baseX:o,baseY:r,bRt:i,bLe:random(5,10),col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]*.8],bwF:e=>random(.8,1.2)*he*1.5,bBF:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let d=p.centerPos[p.centerPos.length-3].x;let m=p.centerPos[p.centerPos.length-3].y;let h=random(-.5,.5);let g=random(-.5,.5);let u=random(-.5,.5);N.heart({pg:pgL2,baseX:o+d,baseY:r+m,size:l.leafHeartSize*random(.5,1),bSh:Qo(8,12),bSg:24,bRt:createVector(i.x+1.05+h,i.y+1+g,i.z+3.14+u),col:l.leafColorA,col2:l.leafColorB})}static drawLotus(e={}){let{pg:t,baseX:o=0,baseY:r=0,meta:l,angle:n=0,bRt:a=createVector(PI/2,0,0),dir:s=2}=e;let i;if(s==0){i=createVector(random(-1,1)*PI,random(-1,1)*PI,n)}else if(s==1){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1)+n,a.z)}else if(s==2){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1),a.z+n)}let c=Zo([2,2,2.5,3]);let p=M.stem({pg:t,baseX:o,baseY:r,bRt:i,bLe:l.leafLength*random(.2,.5)*me,col:l.branchColor,bwF:e=>random(.8,1.2)*he,bBF:e=>createVector(random(-1,1),random(-1,1),0)});let f=M.stem({pg:pgL0,baseX:o,baseY:r,bRt:i,bLe:random(5,10),col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]*.8],bwF:e=>random(.8,1.2)*he*1.5,bBF:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let d=p.centerPos[p.centerPos.length-3].x;let m=p.centerPos[p.centerPos.length-3].y;lotus({pg:pgL2,baseX:o+d,baseY:r+m,size:100*random(.8,1.1),bSh:3,bSg:24,bRt:createVector(random(1.8,2.2),random(-.1,.1),random(-.1,.1)),col:l.leafColorA,col2:l.leafColorB})}static addLeaf(e,t,o,l,n="normal",a){if(n==="final"){o.PT.leafGrowType=random(0,1)>.3?_o:Ro;if(r==2)o.PT.leafGrowType=Ro;if(r==1)o.PT.leafGrowType=Wo}switch(o.PT.leafGrowType){case Ro:N.selLeaf({pg:pgL1,baseX:e,baseY:t,meta:o.PT,angle:.5,bRt:createVector(PI/2+1,PI-1,l),dir:0,specID:0,lengthProgress:a});N.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:o.PT,angle:PI-.5,bRt:createVector(PI/2+1,-1,l),dir:0,specID:1,lengthProgress:a});o.PT.leafCount+=2;break;case _o:let r=TWO_PI/ut;let s=random(.1,1.3);let i=n==="final"?Zo([.3,.3,.5,.7,1,1.2]):1;for(let n=0;n<ut;n++){N.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:o.PT,angle:n*r+s,bRt:createVector(PI/2,0,l+PI/2),dir:1,open:s,finalNode:i,relativePosition:a})}o.PT.leafCount+=ut;break;case Wo:let c=random(-.2,.2);Jt=(Jt+1)%2;if(Jt==0){N.selLeaf({pg:pgL1,baseX:e,baseY:t,meta:o.PT,angle:c,bRt:createVector(PI/2+1,PI-1,l),dir:0,specID:0,lengthProgress:a})}else{N.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:o.PT,angle:PI+c,bRt:createVector(PI/2+1,-1,l),dir:0,specID:1,lengthProgress:a})}o.PT.leafCount+=1;break}}static selLeaf(e={}){let{pg:t,baseX:o=0,baseY:r=0,meta:l,angle:n=0,bRt:a,dir:s=0,finalNode:i=1,relativePosition:c=0,specID:p=0,lengthProgress:f=0}=e;if(gt==0){N.drawLeaf(e)}else if(gt==1){Dt=0;N.drawHeart(e)}else if(gt==2){N.drawLotus(e)}else if(gt==3){N.drawPlam(e)}}static drawPlam(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,meta:l,angle:n=0,bRt:a,dir:s=0,open:i=0,finalNode:c=1,relativePosition:p=0}=e;let f;t=pgL0;if(!a){console.error("drawPlam: bRt is undefined");a=createVector(PI/2,0,0)}f=createVector(a.x+i,a.y+n,a.z+random(-.2,.2));let d=max(200,l.leafLength*random(1.5,2)*me*c);if(isNaN(d))d=100;let m=map(p,0,1,1,2);Be=[1,1];let h=M.stem({pg:t,baseX:o,baseY:r,bRt:f,bLe:d,col:l.branchColor,bwF:e=>(1.2-e*.5)*he,bBF:e=>createVector(m+random(-.2,.2),0,0)});let g=h.centerPos;let u=g.length;let b=Qo(12,18);let x=d*.6;let y=.15;let F=.92;let w=Zo([-1,-2,-1.5]);for(let e=0;e<b;e++){let n=map(e,0,b-1,y,F);let a=floor(n*u);if(a>=g.length)continue;let s=map(n,y,F,PI/8,PI/2.2);let i=-s+random(-.1,.1);let c=createVector(f.x+random(-.1,.1),f.y+i,f.z+random(-.1,.1));let p=s+random(-.1,.1);let d=createVector(f.x+random(-.1,.1),f.y+p,f.z+random(-.1,.1));let m=t=>{let o=map(noise(e*100,t*10),0,1,-.8,.8);let r=map(noise(e*200,t*10),0,1,-.6,0);let l=map(noise(e*300,t*10),0,1,-.3,.3);return createVector(o,r,l)};Be=[1,1];let h=random(1,2);let P=random(1,2);let V=0;let T=e=>{const t=0;const o=.6;const r=1;let l=20;if(e<=o){return.3*he*l}else{return map(e,o,r,.3,0)*he*l}};N.leaf({pg:t,baseX:o+g[a].x,baseY:r+g[a].y,bLe:x*(1-n*.6),col:l.leafColorA,col2:l.leafColorB,bRt:createVector(c.x*w,c.y*1,c.z),bwF:T,bBF:e=>createVector(h,P,V)});N.leaf({pg:t,baseX:o+g[a].x,baseY:r+g[a].y,bLe:x*(1-n*.6),col:l.leafColorA,col2:l.leafColorB,bRt:createVector(d.x*-1,d.y*1,d.z),bwF:T,bBF:e=>createVector(h,P,V)})}}static leaf(e={}){let{pg:t=pgL3,baseX:o=0,baseY:l=0,bRt:n=createVector(PI/2,0,0),bLe:a=400,bSg:s=20,lTp:i=[0,0],notches:c=[],bwF:p=e=>40,cFn:f=e=>e,bBF:d=e=>createVector(random(-10,10),0,random(-5,5)),pointShift:m=.5,strokeStrength:h=.8,strokeNoiseScale:g=10,col:u=[90,.2,.3],col2:b=[90,.2,.3],specID:x=0}=e;x=random(0,1)<.8?0:1;let y=jo(ho);h=h+y.random(0,1)*2;m=5*Me;s=constrain(floor(map(a,50,300,20,60)),20,60);s=max(5,floor(s*ue));let F=createVector(0,0,0);let w=createVector(0,0,0);let P=[F.copy()];let V=[w.copy()];let T=[];let C=[];let E=e=>Ho.applyEulerRotation(e,n);let D=(e,t)=>{let o=p(e);for(let r of c){let l=abs(e-r.position);if(l<.05){if(t==="right"&&r.isRight&&e>r.position||t==="left"&&!r.isRight&&e<r.position){let e=30;let t=pow(1-l/.3,e)*r.depth;return o*(1-t)}}}return o};let A=random(.2,3);let S=random(0,1)>.3?1:0;let I=random(.8,1);let L=1;let B=.5;let v=er(.6,.9);if(r==2)v=1,I=random(.7,1.1),B=0;if(x==0){I=random(.65,.75)+random(-.05,.05);L=1}else if(x==1){I=Zo([1.2,1.2,1.5])+random(-.05,.05);L=.7}let k=random(0,1)>.9?5:1;if(r==2)k=1;for(let e=0;e<s;e++){let r=e/(s-1);let n=d(r);w=p5.Vector.add(w,p5.Vector.mult(n,1/s));let i=Ho.applyEulerRotation(createVector(0,0,a/s),w);F=p5.Vector.add(F,E(i));let c=D(r,"left");let p=D(r,"right");let f=Ho.applyEulerRotation(createVector(-c,0,0),w);let m=Ho.applyEulerRotation(createVector(p,0,0),w);let h=p5.Vector.add(F,E(f));let g=p5.Vector.add(F,E(m));T.push(h.copy());C.push(g.copy());let y=0,A=0,X=0;if(yt==1){let e=pow(1-r,2);if(x==1)e=pow(1-r,10);y=lerp(Number(u[0]),Number(b[0]),fract(e*k));A=Number(u[1])*L;X=lerp(Number(u[2]),Number(b[2])*.7,e)*I}else{if(S==1){y=u[0];A=u[1];X=u[2]*I}else{y=u[0];A=u[1];X=u[2]}}if(e<=0){if(T[0]&&T[1]&&C[1]&&C[0]&&Dt==0){yl({pg:t,pts:[T[0],T[1],C[1],C[0]],baseX:o,baseY:l,col:sr(y,A,X,v),randomOffset:B,vertexMode:Dt,show:0})}}else{let r=e-1;if(T[e]&&T[r]&&P[r]&&P[e]){yl({pg:t,pts:[T[e],T[r],P[r],P[e]],baseX:o,baseY:l,col:sr(y,A,X,v),randomOffset:B,vertexMode:Dt})}if(C[e]&&C[r]&&P[r]&&P[e]){yl({pg:t,pts:[C[e],C[r],P[r],P[e]],baseX:o,baseY:l,col:sr(y,A,X,v),randomOffset:B,vertexMode:Dt})}}P.push(F.copy());V.push(w.copy())}let X=co.colors.stroke[0];if(Oe==0)X=co.colors.stroke[2];let Y=co.colors.stroke[1];let z=e=>{const t=.2;const o=-.35;const r=(noise(e*t,Qo(0,100)*.05)+o)*3*_e;return r>.5?r:random(0,1)>.7?0:0};let O=e=>(.2*(1-e)*map(noise(e*g),0,1,.5,1)+.3)*h*_e;let R=Zo([z,O]);if(At==1)R=O;else if(At==2)R=z;if(r==1||r==2){R=e=>.5;m=0;g=0}if(Dt==0){Fl({pg:t,pts:T.map((e=>{let t=map(noise(e.x*g,e.y*g),0,1,-m,m);let o=map(noise(e.y*g,e.x*g),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,col:sr(X[0],X[1],X[2],1),bwF:R,randomOffset:B});Fl({pg:t,pts:C.map((e=>{let t=map(noise(e.x*g,e.y*g),0,1,-m,m);let o=map(noise(e.y*g,e.x*g),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,col:sr(X[0],X[1],X[2],1),bwF:R,randomOffset:B});Fl({pg:t,pts:[T[0],createVector(0,0)],baseX:o,baseY:l,col:sr(X[0],X[1],X[2],1),bwF:R,randomOffset:B});Fl({pg:t,pts:[C[0],createVector(0,0)],baseX:o,baseY:l,col:sr(X[0],X[1],X[2],1),bwF:R,randomOffset:B});Fl({pg:t,pts:[T[0],T[2]],baseX:o,baseY:l,col:sr(X[0],X[1],X[2],1),bwF:R,randomOffset:B});Fl({pg:t,pts:[C[0],C[2]],baseX:o,baseY:l,col:sr(X[0],X[1],X[2],1),bwF:R,randomOffset:B})}if(r==0||r==2){N.drawLeafVeins({pg:t,baseX:o,baseY:l,lTp:i,centerPos:P,leftPos:T,rightPos:C,col:sr(X[0],X[1],X[2],1),col2:co.colors.flower[1],strokeStrength:.5,specID:x})}gl({pg:pgText,pts:P,baseX:o,baseY:l});return P[P.length-1]}static drawLeafVeins(e={}){let{pg:t,baseX:o,baseY:l,debug:n=false,lTp:a=[3,2],centerPos:s,leftPos:i,rightPos:c,col:p,col2:f=co.colors.flower[1],pointShift:d=.5,strokeStrength:m=1,strokeNoiseScale:h=10,pointMult:g=0,specID:u=0}=e;let b=jo(ho);m=m+b.random(0,1)*3;d=1*Me;g=1*Me;p=[hue(p),saturation(p),brightness(p),alpha(p)];let x=co.colors.leaf[0];let y;if(a[0]==0||a[0]==1||a[0]==2||a[0]==4||a[0]==10||a[0]==12){if(a[0]==2||a[0]==0)y=sr(p[0],p[1],p[2]*.7);else y=sr(x[0],x[1],x[2]*10,1);let F=.1;let w=function(e){return(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*m*_e};let P=function(e){return(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e};if(r==2){if(u==1)y=sr(x[0],x[1],x[2]*10,.2);else if(u==0)y=sr(x[0],x[1],x[2]*10,.8);d=0;w=e=>1.35;P=e=>1.1}if(a[0]==12){Fl({pg:t,pts:s.slice(1).map((e=>{let t=map(b.noise(e.x*F,e.y*F),0,1,-d,d);let o=map(b.noise(e.y*F,e.x*F),0,1,-d,d);return createVector(e.x+t+1,e.y+o)})),baseX:o,baseY:l,col:sr(p[0],p[1],p[2],.3),bwF:w,randomOffset:.2,forceBrush:1})}Fl({pg:t,pts:s.slice(1).map((e=>{let t=map(b.noise(e.x*F,e.y*F),0,1,-d,d);let o=map(b.noise(e.y*F,e.x*F),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:l,col:y,bwF:P,randomOffset:.2,forceBrush:1})}if(a[0]==0&&Dt==0){let V;if(s.length>a[1]){V=floor(s.length/a[1])}else{V=floor(s.length/5)}for(let T=V;T<s.length-V;T+=V){let C=(T-V)/(s.length-2*V);let E=.1+.5*sin(C*PI);let D=.2+.2*sin(C*PI);let A=s[T];let S=p5.Vector.lerp(A,i[T+2],E);let I=p5.Vector.lerp(A,S,.5);I.add(ir(b).mult(3));let L=[];let B=5;for(let Y=0;Y<=B;Y++){let z=Y/B;let O=pow(1-z,2)*A.x+2*(1-z)*z*I.x+pow(z,2)*S.x;let R=pow(1-z,2)*A.y+2*(1-z)*z*I.y+pow(z,2)*S.y;L.push(createVector(O,R).add(ir(b).mult(.2)))}Fl({pg:t,pts:L,baseX:o,baseY:l,col:sr(x[0],x[1],x[2]*10.5,1),bwF:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*m*_e,randomOffset:.2,forceBrush:1});let v=p5.Vector.lerp(A,c[T+2],E);let k=p5.Vector.lerp(A,v,.5);k.add(ir(b).mult(3));let X=[];for(let W=0;W<=B;W++){let _=W/B;let M=pow(1-_,2)*A.x+2*(1-_)*_*k.x+pow(_,2)*v.x;let N=pow(1-_,2)*A.y+2*(1-_)*_*k.y+pow(_,2)*v.y;X.push(createVector(M,N).add(ir(b).mult(.2)))}Fl({pg:t,pts:X,baseX:o,baseY:l,col:sr(x[0],x[1],x[2]*10.5,1),bwF:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*m*_e,randomOffset:.2,forceBrush:1})}}else if(a[0]==1&&Dt==0){for(let H=2;H<s.length-1;H++){for(let G=1;G<a[1];G++){let U=G/a[1];let $=p5.Vector.lerp(i[H-1],s[H-1],U);let j=p5.Vector.lerp(i[H],s[H],U);let q=p5.Vector.lerp(s[H-1],c[H-1],U);let J=p5.Vector.lerp(s[H],c[H],U);Fl({pg:t,pts:[q.add(ir(b).mult(.4)),J.add(ir(b).mult(.4))],baseX:o,baseY:l,col:sr(x[0],x[1],x[2]*10,.5),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:.5,forceBrush:1});Fl({pg:t,pts:[$.add(ir(b).mult(.4)),j.add(ir(b).mult(.4))],baseX:o,baseY:l,col:sr(x[0],x[1],x[2]*10,.5),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:.5,forceBrush:1})}}}else if(a[0]==2&&Dt==0){let K=min(i.length,c.length,s.length);let Q=max(2,floor(K/(a[1]*2)));let Z=floor(s.length/8);for(let ee=Z;ee<s.length-Z;ee+=Q){let te=(ee-Z)/(s.length-2*Z);let oe=.3+.4*sin(te*PI);let re=s[ee];let le=p5.Vector.lerp(re,i[ee],oe);let ne=p5.Vector.lerp(re,le,.5);let ae=createVector(0,5*sin(te*PI),0);ne.add(ae);ne.add(ir(b).mult(2));let se=[];let ie=5;for(let ce=0;ce<=ie;ce++){let pe=ce/ie;let fe=pow(1-pe,2)*re.x+2*(1-pe)*pe*ne.x+pow(pe,2)*le.x;let de=pow(1-pe,2)*re.y+2*(1-pe)*pe*ne.y+pow(pe,2)*le.y;se.push(createVector(fe,de).add(ir(b).mult(.2)))}Fl({pg:t,pts:se,baseX:o,baseY:l,col:sr(p[0],p[1],p[2],b.random(.2,1)),bwF:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*m*_e,randomOffset:.3,forceBrush:1});if(ee+Q/2<s.length-Z){let me=s[ee+floor(Q/2)];let he=p5.Vector.lerp(me,c[ee+floor(Q/2)],oe);let ge=p5.Vector.lerp(me,he,.5);ge.add(ae);ge.add(ir(b).mult(2));let ue=[];for(let be=0;be<=ie;be++){let xe=be/ie;let ye=pow(1-xe,2)*me.x+2*(1-xe)*xe*ge.x+pow(xe,2)*he.x;let Fe=pow(1-xe,2)*me.y+2*(1-xe)*xe*ge.y+pow(xe,2)*he.y;ue.push(createVector(ye,Fe).add(ir(b).mult(.2)))}Fl({pg:t,pts:ue,baseX:o,baseY:l,col:sr(p[0],p[1],p[2],b.random(.2,1)),bwF:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*m*_e,randomOffset:.3,forceBrush:1})}}}else if(a[0]==3){for(let we=2;we<s.length-1;we++){for(let Pe=1;Pe<a[1];Pe++){let Ve=Pe/a[1];let Te=p5.Vector.lerp(i[we-1],s[we-1],Ve);let Ce=p5.Vector.lerp(i[we],s[we],Ve);let Ee=p5.Vector.lerp(s[we-1],c[we-1],Ve);let De=p5.Vector.lerp(s[we],c[we],Ve);let Ae=f[0];let Se=f[1];let Ie=f[2];yl({pg:t,pts:[Te,Ce,s[we],s[we-1]],baseX:o,baseY:l,col:sr(Ae,Se,Ie,.6),randomOffset:.3,vertexMode:Dt});yl({pg:t,pts:[Ee,De,s[we],s[we-1]],baseX:o,baseY:l,col:sr(Ae,Se,Ie,.6),randomOffset:.3,vertexMode:Dt});Fl({pg:t,pts:[Ee.copy().add(ir(b).mult(g)),De.copy().add(ir(b).mult(g))],baseX:o,baseY:l,col:sr(p[0],p[1],p[2],1),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.2)*m*_e,randomOffset:.3,forceBrush:1});Fl({pg:t,pts:[Te.copy().add(ir(b).mult(g)),Ce.copy().add(ir(b).mult(g))],baseX:o,baseY:l,col:sr(p[0],p[1],p[2],1),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.2)*m*_e,randomOffset:.3,forceBrush:1})}}}else if(a[0]==4){}else if(a[0]==5){let Be=b.random(-.1,.1);for(let ve=2;ve<s.length-1;ve++){for(let ke=1;ke<a[1];ke++){let Xe=ke/a[1];let Ye=2*abs(ve/s.length-.5);let ze=p5.Vector.lerp(i[ve-1],s[ve-1],Xe+Be);let Oe=p5.Vector.lerp(i[ve],s[ve],Xe+Be);let Re=p5.Vector.lerp(s[ve-1],c[ve-1],Xe+Be);let We=p5.Vector.lerp(s[ve],c[ve],Xe+Be);let Ne=lerp(co.colors.leaf[0][0],p[0],Ye);let He=lerp(co.colors.leaf[0][1],p[1],Ye);let Ge=lerp(co.colors.leaf[0][2],p[2],Ye);Ne=p[0];He=p[1];Ge=p[2];let Ue=lerp(0,1,Ye);yl({pg:t,pts:[ze,Oe,s[ve],s[ve-1]],baseX:o,baseY:l,col:sr(Ne,He,Ge,Ue*.6),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[Re,We,s[ve],s[ve-1]],baseX:o,baseY:l,col:sr(Ne,He,Ge,Ue*.6),randomOffset:1,vertexMode:Dt})}}}else if(a[0]==6){let $e=b.random(.3,1);let je=map($e,.3,1,1.7,1);for(let qe=2;qe<s.length-1;qe++){for(let Ke=1;Ke<a[1];Ke++){let Qe=Ke/a[1];let Ze=p5.Vector.lerp(i[qe-1],s[qe-1],Qe*$e);let et=p5.Vector.lerp(i[qe],s[qe],Qe*$e);let tt=p5.Vector.lerp(s[qe-1],c[qe-1],Qe*je);let ot=p5.Vector.lerp(s[qe],c[qe],Qe*je);let rt=f[0];let lt=f[1];let nt=f[2];if(b.noise(qe*.5,Ke*.5)>.6){rt=p[0];lt=p[1];nt=p[2]}yl({pg:t,pts:[Ze,et,s[qe],s[qe-1]],baseX:o,baseY:l,col:sr(rt,lt,nt,.6),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[tt,ot,s[qe],s[qe-1]],baseX:o,baseY:l,col:sr(rt,lt,nt,.6),randomOffset:1,vertexMode:Dt})}}}else if(a[0]==7){for(let at=2;at<s.length-1;at++){for(let st=1;st<a[1];st++){let it=st/a[1];let ct=p5.Vector.lerp(i[at-1],s[at-1],it);let pt=p5.Vector.lerp(i[at],s[at],it);let ft=p5.Vector.lerp(s[at-1],c[at-1],it);let dt=p5.Vector.lerp(s[at],c[at],it);let mt=f[0];let ht=f[1];let gt=f[2];let ut=p[0];let bt=p[1];let xt=p[2];let yt=p5.Vector.lerp(s[at-1],ct,.5);let Ft=p5.Vector.lerp(s[at],pt,.5);let wt=p5.Vector.lerp(s[at-1],ft,.5);let Pt=p5.Vector.lerp(s[at],dt,.5);yl({pg:t,pts:[ct,pt,Ft,yt],baseX:o,baseY:l,col:sr(mt,ht,gt,1),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[yt,Ft,s[at],s[at-1]],baseX:o,baseY:l,col:sr(ut,bt,xt,1),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[ft,dt,Pt,wt],baseX:o,baseY:l,col:sr(mt,ht,gt,1),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[wt,Pt,s[at],s[at-1]],baseX:o,baseY:l,col:sr(ut,bt,xt,1),randomOffset:1,vertexMode:Dt});Fl({pg:t,pts:[ft.copy().add(ir(b).mult(g)),dt.copy().add(ir(b).mult(g))],baseX:o,baseY:l,col:sr(p[0],p[1],p[2],p[3]),bwF:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:1,forceBrush:1});Fl({pg:t,pts:[ct.copy().add(ir(b).mult(g)),pt.copy().add(ir(b).mult(g))],baseX:o,baseY:l,col:sr(p[0],p[1],p[2],p[3]),bwF:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:1,forceBrush:1});Fl({pg:t,pts:[wt.copy().add(ir(b).mult(g)),Pt.copy().add(ir(b).mult(g))],baseX:o,baseY:l,col:sr(p[0],p[1],p[2],p[3]),bwF:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:1,forceBrush:1});Fl({pg:t,pts:[yt.copy().add(ir(b).mult(g)),Ft.copy().add(ir(b).mult(g))],baseX:o,baseY:l,col:sr(p[0],p[1],p[2],p[3]),bwF:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:1,forceBrush:1})}}}else if(a[0]==8){let Vt=a[1];let Tt=b.random(.1,.35);for(let Ct=2;Ct<s.length-1;Ct++){if(Ct%Vt==0){for(let Et=1;Et<6;Et++){let At=Et/6;let St=p5.Vector.lerp(i[Ct-1],s[Ct-1],At);let It=p5.Vector.lerp(i[Ct],s[Ct],At);let Lt=p5.Vector.lerp(s[Ct-1],c[Ct-1],At);let Bt=p5.Vector.lerp(s[Ct],c[Ct],At);let vt=f[0];let kt=f[1];let Xt=f[2];let Yt=p[0];let zt=p[1];let Ot=p[2];let Rt=p5.Vector.lerp(St,It,.5);let Wt=p5.Vector.lerp(Lt,Bt,.5);let _t=p5.Vector.lerp(s[Ct-1],s[Ct],Tt);let Mt=p5.Vector.lerp(s[Ct-1],s[Ct],1-Tt);yl({pg:t,pts:[St,Rt,_t,s[Ct-1]],baseX:o,baseY:l,col:sr(vt,kt,Xt,1),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[Lt,Wt,_t,s[Ct-1]],baseX:o,baseY:l,col:sr(vt,kt,Xt,1),randomOffset:1});yl({pg:t,pts:[Rt,_t,Mt,It],baseX:o,baseY:l,col:sr(Yt,zt,Ot,1),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[Wt,_t,Mt,Bt],baseX:o,baseY:l,col:sr(Yt,zt,Ot,1),randomOffset:1,vertexMode:Dt})}}}}else if(a[0]==9){let Nt=b.random(.3,.7);for(let Ht=2;Ht<s.length-1;Ht++){for(let Gt=1;Gt<2;Gt++){let Ut;let $t=2*abs(Ht/s.length-.5);let jt=p5.Vector.lerp(i[Ht-1],s[Ht-1],.1);let qt=p5.Vector.lerp(i[Ht],s[Ht],0);let Jt=p5.Vector.lerp(s[Ht-1],c[Ht-1],.5);let Kt=p5.Vector.lerp(s[Ht],c[Ht],0);let Qt=lerp(co.colors.bg[0][0],p[0],1-$t);let Zt=lerp(co.colors.bg[0][1],p[1],1-$t);let eo=lerp(co.colors.bg[0][2],p[2],1-$t);Qt=f[0];Zt=f[1];eo=f[2];yl({pg:t,pts:[jt,qt,s[Ht],s[Ht-1]],baseX:o,baseY:l,col:sr(Qt,Zt,eo,Nt),randomOffset:2,vertexMode:Dt});yl({pg:t,pts:[Jt,Kt,s[Ht],s[Ht-1]],baseX:o,baseY:l,col:sr(Qt,Zt,eo,Nt),randomOffset:2,vertexMode:Dt})}}}else if(a[0]==10&&Dt==0){function to(e,t,o,r,l){let n=[];for(let t=0;t<=o;t++){let a=t/o;let i=floor(l*a);i=max(0,min(i,e.length-1));let c=p5.Vector.lerp(e[i],s[i],r);n.push(c)}n[n.length-1]=t;let a=[];for(let e=0;e<n.length;e++){let t=max(0,e-1);let o=min(n.length-1,e+1);let r=p5.Vector.lerp(p5.Vector.lerp(n[t],n[e],.5),p5.Vector.lerp(n[e],n[o],.5),.5);a.push(r)}return a}function oo(e,color){Fl({pg:t,pts:e,baseX:o,baseY:l,col:sr(x[0],x[1],x[2]*10,.5),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.6,1)+.3)*m*_e,randomOffset:.1,forceBrush:1})}let ro=[{pathRatio:.6,lerpRatio:.3},{pathRatio:.7,lerpRatio:.5},{pathRatio:.8,lerpRatio:.7}];for(let{pathRatio:lo,lerpRatio:no}of ro){let ao=floor(i.length*lo);let so=20;let io=floor(i.length/10*floor(lo*10));let po=i[io];let fo=to(i,po,so,no,ao);oo(fo,x);let mo=c[io];let go=to(c,mo,so,no,ao);oo(go,x)}}else if(a[0]==11){let uo=b.random(1.2,2.5);let bo=uo*b.random(1,2.5);let xo=new Map;let yo=Qo(150,250);if(Le==1)yo=Qo(20,50);function Fo(e,t,o){let r=floor(e.x/o);let l=floor(e.y/o);for(let n=-1;n<=1;n++){for(let a=-1;a<=1;a++){let key=`${r+n},${l+a}`;if(t.has(key)){let r=t.get(key);for(let t of r){let r=p5.Vector.dist(e,t);if(r<o)return false}}}}return true}function wo(e,t,o){let r=floor(e.x/o);let l=floor(e.y/o);let key=`${r},${l}`;if(!t.has(key)){t.set(key,[])}t.get(key).push(e)}for(let Po=2;Po<s.length-1;Po++){let Vo=i[Po];let To=c[Po];let Co=s[Po];let Eo=floor(yo/(s.length-3));let Do=0;let Ao=0;while(Ao<Eo&&Do<100){Do++;let So=b.random(0,b.random(0,1));let Io;if(random(0,1)<.5){Io=p5.Vector.lerp(Vo,Co,So)}else{Io=p5.Vector.lerp(Co,To,So)}Io.add(ir(b).mult(b.random(.5,2)));if(Fo(Io,xo,bo)){wo(Io,xo,bo);Ao++;t.push();t.translate(o,l);t.noStroke();if(Le==1){t.fill(Qo(0,6)*20,.5,.8,1)}else{if(b.random(0,1)<.7){t.fill(Je[0][0],Je[0][1],Je[0][2]*.7,.3)}else{t.fill(Je[1][0],Je[1][1],Je[1][2]*1.2,.5)}}t.ellipse(Io.x,Io.y,uo*b.random(.7,1),uo*b.random(.7,1));t.pop()}}}}else if(a[0]==12){let Lo=min(i.length,c.length,s.length);let Bo=max(2,floor(Lo/(a[1]*2)));let vo=floor(s.length/8);let ko=.4;if(u==1)ko=.6;else if(u==0)ko=.1;let Xo=1;if(u==1)Xo=5;for(let Yo=vo;Yo<s.length-vo;Yo+=Bo){let zo=(Yo-vo)/(s.length-2*vo);let Oo=.48+.48*sin(zo*PI);let Ro=s[Yo];let Wo=p5.Vector.lerp(Ro,i[Yo+5],Oo);let _o=p5.Vector.lerp(Ro,Wo,.5);let Mo=createVector(0,5*sin(zo*PI),0);_o.add(Mo);_o.add(ir(b).mult(2));let No=[];let Ho=5;for(let qo=0;qo<=Ho;qo++){let Jo=qo/Ho;let Ko=pow(1-Jo,2)*Ro.x+2*(1-Jo)*Jo*_o.x+pow(Jo,2)*Wo.x;let Zo=pow(1-Jo,2)*Ro.y+2*(1-Jo)*Jo*_o.y+pow(Jo,2)*Wo.y;No.push(createVector(Ko,Zo).add(ir(b).mult(.2)))}Fl({pg:t,pts:No,baseX:o,baseY:l,col:sr(p[0],p[1],p[2]*Xo,ko),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:.3,forceBrush:1});let Go=p5.Vector.lerp(Ro,c[Yo+5],Oo);let Uo=p5.Vector.lerp(Ro,Go,.5);Uo.add(Mo);Uo.add(ir(b).mult(2));let $o=[];for(let er=0;er<=Ho;er++){let tr=er/Ho;let or=pow(1-tr,2)*Ro.x+2*(1-tr)*tr*Uo.x+pow(tr,2)*Go.x;let rr=pow(1-tr,2)*Ro.y+2*(1-tr)*tr*Uo.y+pow(tr,2)*Go.y;$o.push(createVector(or,rr).add(ir(b).mult(.2)))}Fl({pg:t,pts:$o,baseX:o,baseY:l,col:sr(p[0],p[1],p[2]*Xo,ko),bwF:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*m*_e,randomOffset:.3,forceBrush:1})}}else if(a[0]==13){for(let cr=1;cr<s.length;cr++){for(let pr=1;pr<a[1];pr++){let fr=pr/a[1];let dr=2*abs(cr/s.length-.5);let mr=p5.Vector.lerp(i[cr-1],s[cr-1],.1);let hr=p5.Vector.lerp(i[cr],s[cr],.1);let gr=p5.Vector.lerp(s[cr-1],c[cr-1],.8);let ur=p5.Vector.lerp(s[cr],c[cr],.8);let br=co.colors.flower[0][0];let xr=co.colors.flower[0][1];let yr=co.colors.flower[0][2]*.8;let Fr=lerp(0,1,dr);yl({pg:t,pts:[mr,hr,s[cr],s[cr-1]],baseX:o,baseY:l,col:sr(br,xr,yr,Fr*1),randomOffset:0,vertexMode:0});yl({pg:t,pts:[gr,ur,s[cr],s[cr-1]],baseX:o,baseY:l,col:sr(br,xr,yr,Fr*1),randomOffset:0,vertexMode:0})}}let lr=co.colors.branch[1][0];let nr=co.colors.branch[1][1];let ar=co.colors.branch[1][2]*.6;if(a[2]==0){for(let wr=2;wr<s.length-1;wr++){for(let Pr=1;Pr<3;Pr++){let Vr=Pr/3;let Tr=p5.Vector.lerp(i[wr-1],s[wr-1],Vr);let Cr=p5.Vector.lerp(i[wr],s[wr],Vr);let Er=p5.Vector.lerp(s[wr-1],c[wr-1],Vr);let Dr=p5.Vector.lerp(s[wr],c[wr],Vr);Fl({pg:t,pts:[Er.add(ir(b).mult(.4)),Dr.add(ir(b).mult(.1))],baseX:o,baseY:l,col:sr(lr,nr,ar,.5),bwF:e=>.5,randomOffset:.1,forceBrush:1});Fl({pg:t,pts:[Tr.add(ir(b).mult(.4)),Cr.add(ir(b).mult(.1))],baseX:o,baseY:l,col:sr(lr,nr,ar,.5),bwF:e=>.5,randomOffset:.1,forceBrush:1})}}}}}}class H{static fruitSeed(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,bRt:l=createVector(PI/2,0,0),bLe:n=500,bSg:a=30,bwF:s=e=>sin(e*PI)*20,col:i=[90,.2,.3],cFn:c=e=>e,bBF:p=e=>createVector(random(-10,10),0,random(-5,5)),pointShift:f=1.5,strokeNoiseScale:d=.2,strokeStrength:m=1}=e;let h=jo(ho);m=m+h.random(0,1)*2;f=10*Me;a=max(5,floor(a*ue));let g=createVector(0,0,0);let u=createVector(0,0,0);let b=[g.copy()];let x=[u.copy()];let y=[g.copy()];let F=[g.copy()];let w=e=>Ho.applyEulerRotation(e,l);let P=constrain(random(.6,1.2),.6,1);for(let e=0;e<a;e++){let l=e/(a-1);let f=p(l);u=p5.Vector.add(u,p5.Vector.mult(f,1/a));let d=Ho.applyEulerRotation(createVector(0,0,n/a),u);g=p5.Vector.add(g,w(d));let m=s(l);let h=Ho.applyEulerRotation(createVector(-m,0,0),u);let V=p5.Vector.add(g,w(h));let T=Ho.applyEulerRotation(createVector(m,0,0),u);let C=p5.Vector.add(g,w(T));if(e>0){let e=p5.Vector.sub(g,y[y.length-1]);let l=p5.Vector.sub(V,g);let n=p5.Vector.cross(e,l);let a=map(abs(n.angleBetween(createVector(0,1,0))),0,PI,1,0);a=c(a)||0;let s=or(i[0],i[0],a);let p=map(a,0,1,i[1],i[1]);let f=map(a,0,1,i[2],i[2]);s=i[0];p=i[1];f=i[2];yl({pg:t,pts:[V,y[y.length-2],b[b.length-2],g],baseX:o,baseY:r,doFill:true,doStr:false,col:sr(s,p,f,P),randomOffset:.1});yl({pg:t,pts:[C,F[F.length-2],b[b.length-2],g],baseX:o,baseY:r,doFill:true,doStr:false,col:sr(s,p,f,P),randomOffset:.1})}b.push(g.copy());x.push(u.copy());y.push(V.copy());F.push(C.copy())}if(Oe==0)i=co.colors.stroke[2];Fl({pg:t,pts:b.map((e=>{let t=map(noise(e.x*d,e.y*d),0,1,-f,f);let o=map(noise(e.y*d,e.x*d),0,1,-f,f);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(i[0],i[1],i[2]*.6,1),bwF:e=>(.4*(1-e)*map(noise(e*100),0,1,.1,1)+.4)*m*_e*random(.1,.2),randomOffset:.2});Fl({pg:t,pts:y.map((e=>{let t=map(noise(e.x*d,e.y*d),0,1,-f,f);let o=map(noise(e.y*d,e.x*d),0,1,-f,f);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(i[0],i[1],i[2]*.6,1),bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*m*_e*random(.5,1),randomOffset:.1});Fl({pg:t,pts:F.map((e=>{let t=map(noise(e.x*d,e.y*d),0,1,-f,f);let o=map(noise(e.y*d,e.x*d),0,1,-f,f);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(i[0],i[1],i[2]*.6,1),bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*m*_e*random(.5,1),randomOffset:.1});return b}static pinecone(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,bRt:l=createVector(0,0,0),col:n,PT:a}=e;let s=a.fruitSize*random(.6,1);let i=a.fruitColors["pinecone"][0];let c=a.fruitColors["pinecone"][1];let p=a.fruitColors["pinecone"][2];let f=int(a.layers*random(.5,1.2));let d=int(a.scalesPerLayer*random(.8,1.2));let m=a.coneHeight*random(.8,1.2);let h=a.coneRadius*random(.8,1.2);let g=createVector(random(-.3,.3)*PI+PI/2,random(1.8,1.95)*PI+PI/2,0);let u=s*random(.4,1);let b=M.stem({pg:t,baseX:o,baseY:r,bRt:g,bLe:u,col:io.branchColor,bwF:e=>1,bBF:e=>createVector(0,0,0)});let x=Vr();let y=random(.2,.6);for(let e=f-1;e>=0;e--){let l=(f-1-e)/(f-1);let n=exp(-pow((l-.5)*2,2)/3);let a=h*n;let u=a;let F=m*l-m*.9;let w=random(.8,1);for(let e=0;e<d;e++){let a=(e/d+l*.5)*TWO_PI;let f=s*y*n*random(.9,1.1);let m=createVector(u*cos(a),u*sin(a),F);let h=Ho.applyEulerRotation(m,g);let P=o+b.centerPos[b.centerPos.length-1].x+h.x;let V=r+b.centerPos[b.centerPos.length-1].y+h.y;let T=createVector(g.x,g.y,g.z+a);let C=x(l,w);H.fruitSeed({pg:t,baseX:P,baseY:V,bRt:T,bLe:f*.6,bwF:e=>f*.45*sin(e*PI),col:[i,c,p*random(.5,1),random(.8,1)],cFn:e=>e,strokeStrength:.4,bBF:e=>createVector(0,-C*(1-e),0)})}}}static drawFruit(e={}){let{pg:t=pgL3,baseX:o=0,baseY:l=0,type:n="pinecone",size:a=50,meta:s={},PT:i,branchEnd:c=createVector(o,l,0),currentWidth:p=1}=e;let f=c.x;let d=c.y;let m=p5.Vector.sub(createVector(f,d),createVector(o,l)).normalize();let h=atan2(m.y,m.x);if(r==2)ht=6;if(ht==0)n="pinecone";else if(ht==1)n="apple";else if(ht==2)n="raspberry";else if(ht==3)n="buddhahand";else if(ht==4)n="melon";else if(ht==5)n="melon";else if(ht==6)n="SP2Fruit";switch(n){case"pinecone":H.pinecone({pg:t,baseX:f,baseY:d,col:s.branchColor,bRt:createVector(0,0,h),PT:i});break;case"apple":let e=Zo([1,1,2,2,3,4]);if(i.appleSize<8)e=e*2;let r=PI/e;Be=[1,1];for(let o=0;o<e;o++){let e=random(1,2);let o=random(-PI/4,PI/4);let r=f+cos(h+o)*e;let l=d+sin(h+o)*e;let n=random(.8,1.2);let a=Zo([-1.5,1.5]);H.apple({pg:t,baseX:r,baseY:l,bRt:createVector(PI/2+n,a,n),PT:i,size:i.appleSize*random(.6,1.2),sLe:i.fruitstem})}break;case"raspberry":let a=1.5;if(p>=a){H.raspberry({pg:t,baseX:f,baseY:d,bRt:createVector(0,0,h),PT:i,size:i.raspberrySize,sLe:i.fruitstem})}break;case"buddhahand":let c={branchColor:i.colors.branch[0],flowerColorA:i.colors.fruit[2],flowerPetal:Zo([5,7,9]),flowerLengthA:i.flowerLengthA*random(.8,1),flowerWidthA:i.flowerWidthA*random(.8,1),flowerLengthC:i.flowerLengthC,fSh:e=>e>.5?1-e+.1:.4,petalfType:[5,2],bBF:e=>{let t=5;let o=Zo([1,-1]);return createVector(sin(e*PI)*t*o,cos(e*PI)*.5,sin(e*PI*2)*2)}};_.drawFlowerB({pg:t,baseX:f,baseY:d,direction:createVector(random(-1,1),random(-1,1),0),rot:random(0,TWO_PI),op:.95,meta:c});break;case"melon":let m=1;let g=PI/m;Be=[1,1];let u;if(ht==4)u=i.melonSize*random(.6,1.2),m=Qo(2,5);else if(ht==5)u=i.melonSize*3*random(.6,1.2),m=1;let b=random(0,1)>.8?-1:0;for(let e=0;e<m;e++){let e=random(1,2);let o=random(-PI/4,PI/4);o=0;let r=f+cos(h+o)*e;let l=d+sin(h+o)*e;let n=random(0,1)>.3?random(.5,.8):random(-.9,-.4);let a=random(-.3,.3);H.melon({pg:t,baseX:r,baseY:l,bRt:createVector(n,a,b),PT:i,size:u,length:u*random(.8,1.2),sLe:i.fruitstem})}break;case"SP2Fruit":let x=createVector(0,1,Zo([-1,1]));{let e={branchColor:i.colors.branch[0],flowerColorA:[i.colors.flower[0][0],i.colors.flower[0][1],Number(i.colors.flower[0][2])*random(.8,1.1)],flowerColorB:[random(45,65),random(.8,1),random(.8,1)],flowerPetal:12,flowerLengthA:110*random(.9,1.1),flowerWidthA:9*random(.6,1.2),flowerLengthC:30*random(.8,1.2),fSh:e=>{if(e<.4)return map(e,0,.5,.8,1);else if(e>=.4&&e<.6)return map(e,.4,.6,1,.5);else return map(e,.6,1,.5,.2)},petalfType:[13,2,0],spType:1};_.drawFlowerG({pg:pgL0,baseX:o,baseY:l,direction:x,op:1,meta:e,doFruit:random(0,1)<.5?1:0})}break;default:console.warn("Unknown fruit type:",n);break}}static apple(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,bRt:l=createVector(0,0,0),PT:n,size:a=20,sLe:s=30,pointShift:i=.01,strokeStrength:c=1,strokeNoiseScale:p=.1}=e;let f=jo(ho);c=c+f.random(0,1)*2;i=i*Me;let d={base:{hue:n.colors.fruit[1][0],saturation:n.colors.fruit[1][1],brightness:n.colors.fruit[1][2]}};let m=[Number(d.base.hue)+er(-20,20),Number(d.base.saturation)+er(-.1,.1),Number(d.base.brightness)+er(-.1,.1),1];let h={pg:t,baseX:o,baseY:r,bRt:l,bLe:s*random(2,5),col:io.branchColor,bBF:e=>createVector(random(1,2),random(1,2),0),bwF:e=>1,strokeStrength:1};let g=M.stem(h);let u=g.centerPos[g.centerPos.length-1];let b=p5.Vector.sub(g.centerPos[g.centerPos.length-1],g.centerPos[g.centerPos.length-2]).normalize();let x=20;let y={pg:t,baseX:u.x+o,baseY:u.y+r,bRt:l,bLe:x,col:io.branchColor,bBF:e=>createVector(1,0,0),bwF:e=>3,strokeStrength:1};let F=M.stem(y);let w=F.centerPos[round(F.centerPos.length/2)];let P=u.x+w.x+o;let V=u.y+w.y+r;u=w;let T=p5.Vector.cross(createVector(0,-1,0),b);let C=Ho.angle(createVector(0,-1,0),b);let E=e=>{let t=createVector(e.x,e.y-a,e.z);let o=T.mag()>.001?Ho.rotateVectorAroundAxis(t,T,C):t.copy();return createVector(o.x+P,o.y+V,o.z)};let D=40;let A=[];for(let e=0;e<=D;e++){let t=e/D;let o=-a*(2*t-1);A.push(createVector(0,o))}let S=e=>{let t=2*e-1;return a*sqrt(1-pow(t,2))};let[I,L]=bl({pts:A,bwF:S});function B(e,o){const r=A.length-1;const l=v-1;const n=e/r;const a=o/l;const s=(o+1)/l;const i={Pos0_0:p5.Vector.lerp(I[e],L[e],a),Pos0_1:p5.Vector.lerp(I[e+1],L[e+1],a),Pos1_0:p5.Vector.lerp(I[e],L[e],s),Pos1_1:p5.Vector.lerp(I[e+1],L[e+1],s)};let c=sin(s*PI)*n;c+=map(noise(s*20,n*20),0,1,.2,.5);const p={h:or(m[0],m[0],c),s:lerp(m[1],m[1],c),b:lerp(m[2],m[2]*.7,c),a:lerp(m[3],m[3]*.8,c)};yl({pg:t,pts:[i.Pos0_0,i.Pos0_1,i.Pos1_1,i.Pos1_0].map(E),doFill:true,col:sr(p.h,p.s,p.b,p.a),randomOffset:.5})}const v=8;const k=A.length-1;const X=v-1;for(let e=0;e<k;e++){for(let t=0;t<X;t++){B(e,t)}}let Y=co.colors.stroke[0];if(Oe==0)Y=co.colors.stroke[2];let z=(e,o=1.2)=>{Fl({pg:t,pts:e.map((e=>{let t=map(noise(e.x*p,e.y*p),0,1,-i,i);let o=map(noise(e.y*p,e.x*p),0,1,-i,i);let r=E(e);return createVector(r.x+t,r.y+o)})),baseX:0,baseY:0,col:sr(Y[0],Y[1],Y[2],1),randomOffset:0,bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*c*_e})};z(I);z(L);let O=(e,o,r=10,l=1.1)=>{let n=[];for(let t=0;t<=r;t++){let l=t/r;n.push(p5.Vector.lerp(e,o,l))}Fl({pg:t,pts:n.map(E),baseX:0,baseY:0,col:sr(m[0],m[1],m[2]*l,1),randomOffset:0,bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*c*_e})};O(I[0],L[0],10,1.1);O(I[I.length-1],L[L.length-1],10,1.2);let R=floor(random(2,4));for(let e=0;e<R;e++){let e=Zo([-1,1]);let o=e*random(1,2);o=e*o;let r=createVector(l.x+random(1,2),l.y+o,1);r=createVector(l.x+3,l.y+o,1);let s={leafLength:a*random(1,2),leafWidth:a,color:[n.colors.leaf[0][0],n.colors.leaf[0][1],n.colors.leaf[0][2],1]};N.leaf({pg:t,baseX:P,baseY:V,bRt:r,bLe:s.leafLength,pointShift:.2,strokeNoiseScale:.05,strokeStrength:.2,bwF:e=>sin(e*PI)*s.leafWidth*.5,bBF:e=>createVector(random(-2,2),random(-1,1),0),col:n.colors.leaf[1],strokeType:1})}return{center:u,size:a,rotation:l}}static raspberry(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,bRt:l=createVector(0,0,0),PT:n,size:a=15,sLe:s=30,drupeletCount:i=Qo(5,15),layer:c=Qo(3,10)}=e;let p=M.stem({pg:t,baseX:o,baseY:r,bRt:l,bLe:s,col:io.branchColor,bBF:e=>createVector(random(-.5,.5),random(-.5,.5),0),bwF:e=>.8,strokeStrength:0});let f=p.centerPos[p.centerPos.length-1];let d=p5.Vector.sub(p.centerPos[p.centerPos.length-1],p.centerPos[p.centerPos.length-2]).normalize();let m=p5.Vector.cross(createVector(0,-1,0),d);let h=Ho.angle(createVector(0,-1,0),d);let g=e=>{let t=m.mag()>.001?Ho.rotateVectorAroundAxis(e,m,h):e.copy();return createVector(t.x+f.x+o,t.y+f.y+r,t.z)};let u=[];for(let e=0;e<i;e++){let t=1-e/(i-1)*2;let o=sqrt(1-t*t);let r=PI*2*e*(3-sqrt(5));let l=cos(r)*o;let n=sin(r)*o;let s=a*he;let c=1.2*(random(random(0,1))+.2);let p=createVector(l*s*c,t*s*c,n*s*c);u.push(p)}u.forEach((e=>{let t=e.mag()/a;let o=he*a*random(.2,.4)*(1-.2*t);let r=g(e);let l=e.copy().normalize();H.drawGradientFlowerCenter(r.x,r.y,o,l,c)}));return{center:f,size:a,rotation:l}}static drawGradientFlowerCenter(e,t,o,r,l=8){let n=2;let a=3;let s=jo(ho);a=a+s.random(0,1)*2;n=10*Me;let i=Ho.vectorToEulerAngles(r);let c=l;let p=16;let f=[];for(let r=0;r<c;r++){let l=o*(1-r/c);let n=o*(1-(r+1)/c);let a=[];let s=[];for(let e=0;e<=p;e++){let t=e/p*TWO_PI;let o=createVector(cos(t)*l,sin(t)*l,0);let c=createVector(cos(t)*n,sin(t)*n,0);o=Ho.applyEulerRotation(o,i);c=Ho.applyEulerRotation(c,i);a.push(o);s.push(c);if(r===0){f.push(o.copy())}}let d=random(.9,1);let m=random(0,.2);for(let o=0;o<p;o++){let l=r/(c-1);let n=lerp(co.colors.fruit[2][0],co.colors.fruit[2][0],l);let i=lerp(m,co.colors.fruit[2][1],l);let p=lerp(d,co.colors.fruit[2][2],l);yl({pg:pgL4,pts:[a[o],a[o+1],s[o+1],s[o]],baseX:e,baseY:t,doFill:true,doStr:false,col:sr(n,i,p,1),randomOffset:.5})}}let d=co.colors.stroke[0];if(Oe==0)d=co.colors.stroke[2];let m=co.colors.fruit[1];Fl({pg:pgL4,pts:f.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-n,n);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-n,n);return createVector(e.x+t,e.y+o)})),baseX:e,baseY:t,col:sr(d[0],d[1],d[2],1),bwF:e=>(.3*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*a*_e*random(.3,.5)});let h=o*.2;let g=[];for(let e=0;e<=p;e++){let t=e/p*TWO_PI;let o=createVector(cos(t)*h,sin(t)*h,0);o=Ho.applyEulerRotation(o,i);g.push(o)}Fl({pg:pgL4,pts:g.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-n,n);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-n,n);return createVector(e.x+t,e.y+o)})),baseX:e,baseY:t,col:sr(m[0],m[1],m[2],1),bwF:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*a*_e*random(.3,.5)})}static addFruit(e,t,o,r){let l=o.PT.lastFruitPos||{x:-Infinity,y:-Infinity};let n={x:e,y:t};let a=50;let s=dist(n.x,n.y,l.x,l.y);if(s>a){let e=Zo(o.PT.fruitTypes);let t=o.PT.fruitColors[e];H.drawFruit({pg:pgL2,id:o.fruitCount,baseX:n.x,baseY:n.y,type:e,col:t,PT:o.PT,currentWidth:r});o.PT.fruitCount++;o.PT.lastFruitPos=n;return true}}static melon(e={}){let{pg:t=pgL3,baseX:o=0,baseY:l=0,bRt:n=createVector(0,0,0),PT:a,size:s=20,length:length=40,sLe:i=30,pointShift:c=.01,strokeStrength:p=1,strokeNoiseScale:f=.1,bLe:d=50,sBn:m}=e;let h=jo(ho);p=p+h.random(0,1)*2;c=c*Me;let g={base:{hue:a.colors.fruit[1][0],saturation:a.colors.fruit[1][1],brightness:a.colors.fruit[1][2]}};let u=[Number(g.base.hue)+er(-20,20),Number(g.base.saturation)+er(-.1,.1),Number(g.base.brightness)+er(-.1,.1),1];m=m||createVector(h.random(1,2),h.random(1,2),0);let b={pg:t,baseX:o,baseY:l,bRt:n,bLe:d,col:sr(0,0,0,.8),bBF:e=>m,bwF:e=>2,strokeStrength:1};let x=M.stem(b);let y=x.centerPos[x.centerPos.length-1];let F=p5.Vector.sub(x.centerPos[x.centerPos.length-1],x.centerPos[x.centerPos.length-2]).normalize();let w=y.x+o;let P=y.y+l;let V=p5.Vector.cross(createVector(0,-1,0),F);let T=Ho.angle(createVector(0,-1,0),F);let C=e=>{let t=createVector(e.x,e.y-length*2.3,e.z);let o=V.mag()>.001?Ho.rotateVectorAroundAxis(t,V,T):t.copy();return createVector(o.x+w,o.y+P,o.z)};let E=40;let D=[];let A=Zo([0,2,4,8,-2,-4,-8]);if(r==2)A=0;for(let e=0;e<=E;e++){let t=e/E;let o=-length*2.5*(2*t-1);let r=A*sin(t*PI);D.push(createVector(r,o))}let S=(e,t,o,r=false)=>{let l=4*e-1;if(ht==6)l=2*e-1;let n=s*.3*sqrt(1-pow(l,2));let a=t+1e3;let i=t+2e3;let c=r?a:i;let p=noise(e*1+c)*.2+h.random(-.03,.03);let f=sin(e*(o+(r?2:-2)))*.1;let d=noise(e*3+c)*.1;return n*(1+p+f+d)};let I=h.random(1,2);let L=qo(h,6,12);let[B,v]=bl({pts:D,bwF:e=>S(e,I,L,true)});let k=Qo(10,16);let X=co.colors.branch[0].map(Number);let Y=co.colors.flower[0].map(Number);function z(e,o){const l=D.length-1;const n=k-1;const a=e/l;const s=o/n;const i=(o+1)/n;const c={Pos0_0:p5.Vector.lerp(B[e],v[e],s),Pos0_1:p5.Vector.lerp(B[e+1],v[e+1],s),Pos1_0:p5.Vector.lerp(B[e],v[e],i),Pos1_1:p5.Vector.lerp(B[e+1],v[e+1],i)};let p=1-lerp(sin(i*PI)*a,a,a);p+=map(noise(i*20,a*20),0,1,.2,.5);const f=sin(i*PI*8)>0?1:.95;const d=pow(p,2.5);const m=1-d*.4;let h;if(r===2){const e=1-p;h={h:or(X[0],Y[0],e),s:lerp(X[1],Y[1],e),b:lerp(X[2],Y[2],e)*m,a:1}}else{h={h:or(u[0],u[0],p),s:lerp(u[1],u[1]*.9,p),b:lerp(u[2],u[2],p)*m*(f*.3+.7),a:lerp(u[3],u[3],p)}}yl({pg:t,pts:[c.Pos0_0,c.Pos0_1,c.Pos1_1,c.Pos1_0].map(C),doFill:true,col:sr(h.h,h.s,h.b,h.a),randomOffset:.3})}const O=D.length-1;const R=k-1;for(let e=0;e<O;e++){for(let t=0;t<R;t++){z(e,t)}}let W=qo(h,100,200);let _=sr(u[0],u[1]*.5,u[2]*1.2,.5);if(ht==6){for(let e=2;e<D.length-1;e++){let o=B[e];let r=v[e];let l=D[e];let n=floor(W/(D.length-3));for(let e=0;e<n;e++){let e=h.random(0,h.random(0,1));e=map(e,0,1,.2,.8);let n;if(random(0,1)<.5){n=p5.Vector.lerp(o,l,e)}else{n=p5.Vector.lerp(l,r,e)}n.add(ir(h).mult(random(.2,.8)));let a=h.random(0,1)<.95?h.random(1,1.5):2.5;a=a*1.2;let s=color(_);t.push();t.noStroke();s.setAlpha(h.random(.1,.4));t.fill(s);let i=C(n);t.ellipse(i.x,i.y,a,a);t.pop()}}}let N=co.colors.stroke[0];if(Oe==0)N=co.colors.stroke[2];let H=(e,o=1.2)=>{Fl({pg:t,pts:e.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-c,c);let o=map(noise(e.y*f,e.x*f),0,1,-c,c);let r=C(e);return createVector(r.x+t,r.y+o)})),baseX:0,baseY:0,col:sr(N[0],N[1],N[2],1),randomOffset:0,bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*p*_e})};H(B);H(v);return{center:y,size:s,rotation:n}}}const G={hash:"0x4b51b42657b225bafe8505090afc97a285acb81f4d308495f242d5f9cde9b138",editionNumber:1,totalEditions:0,input:{path:"#data_BAN801Y7VTsEhdt5FHgTeRQDk9GDK4IqBKDijx2OHI8dBVLTd7WHxprBtdU="}};function U(){const e=new URLSearchParams(window.location.search);if(window.location.hash){const hash=window.location.hash;const t=hash.indexOf("?");if(t!==-1){const o=new URLSearchParams(hash.slice(t+1));for(const[key,t]of o.entries()){if(!e.has(key)){e.append(key,t)}}}}return e}const $=U();let j=G;let q=false;try{const rn=$.get("payload");if(rn){q=true;const ln=atob(rn);const nn=JSON.parse(ln);if(nn&&typeof nn==="object"){j=nn}}}catch(an){console.error("Payload 解析错误:",an)}var hash=j.hash||G.hash;var J=j.editionNumber??G.editionNumber;var K=j.totalEditions??G.totalEditions;window.pathData=j.input&&j.input.path?j.input.path:window.location.hash||G.input.path;if(q){console.log("hash:"+hash);console.log("editionNumber:"+J);console.log("totalEditions:"+K);console.log("pathData:"+pathData)}else{console.log("d:hash:"+hash);console.log("d:editionNumber:"+J);console.log("d:totalEditions:"+K);console.log("d:pathData:"+pathData)}const Q=function(e){var t,o,r,l,n=function e(t){for(var o=0,r=1779033703^t.length;o<t.length;o++)r=(r=Math.imul(r^t.charCodeAt(o),3432918353))<<13|r>>>19;return function(){return r=Math.imul((r=Math.imul(r^r>>>16,2246822507))^r>>>13,3266489909),(r^=r>>>16)>>>0}}(e),a={rand:(t=n(),o=n(),r=n(),l=n(),function(){r|=0;var e=((t|=0)+(o|=0)|0)+(l|=0)|0;return l=l+1|0,t=o^o>>>9,o=r+(r<<3)|0,r=(r=r<<21|r>>>11)+e|0,(e>>>0)/4294967296}),randInt:function(e,t){return e+Math.floor((t-e)*a.rand())}};return a};window.debugForceRandomSeed=false;const Z=Q(hash);let ee;let te=localStorage.getItem("debugForceRandomSeed")==="1";if(te){ee=Math.floor(Math.random()*(9e8-1e8))+1e8;console.log("[DEBUG] hashSeed:",ee);localStorage.removeItem("debugForceRandomSeed")}else{ee=Z.randInt(1e8,9e8);console.log("hash2Seed:"+ee)}function oe(){var e=navigator.userAgent||navigator.vendor||window.opera;if(/Mac/i.test(e)){specialAlpha=.8;return"Mac"}else if(/Win/i.test(e)){specialAlpha=.2;return"PC"}else{return"Unknown"}}var re=oe();window.isMachine=$.get("machine")!==null;window.hires=$.get("hires")!==null;console.log("isMachine:"+window.isMachine);console.log("hires:"+window.hires);function le(){dispatchEvent(new Event("capture-preview"));console.info("");console.info("###verse-preview-capture")}function ne(e="myCanvas"){const t=document.getElementById(e);if(!t){console.warn("Canvas not found:",e);return}const o=t.toDataURL("image/png");window.$artifact={preview:o};dispatchEvent(new Event("capture-preview"));console.info("###verse-preview-capture")}window.capturePreviewFromVerse=ne;let ae=0,se=0,ie=30,ce;let pe=false,fe=false;let de=.3,me=.7,he=0,ge=1;let ue=1,be=.1;let xe=1.2,ye=1,Fe={};let we,Pe;let Ve=0,Te=0,Ce=0,Ee;let De={x:0,y:0,height:0};let Ae=0,Se=0;let Ie=[],Le=0,Be=[1,1];let ve=0,ke=0;let Xe=1,Ye=1,ze=1,Oe=1;let Re=1,We=0;let _e=0,Me,Ne;let He=0,Ge=0;let Ue=0;let $e=[1,1,1];let je=[1,1,1];let qe,Je,Ke=0,Qe;let Ze={pgL0:null,pgL1:null,pgL15:null,pgL2:null,pgL3:null,pgL4:null,pgText:null,pgTex:null,pgFinal:null,snapShotImg:null,pgFrame:null,pgVerse:null};let et,tt;let ot,rt,lt,nt,at,st,it,ct,pt,ft;let dt,mt;let ht=1,gt=3;let ut=0,bt;let xt=false;let yt,Ft,wt=0;let Pt=0,Vt,Tt;let Ct=0,Et=0;let Dt=0;let At=0,St=0;let It=0,Lt=0;let Bt=0,vt=0;let kt=0,Xt=true;let Yt=0;let zt="";let Ot;let Rt=.001,Wt=.01;let _t=0,Mt=false;const Nt=1e3;let Ht=[],Gt=[],Ut=[];let $t=[],jt=[];let qt=new Set;let Jt=0,Kt=0;let Qt,Zt,eo=0;let to=.995,oo=.995,ro=.995;let lo=1,no=.9,ao=.1;let so="A";let io={},co={},po={},fo={},mo={};let ho;let go,uo,bo,xo;let yo=null,Fo="#";let wo=0,Po=0;let Vo=0;let To=new URLSearchParams(window.location.search);let Co=To.has("paperType")?parseInt(To.get("paperType")):null;let Eo=/^\?\d+/.test(window.location.search);let Do={},Ao;const So={0:{colors:{vine:[lr("#F6F5F9")],fruit:[lr("#CD8A6F"),lr("#E3AA5F"),lr("#EAB29B")],flower:[lr("#A75065"),lr("#F6F5F9")],leaf:[lr("#677079"),lr("#FFE7F6")],branch:[lr("#444440"),lr("#BF8463"),lr("#9A6A4F")],grass:[lr("#335D80")],mushroom:[lr("#DED5C6"),lr("#C5885F"),lr("#E3D65F"),lr("#FAFEFF"),lr("#856F5F"),lr("#A75065")],butterfly:[lr("#FAFEFF"),lr("#DFD25C")],stone:[lr("#67645F")],bg:[lr("#DED5C6")],stroke:[lr("#434240"),lr("#CD8A6F"),lr("#DED5C6")]}},1:{colors:{vine:[lr("#FEFFFD")],fruit:[lr("#94342A"),lr("#BFAF94"),lr("#DFD25C")],flower:[lr("#FAFEFF"),lr("#BFAF94")],leaf:[lr("#B93737"),lr("#FAFEFF")],branch:[lr("#604726"),lr("#FAFEFF"),lr("#1E414E")],grass:[lr("#3E322F")],mushroom:[lr("#FAFEFF"),lr("#FEFFFD"),lr("#DFD25C"),lr("#688CE3"),lr("#DFAC5C"),lr("#FAFEFF")],butterfly:[lr("#DFD25C"),lr("#FAFEFF")],stone:[lr("#2C4F58")],bg:[lr("#BFAF94")],stroke:[lr("#5B5B5B"),lr("#688CE3"),lr("#DFAC5C")]}},2:{colors:{vine:[lr("#FEFFFD")],fruit:[lr("#95AADE"),lr("#C8C9BB"),lr("#4761A0")],flower:[lr("#E89B65"),lr("#D87D5D")],leaf:[lr("#63AEA1"),lr("#B7D1A9")],branch:[lr("#FEFFFD"),lr("#B7D1A9"),lr("#94B08A")],grass:[lr("#B7D1A9")],mushroom:[lr("#FEFFFD"),lr("#E89B65"),lr("#B7D1A9"),lr("#B7D1A9"),lr("#63AEA1"),lr("#63AEA1")],butterfly:[lr("#63AEA1"),lr("#B7D1A9")],stone:[lr("#63AEA1")],bg:[lr("#CCC6B3")],stroke:[lr("#373733"),lr("#8D4D21"),lr("#F8C32B")]}},3:{colors:{vine:[lr("#708075")],fruit:[lr("#3F4A45"),lr("#708075"),lr("#FAD2A8")],flower:[lr("#FAC9C4"),lr("#FDFDEB")],leaf:[lr("#718175"),lr("#474F52")],branch:[lr("#B3B0A8"),lr("#E5E1D5"),lr("#B3B0A8")],grass:[lr("#A89C69")],mushroom:[lr("#FDFDEB"),lr("#E5E1D5"),lr("#FAC9C4"),lr("#E5E1D5"),lr("#6E7850"),lr("#E5E1D5")],butterfly:[lr("#597356"),lr("#597356")],stone:[lr("#858179")],bg:[lr("#D1CDC2")],stroke:[lr("#514D45"),lr("#FAC9C4"),lr("#4C5752")]}},4:{colors:{vine:[lr("#396782")],fruit:[lr("#D2D2E1"),lr("#CB97B0"),lr("#FCC911")],flower:[lr("#FDFDEB"),lr("#FBE282")],leaf:[lr("#89A9AD"),lr("#D6D494")],branch:[lr("#D2C09C"),lr("#FDF8C2"),lr("#C2B08A")],grass:[lr("#BCD0D0")],mushroom:[lr("#FDFDEB"),lr("#F7E39D"),lr("#F4E972"),lr("#FBF8F4"),lr("#AF7FAB"),lr("#DEC9DC")],butterfly:[lr("#FBE282"),lr("#EFC09E")],stone:[lr("##858179")],bg:[lr("#FFFCD8")],stroke:[lr("#5F4C26"),lr("#396782"),lr("#D2C09C")]}},5:{colors:{vine:[lr("#394D4B")],fruit:[lr("#BA6E50"),lr("#3A5856"),lr("#E9DEC6")],flower:[lr("#FFFDFF"),lr("#3A5856")],leaf:[lr("#394D4B"),lr("#B6866B")],branch:[lr("#A58F75"),lr("#F8F6F7"),lr("#8C7A65")],grass:[lr("#D7745A")],mushroom:[lr("#E9DEC6"),lr("#D7745A"),lr("#DEDCDD"),lr("#3A5856"),lr("#A58F75"),lr("#30312C")],butterfly:[lr("#FCBFD5"),lr("#D1A4D8")],stone:[lr("#937C63")],bg:[lr("#DEDCDD")],stroke:[lr("#271F18"),lr("#D7745A"),lr("#A58F75")]}},6:{colors:{vine:[lr("#090607")],fruit:[lr("#5578B2"),lr("#F4BFAA"),lr("#9A3724")],flower:[lr("#FCF0E1"),lr("#F07E56")],leaf:[lr("#A9A589"),lr("#D2B26E")],branch:[lr("#DADCD0"),lr("#625135"),lr("#EBD8A4")],grass:[lr("#3D271F")],mushroom:[lr("#5578B2"),lr("#FFF1B4"),lr("#F4BFAA"),lr("#625135"),lr("#F4BFAA"),lr("#F8F6F7")],butterfly:[lr("#898773"),lr("#D2B26E")],stone:[lr("#7A6952")],bg:[lr("#A79470")],stroke:[lr("#080807"),lr("#F8F6F7"),lr("#CA4F28")]}},7:{colors:{vine:[lr("#5A5B3F")],fruit:[lr("#C4A498"),lr("#99794C"),lr("#6D8D29")],flower:[lr("#EFEDEB"),lr("#F8C32B")],leaf:[lr("#7E7F49"),lr("#F6F7E5")],branch:[lr("#2C1C05"),lr("#E67A29"),lr("#677348")],grass:[lr("#9B9968")],mushroom:[lr("#F1F2E0"),lr("#A8A99B"),lr("#545146"),lr("#E1E2D1"),lr("#545146"),lr("#E1E2D1")],butterfly:[lr("#727BB4"),lr("#F4F3F2")],stone:[lr("#664822")],bg:[lr("#D8CFC2")],stroke:[lr("#393519"),lr("#677348"),lr("#E5DDCF")]}},8:{colors:{vine:[lr("#82955C")],fruit:[lr("#FCC911"),lr("#DC5B55"),lr("#F1F2E0")],flower:[lr("#F6F7E5"),lr("#F7B515")],leaf:[lr("#C5B26E"),lr("#231716")],branch:[lr("#B96942"),lr("#F7B515"),lr("#A15A3A")],grass:[lr("#6D7C51")],mushroom:[lr("#F1F2E0"),lr("#DC5B55"),lr("#F1F2E0"),lr("#C5B26E"),lr("#F1F2E0"),lr("#82955C")],butterfly:[lr("#FA74B2"),lr("#5FAAA6")],stone:[lr("#545146")],bg:[lr("#F2DDB4")],stroke:[lr("#465753"),lr("#F7B515"),lr("#B96942")]}},9:{colors:{vine:[lr("#E6DBC4")],fruit:[lr("#36342E"),lr("#F6F7E5"),lr("#E6DBC4")],flower:[lr("#F6F7E5"),lr("#E6DBC4")],leaf:[lr("#E6DBC4"),lr("#E6DBC4")],branch:[lr("#CE5C6B"),lr("#E9DEC6"),lr("#403737")],grass:[lr("#403737")],mushroom:[lr("#F6F7E5"),lr("#E6DBC4"),lr("#F6F7E5"),lr("#E6DBC4"),lr("#F6F7E5"),lr("#E6DBC4")],butterfly:[lr("#FFFFFF"),lr("#F1F2E0")],stone:[lr("#FFFFFF")],bg:[lr("#E6DBC4")],stroke:[lr("#36342E"),lr("#36342E"),lr("#CE5C6B")]}},10:{colors:{vine:[lr("#ECBDC0")],fruit:[lr("#DEA643"),lr("#ECBDC0"),lr("#8A8FC6")],flower:[lr("#FDF7F0"),lr("#FDF7F0")],leaf:[lr("#899BB3"),lr("#A3A776")],branch:[lr("#A3A776"),lr("#F8E1AE"),lr("#8C7A65")],grass:[lr("#5E8262")],mushroom:[lr("#FDF7F0"),lr("#D1BC63"),lr("#F1F2E0"),lr("#D1BC63"),lr("#F1F2E0"),lr("#D1BC63")],butterfly:[lr("#FFFFFF"),lr("#D1BC63")],stone:[lr("#FDF7F0")],bg:[lr("#FDF7F0")],stroke:[lr("#414141"),lr("#8A8FC6"),lr("#D1BC63")]}},11:{colors:{vine:[lr("#FDF8EA")],fruit:[lr("#C2B08A"),lr("#8F3F34"),lr("#8F3F34")],flower:[lr("#E7DED3"),lr("#FFFBF7")],leaf:[lr("#6B716D"),lr("#A3A776")],branch:[lr("#45311C"),lr("#E9DEC6"),lr("#C2B08A")],grass:[lr("#BB9F97")],mushroom:[lr("#F1F2E0"),lr("#C2B08A"),lr("#F1F2E0"),lr("#A3A776"),lr("#5B76A8"),lr("#8F3F34")],butterfly:[lr("#7E887F"),lr("#5B76A8")],stone:[lr("#FDF7F0")],bg:[lr("#A6AEA8")],stroke:[lr("#565656"),lr("#D1CBCB"),lr("#E1D7CB")]}},12:{colors:{vine:[lr("#7B5226")],fruit:[lr("#E3DFC5"),lr("#DCAAA9"),lr("#D8A296")],flower:[lr("#D8A296"),lr("#F2D5B7")],leaf:[lr("#202427"),lr("#202427")],branch:[lr("#2E3137"),lr("#EBE6D9"),lr("#B3A8A1")],grass:[lr("#D89088")],mushroom:[lr("#EBE6D9"),lr("#D89088"),lr("#F1F2E0"),lr("#7B5226"),lr("#DCD7C0"),lr("#BAB2B6")],butterfly:[lr("#DCD7C0"),lr("#484148")],stone:[lr("#2E3137")],bg:[lr("#E3DFC5")],stroke:[lr("#000000"),lr("#D89088"),lr("#F2D5B7")]}},13:{colors:{vine:[lr("#8BA780")],fruit:[lr("#F2F2E6"),lr("#A94E5C"),lr("#985562")],flower:[lr("#FFFFFF"),lr("#57896E")],leaf:[lr("#708F68"),lr("#F2F2E6")],branch:[lr("#F2F2E6"),lr("#8BA780"),lr("#6E8A6A")],grass:[lr("#412F2B")],mushroom:[lr("#F2F2E6"),lr("#E8E9D5"),lr("#FFFFFF"),lr("#CAD6BC"),lr("#F2F2E6"),lr("#CAD6BC")],butterfly:[lr("#232F20"),lr("#F2F2E6")],stone:[lr("#F2F2E6")],bg:[lr("#E8E9D5")],stroke:[lr("#4E4E4E"),lr("#A94E5C"),lr("#F8C32B")]}},14:{colors:{vine:[lr("#FEFDF9")],fruit:[lr("#9EB745"),lr("#8F6C37"),lr("#EEE3C8")],flower:[lr("#FFFFFF"),lr("#6E8A6A")],leaf:[lr("#6E8A6A"),lr("#EEE3C8")],branch:[lr("#262710"),lr("#5E5F5A"),lr("#8A806A")],grass:[lr("#47872B")],mushroom:[lr("#F2F2E6"),lr("#6B6858"),lr("#34302A"),lr("#EEE3C8"),lr("#B89340"),lr("#6E8A6A")],butterfly:[lr("#232F20"),lr("#F2F2E6")],stone:[lr("#6B6858")],bg:[lr("#EEE3C8")],stroke:[lr("#34302A"),lr("#B89340"),lr("#E1CA96")]}},15:{colors:{vine:[lr("#E8E3D5")],fruit:[lr("#302D00"),lr("#8A8371"),lr("#B05D1F")],flower:[lr("#E4D077"),lr("#302D00")],leaf:[lr("#74727B"),lr("#E8E3D5")],branch:[lr("#E8E3D5"),lr("#E8E3D5"),lr("#E8E3D5")],grass:[lr("#E4D077")],mushroom:[lr("#EFE4C4"),lr("#E8E3D5"),lr("#EFE4C4"),lr("#E8E3D5"),lr("#EFE4C4"),lr("#E8E3D5")],butterfly:[lr("#E8E3D5"),lr("#E8E3D5")],stone:[lr("#E8E3D5")],bg:[lr("#E8E3D5")],stroke:[lr("#080807"),lr("#73C3EC"),lr("#C44287")]}},16:{colors:{vine:[lr("#1F1200")],fruit:[lr("#425C7C"),lr("#8A8371"),lr("#7B5469")],flower:[lr("#9C8895"),lr("#506066")],leaf:[lr("#E4D2BE"),lr("#EFE4C4")],branch:[lr("#B39C86"),lr("#E4D2BE"),lr("#293B4A")],grass:[lr("#5A4C3A")],mushroom:[lr("#EFE4C4"),lr("#E4D2BE"),lr("#EFE4C4"),lr("#E4D2BE"),lr("#EFE4C4"),lr("#E4D2BE")],butterfly:[lr("#506066"),lr("#EFE4C4")],stone:[lr("#E4D2BE")],bg:[lr("#EFE4C4")],stroke:[lr("#1F1200"),lr("#FEFDF9"),lr("#293B4A")]}},17:{colors:{vine:[lr("#A9493E")],fruit:[lr("#C49852"),lr("#A9493E"),lr("#E8B05E")],flower:[lr("#D7B170"),lr("#5D8A66")],leaf:[lr("#FDFDEB"),lr("#D6D494")],branch:[lr("#077B8C"),lr("#C8785F"),lr("#A9493E")],grass:[lr("#BCBFD0")],mushroom:[lr("#FDFDEB"),lr("#C49852"),lr("#D7B170"),lr("#A9493E"),lr("#C2B08A"),lr("#537477")],butterfly:[lr("#A9493E"),lr("#CCA981")],stone:[lr("##858179")],bg:[lr("#EDCFB7")],stroke:[lr("#32321F"),lr("#396782"),lr("#D2C09C")]}},18:{colors:{vine:[lr("#512A0F")],fruit:[lr("#355189"),lr("#EAEEE9"),lr("#5A8874")],flower:[lr("#A1351C"),lr("#FFC4C4")],leaf:[lr("#625642"),lr("#D6D494")],branch:[lr("#A2917C"),lr("#56846C"),lr("#63BBB9")],grass:[lr("#5A8874")],mushroom:[lr("#FDFDEB"),lr("#63BBB9"),lr("#FFAD4C"),lr("#DD4537"),lr("#C2B08A"),lr("#537477")],butterfly:[lr("#253437"),lr("#FEF8EB")],stone:[lr("##FEF8EB")],bg:[lr("#BD9E67")],stroke:[lr("#150B0B"),lr("#396782"),lr("#D2C09C")]}},19:{colors:{vine:[lr("#B5A4A0")],fruit:[lr("#5C3A15"),lr("#658072"),lr("#1A1874")],flower:[lr("#DCB5B5"),lr("#AD9794")],leaf:[lr("#5A5C4D"),lr("#D6D494")],branch:[lr("#8B542B"),lr("#54593D"),lr("#A0703B")],grass:[lr("#1E1D26")],mushroom:[lr("#FDFDEB"),lr("#D2C09C"),lr("#7D8160"),lr("#D2C09C"),lr("#C2B08A"),lr("#AC9691")],butterfly:[lr("#1A1874"),lr("#FEF8EB")],stone:[lr("#BDC2B4")],bg:[lr("#DFE3DA")],stroke:[lr("#2C2517"),lr("#DCB5B5"),lr("#D2C09C")]}},20:{colors:{vine:[lr("#17181A")],fruit:[lr("#EDCEE1"),lr("#AB6958"),lr("#DBE4E5")],flower:[lr("#CFCAC9"),lr("#868074")],leaf:[lr("#4D4433"),lr("#030305")],branch:[lr("#3F3929"),lr("#3F3929"),lr("#F2EDD8")],grass:[lr("#EDCEE1")],mushroom:[lr("#9D8D7B"),lr("#D2C09C"),lr("#9D8D7B"),lr("#D4D5D6"),lr("#C2B08A"),lr("#9C998E")],butterfly:[lr("#5D4D3C"),lr("#D4D5D6")],stone:[lr("#EEEADE")],bg:[lr("#BBB29D")],stroke:[lr("#262013"),lr("#AB6958"),lr("#D2C09C")]}},21:{colors:{vine:[lr("#BBCDAD")],fruit:[lr("#F97247"),lr("#EAD1AE"),lr("#F97247")],flower:[lr("#F6EEE5"),lr("#F9AF7B")],leaf:[lr("#A3B78E"),lr("#BBCDAD")],branch:[lr("#9E6E33"),lr("#A77D37"),lr("#F2EDD8")],grass:[lr("#F9CF7D")],mushroom:[lr("#F97247"),lr("#F9CF7D"),lr("#F6EEE5"),lr("#F9CF7D"),lr("#F6DFC7"),lr("#A3B78E")],butterfly:[lr("#F6EEE5"),lr("#BBCDAD")],stone:[lr("#F7C973")],bg:[lr("#F9CF7D")],stroke:[lr("#60503B"),lr("#D4855A"),lr("#F9CF7D")]}},22:{colors:{vine:[lr("#E7E2D8")],fruit:[lr("#161616"),lr("#F1EEE7"),lr("#E7E2D8")],flower:[lr("#FFFFFF"),lr("#FEF8EB")],leaf:[lr("#FEF8EB"),lr("#E7E2D8")],branch:[lr("#161616"),lr("#E7E2D8"),lr("#F2EDD8")],grass:[lr("#E7E2D8")],mushroom:[lr("#E7E2D8"),lr("#E7E2D8"),lr("#E7E2D8"),lr("#E7E2D8"),lr("#E7E2D8"),lr("#E7E2D8")],butterfly:[lr("#E7E2D8"),lr("#E7E2D8")],stone:[lr("#E7E2D8")],bg:[lr("#E9E9E9")],stroke:[lr("#161616"),lr("#161616"),lr("#FFFFFF")]}},23:{colors:{vine:[lr("#6A904B")],fruit:[lr("#DCDDCD"),lr("#DCDDCD"),lr("#DBE4E5")],flower:[lr("#F2EDD8"),lr("#F2D147")],leaf:[lr("#6A904B"),lr("#030305")],branch:[lr("#6A904B"),lr("#3F3929"),lr("#F2EDD8")],grass:[lr("#6A904B")],mushroom:[lr("#DCDDCD"),lr("#DCDDCD"),lr("#DCDDCD"),lr("#DCDDCD"),lr("#DCDDCD"),lr("#DCDDCD")],butterfly:[lr("#F2EDD8"),lr("#F2EDD8")],stone:[lr("#DCDDCD")],bg:[lr("#DCDDCD")],stroke:[lr("#262013"),lr("#465F32"),lr("#E5F2D8")]}},24:{colors:{vine:[lr("#6A904B")],fruit:[lr("#556843"),lr("#556843"),lr("#556843")],flower:[lr("#BD2D2D"),lr("#EED628")],leaf:[lr("#8BA260"),lr("#030305")],branch:[lr("#595347"),lr("#3F3929"),lr("#7E524A")],grass:[lr("#899F5E")],mushroom:[lr("#DCDDCD"),lr("#FFFFFD"),lr("#DCDDCD"),lr("#FFFFFD"),lr("#DCDDCD"),lr("#FFFFFD")],butterfly:[lr("#E2DDD3"),lr("#FFFFFD")],stone:[lr("#E2DDD3")],bg:[lr("#E2DDD3")],stroke:[lr("#262013"),lr("#465F32"),lr("#E5F2D8")]}},25:{colors:{vine:[lr("#303030")],fruit:[lr("#000000"),lr("#303030"),lr("#303030")],flower:[lr("#FF0000"),lr("#FFFFFF")],leaf:[lr("#303030"),lr("#030305")],branch:[lr("#000000"),lr("#303030"),lr("#303030")],grass:[lr("#000000")],mushroom:[lr("#303030"),lr("#000000"),lr("#303030"),lr("#000000"),lr("#303030"),lr("#000000")],butterfly:[lr("#FF0000"),lr("#D3D3D3")],stone:[lr("#303030")],bg:[lr("#272727")],stroke:[lr("#D3D3D3"),lr("#303030"),lr("#FFD900")]}},26:{colors:{vine:[lr("#DCC902")],fruit:[lr("#000000"),lr("#F6FCDE"),lr("#303030")],flower:[lr("#DCC902"),lr("#FFFFFF")],leaf:[lr("#23708C"),lr("#030305")],branch:[lr("#15486C"),lr("#303030"),lr("#303030")],grass:[lr("#303D38")],mushroom:[lr("#D0B06C"),lr("#23708C"),lr("#FFD900"),lr("#D0B06C"),lr("#303030"),lr("#D0B06C")],butterfly:[lr("#F6FCDE"),lr("#AA6B46")],stone:[lr("#F6FCDE")],bg:[lr("#D0B06C")],stroke:[lr("#685A3D"),lr("#303030"),lr("#FFD900")]}},27:{colors:{vine:[lr("#C853FD")],fruit:[lr("#5E7FE3"),lr("#89D7FC"),lr("#C853FD")],flower:[lr("#FF3A5D"),lr("#FFFFFE")],leaf:[lr("#05FCD5"),lr("#06ED95")],branch:[lr("#688EFF"),lr("#7ECAFF"),lr("#FF3A5D")],grass:[lr("#06ED95")],mushroom:[lr("#FF2771"),lr("#00FFDE"),lr("#7ECAFF"),lr("#A463FF"),lr("#FF99AA"),lr("#FFFFFE")],butterfly:[lr("#FFFFFE"),lr("#865B4B")],stone:[lr("#8A5E4F")],bg:[lr("#000000")],stroke:[lr("#E7E7E7"),lr("#00E791"),lr("#FF3A5D")]}}};const Io={SIMPLE:"基礎橢圓形",QUILL:"羽毛",WAVE:"波浪NOISE",GOURD:"葫蘆形",TRIANGLE:"三角",HEART:"心形",JAGGED:"鋸齒邊",ROUND:"圓形",BAMBOO:"竹葉",FERN:"蕨葉",BRUG:"紅茄苳"};const Lo={[Io.SIMPLE]:e=>t=>pow(sin(PI*t),e.leafPointyness),[Io.QUILL]:e=>t=>pow(atan(PI*(1-t)),e.leafPointyness)*.5,[Io.WAVE]:e=>t=>{let o=pow(sin(PI*t),e.leafPointyness);let r=map(noise(t*.5),0,1,.05,.1)*cos(12*PI*t);return o*(1+r)},[Io.GOURD]:e=>t=>{let o=t-.35;return pow(1-4*o*o,e.leafPointyness)*(.5+.2*sin(t*6*PI))},[Io.TRIANGLE]:e=>e=>{if(e<.2){return e*5}else if(e>.8){return(1-e)*5}else{return 1}},[Io.HEART]:e=>t=>{let o=(t-.5)*2;let r=sqrt(1-abs(o))*sqrt(abs(o));r*=1.2-.3*pow(abs(o),.5);if(t<.4){r*=map(t,0,.4,0,1)}return r*1.5*e.leafPointyness},[Io.JAGGED]:e=>t=>noise(t*e.leafShapeEdge,e.leafShapeN)*pow(sin(PI*t),e.leafPointyness),[Io.ROUND]:e=>e=>{let t=(e-.5)*2;return sqrt(1-t*t)},[Io.BAMBOO]:e=>{let t=.5;return e=>{if(e<.1){let o=e/.05;return pow(o,.6)*.7*t}else if(e<.3){let o=(e-.05)/.15;return(.7+.3*o)*t}else{let o=(e-.3)/.7;return(1-pow(o,1.5))*(1+.1*sin(o*PI*2))*t}}},[Io.FERN]:e=>t=>{let o=1.5-pow(t,.7);let r=.3*(.5+.5*sin(t*10*PI));let l=1-pow(t,.1);let width=.2;return(o+r*l)*width*e.leafPointyness},[Io.BRUG]:e=>e=>pow(sin(PI*e),.7)};const Bo={NATURAL:"自然花瓣",HEART:"心形花瓣",SLENDER:"細長花瓣",ROUND:"圓形花瓣"};const vo={[Bo.NATURAL]:e=>t=>{if(t<.5){return.3+noise(t*e.flowerShapeEdge,e.flowerShapeN)*e.flowerShapeFn(t)}else{return.2+noise(t*e.flowerShapeEdge,e.flowerShapeN)*e.flowerShapeFn(t)}},[Bo.HEART]:e=>e=>{let t=(e-.5)*2;if(e<.5){return.2+pow(1-abs(t),2)*(1+Math.sin(e*Math.PI*2))*.9}else{return.3+pow(1-abs(t),2)*(1+Math.sin(e*Math.PI*2))}},[Bo.SLENDER]:e=>e=>{if(e<.5){return.2+.8*pow(sin(PI*e),1.5)}else{return.05+.95*pow(sin(PI*e),3)}},[Bo.ROUND]:e=>e=>{let t=(e-.5)*2;let o=sqrt(1-t*t);return o*1.5}};const ko={SHARP_UP:"急劇上揚",SHARP_DOWN:"急劇下垂"};const Xo={NOISE:"noise",EDGE_GRADIENT:"邊緣漸層",REVERSE_EDGE_GRADIENT:"反轉邊緣漸層",PEAK_GRADIENT:"010漸層",SOLID_COLOR:"純色"};const Yo={[ko.SHARP_UP]:e=>e=>{let t=random(.1,.3);return e<t?0:e*8},[ko.SHARP_DOWN]:e=>e=>{let t=random(.1,.3);return e<t?2:e*Zo([-7,-12,-15])}};const zo={[Xo.NOISE]:e=>{let t=random(5,15);return e=>pow(noise(e*t),.7)},[Xo.EDGE_GRADIENT]:e=>{let t=random(.3,.4);let o=random(.4,.6);return e=>{if(e<t){return 0}else{let r=(e-t)/o;r=isNaN(r)?0:constrain(r,0,1);return pow(r,1.5)}}},[Xo.REVERSE_EDGE_GRADIENT]:e=>{let t=random(.7,.8);let o=random(.2,.4);return e=>{if(e>t){return 0}else{let r=(t-e)/o;r=constrain(r,0,1);return pow(r,2)}}},[Xo.PEAK_GRADIENT]:e=>{let t=random(.45,.55);let o=random(.1,.2);return e=>{let r=abs(e-t)/o;r=constrain(r,0,1);return pow(1-r,3)}},[Xo.SOLID_COLOR]:e=>e=>1};const Oo={UPRIGHT:"直立",CURVED:"彎曲"};const Ro="對生";const Wo="互生";const _o="輪生";const Mo={branchFork:5,branchDepth:2,branchWidth:1.2,leafGrowType:Wo,leafWidth:3,leafLength:30,spikeProb:1,flowerProb:.5,leafProb:.5,sunflowerPetalCount:12,flowerWidthA:10,sunSize:30,lTp:[3,0],petalfType:[1,3],flowerLengthC:60,leafShape:Lo[Io.ROUND]({leafPointyness:1})};const No={lTp:[12,8],leafShape:Lo[Io.BRUG]({leafPointyness:1}),leafGrowType:Wo,branchDepth:2,branchFork:2,branchWidth:1.2,spikeProb:1,flowerProb:.9,leafProb:.5,leafLength:130,leafWidth:30};class Ho{static getEulerFromPoints(e,t){if(t<=0||t>=e.length){console.error("getEulerFromPoints 中的無效索引");return createVector(0,0,0)}var o=p5.Vector.sub(e[t],e[t-1]);return this.vectorToEulerAngles(o)}static vectorToEulerAngles(e){if(!e||!this.isValidVector(e)){console.error("Invalid input vector in vectorToEulerAngles");return createVector(0,0,0)}let t=e.copy().normalize();if(!this.isValidVector(t)){console.error("Normalization failed in vectorToEulerAngles");return createVector(0,0,0)}let o=asin(constrain(-t.y,-1,1));let r=atan2(t.x,t.z);let l=0;return createVector(o,r,l)}static rotateVectorAroundAxis(e,t,o){if(!e||!t||typeof o!=="number"){console.error("Invalid parameters in rotateVectorAroundAxis");return createVector(0,0,0)}if(!this.isValidVector(e)){console.error("Invalid input vector:",e);return createVector(0,0,0)}if(!this.isValidVector(t)){console.error("Invalid rotation axis:",t);return e.copy()}let r=t.mag();if(r<1e-4){console.error("Zero magnitude rotation axis");return e.copy()}o=o%TWO_PI;let l=t.copy().mult(1/r);let n=cos(o);let a=sin(o);try{let t=e.copy().mult(n);let o=l.cross(e);let r=o.mult(a);let s=l.dot(e);let i=l.copy().mult(s*(1-n));return t.add(r).add(i)}catch(t){console.error("Error in rotation calculation:",t);return e.copy()}}static isValidVector(e){return e&&typeof e.x==="number"&&isFinite(e.x)&&typeof e.y==="number"&&isFinite(e.y)&&typeof e.z==="number"&&isFinite(e.z)}static applyEulerRotation(e,t){if(!e||!t){console.error("Invalid parameters in VectorUtils.applyEulerRotation");return createVector(0,0,0)}let o=e.copy();try{if(t.x!==0&&isFinite(t.x)){o=this.rotateVectorAroundAxis(o,createVector(1,0,0),t.x)}if(t.y!==0&&isFinite(t.y)){o=this.rotateVectorAroundAxis(o,createVector(0,1,0),t.y)}if(t.z!==0&&isFinite(t.z)){o=this.rotateVectorAroundAxis(o,createVector(0,0,1),t.z)}o.x=round(o.x*100)/100;o.y=round(o.y*100)/100;o.z=round(o.z*100)/100;return o}catch(t){console.error("Error in VectorUtils.applyEulerRotation:",t);return e.copy()}}static angle(e,t){var o=e.dot(t);var r=e.mag()*t.mag();var l=constrain(o/r,-1,1);return acos(l)}}class Go{constructor(e=1,t=0,o=0,r=0){this.w=e;this.x=t;this.y=o;this.z=r}static fromEuler(e){let t=cos(e.x*.5);let o=sin(e.x*.5);let r=cos(e.y*.5);let l=sin(e.y*.5);let n=cos(e.z*.5);let a=sin(e.z*.5);return new Go(t*r*n+o*l*a,o*r*n-t*l*a,t*l*n+o*r*a,t*r*a-o*l*n)}toEuler(){this.normalize();let e,t,o;let r=2*(this.w*this.x+this.y*this.z);let l=1-2*(this.x*this.x+this.y*this.y);e=atan2(r,l);let n=2*(this.w*this.y-this.z*this.x);if(abs(n)>=1){t=(n>=0?1:-1)*PI/2}else{t=asin(n)}let a=2*(this.w*this.z+this.x*this.y);let s=1-2*(this.y*this.y+this.z*this.z);o=atan2(a,s);return createVector(e,t,o)}normalize(){let e=sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);if(e===0)return this;this.w/=e;this.x/=e;this.y/=e;this.z/=e;return this}multiply(e){return new Go(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.w*e.x+this.x*e.w+this.y*e.z-this.z*e.y,this.w*e.y-this.x*e.z+this.y*e.w+this.z*e.x,this.w*e.z+this.x*e.y-this.y*e.x+this.z*e.w)}static combineRotations(e,t){let o=Go.fromEuler(e);let r=Go.fromEuler(t);return r.multiply(o).toEuler()}}class Uo{static createWidthFunction(e,t,o,l){return function(n){let[a,s]=Uo.calculateJointDistance(n,o,l);let i;if(a<1){i=e*(3+5*(1-n))}else{if(r==2){i=e*(2+7*(1-n)*map(noise(n*.001),0,1,.8,1))}else{i=e*(2+7*(1-n)*map(noise(n*10),0,1,.5,1))}}return min(i,t)}}static createbranchBendFunction(e,t){return function(o){let[r,l]=Uo.calculateJointDistance(o,e,t);if(typeof Ee==="undefined"||!Array.isArray(Ee)||Ee.length<2){Ee=[0,0]}if(r<1){return createVector(0,l*Ee[0],0)}else{return createVector(0,random(-Ee[1],Ee[1]),0)}}}static createJoints(e,t){let o=[];for(let r=0;r<e;r++){o.push([floor(random(0,1)*t),random(-.2,.2)])}return o}static calculateJointDistance(e,t,o){let r=o;let l=0;if(!t||t.length===0){return[r,0]}for(let n=0;n<t.length;n++){let a=abs(e*o-t[n][0]);if(a<r){r=a;l=n}}return[r,t[l][1]]}}function $o(e){if(So[e]){PT.colorsID=e;PT.colors=So[e].colors;io.colorsID=e;io.colors=So[e].colors;return So[e].colors}return null}function jo(e){return{_seed:e,_state:new Uint32Array(4),_initialized:false,_init:function(){if(this._initialized)return;let e=this._seed;this._state[0]=e>>>0;this._state[1]=e*1597>>>0;this._state[2]=e*3571>>>0;this._state[3]=e*6011>>>0;for(let e=0;e<20;e++){this._next()}this._initialized=true},_next:function(){const e=this._state[1]*5>>>0;const t=this._state[1]<<9;this._state[2]^=this._state[0];this._state[3]^=this._state[1];this._state[1]^=this._state[2];this._state[0]^=this._state[3];this._state[2]^=t;this._state[3]=(this._state[3]<<11|this._state[3]>>>21)>>>0;return e},random:function(min=0,max=1){if(!this._initialized)this._init();const e=this._next()/4294967296;return min+e*(max-min)},noise:function(e,t=0){let o=Math.sin(e*12.9898+t*78.233)*43758.5453;return o-Math.floor(o)},randomGaussian:function(e=0,t=1){let o=this.random();let r=this.random();let l=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*r);return e+l*t}}}function qo(e,t,o){return floor(e.random(t,o))}function Jo(e,t){return t[floor(e.random(0,t.length*.99))]}function Ko(e,min,max){if(arguments.length===1){max=min;min=0}return parseFloat(e.random(min,max).toFixed(2))}function Qo(e,t){return floor(random(e,t))}function Zo(e){return e[floor(random(0,e.length*.99))]}function er(min,max){if(arguments.length===1){max=min;min=0}return parseFloat(random(min,max).toFixed(2))}function tr(e){let t=e.random(0,Math.PI*2);let o=Math.acos(e.random(-1,1));let r=Math.sin(o)*Math.cos(t);let l=Math.sin(o)*Math.sin(t);let n=Math.cos(o);return createVector(r,l,n)}function or(e,t,o){let r=((t-e)%360+540)%360-180;return(e+r*o+360)%360}function rr(e){return noise(e)*2-1}function lr(e){e=e.replace("#","");let t=parseInt(e.substring(0,2),16)/255;let o=parseInt(e.substring(2,4),16)/255;let r=parseInt(e.substring(4,6),16)/255;let max=Math.max(t,o,r);let min=Math.min(t,o,r);let l,n,a=max;let s=max-min;n=max===0?0:s/max;if(max===min){l=0}else{switch(max){case t:l=(o-r)/s+(o<r?6:0);break;case o:l=(r-t)/s+2;break;case r:l=(t-o)/s+4;break}l/=6}return[(l*360).toFixed(2),n.toFixed(2),a.toFixed(2)]}function nr(e,t,o){e=e%360;t=Math.min(1,Math.max(0,t));o=Math.min(1,Math.max(0,o));let r=o*t;let l=r*(1-Math.abs(e/60%2-1));let n=o-r;let a,s,i;if(e>=0&&e<60){[a,s,i]=[r,l,0]}else if(e>=60&&e<120){[a,s,i]=[l,r,0]}else if(e>=120&&e<180){[a,s,i]=[0,r,l]}else if(e>=180&&e<240){[a,s,i]=[0,l,r]}else if(e>=240&&e<300){[a,s,i]=[l,0,r]}else{[a,s,i]=[r,0,l]}a=Math.round((a+n)*255);s=Math.round((s+n)*255);i=Math.round((i+n)*255);const c=a.toString(16).padStart(2,"0");const p=s.toString(16).padStart(2,"0");const f=i.toString(16).padStart(2,"0");return`#${c}${p}${f}`}function ar(e,t){t=t!=undefined?t:4;let o=1/(1+exp(-t*(e-.4)));let r=1/(1+exp(-t*(e-.6)));return(o+r)/2}function sr(e,t,o,r=1){let l=e;let n=t;let a=o;let s=r;return color(l,n,a,s)}function ir(e){let t=e.random(TWO_PI);return createVector(cos(t),sin(t))}function cr(e,t,o){let r=p5.Vector.lerp(e,t,.5);let l=p5.Vector.dist(e,t)/2;let n=atan2(e.y-r.y,e.x-r.x);let a=atan2(t.y-r.y,t.x-r.x);if(a>n){a-=TWO_PI}let s=lerp(n,a,o);let i=r.x+cos(s)*l;let c=r.y+sin(s)*l;return createVector(i,c)}const pr=new Map;function fr(e){if(e instanceof p5.Color){return e}if(typeof e==="string"){if(pr.has(e)){return pr.get(e)}const t=color(e);pr.set(e,t);return t}return color("black")}function dr(e,t,o,r=1){const l=`hsv_${e}_${t}_${o}_${r}`;if(pr.has(l)){return pr.get(l)}const n=sr(e,t,o,r);pr.set(l,n);return n}function mr(){PT={};PT.plantType="woody";PT.container={type:"",height:120,maxBranchWidthidth:45};ve=Qo(0,28);ke=ve;if(r==1){ve=23}else if(r==2){ve=24}l.colorPalette=ve;$o(ve);go=PT.colors.bg[0];PT.leafGrowType=Zo([Ro,Wo,_o]);PT={...PT,...Fr(),...ur(),...br(),...xr(),...hr(),spiral:gr()};if(r==1){PT={...PT,...Mo}}else if(r==2){PT={...PT,...No}}return PT}function hr(){let e={};e.mBW=random(0,1)<.8?300*he:500*he;e.branchWidth=random(0,1)<.8?er(.7,.9)*ge:er(.9,1.2)*ge;e.stemTexLine=random(0,1)<.2?1:0;e.branchColor=PT.colors.branch[0].map(Number);e.stemWidth=er(2,11);e.sBn=er(3,8);e.sLe=random(0,1)<.8?er(300,500):er(500,700);e.stemCount=Zo([2,3,4,5]);if(random(0,1)>.5)e.branchFork=Zo([1,2]);else e.branchFork=Zo([2,3,3,4,5]);e.branchDepth=Zo([0,1,1,2,2,3,4]);if(E==1){e.mBW=2e3;e.branchWidth=random(2,6);e.stemWidth=er(6,11);e.sLe=er(800,1200);e.branchFork=Zo([1,2]);e.branchDepth=Zo([1,1,2])}if(D==1){e.branchFork=1;e.branchDepth=Zo([0,1,2])}return e}function gr(){let e={baseRadius:er(4.5,6.5),baseFrequency:10,baseWidth:er(2,4),widthVariation:er(3.5,6),bendStrength:er(.5,1),twistFactor:er(.3,.6),noiseScale:er(.05,.15),noiseStrength:er(.5,2),color:PT.colors.vine[0].map(Number),maxLength:er(.5,1),radiusVariation:er(1,1.5),spiralTightness:er(.6,1),glowProbability:er(.05,.3),detailLevel:er(2,20),smoothness:er(1,10),leaf:{pN:er(.5,1.5),frq:er(5,10),amp:er(.05,.1),shape:t=>{let o=pow(sin(PI*t),e.leaf.pN);let r=e.leaf.amp*cos(e.leaf.frq*PI*t);return o*(1+r)},color:PT.colors.vine[0].map(Number),size:{length:er(30,70)*1.5*he,width:er(15,25)*he},veins:{type:Qo(2,2),density:Qo(2,5),spacing:Qo(2,4)}}};if(D==1){e.leaf={pN:er(.5,1.5),frq:er(5,10),amp:er(.05,.1),shape:t=>{let o=Math.pow(Math.sin(Math.PI*t),e.leaf.pN);let r=e.leaf.amp*Math.cos(e.leaf.frq*Math.PI*t);return o*(1+r)},color:PT.colors.vine[0].map(Number),size:{length:er(30,100)*3*he,width:er(15,25)*2*he},veins:{type:Qo(1,3),density:Qo(2,5),spacing:Qo(2,4)}}}return e}function ur(){let e={fruitSize:random(0,1)<.8?er(80,130)*he:er(130,160)*he,fruitProb:er(.5,.9),fruitTypes:["apple","apple","apple","pinecone","raspberry","raspberry","buddhahand","buddhahand"],appleSize:random(0,1)<.8?er(4,16)*he:er(16,22)*he,raspberrySize:random(0,1)<.8?er(50,90)*he:er(100,160)*he,melonSize:random(0,1)<.8?er(15,20)*he:er(20,25)*he,buddhahandSize:random(0,1)<.8?er(20,25)*he:er(25,30)*he,buddhahandFingers:Qo(12,16),buddhahandCurvature:er(.5,1.5),buddhaHandTextureDetail:Qo(3,6),fruitColors:{pinecone:PT.colors.fruit[0].map(Number),apple:PT.colors.fruit[1].map(Number),raspberry:PT.colors.fruit[2].map(Number),buddhahand:[60,.8,.9]},layers:Qo(6,10),scalesPerLayer:Qo(5,10)};e.fruitstem=e.appleSize*er(3,5)*me;if(er(0,1)<.5){e.coneHeight=e.fruitSize*er(.7,1);e.coneRadius=e.fruitSize*er(.2,.3)}else{e.coneHeight=e.fruitSize*er(.5,1);e.coneRadius=e.fruitSize*.02}return e}function br(){let e={flowerProb:er(.5,.9),flowerPetal:Zo([4,5,6,9]),sunflowerPetalCount:Zo([6,8,12]),flowerWidthA:random(0,1)<.8?er(10,20)*he:er(20,40)*he,flowerLengthA:random(0,1)<.8?er(80,120)*he:er(120,150)*he,flowerLengthC:random(0,1)<.8?er(120,300)*.3*he:er(300,500)*.3*he,flowerShapeEdge:er(5,10),flowerShapeN:er(0,PI)*.01,flowerShapeFn:e=>pow(sin(PI*e),.3)};let t=Zo([Bo.NATURAL,Bo.HEART,Bo.SLENDER,Bo.ROUND]);if(t==Bo.ROUND)e.flowerLengthA=e.flowerLengthA/2;e.fSh=vo[t](e);let o=[er(-.5,.5),er(5,10)];let r=[er(0,1)*PI,er(1,5)];let l=[er(0,1)*PI,er(5,15)];let n=[er(0,1)*.5,er(.8,1.2)];e.sunSize=Zo([24,28,32])*he;e.flowerLengthB=max(er(5,15),e.flowerWidthA*.3)*he;e.flowerWidthB=max(Zo([3,er(2,8)]),e.flowerWidthA*.4)*he;let a=Qo(0,PT.colors.flower.length/2)*2;mo.flowerColorId=a;e.flowerColorA=PT.colors.flower[0].map(Number);e.flowerColorB=PT.colors.flower[1].map(Number);e.petalfType=Zo([[1,1],[1,2],[3,2],[6,2],[7,2],[8,Qo(1,5)],[9,2],[10,4]]);let s=Zo([Xo.NOISE,Xo.EDGE_GRADIENT,Xo.REVERSE_EDGE_GRADIENT,Xo.PEAK_GRADIENT,Xo.SOLID_COLOR]);let i={seed:er(0,PI),frq:er(1,5),amp:er(.5,1.5)};e.flowerColorFn=zo[s](i);mo.flowerColorType=s;return e}function xr(){let e={leafProb:Zo([.2,.4,.6,.9]),lTp:random(0,1)<.5?Zo([[0,Qo(8,16)],[1,Qo(2,5)],[2,Qo(5,12)],[11,2]]):Zo([[3,2],[4,0],[6,2],[5,2],[7,2],[8,Qo(1,5)],[9,2],[10,4],[11,2]]),veinsType2:Zo([[10,2],[0,Qo(5,10)],[11,2],[4,2]]),leafLength:random(0,1)<.8?er(120,250)*he:er(300,450)*he,leafWidth:random(0,1)<.8?er(20,40)*he:er(40,70)*he,leafHeartSize:random(0,1)<.8?er(6,12)*he:er(15,25)*he,leafPointyness:er(.5,1.5),leafShapeEdge:er(10,20),leafShapeN:er(0,1)*PI};e.leafLength=constrain(e.leafLength,100,500);e.leafWidth=constrain(e.leafWidth,20,50);e.shapeName=Zo([Io.SIMPLE,Io.QUILL,Io.TRIANGLE,Io.WAVE,Io.JAGGED,Io.HEART,Io.GOURD,Io.BAMBOO,Io.FERN,Io.HEART]);e.leafShape=Lo[e.shapeName](e);bt=e.lTp;e.leafColorA=PT.colors.leaf[0].map(Number);e.leafColorB=PT.colors.leaf[1].map(Number);let t=[er(-.1,.1),er(3,5)];e.leafColorFn=e=>{let o=ar(pow(e,1.5)+t[0],t[1]);return constrain(o,.1,.9)};return e}function yr(){return{plantType:"grass",grassProb:er(.2,.7),grassLength:random(0,1)<.9?er(200,400)*he:er(400,700)*he,grassWidth:random(0,1)<.9?er(3,6)*he:er(6,10)*he,grassShape:Zo([e=>pow(atan(PI*(1-e)*map(noise(e*1e3),0,1,.5,1)),2),e=>pow(cos(PI*e/2),2)]),grassColor:PT.colors.grass[0].map(Number),stembenScale:Zo([8,10,12])}}function Fr(){let e={};e.spikeProb=er(.5,1.2);e.spikeCountRange=Zo([1,3,5,8]);e.hasSpikesW=er(2,5);e.hasSpikesL=er(0,1)>.1?er(.2,.8):er(1,1.5);e.spikeColor=PT.colors.branch[1].map(Number);e.spikeColor2=PT.colors.branch[2].map(Number);if(E==1){e.hasSpikesW=er(.5,1);e.hasSpikesL=er(.2,.5)}if(D==1){e.spikeProb=.97;e.hasSpikesW=er(.5,1);e.hasSpikesL=er(.2,.5)}return e}function wr(){let e=Qo(0,5);return{plantType:"mushroom",mushroomProb:er(.3,.6),mushroomColor:{cap:PT.colors.mushroom[e].map(Number),stem:PT.colors.mushroom[e].map(Number)},mushroomWidth:Zo([er(1.5,3),er(1.5,3),er(1.5,3),er(3,5)]),mushroomHeight:Qo(60,160),capWidth:null,capHeight:Qo(10,30),mushroomLimit:Fe.mushroom,mushroomCount:0}}function Pr(){let e=Zo([ko.SHARP_UP,ko.SHARP_DOWN]);let t={seed:er(0,PI),frq:er(1,5),amp:er(.5,1.5)};io.flowerOpenCurve=Yo[e](t);mo.flowerOpenType=e}function Vr(){let e=[er(-.5,.5),er(5,10)];let t=[er(0,1)*PI,er(1,5)];let o=[er(0,1)*PI,er(5,15)];let r=[er(0,1)*PI,er(1,5)];let l=[er(0,1)*.5,er(.8,1.2)];let n=[function(e,t){return e<.1?2+t*o[1]:noise(e*10,o[0])},function(e,t){return e<l[0]?0:10-e*map(t,0,1,16,20)*l[1]},function(e,o){return sin(e*PI*t[1])*o*l[1]}];return Zo(n)}function Tr(){const e={width:B.dim*B.ratio,height:B.dim};const t={pgL4:{needsFont:false},pgL3:{needsFont:false},pgL1:{needsFont:false},pgL15:{needsFont:false},pgL2:{needsFont:false},pgL0:{needsFont:false},pgBg:{needsFont:true,fontSize:60},pgText:{needsFont:true,fontSize:10,align:[LEFT,TOP]},pgFinal:{needsFont:false},pgTex:{needsFont:false},pgFrame:{needsFont:false},snapShotImg:{needsFont:false},pgVerse:{needsFont:false}};Object.entries(t).forEach((([t,o])=>{let r;if(t==="pgVerse"){r=createGraphics(B.dim*B.ratio,B.dim)}else{r=createGraphics(e.width,e.height)}Ze[t]=r;r.colorMode(HSB,360,1,1,1);r.strokeJoin(ROUND);r.strokeCap(SQUARE);r.noStroke();window[t]=r}));Gt=Array.from({length:ce},(()=>createGraphics(e.width,e.height)))}function Cr(){let e={};e.leafColorA=[PT.colors.leaf[0][0],PT.colors.leaf[0][1],PT.colors.leaf[0][2]];e.leafColorB=[PT.colors.leaf[1][0],PT.colors.leaf[1][1],PT.colors.leaf[1][2]];e.branchColor=[PT.colors.branch[0][0],PT.colors.branch[0][1],PT.colors.branch[0][2]];e.vineColor=[PT.colors.vine[0][0],PT.colors.vine[0][1],PT.colors.vine[0][2]];e.fruitColors={pinecone:[PT.colors.fruit[0][0],PT.colors.fruit[0][1],PT.colors.fruit[0][2]],apple:[PT.colors.fruit[1][0],PT.colors.fruit[1][1],PT.colors.fruit[1][2]],raspberry:[PT.colors.fruit[2][0],PT.colors.fruit[2][1],PT.colors.fruit[2][2]],buddhahand:[60,.8,.9]};e.flowerColorA=[PT.colors.flower[0][0],PT.colors.flower[0][1],PT.colors.flower[0][2]];e.flowerColorB=[PT.colors.flower[1][0],PT.colors.flower[1][1],PT.colors.flower[1][2]];e.grassColor=[PT.colors.grass[0][0],PT.colors.grass[0][1],PT.colors.grass[0][2]];if(PT.colors&&PT.colors.branch){e.spikeColor=[PT.colors.branch[1][0],PT.colors.branch[1][1],PT.colors.branch[1][2]];e.spikeColor2=[PT.colors.branch[2][0],PT.colors.branch[2][1],PT.colors.branch[2][2]]}else{e.spikeColor=[0,0,0];e.spikeColor2=[0,0,0]}return e}function Er(e){let t=xr();io.leafShape=t.leafShape;io.leafProb=t.leafProb;io.lTp=t.lTp;io.leafLength=t.leafLength;io.leafWidth=t.leafWidth;io.leafHeartSize=t.leafHeartSize;io.leafPointyness=t.leafPointyness;io.leafShapeEdge=t.leafShapeEdge;io.leafShapeN=t.leafShapeN;io.leafColorA=t.leafColorA;io.leafColorB=t.leafColorB;io.leafColorFn=t.leafColorFn}function Dr(e){let t=br();io.flowerProb=t.flowerProb;io.flowerPetal=t.flowerPetal;io.flowerWidthA=t.flowerWidthA;io.flowerLengthA=t.flowerLengthA;io.flowerWidthB=t.flowerWidthB;io.flowerLengthB=t.flowerLengthB;io.flowerLengthC=t.flowerLengthC;io.flowerShapeEdge=t.flowerShapeEdge;io.flowerShapeN=t.flowerShapeN;io.flowerShapeFn=t.flowerShapeFn;io.fSh=t.fSh;io.flowerColorA=t.flowerColorA;io.flowerColorB=t.flowerColorB;io.flowerColorFn=t.flowerColorFn;io.sunflowerPetalCount=t.sunflowerPetalCount;io.sunSize=t.sunSize}function Ar(e){let t=ur();io.fruitSize=t.fruitSize;io.fruitColors=t.fruitColors;io.fruitProb=t.fruitProb;io.fruitTypes=t.fruitTypes;io.seedType=t.seedType;io.appleSize=t.appleSize;io.fruitstem=t.fruitstem;io.layers=t.layers;io.scalesPerLayer=t.scalesPerLayer;io.coneHeight=t.coneHeight;io.coneRadius=t.coneRadius;io.buddhaHandSize=t.buddhaHandSize;io.buddhaHandFingers=t.buddhaHandFingers;io.buddhaHandCurvature=t.buddhaHandCurvature;io.buddhaHandTextureDetail=t.buddhaHandTextureDetail}function Sr(){let e=hr();io.branchWidth=e.branchWidth;io.branchDepth=e.branchDepth;io.branchColor=e.branchColor;io.branchFork=e.branchFork}function Ir(){let e=Fr();io.spikeProb=e.spikeProb;io.hasSpikesW=e.hasSpikesW}function Lr(){let e=jo(ho);if(uo==0||uo==3)Ke=Jo(e,[0,1,2,3,4]);else Ke=Jo(e,[0,1,2]);if(uo==0&&vt)Ke=5;l.frameType=Ke;wo=e.random(.105,.12);pgFrame.rectMode(CENTER);pgFrame.noFill();if(Ke==0||Ke==1||Ke==3)pgFrame.stroke(qe[0][0],qe[0][1],qe[0][2],1);else if(Ke==2||Ke==4)pgFrame.stroke(qe[0][0],qe[0][1]*.8,qe[0][2]*.9,1);if(window.debugMode5==1)pgFrame.stroke(0,0,.85,1);if(Ke==0)wo=.1,pgFrame.strokeWeight(width*(wo+.02));else if(Ke==1)wo=.1,pgFrame.strokeWeight(width*wo);else if(Ke==2)wo=.08,pgFrame.strokeWeight(width*wo);else if(Ke==3)wo=.1,Po=.51,pgFrame.strokeWeight(width*wo);else if(Ke==4)wo=.1,Po=.505,pgFrame.strokeWeight(width*wo);pgFrame.rect(width/2,height/2,width,height);pgFrame.strokeWeight(2);if(Ke==0){pgFrame.stroke(Je[0],Je[1],Je[2],.8);Yr(width/2,height/2,width-width*wo,height-width*wo,-.15,1.5);Yr(width/2,height/2,width-width*(wo+.02),height-width*(wo+.02),-.2,3)}else if(Ke==1){pgFrame.stroke(Je[0],Je[1],Je[2],.8);Yr(width/2,height/2,width-width*.1,height-width*.1,-.2,3)}else if(Ke==2){pgFrame.stroke(Je[0],Je[1],Je[2],.8);Yr(width/2,height/2,width-width*wo,height-width*wo,-.2,3)}else if(Ke==3){pgFrame.translate(height/2,height/2);pgFrame.fill(qe[0][0],qe[0][1],qe[0][2],1);if(window.debugMode5==1)pgFrame.fill(0,0,.85,1);pgFrame.push();Hr(.9);pgFrame.rotate(HALF_PI);Hr(.9);pgFrame.rotate(HALF_PI);Hr(.9);pgFrame.rotate(HALF_PI);Hr(.9);pgFrame.pop();pgFrame.strokeWeight(2);pgFrame.stroke(Je[0],Je[1],Je[2],.8);kr(height*.9*.5,-.1,2);kr(height*.9*Po,-.2,3.5)}else if(Ke==4){pgFrame.translate(height/2,height/2);pgFrame.fill(qe[0][0],qe[0][1]*.8,qe[0][2]*.9,1);if(window.debugMode5==1)pgFrame.fill(0,0,.85,1);pgFrame.push();Hr(.9);pgFrame.rotate(HALF_PI);Hr(.9);pgFrame.rotate(HALF_PI);Hr(.9);pgFrame.rotate(HALF_PI);Hr(.9);pgFrame.pop();pgFrame.strokeWeight(2);pgFrame.stroke(Je[0],Je[1],Je[2],.8);pgFrame.strokeWeight(2);pgFrame.stroke(Je[0],Je[1],Je[2],.8);kr(height*.9*.5,-.15,3.5);kr(height*.9*Po,-.2,2)}if(window.debugMode5==1){if(Ke==0||Ke==1||Ke==2){let e=width-width*wo;let t=height-width*wo;let o=Math.min(e,t)/10;let r=Math.floor(e/o);let l=Math.floor(t/o);let n=o*r;let a=o*l;let s=(width-e)/2+(e-n)/2;let i=(height-t)/2+(t-a)/2;pgFrame.push();pgFrame.stroke(0,0,0,.2);pgFrame.strokeWeight(.5);for(let e=0;e<=r;e++){let t=s+e*o;pgFrame.line(t,i,t,i+a)}for(let e=0;e<=l;e++){let t=i+e*o;pgFrame.line(s,t,s+n,t)}pgFrame.pop();let c=Math.max(10,o*.1);pgFrame.push();pgFrame.stroke(0,0,0,.8);pgFrame.strokeWeight(1);for(let e=0;e<=l;e++){let t=i+e*o;pgFrame.line(s,t,s-c,t);pgFrame.line(s+n,t,s+n+c,t)}pgFrame.pop();let p=c*.5;pgFrame.push();pgFrame.stroke(0,0,0,.5);pgFrame.strokeWeight(.6);for(let e=0;e<l;e++){let t=i+e*o;let r=i+(e+1)*o;for(let e=1;e<10;e++){let r=t+o*e/10;pgFrame.line(s,r,s-p,r);pgFrame.line(s+n,r,s+n+p,r)}}pgFrame.pop()}else{}}zr(wo);_r(Po)}function Br(){let e=Math.min(5,ce);const t=[E,D,C,g,A];let o,r;if(ve===25||ve===27){o=[0,0,1,1];r=[0,0,1,1]}else{o=[0,0,0,1];r=[0,0,0,.5]}if(Ke===0||Ke===1||Ke===2){let l=width*(wo/2);let n=width*(1-wo/2);let a=height-width*(wo/2)+15;let s=(n-l)/ce;for(let n=0;n<e;n++){let e=l+n*s;pgFrame.push();pgFrame.fill(...o);pgFrame.noStroke();pgFrame.ellipse(e,a,2,2);if(t[n]){pgFrame.noFill();pgFrame.stroke(...r);pgFrame.strokeWeight(.5);pgFrame.ellipse(e,a,5,5)}pgFrame.pop()}}else if(Ke===3||Ke===4){let l=height*.92*Po;let n=0,a=0;let s=PI/2;let i=PI*2*.75;pgFrame.push();for(let c=0;c<e;c++){let p=map(c,0,ce-1,s,i);let f=n+cos(p)*l;let d=a+sin(p)*l;pgFrame.push();pgFrame.fill(...o);pgFrame.noStroke();pgFrame.ellipse(f,d,2,2);if(t[e-1-c]){pgFrame.noFill();pgFrame.stroke(...r);pgFrame.strokeWeight(.5);pgFrame.ellipse(f,d,5,5)}pgFrame.pop()}pgFrame.pop()}}function vr(e=100){const t=[];const o=.005;for(let r=0;r<TAU;r+=o){const o=1;t.push(new createVector(cos(r)*e*o,sin(r)*e*o))}return t}function kr(e,t=-.15,o=3){let r=vr(e);pgFrame.push();const l=1;for(let e=0;e<r.length-1;e++){const n=t;const a=(noise(e*l,random(0,500)*.05)+n)*o;const s=r[e];const i=r[e+1];pgFrame.strokeWeight(a>.5?a:random(0,1)>.8?0:0);pgFrame.line(s.x,s.y,i.x,i.y)}pgFrame.pop()}function Xr(e,t){const o=[];const r=.5;for(let l=-e/2;l<=e/2;l+=r){o.push(new createVector(l,-t/2))}for(let l=-t/2;l<=t/2;l+=r){o.push(new createVector(e/2,l))}for(let l=e/2;l>=-e/2;l-=r){o.push(new createVector(l,t/2))}for(let l=t/2;l>=-t/2;l-=r){o.push(new createVector(-e/2,l))}return o}function Yr(e,t,o,r,l=-.15,n=3){let a=Xr(o,r);pgFrame.push();pgFrame.translate(e,t);const s=1;for(let e=0;e<a.length-1;e++){const t=l;const o=(noise(e*s,frameCount*.05)+t)*n;const r=a[e];const i=a[e+1];pgFrame.strokeWeight(o>.5?o:random(0,1)>.8?0:0);pgFrame.line(r.x,r.y,i.x,i.y)}pgFrame.pop()}function zr(){if(Ke>2)return;pgFrame.push();pgFrame.stroke(Je[0],Je[1],Je[2],.3);let e=ce;let t=5;let o=width*(wo/2);let r=width*(1-wo/2);let l=(r-o)/e;for(let e=0;e<=ce;e++){let r=o+e*l;let n=height-width*(wo/2)+2;if(e%5==0)pgFrame.strokeWeight(1),pgFrame.line(r,n+2,r,n+4+t);else pgFrame.strokeWeight(.5),pgFrame.line(r,n+2,r,n+2+t)}pgFrame.pop()}function Or(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Je[0],Je[1],Je[2],random(.05,.15));let e=width*(1-wo/4)/ce;let t=height-width*wo/4;let o=ae/ce;let r=width*wo/3+e*ae;let l=r+e;pgFrame.ellipse(r,t,2)}function Rr(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Je[0],Je[1],Je[2],random(.05,.15));let e=width*(1-wo/4)/ce;let t=height-width*wo/4;let o=ae/ce;let r=width*wo/3+e*ae;let l=r+e;pgFrame.ellipse(r,t,2)}function Wr(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Je[0],Je[1],Je[2],random(.05,.15));let e=width*(1-wo)/ce;let t=height-width*(wo/2)+7;let o=ae/ce;let r=width*wo/2+e*ae;let l=r+e;Nr(r,t,l,t)}function _r(){if(Ke<3)return;pgFrame.push();pgFrame.translate(0,0);let e=height*.91*Po;let t=PI/2;let o=PI*2*.75;for(let r=0;r<ce;r++){let l=map(r,0,ce-1,t,o);let n=cos(l)*e;let a=sin(l)*e;let s=cos(l)*(e-(r%5==0?9:5));let i=sin(l)*(e-(r%5==0?9:5));pgFrame.stroke(Je[0],Je[1],Je[2],.01);pgFrame.line(n,a,s,i)}pgFrame.pop()}function Mr(){if(Ke<3)return;pgFrame.push();pgFrame.translate(0,0);pgFrame.stroke(0,0,0,.5);let e=height*.91*Po;let t=ae/(ce-1);let o=PI*2*.75;let r=map(t,0,1,PI*2*.75,PI/2);let l=.03;for(let t=o;t>r;t-=l){let o=cos(t)*e;let r=sin(t)*e;let n=cos(t-l)*e;let a=sin(t-l)*e;Nr(o,r,n,a,-.2,2)}pgFrame.pop()}function Nr(e,t,o,r,l=-.1,n=2){pgFrame.push();const a=1;const s=[];const i=dist(e,t,o,r);const c=1;for(let l=0;l<=i;l+=c){const n=l/i;const a=lerp(e,o,n);const c=lerp(t,r,n);s.push(createVector(a,c))}for(let e=0;e<s.length;e++){const t=l;const o=(noise(e*a,frameCount*.05)+t)*n;if(o>.5){pgFrame.strokeWeight(o);pgFrame.point(s[e].x,s[e].y)}}pgFrame.pop()}function Hr(e=.95){let t=height/2*e;pgFrame.noStroke();pgFrame.beginShape();pgFrame.vertex(-t,-t);pgFrame.vertex(0,-t);let o=-t*.552284749831;pgFrame.bezierVertex(o,-t,-t,o,-t,0);pgFrame.endShape()}async function Gr(){if(!Ll||!Ll.paths||!Array.isArray(Ll.paths)||!Ll.dots||!Array.isArray(Ll.dots)){console.error("JSON 数据格式错误，缺少必要的 paths 或 dots 数组");return}const e=Ll;allPaths=[];yo={segments:[],dots:[]};for(let t=0;t<e.paths.length;t++){let o=e.paths[t];if(!Array.isArray(o)||o.length<2){console.warn(`路径 ${t} 无效或点数不足，跳过此路径`);continue}let r=true;for(let e of o){if(e.x===undefined||e.y===undefined){console.warn(`路径 ${t} 中有无效点，跳过此路径`);r=false;break}}if(!r)continue;allPaths.push(o.map((e=>createVector(e.x,e.y))));let l=0;for(let e=0;e<o.length-1;e++){let t=o[e];let r=o[e+1];let n=dist(t.x,t.y,r.x,r.y);l+=n}l=map(l,0,500,0,width);let n=[];for(let e=0;e<o.length;e++){if(e===0){n.push(0)}else{let t=o[e-1];let r=o[e];let l=atan2(r.y-t.y,r.x*B.ratio-t.x*B.ratio);n.push(l)}}if(o.length>=2){let e=o[0];let r=o[o.length-1];let n=atan2(r.y-e.y,r.x*B.ratio-e.x*B.ratio);let a=dist(e.x*B.ratio,e.y,r.x*B.ratio,r.y);a=map(a,0,500,0,B.dim)*random(.95,1.05);let s=n+1.57;let i=co.branchWidth*random(.8,1.2);yo.segments.push({startPoint:e,endPoint:r,baseX:e.x,baseY:e.y,bRt:createVector(PI/2,0,s),bLe:a,bwF:i,mBD:co.branchDepth,col:co.branchColor,forkCount:co.branchFork,mBW:co.mBW,meta:co,twI:constrain(random(-.5,1),0,.5),stemTexLine:co.stemTexLine,pathIndex:t,pathTotal:l})}}let t=e.dots;let o=t.filter((e=>e.x!==undefined&&e.y!==undefined));if(o.length!==t.length){console.warn(`有 ${t.length-o.length} 个无效点被过滤`)}singlePoints=o.map((e=>createVector(e.x,e.y)));for(let e=0;e<o.length;e++){yo.dots.push({baseX:o[e].x,baseY:o[e].y})}}function Ur(){if(window.location.hash){return}const e=new URLSearchParams(window.location.search);if(!e.has("useCommentData")){return}const t=document.getElementsByTagName("script");for(let e=0;e<t.length;e++){const o=t[e];if(!o.src||!o.src.includes("sketch.js")){continue}const r=new XMLHttpRequest;r.open("GET",o.src,false);r.send();if(r.status!==200){console.error("无法加载脚本内容");return}const l=r.responseText;const n=l.match(/\/\/#data_([^\r\n]+)/);if(!n){return}const a=n[1].trim().split(" ")[0];window.location.hash="#data_"+a;return}}window.onload=function(){Ur()};function $r(){try{const e=window.location.hash;if(e&&e.includes("#data_")){let t=e.split("#data_")[1];if(t.includes("&")){t=t.split("&")[0]}if(t.includes("#")){t=t.split("#")[0]}if(t.includes("?")){t=t.split("?")[0]}t=decodeURIComponent(t);const o=qr(t);if(o){const e={paths:o.paths.map((e=>e.map((e=>({x:e.x,y:e.y}))))),dots:o.dots.map((e=>({x:e.x,y:e.y})))};return e}try{let e;try{e=atob(t)}catch(o){console.error("base64解码失败，尝试直接解析JSON:",o);e=t}const o=JSON.parse(e);console.log("使用标准JSON格式解码");if(o.p&&Array.isArray(o.p)){const e=o.p.map(jr);const t=e.map((e=>e.map((e=>({x:e.x,y:e.y})))));console.log(`已加载 ${e.length} 条路径 (JSON格式)`);let r=[];if(o.d&&Array.isArray(o.d)){r=o.d.map((e=>({x:e[0],y:e[1]})));console.log(`已加载 ${r.length} 个点`)}const l={paths:t,dots:r};console.log("最终JSON结构:",JSON.stringify(l,null,2));return l}else if(o.paths&&Array.isArray(o.paths)){console.log(`已加载 ${o.paths.length} 条旧格式路径`);console.log("最终JSON结构:",JSON.stringify(o,null,2));return o}}catch(e){console.warn("JSON解析失败")}}}catch(e){console.warn("解析URL数据失败:",e)}return null}function jr(e){if(!e.length)return[];const t=[];let o=e[0][0];let r=e[0][1];t.push(createVector(o,r));for(let l=1;l<e.length;l++){o+=e[l][0];r+=e[l][1];t.push(createVector(o,r))}return t}function qr(e){try{if(!e||e.length<5){console.log("数据太短，无法解析为有效的二进制格式");return null}let t;try{const o=e.replace(/-/g,"+").replace(/_/g,"/");t=atob(o)}catch(e){console.error("二进制解码失败",e);return null}if(t.length<2){console.log("解码后数据太短，无法包含有效信息");return null}let o=0;const r=t.charCodeAt(o++);if(r===undefined||o>=t.length){console.log("无法读取路径数量或数量为0");return null}const l=[];for(let e=0;e<r;e++){if(o>=t.length){console.log("数据不完整，无法读取所有路径");return{paths:l,dots:[]}}const e=t.charCodeAt(o++);if(e===undefined||e<1||o>=t.length){console.log("无效的点数量");continue}let r=[];let n=0,a=0;let s=e>2;let i=true;let c=null;for(let p=0;p<e;p++){if(o+1>=t.length){console.log("数据不完整，无法读取所有点");if(r.length>0){l.push(r)}return{paths:l,dots:[]}}if(p===0){const e=t.charCodeAt(o++)*2;const l=t.charCodeAt(o++)*2;n=e;a=l;r.push(createVector(e,l))}else{const e=t.charCodeAt(o++);const l=t.charCodeAt(o++);const f=e-128;const d=l-128;if(s&&p>1){const e=r[p-1].x-r[p-2].x;const t=r[p-1].y-r[p-2].y;if(p===2){c={dx:e,dy:t}}if(c){const e=Math.sign(f)===Math.sign(c.dx)&&Math.sign(d)===Math.sign(c.dy);if(!e){i=false}}}n+=f;a+=d;r.push(createVector(n,a))}}if(r.length>=2){if(s&&i&&r.length>2){const e=r[0].copy();const t=r[r.length-1].copy();r=[e,t]}l.push(r)}else{console.log("路径点数不足，已忽略")}}const n=[];if(o<t.length){try{const e=t.charCodeAt(o++);if(e>0&&e<100){for(let r=0;r<e;r++){if(o+1>=t.length){console.log(`数据不足，无法解析第${r+1}个点`);break}const e=t.charCodeAt(o++)*2;const l=t.charCodeAt(o++)*2;if(e>0&&e<500&&l>0&&l<500){n.push(createVector(e,l))}else{console.log(`忽略超出画布范围的点: (${e}, ${l})`)}}}}catch(e){console.error("解析独立点时出错",e)}}if(l.length>0||n.length>0){const e={paths:l,dots:n};const t={paths:l.map((e=>({length:e.length,first:e.length>0?{x:e[0].x,y:e[0].y}:null,last:e.length>0?{x:e[e.length-1].x,y:e[e.length-1].y}:null}))),dots:n.map((e=>({x:e.x,y:e.y})))};return e}else{console.log("解压结果无有效数据");return null}}catch(e){console.error("二进制解码失败",e);return null}}{function Jr(){pgL0.clear();pgL1.clear();pgL15.clear();pgL2.clear();pgL3.clear();pgL4.clear();pgText.clear();pgFinal.clear()}function Kr(){if(!Ht||Ht.length===0){console.warn("yPositions 為空或未定義");return}jt=[...Ht].sort(((e,t)=>{if(abs(e.y-t.y)<.001){return e.index-t.index}return e.y-t.y}));Cl();if(!tt){tt=createGraphics(B.dim*B.ratio,B.dim)}tt.clear();for(let e of jt){if(Gt[e.index]){tt.image(Gt[e.index],0,0)}}}function Qr(){pgFinal.image(pgL0,0,0);if(Ao==0){pgFinal.image(pgL1,0,0);pgFinal.image(pgL15,0,0);pgFinal.image(pgL2,0,0)}else if(Ao==1){pgFrame.push();if(Ke==3||Ke==4)pgFrame.translate(-width/2,-height/2);pgFrame.image(pgL1,0,0);pgFrame.image(pgL15,0,0);pgFrame.image(pgL2,0,0);pgFrame.pop()}pgFinal.image(pgL3,0,0);pgFinal.image(pgL4,0,0);pgFinal.image(pgText,0,0);if(!Gt[ae]){Gt[ae]=createGraphics(B.dim*B.ratio,B.dim);Gt[ae].PLANT=fo.PLANT}Gt[ae].image(pgFinal,0,0);Ht[ae]={y:constrain(Pe,0,B.dim),index:ae};Kr();if(h==0)Jr()}function Zr(){for(let e of Gt){if(e){e.remove()}}Gt=[];$t=[];qt.clear();Ht=[];Ut=[];jt=[];ae=0;se=0;pe=false;fe=false;if(et){et.remove()}if(tt){tt.remove()}}}{function el(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,meta:l=e.PT||{},benScale:n=10,kk:a=1}=e;let s=[];let i=Zo([[3,2],[4,2],[5,2],[8,2],[9,2],[8,2]]);let c=0;for(let e=0;e<Fe.grass;e++){if(random(0,1)<l.grassProb&&l.grassCount<Fe.grass){l.grassCount++;let s=random(1.2,3)*he;let p=o+random(-15,15);let f=r+random(-15,15);let d=(e,0,Fe.grass,2,n);c++;N.leaf({pg:t,lTp:i,baseX:p,baseY:f,col:[l.grassColor[0],l.grassColor[1],l.grassColor[2],1],bRt:createVector(PI/2+random(-.5,.5),random(-1,1)*PI,0),bLe:l.grassLength*random(.8,1.5)*a,bwF:function(e){return l.grassShape(e)*l.grassWidth*s*a},bBF:function(t){return createVector(map(noise(t*2,e),0,1,-1,1)*d,0,map(noise(t*2,e+PI),0,1,-1,1)*d)}})}}return s}function tl(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,PT:l=e.PT||{},capWidth:n=e.capWidth}=e;if(!fo||!fo.PT){console.error("eachPlant or eachPlant.PT is undefined");return[]}let a=[];for(let e=0;e<Fe.mushroom;e++){if(random(0,1)<fo.PT.mushroomProb&&fo.PT.mushroomCount<Fe.mushroom){ol({pg:t,baseX:o+random(-5,5),baseY:r+random(-5,5),M:l,capWidth:n});fo.PT.mushroomCount++}}return a}function ol(e={}){let{pg:t,baseX:o,baseY:r,M:l=e.M||{},capWidth:n=l.capWidth,capHeight:a=l.capHeight,baseWidth:s=l.mushroomWidth,mushroomHeight:i=l.mushroomHeight,col:c=l.mushroomColor,strokeStrength:p=1,lineSegScale:f=Zo([.05,.2,1,5]),lineLimit:d=Zo([.4,.95,.1]),pointShift:m=3}=e;let h=jo(ho);p=p+h.random(0,1)*2;m=10*Me;let g=[];let u=i-a;let b=random(0,1)>.5;let x=[random(-1,1),random(-2,2),random(-1,1)];const y=(e=true)=>{const l={pg:t,baseX:o,baseY:r,bRt:createVector(PI/2,x[0],0),bLe:u,col:[co.colors.mushroom[0][0],co.colors.mushroom[0][1],co.colors.mushroom[0][2],1],bwF:e=>{let t=1-pow(1-e,.2);let o=noise(e*3)*2+.5;let r=sin(e*PI*3)*.1+1;return s*(1.2-t)*o*r},bBF:e=>createVector(x[1],x[2],0),bSh:3,closeS:true,curveS:false,mushroomStroke:true};return M.stem(l)};let F=y();let w=F.centerPos[F.centerPos.length-1];let P=random(.5,3);let V=random(0,1)>.5;let T=createVector(0,0,0);let C=[];let E=16;for(let e=0;e<E;e++){C.push({x:random(-2,2),y:random(1,2),z:random(-2,2)})}let D;if(random(0,1)<lo)D=co.colors.stroke[2];else D=co.colors.stroke[0];if(Oe==0)D=[0,0,1];const A=(e,l=false)=>{let s=createVector(e.x,e.y+7,e.z);let i=createVector(0,0,0);let f=[s.copy()];let d=[];let h=[];let g=E;let u=e=>createVector(sin(e*PI)*random(-2,2)*P,-cos(e*PI)*random(1,2),cos(e*PI)*random(-2,2)*P);let b=(e,t)=>{let o=n*sin(e*PI);let r=noise(e*5)*.3;if(V){t=t==="left"?"right":"left"}return t==="left"?o*(1-r):o*(1+r)};for(let e=0;e<g;e++){let n=e/(E-1);let p=createVector(sin(n*PI)*C[e].x,-cos(n*PI)*C[e].y,cos(n*PI)*C[e].z);i.add(p5.Vector.mult(p,1/E));let m=createVector(0,-a/E,0);let g=Ho.applyEulerRotation(m,i);s.add(g);let u=b(n,"left");let x=b(n,"right");if(l){if(n<.5){let e=map(n,0,.5,-.5,1);let t=sin(map(e,0,1,PI/2,PI));u*=t;x*=t}if(n>.5)continue}let y=Ho.applyEulerRotation(createVector(-u,0,0),i);let F=Ho.applyEulerRotation(createVector(x,0,0),i);d.push(p5.Vector.add(s,y));h.push(p5.Vector.add(s,F));f.push(s.copy());if(e>0){let n;let a;let s;if(l){n=c.cap[0];a=c.cap[1];s=c.cap[2]}else{n=c.cap[0];a=c.cap[1];s=c.cap[2]*.7}yl({pg:t,pts:[d[e],d[max(e-2,0)],f[max(e-2,0)],f[e]],baseX:o,baseY:r,doFill:true,doStr:false,col:sr(n,a,s,1),randomOffset:1,vertexMode:Dt});yl({pg:t,pts:[h[e],h[max(e-2,0)],f[max(e-2,0)],f[e]],baseX:o,baseY:r,doFill:true,doStr:false,col:sr(n,a,s,1),randomOffset:1,vertexMode:Dt})}}if(!l){Fl({pg:t,pts:d.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-m,m);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(D[0],D[1],D[2],1),bwF:e=>(.15*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*_e});Fl({pg:t,pts:h.map((e=>{let t=map(noise(e.x*be,e.y*be,frameCount),0,1,-m,m);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(D[0],D[1],D[2],1),bwF:e=>(.15*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*_e})}else if(l){let l=5;for(let n=0;n<l;n++){let a=floor(map(n,0,l-1,d.length*.1,d.length*.9));if(a>=0&&a<d.length){let l=d[a];let s=h[a];let i=createVector(e.x,e.y-5,e.z);let c=[];let p=[];let f=10;for(let e=0;e<=f;e++){let t=e/f;let o=lerp(l.x,i.x,t);let r=lerp(l.y,i.y,t);let a=lerp(l.z,i.z,t);let s=sin(t*PI)*noise(t*5+n)*5;o+=s*noise(t*3+n*10);r+=s*noise(t*3+n*20);c.push(createVector(o,r,a))}for(let e=0;e<=f;e++){let t=e/f;let o=lerp(s.x,i.x,t);let r=lerp(s.y,i.y,t);let l=lerp(s.z,i.z,t);let a=sin(t*PI)*noise(t*5+n+100)*5;o+=a*noise(t*3+n*10+100);r+=a*noise(t*3+n*20+100);p.push(createVector(o,r,l))}Fl({pg:t,pts:c,bwF:e=>{let t=1;let o=noise(e*5+n*10)*.5+.5;let r=sin(e*PI);let l=1-pow(abs(e-.5)*2,2);return t*r*o*l},doFill:true,baseX:o,baseY:r,col:sr(D[0],D[1],D[2],.5)});Fl({pg:t,pts:p,bwF:e=>{let t=1;let o=noise(e*5+n*10+100)*.5+.5;let r=sin(e*PI);let l=1-pow(abs(e-.5)*2,2);return t*r*o*l},doFill:true,baseX:o,baseY:r,col:sr(D[0],D[1],D[2],.5)})}}Fl({pg:t,pts:d.map((e=>{let t=map(noise(e.x*be,e.y*be),0,1,-m,m);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,doFill:true,col:sr(D[0],D[1],D[2],1),bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*_e});Fl({pg:t,pts:h.map((e=>{let t=map(noise(e.x*be,e.y*be),0,1,-m,m);let o=map(noise(e.y*be,e.x*be,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,doFill:true,col:sr(D[0],D[1],D[2],1),bwF:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*p*_e})}return{leftPos:d,rightPos:h,centerPos:f}};if(b){t.push();y(true);let e=A(w);al(t,o,r,n,a,e.leftPos,e.rightPos,e.centerPos,c.cap);t.pop()}else{t.push();let e=y(false);let l=e.centerPos[e.centerPos.length-1];let s=A(l,false);al(t,o,r,n,a,s.leftPos,s.rightPos,s.centerPos,c.cap);A(l,true);y(true);t.pop()}return g}function rl(e,t){let o=false;for(let r=0,l=t.length-1;r<t.length;l=r++){let n=t[r].x,a=t[r].y;let s=t[l].x,i=t[l].y;let c=a>e.y!==i>e.y&&e.x<(s-n)*(e.y-a)/(i-a)+n;if(c)o=!o}return o}function ll(e,t){let o=null;let r=Infinity;for(let l=0,n=t.length-1;l<t.length;n=l++){let a=t[n];let s=t[l];let i=createVector(s.x-a.x,s.y-a.y);let c=createVector(e.x-a.x,e.y-a.y);let p=i.magSq();if(p===0){let t=dist(e.x,e.y,a.x,a.y);if(t<r){r=t;o=createVector(a.x,a.y)}continue}let f=c.dot(i);let d=constrain(f/p,0,1);let m=createVector(a.x+d*i.x,a.y+d*i.y);let h=dist(e.x,e.y,m.x,m.y);if(h<r){r=h;o=m}}return o||createVector(e.x,e.y)}function nl(e,t){for(let o of e){if(!rl(o,t)){let e=ll(o,t);o.x=e.x;o.y=e.y}}return e}function al(e,t,o,r,l,n,a,s,i){const c=random(10,15);let p=[];for(let r=0;r<c;r++){let r,c,f,d,m,h,g;let u=20;let b=50;let x=0;let y=false;while(!y&&x<b){r=floor(random(1,s.length-1));c=s[r];f=random(-l*2,l*2);d=random(-l*.5,l*.5);m=random(1,6);h=t+c.x+f;g=o+c.y+d;y=true;for(let e of p){let t=dist(h,g,e.x,e.y);if(t<u){y=false;break}}x++}if(!y)continue;p.push({x:h,y:g});let F=[];let w=random(.5,1.5);let P=random(.5,1.5);for(let e=0;e<60;e++){let t=e/60*TWO_PI;let o=noise(cos(t)*1.5,sin(t)*1.5)*.2+.9;let r=h+cos(t)*m*o*w;let l=g+sin(t)*m*o*P;F.push(createVector(r,l))}let V=[];for(let e=0;e<n.length;e++){V.push({x:t+n[e].x,y:o+n[e].y})}for(let e=a.length-1;e>=0;e--){V.push({x:t+a[e].x,y:o+a[e].y})}F=nl(F,V);yl({pg:e,pts:F,doFill:true,col:sr(i[0],i[1]*random(.8,1.2),i[2]*random(.8,1.2),1),randomOffset:2,n:5});let T;if(random(0,1)<lo)T=co.colors.stroke[2];else T=co.colors.stroke[0];Fl({pg:e,pts:F,doFill:true,col:sr(T[0],T[1],T[2],1),bwF:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*_e,randomOffset:1,n:5})}}function sl(e,t,o){let r=random(.1,.5);let l=random(random(0,1))*Zo([1,-1])*width*.4;let n=random(random(0,1))*Zo([1,-1])*height*.4;dl({pg:pgL4,baseX:e+l,baseY:t+n,size:r,bodyColor:[o.colors.butterfly[0][0],o.colors.butterfly[0][1],o.colors.butterfly[0][2]*random(.6,1.2),1],wingColor:[o.colors.butterfly[1][0]*random(.9,1.1),o.colors.butterfly[1][1],o.colors.butterfly[1][2]*random(.9,1.1),1]});if(window.debugMode6)hl(pgText,e,t,e+l,t+n,r)}function il(e,t,o){let r=random(.1,.5);let l=random(random(0,1))*Zo([1,-1])*width*.4;let n=random(random(0,1))*Zo([1,-1])*height*.4;ml({pg:pgL4,baseX:e+l,baseY:t+n,size:r,bodyColor:[o.colors.butterfly[0][0],o.colors.butterfly[0][1]*.8,o.colors.butterfly[0][2]*random(.8,1.2),1],wingColor:[0,0,random(.6,1),.3]});if(window.debugMode6)hl(pgText,e,t,e+l,t+n,r)}function cl(e,t,o){let r=random(.2,.4);let l=random(random(0,1))*Zo([1,-1])+random(-10,10);let n=random(random(0,1))*Zo([1,-1])+random(-10,10);pl({pg:pgL4,baseX:e+l,baseY:t+n,size:r,bodyColor:Zo([co.colors.stroke[1],co.colors.stroke[2]]),spotColor:co.colors.stroke[0],rotation:TWO_PI*.75+random(-1.5,1.5),ratio:random(.4,.8)});if(window.debugMode6)hl(pgText,e,t,e+l,t+n,r)}function pl(e={}){const{pg:t,baseX:o,baseY:r,size:l=1,bodyColor:n=[0,1,.5,1],spotColor:a=[0,0,.1,1],rotation:s=TWO_PI*.75,ratio:i=.5}=e;let c=30*l;let p=c*2*i;let f=o;let d=r;let m=s;let h=100;let g=100;let u=random(.05,.4);let b=Zo([.02,.15,.25,.4]);let x=int(map(b,.02,.15,90,80));let y=random(.8,1.2);let F=l<1?1/l*1:1;let w=p*1.2;let P=i*2;function V(e,t,o,r=0){let n=[];let a=r;let s=0;for(let r=0;r<t.length;r++){let i=e+o[r];a+=cos(i)*t[r]*(c/30)*l*F;s+=sin(i)*t[r]*(c/30)*l*F;n.push([a,s])}return n}function T(e,t,o,r=0){let n=[];let a=r;let s=0;for(let r=0;r<t.length;r++){let i=e+o[r];a+=cos(i)*t[r]*(c/30)*l*F;s+=sin(i)*t[r]*(c/30)*l*F;n.push([a,s])}return n}let C=[{baseAngle:-PI*.45,lengths:[10,10*P,10*P],angles:[0,PI*.25,-PI*.15],offsetX:w*1.6},{baseAngle:-PI*.5,lengths:[20,7*P,5*P],angles:[0,PI*.2,-PI*.1],offsetX:w*1.2},{baseAngle:-PI*.65,lengths:[18,6*P,4*P],angles:[0,PI*.15,-PI*.1],offsetX:w*.8}];let E=[{baseAngle:-PI*.3,lengths:[5,8*P,6*P],angles:[0,PI*.15,-PI*.2],offsetX:w*1.7},{baseAngle:PI*.3,lengths:[5,8*P,6*P],angles:[0,-PI*.15,PI*.2],offsetX:w*1.7}];let D=C.map((e=>V(e.baseAngle,e.lengths,e.angles,e.offsetX)));t.push();{t.push();t.stroke(a[0],a[1],a[2],.8);t.strokeWeight(.5*l);t.translate(f,d);t.rotate(m);t.translate(-c*.1,c*0);t.noFill();let e=100;let o=.8;E.forEach(((e,o)=>{let r=T(e.baseAngle,e.lengths,e.angles,e.offsetX);for(let e=0;e<r.length-1;e++){let o=e+1;fl(t,r[e][0],r[e][1],r[o][0],r[o][1],100,1,0)}}));t.pop()}{t.push();t.stroke(a[0],a[1],a[2],.8);t.strokeWeight(.6*l);t.translate(f,d);t.rotate(m);t.translate(-c*.2,c*-.3);t.noFill();let e=100;let o=1;D.forEach((e=>{for(let o=0;o<e.length-1;o++){let r=o+1;fl(t,e[o][0],e[o][1],e[r][0],e[r][1],100,1,0);t.push();t.scale(1,-1);t.translate(0,-c*.6);fl(t,e[o][0],e[o][1],e[r][0],e[r][1],100,1,0);t.pop()}}));t.pop();for(let e=0;e<200;e++){let o=e+1;let r,s;let i,F;let w=noise(e*.1+random(1e3));let P=map(w,0,1,-2,2)*l;if(e<h){r=p*cos(e/200*6.28)+p;i=pow(e/h,u)*sin(e/200*6.28)*c+P}else if(e>=h&&e<g){r=p*cos(e/200*6.28)+p;i=sin(e/200*6.28)*c+P}else if(e>=g){r=p*cos(e/200*6.28)+p;i=pow(1-(e-g)/h,u)*sin(e/200*6.28)*c+P}if(o<h){s=p*cos(o/200*6.28)+p;F=pow(o/h,u)*sin(o/200*6.28)*c+P}else if(o>=h&&o<g){s=p*cos(o/200*6.28)+p;F=sin(e/200*6.28)*c+P}else if(o>=g){s=p*cos(e/200*6.28)+p;F=pow(1-(o-g)/h,u)*sin(o/200*6.28)*c+P}t.push();t.translate(f,d);t.rotate(m);if(e<30){t.strokeWeight(.2);t.stroke(a[0],a[1],a[2],.8);let e=5;for(let o=0;o<e;o++){let e=r+random(-1,1)*l;let o=random(-1,1)*l;fl(t,e,o,e+random(-.5,.5),o+random(-.5,.5),40,i*.3,0)}fl(t,r,0,s,0,40,i,0,0)}else if(e>30&&e<100){t.strokeWeight(.15);t.stroke(n[0],n[1],n[2]*y,1);let e=3;for(let o=0;o<e;o++){let e=lerp(r,s,random(0,1));let o=lerp(0,i,random(0,1))+random(-1,1)*l;fl(t,e,o,e+random(-.3,.3),o+random(-.3,.3),30,i*.2,0)}fl(t,r,0,s,0,80,i,0)}if(e>32&&e<x){t.strokeWeight(.15);t.stroke(a[0],a[1],a[2],.6);let o=4;for(let n=0;n<o;n++){let o=lerp(r,s,random(0,1));let n=random(-.5,.5)*l;fl(t,o,n,o+random(-.2,.2),n+random(-.2,.2),30,map(e,32,x,p*.005,p*b)*random(.8,1.2))}fl(t,r,0,s,0,30,map(e,32,x,p*.005))}t.pop()}}t.pop()}function fl(e,t,o,r,l,n=20,a=2,s=1){for(let i=0;i<n;i++){let n=random(0,1);let i=lerp(t,r,n)+random(-a,a)*s;let c=lerp(o,l,n)+random(-a,a);e.point(i,c)}}function dl(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,size:l=1,bodyColor:n=[20,.5,.8,1],wingColor:a=[100,.7,.7,1],wingPattern:s=0,pointShift:i=1.5,strokeNoiseScale:c=.2,strokeStrength:p=1}=e;let f=jo(ho);p=p+f.random(0,1)*2;i=10*Me;let d=50*l;let m=30*l;let h=15*l;let g=createVector(PI/2,0,random(-2,2));let u=_.petal2({pg:t,baseX:o,baseY:r,bRt:g,bLe:d,bSg:10,bSh:3,bwF:e=>sin(e*PI)*1,bBF:e=>createVector(0,0,0),col:n,closeS:true,closeE:true});let b=map(l,.4,1.6,12,24);let x=u.centerPoints;let y=5;let F=x[y];let w=x[y-Qo(1,4)];let P=x[y+1]||x[y];let V=x[y-1]||x[y];let T=p5.Vector.sub(P,V).normalize();let C=createVector(-T.y,T.x,0).normalize();function E(e,t){if(e>.7){return sin(e*PI)*t*(1-e)*0}else{return sin(e*PI)*t*(1-e)*.8}}let D=random(1,2);_.petal({pg:t,baseX:o+F.x,baseY:r+F.y,direction:C.copy().mult(-1).rotate(-PI/3.5),bLe:m*3,bSg:b,bwF:e=>E(e,m*D),col:a,bBF:e=>createVector(0,sin(e*PI)*.8,-sin(e*PI)*.3),drawOutLine:1,strokeStrength:.4});_.petal({pg:t,baseX:o+w.x,baseY:r+w.y,direction:C.copy().mult(-1).rotate(PI/3),bLe:m*2,bSg:b-10,bwF:e=>E(e,m*.8),col:a,bBF:e=>createVector(0,-sin(e*PI)*.3,sin(e*PI)*.2),drawOutLine:1,strokeStrength:.4});_.petal({pg:t,baseX:o+F.x,baseY:r+F.y,direction:C.copy().rotate(PI/3.5),bLe:m*3,bSg:b,bwF:e=>E(e,m*D),col:a,bBF:e=>createVector(0,sin(e*PI)*.8,-sin(e*PI)*.3),drawOutLine:1,strokeStrength:.2});_.petal({pg:t,baseX:o+w.x,baseY:r+w.y,direction:C.copy().rotate(-PI/3),bLe:m*2,bSg:b-10,bwF:e=>E(e,m*.8),col:a,bBF:e=>createVector(0,-sin(e*PI)*.3,sin(e*PI)*.2),drawOutLine:1,strokeStrength:.2});let A=x[0];let S=[];let I=createVector(A.x-m*.1,A.y);let L=C.copy().mult(-1).rotate(-PI/2.5).normalize();for(let e=0;e<=20;e++){let t=e/20;let o=p5.Vector.add(I,p5.Vector.mult(L,t*m));let r=createVector(-L.y,L.x,0);o.add(p5.Vector.mult(r,sin(t*PI*.5)*m*.2));S.push(o)}let B=[];let v=createVector(A.x+m*.1,A.y);let k=C.copy().rotate(PI/2.5).normalize();for(let e=0;e<=20;e++){let t=e/20;let o=p5.Vector.add(v,p5.Vector.mult(k,t*m));let r=createVector(-k.y,k.x,0);o.add(p5.Vector.mult(r,-sin(t*PI*.5)*m*.2));B.push(o)}Fl({pg:t,pts:S,baseX:o,baseY:r,doFill:true,col:sr(0,0,0,1),bwF:e=>.5*(sin(e*PI)*.5+.5),randomOffset:1});Fl({pg:t,pts:B,baseX:o,baseY:r,doFill:true,col:sr(0,0,0,1),bwF:e=>.5*(sin(e*PI)*.5+.5),randomOffset:1})}function ml(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,size:l=1,bodyColor:n=[20,.5,.8,1],wingColor:a=[0,0,.9,.3],dir:s=0,pointShift:i=1.5,strokeNoiseScale:c=.2,strokeStrength:p=1}=e;let f=jo(ho);i=10*Me;let d=80*l;let m=40*l;let h=createVector(PI/2,0,random(-3,3));s=10;let g=_.petal2({pg:t,baseX:o,baseY:r,bRt:h,bLe:d,bSg:12,bSh:4,bwF:e=>sin(e*PI)*l*.8,bBF:e=>createVector(random(-3,3),random(0,2),2),col:n,closeS:true,closeE:true});let u=g.centerPoints;let b=floor(u.length*random(.3,.4));let x=u[b];let y=u[b+Zo([0,1])];let F=p5.Vector.sub(u[b+1]||u[b],u[b-1]||u[b]).normalize();let w=p5.Vector.sub(u[b+1]||u[b],u[b-1]||u[b]).normalize();let P=createVector(-F.y,F.x,0).normalize();let V=sin(s*.2)*PI*.1;V+=noise(s*.05)*PI*.05;function T(e,length,width,l,n){_.petal({pg:t,baseX:o+l.x,baseY:r+l.y,direction:e,bLe:length,bSg:12,bwF:e=>{let t=sin(e*PI)*width;if(e<.2)return t*e*5;if(e>.8)return t*(1-e)*5;return t},col:a,bBF:e=>createVector(sin(e*PI)*n,0,0),drawOutLine:1,strokeStrength:.1})}T(P.copy().mult(-1).rotate(-PI/6+V),m*1.4,m*.2,x,1);T(P.copy().mult(-1).rotate(-PI/12+V),m*1.1,m*.1,y,-1);T(P.copy().rotate(PI/6-V),m*1.4,m*.2,x,1);T(P.copy().rotate(PI/12-V),m*1.1,m*.1,y,-1);let C=u[0];let E=p5.Vector.sub(u[1],u[0]).normalize();let D=l*6;let A=l*random(2,3);let S=createVector(C.x-D*P.x,C.y-D*P.y,C.z);let I=createVector(C.x+D*P.x,C.y+D*P.y,C.z);H.drawGradientFlowerCenter(o+S.x,r+S.y,A,createVector(0,0,1),4);H.drawGradientFlowerCenter(o+I.x,r+I.y,A,createVector(0,0,1),4)}function hl(e,t,o,r,l,n){let a=n*50;e.push();e.stroke(0,0,0,1);e.strokeWeight(.5);e.noFill();let s=(t+r)/2;let i=(o+l)/2;let c=s-(l-o)*.2;let p=i+(r-t)*.2;let f=sqrt(pow(r-t,2)+pow(l-o,2));let d=round(f/2);d=max(d,20);e.beginShape();e.strokeWeight(.4);for(let n=0;n<=d;n++){let a=n/d;let s=pow(1-a,2)*t+2*(1-a)*a*c+pow(a,2)*r;let i=pow(1-a,2)*o+2*(1-a)*a*p+pow(a,2)*l;if(n%4<2){e.vertex(s,i)}else{e.vertex(s,i);e.endShape();e.beginShape()}}e.endShape();e.noStroke();e.noFill();e.stroke(0,0,0,1);e.strokeWeight(.3);e.rectMode(CENTER);e.rect(r,l,a,a);e.strokeWeight(.7);let m=a*.5;let h=a*.3;e.line(r,l-h,r,l-h-m);e.line(r,l+h,r,l+h+m);e.line(r-h,l,r-h-m,l);e.line(r+h,l,r+h+m,l);e.noStroke();let g=`X:${Math.round(r)} Y:${Math.round(l)} S:${n.toFixed(1)}`;e.textSize(6);let u=e.textWidth(g);let b=a*.4;let x=a*.05;e.fill(0,0,0,1);e.textAlign(LEFT,BOTTOM);e.text(g,r+a/2+x,l+a/2-a*.1);e.pop()}}{function gl(e={}){let{pts:t=[],pg:o=pgText,baseX:r=0,baseY:l=0,minPoints:n=50}=e;if(Ie[3]==0)return;if(t.length<n){let e=[];if(t.length>=2){for(let o=0;o<t.length-1;o++){let r=t[o];let l=t[o+1];let a=ul(r,l,ceil(n/(t.length-1)));if(o===0){e=e.concat(a)}else{e=e.concat(a.slice(1))}}t=e}}o.strokeWeight(.5);o.stroke(Ie[0],Ie[1],Ie[2],Ie[3]);o.noFill();for(let e=0;e<t.length-1;e++){if(e%1===0){o.ellipse(t[e].x+r,t[e].y+l,1)}}}function ul(e,t,o=20){let r=[];for(let l=0;l<o;l++){let n=l/(o-1);let a=lerp(e.x,t.x,n);let s=lerp(e.y,t.y,n);a+=rr(n*10)*.5;s+=rr(n*10+100)*.5;r.push(createVector(a,s))}return r}function bl(e={}){let{pts:t=[],bwF:o=e=>10,widthMultiplier:l=1}=e;let n=[];let a=[];let s=Be[0];let i=Be[1];if(t.length<3){return[[],[]]}for(let e=1;e<t.length-1;e++){l=map(noise(e*s,t.length*s),0,1,1/i,1*i);if(r==2)l=1;let c=o(e/t.length)*l;let p=t[e-1];let f=t[e];let d=t[e+1];let m=atan2(f.y-p.y,f.x-p.x);let h=atan2(f.y-d.y,f.x-d.x);let g=(m+h)/2;if(g<h){g+=PI}n.push(createVector(f.x+c*cos(g),f.y+c*sin(g)));a.push(createVector(f.x-c*cos(g),f.y-c*sin(g)))}if(r==2)l=1;let c=t.length-1;let p=t[0];let f=t[c];let d=atan2(t[1].y-p.y,t[1].x-p.x)-PI/2;let m=atan2(f.y-t[c-1].y,f.x-t[c-1].x)-PI/2;let h=o(0)*l;let g=o(1)*l;n.unshift(createVector(p.x+h*cos(d),p.y+h*sin(d)));a.unshift(createVector(p.x-h*cos(d),p.y-h*sin(d)));n.push(createVector(f.x+g*cos(m),f.y+g*sin(m)));a.push(createVector(f.x-g*cos(m),f.y-g*sin(m)));return[n,a]}function xl(e,t=1,o=1,r=1){push();let l=hue(e);let n=saturation(e);let a=brightness(e);let s=alpha(e);let i=abs(l+We)%360;if(t>0)i=t;let c=n*o;let p=a*r;if(o>9)c=1;if(r>9)p=1;let f=color(i,c,p,s);pop();return f}function yl(e={}){let{pts:t=[],pg:o=pgL3,doFill:r=true,col:l=color("black"),baseX:n=0,baseY:a=0,randomOffset:s=0,vertexMode:i=0}=e;const c=t.length*1e3+n*10+a+random(0,1e4)^ho;const p=jo(c);if(i==1)s=0;else s=max(s*Ne,.5);function f(){if(b==1)return random(-s,s);else return map(noise(c),0,1,-s,s)}if(Pt==1&&i==0){l=color(go[0],go[1],go[2]*Ct,1)}if(i==0&&Pt==0)l=xl(l,$e[0],$e[1],$e[2]);o.beginShape();if(t.length>-1){if(r){let e=noise(t.length*10)>.3?2:1;if(i==0){o.fill(hue(l),saturation(l)*Xe,brightness(l)*Ye,alpha(l)*ze)}else if(i==1){o.fill(hue(l),saturation(l)*Xe,brightness(l)*Ye*random(.8,1),alpha(l)*constrain(random(-.2,.5*e),.5,.9)*ze)}else{o.fill(hue(l),saturation(l)*Xe,brightness(l)*Ye*random(.9,1),alpha(l)*constrain(random(-.2,.5*e),.7,.9)*ze)}o.noStroke()}else{o.noFill()}if(i==0){for(let e=0;e<t.length;e++){o.vertex(t[e].x+n+f(),t[e].y+a+f())}}else if(i==1){for(let e=0;e<t.length;e++){o.curveVertex(t[e].x+n+f(),t[e].y+a+f())}}else if(i==2){let e=t[0];o.curveVertex(e.x+n+f(),e.y+a+f());o.curveVertex(e.x+n+f(),e.y+a+f());for(let e=1;e<t.length-2;e+=3){let r=t[e];let l=t[e+1];let s=t[e+2];let i=lerp(r.x,l.x,random(.2,.4));let c=lerp(r.y,l.y,random(.2,.4));o.curveVertex(i+n+f(),c+a+f());let p=lerp(r.x,l.x,random(.4,.6));let d=lerp(r.y,l.y,random(.4,.6));o.curveVertex(p+n+f()*1.2,d+a+f()*1.2);let m=lerp(l.x,s.x,random(.2,.4));let h=lerp(l.y,s.y,random(.2,.4));o.curveVertex(m+n+f(),h+a+f());o.curveVertex(s.x+n+f(),s.y+a+f())}for(let e=floor(t.length/3)*3;e<t.length;e++){let r=t[e];o.curveVertex(r.x+n+f(),r.y+a+f())}let r=t[t.length-1];o.curveVertex(r.x+n+f(),r.y+a+f())}}o.endShape(CLOSE)}function Fl(e={}){let{pts:t=[],pg:o=pgL3,baseX:r=0,baseY:l=0,col:n="black",bwF:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:i=0,vertexMode:c=1,minPoints:p=10,sameWidth:f=0,forceBrush:d=0}=e;if(d==1){return Pl(e)}if(Bt==0){return Pl(e)}else if(Bt==1){return Pl(e),wl(e)}}function wl(e={}){let{pts:t=[],pg:o=pgL3,baseX:r=0,baseY:l=0,col:n="black",bwF:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:i=0,vertexMode:c=1,minPoints:p=10,sameWidth:f=0}=e;let d=jo(ho);let m;if(Pt==1){let e=co.colors.stroke[0];let t=co.colors.stroke[1];if(Et==0)m=sr(e[0],e[1],e[2],.4);else if(Et==1)m=sr(t[0],t[1],t[2],.3);else if(Et==2)m=sr(0,0,1,.5)}else{m=n;m.levels[3]=.5;if(m.levels[3]===0)return}let h=1;let[g,u]=bl({pts:t,bwF:e=>a(e)*h});o.push();o.noStroke();let b=g.concat(u.reverse());if(b.length<2){o.pop();return[g,u]}let x=[];for(let e=0;e<b.length-1;e++){let t=b[e];let o=b[e+1];let r=dist(t.x,t.y,o.x,o.y);let l=floor(map(r,0,20,2,6));l=constrain(l,2,6);x.push(t);for(let e=1;e<=l;e++){let r=e/(l+1);let n=lerp(t.x,o.x,r);let a=lerp(t.y,o.y,r);x.push({x:n,y:a})}}x.push(b[b.length-1]);let y=x.length;for(let e=0;e<y;e++){if(Ko(d,0,1)>.2){let t=hue(m);let n=saturation(m);let s=Ko(d,0,1)<.9?Ko(d,.7,1.3):Jo(d,[.8,2]);let i=brightness(m)*s;let c=x[e];let p=noise(c.x*.1,c.y*.1);let f=qo(d,1,3);for(let s=0;s<f;s++){let s=Ko(d,0,1)<.9?Ko(d,.8,1.8):Ko(d,2,3);s*=a(e/y);let p=Ko(d,0,1)>.05?random(.7,.98):Ko(d,1.2,2);let f=Ko(d,-s,s)*p;let m=Ko(d,-s,s)*p;o.fill(t,n,i,.3);s=constrain(s,0,4);if(s>=3)s=s*random(.1,.5);o.ellipse(c.x+f+r,c.y+m+l,s)}}}o.pop();return[g,u]}function Pl(e={}){let{pts:t=[],pg:o=pgL3,baseX:r=0,baseY:l=0,col:n="black",bwF:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:i=0,vertexMode:c=1,minPoints:p=10,sameWidth:f=0}=e;if(t.length<4){let e=[];for(let o=0;o<t.length-1;o++){let r=t[o];let l=t[o+1];e.push(r);let n=ceil((5-t.length)/(t.length-1));for(let t=1;t<=n;t++){let o=t/(n+1);let a=lerp(r.x,l.x,o);let s=lerp(r.y,l.y,o);e.push(createVector(a,s))}}e.push(t[t.length-1]);t=e}let d;if(Pt==1){let e=co.colors.stroke[0];let t=co.colors.stroke[1];if(Et==0)d=sr(e[0],e[1],e[2],.8);else if(Et==1)d=sr(t[0],t[1],t[2],.5);else if(Et==2)d=sr(0,0,1,.9)}else{d=n instanceof p5.Color?n:color(n);if(!d||!d.levels||d.levels.length<4){console.warn("Invalid processedColor or levels missing:",d);return}if(d.levels[3]===0)return}let m=1;if(Et==2){m=random(0,1)<.05?random(5,10):random(0,1)<.5?random(2,3):random(.8,1.2)}if(Pt==1&&It==1){m=random(0,1)<.2?random(1.5,2.2):random(.8,1.2)}if(f==1)m=1;let[h,g]=bl({pts:t,bwF:e=>a(e)*m});if(It==1&&random(0,1)<.2){let[e,n]=bl({pts:t,bwF:e=>noise(e*10)*Zo([2,2,1,1,0])});let a=co.colors.stroke[2];o.push();o.noFill();o.strokeWeight(random(.5,2));o.stroke(a[0],a[1],a[2],.5);if(random(0,1)>.95){let e=r+random(-10,10);let t=l+random(-10,10);let n=random(1,3);o.ellipse(e,t,n)}o.pop();yl({pts:e.map((e=>({x:e.x+noise(e.x*.1,e.y*.1)*5,y:e.y+noise(e.y*.1,e.x*.1)*5}))).concat(n.reverse().map((e=>({x:e.x+noise(e.x*.1,e.y*.1)*5,y:e.y+noise(e.y*.1,e.x*.1)*5})))),pg:o,col:sr(a[0],1,a[2]*Zo([.6,1,1.2]),1),baseX:r,baseY:l,randomOffset:i,vertexMode:1})}yl({pts:h.concat(g.reverse()),pg:o,col:d,baseX:r,baseY:l,randomOffset:i,vertexMode:1});return[h,g]}}function draw(){ortho(-width/2*L,width/2*L,-height/2*L,height/2*L,-1e4,1e4);if(fe==false&&ae>=ce){fe=true;if(e==1){setTimeout((()=>{saveCanvas(zt,"png")}),500);setTimeout((()=>{ho=Qo(3e6,99e5);let e=window.location.hash;let t="";if(e.includes("data_")){t="#data_"+e.split("data_")[1].split("#")[0]}window.location.hash=t+(t?"#":"")+"seed_"+ho}),3500)}if(window.isMachine){console.log("capturePreviewFromVerse");setTimeout((()=>{window.capturePreviewFromVerse("snap2Verse")}),300)}console.log("");console.log("== all done ==")}if(fe==false){Ot.setState({distance:1e3,center:[0,0,0],rotation:[1,0,0,0]});if(!pe&&ae<ce)k();else if(pe==true&&ae<ce)X()}if(fe==true){if(t==0&&I==0){noLoop()}else{if(I==0){let e=frameCount*.005;let t=Ot.getState();if(!Mt){_t=millis();Mt=true}let o=constrain((millis()-_t)/Nt,0,1);let r=1;let l=.01*cos(e);let n=.06*sin(e);let a=-.01;let s=sqrt(r*r+l*l+n*n+a*a);r/=s;l/=s;n/=s;a/=s;let i=t.rotation;let c=[r,l,n,a];t.rotation=[lerp(i[0],c[0],o*.1),lerp(i[1],c[1],o*.1),lerp(i[2],c[2],o*.1),lerp(i[3],c[3],o*.1)];Ot.setState(t)}Cl()}}if(fe&&!Mt){$t=[]}}function Vl(){let e=get();pgVerse.image(e,0,0,pgVerse.width,pgVerse.height)}function Tl(e){randomSeed(e);noiseSeed(e)}function Cl(){rectMode(CENTER);clear();stroke(1,0,1,1);noFill();Ot.beginHUD();push();translate(0,0,-1e3);image(pgBg,width/2,height/2);pop();Ot.endHUD();for(let e=0;e<jt.length;e++){let t=jt[e];if(!Gt[t.index]){console.warn(`圖層 ${t.index} 不存在`);continue}push();let o=constrain(t.y,0,B.dim);let r=map(e,0,jt.length,-700,-200);r+=e*.001;translate(0,0,r);image(Gt[t.index],0,0,width,height);if(I==1){noFill();stroke(0,0,0,1);strokeWeight(1);rect(0,0,width,height)}pop()}Ot.beginHUD();push();if(F){blendMode(DARKEST);image(F,width/2,height/2,width,height)}blendMode(BLEND);if(I==0)image(pgFrame,width/2,height/2);blendMode(MULTIPLY);image(pgTex,width/2,height/2);blendMode(BLEND);pop();Ot.endHUD()}function El(e){if(I==1){let t=.05;if(e.delta>0){L+=t}else{L-=t}L=constrain(L,.01,5);return false}}function keyPressed(){if(keyCode===ENTER){console.log("save image:"+zt+".png");saveCanvas(zt,"png")}if(keyCode===32){let hash=window.location.hash;let e="";if(hash.includes("data_")){e=decodeURIComponent(hash)}let t;try{t=JSON.parse(e)}catch(o){t=e}let o={hash:t,plantStatistics:a,pathData:pathData};let r=JSON.stringify(o,null,2);console.log("save json:"+zt+".json");saveJSON(o,zt+".json")}if(key==="g"||key==="G"){W(jt,Gt,ho)}}function mousePressed(){}function Dl(){window.location.reload()}function Al(){const e=document.querySelector("canvas");if(!e)return;const t=window.innerWidth;const o=window.innerHeight;const r=B.dim*B.ratio;const l=B.dim;if(t/o>r/l){e.style.height=o+"px";e.style.width=o*r/l+"px"}else{e.style.width=t+"px";e.style.height=t*l/r+"px"}}function Sl(e,t=100,o=10){pgText.push();pgText.translate(-width/2,-height/2);pgText.fill(0,1,1,1);pgText.ellipse(0,0,100);pgText.pop();console.log("drawPathWithArrows");pgText.stroke(0,1,1,1);pgText.strokeWeight(2);pgText.noFill();pgText.beginShape(LINES);for(let t=0;t<e.length;t++){if(t===0){pgText.vertex(e[t][0],e[t][1])}else{let o=e[t-1];let r=e[t];let l=dist(o[0],o[1],r[0],r[1]);if(l<=20){pgText.vertex(r[0],r[1])}else{pgText.endShape();pgText.beginShape(LINES);pgText.vertex(r[0],r[1])}}}pgText.endShape();let r=0;for(let l=1;l<e.length;l++){let[n,a]=e[l-1];let[s,i]=e[l];let c=dist(n,a,s,i);if(c>30)continue;r+=c;if(r>=t){let e=Math.atan2(i-a,s-n);Il(s,i,e,o);r=0}}}function Il(e,t,o,r){pgText.push();pgText.translate(e,t);pgText.rotate(o);pgText.fill(120,1,1,1);pgText.stroke(0,0,1,1);pgText.strokeWeight(.5);pgText.triangle(0,0,-r,-r/2,-r,r/2);pgText.pop()}window.addEventListener("resize",Al);window.setup=setup;window.draw=draw;let Ll={},Bl=0;let vl={paths:[[{x:244,y:170},{x:110,y:239}],[{x:109,y:253},{x:228,y:332}],[{x:251,y:334},{x:361,y:275}],[{x:358,y:265},{x:249,y:176}],[{x:220,y:246},{x:112,y:381}],[{x:266,y:275},{x:369,y:347}],[{x:272,y:222},{x:381,y:220}],[{x:170,y:246},{x:171,y:49}],[{x:241,y:294},{x:224,y:432}],[{x:289,y:243},{x:409,y:157}],[{x:305,y:391},{x:391,y:301}]],dots:[{x:295,y:352},{x:130,y:300},{x:135,y:170},{x:313,y:248},{x:304,y:180}]};let kl={paths:[[{x:70,y:418},{x:15,y:340}],[{x:47,y:357},{x:119,y:266}],[{x:130,y:352},{x:71,y:291}],[{x:125,y:395},{x:228,y:299}],[{x:171,y:406},{x:294,y:336}],[{x:270,y:413},{x:235,y:336}],[{x:330,y:380},{x:310,y:252}],[{x:312,y:453},{x:404,y:341}],[{x:436,y:415},{x:346,y:321}],[{x:466,y:367},{x:423,y:243}]],dots:[{x:170,y:283},{x:140,y:454},{x:272,y:317},{x:402,y:293},{x:236,y:397},{x:442,y:479},{x:375,y:317},{x:57,y:485},{x:242,y:445}]};let Xl={paths:[[{x:471,y:100},{x:66,y:105}],[{x:44,y:120},{x:296,y:125}],[{x:472,y:249},{x:213,y:251}],[{x:45,y:225},{x:350,y:229}],[{x:36,y:387},{x:224,y:384}],[{x:114,y:406},{x:293,y:409}],[{x:450,y:378},{x:310,y:378}]],dots:[]};let Yl={paths:[[{x:249,y:483},{x:226.28,y:425.04},{x:184.74,y:377.74},{x:145.58,y:328.11},{x:122.15,y:269.87},{x:116,y:207}],[{x:213,y:367},{x:199,y:283.17},{x:210.83,y:198.68},{x:240.26,y:118.47},{x:251,y:35}],[{x:254,y:433},{x:282.65,y:376.35},{x:333.84,y:332.16},{x:366.24,y:274.16},{x:374,y:207}],[{x:248,y:393},{x:266,y:300.23},{x:298.7,y:211.53},{x:317,y:119}]],dots:[{x:194,y:442},{x:301,y:396},{x:318,y:451},{x:227,y:334},{x:308,y:332}]};let zl={paths:[[{x:455,y:245},{x:409.73,y:135.67},{x:318.71,y:60},{x:204.1,y:40.3},{x:98.42,y:96.58},{x:35.44,y:200.4},{x:41.71,y:318.82},{x:116.74,y:413.83},{x:221.71,y:465.71},{x:338.62,y:455.38},{x:423.31,y:370.39},{x:464,y:260}],[{x:103,y:449},{x:232,y:372}],[{x:402,y:430},{x:342,y:338}],[{x:53,y:109},{x:91,y:241}],[{x:448,y:180},{x:307,y:187}]],dots:[{x:392,y:355},{x:320,y:423},{x:206,y:428},{x:393,y:219},{x:100,y:350}]};let Ol={paths:[[{x:62,y:535},{x:4,y:391}],[{x:63,y:535},{x:71,y:276}],[{x:145,y:528},{x:98,y:434}],[{x:163,y:537},{x:169,y:336}],[{x:290,y:517},{x:227,y:420}],[{x:302,y:522},{x:364,y:375}],[{x:440,y:522},{x:417,y:312}],[{x:472,y:511},{x:480,y:400}],[{x:364,y:517},{x:300,y:392}],[{x:449,y:502},{x:450,y:441}],[{x:207,y:515},{x:215,y:247}],[{x:0,y:214},{x:94,y:281}],[{x:0,y:328},{x:182,y:387}]],dots:[{x:386,y:493},{x:236,y:492},{x:292,y:493},{x:84,y:492},{x:416,y:481},{x:19,y:487},{x:142,y:493}]};let Rl={paths:[[{x:270,y:508},{x:255,y:300}],[{x:344,y:522},{x:314,y:144}],[{x:518,y:63},{x:335,y:301}],[{x:506,y:209},{x:414,y:330}],[{x:173,y:532},{x:189,y:226}],[{x:2,y:222},{x:92,y:334}],[{x:100,y:522},{x:94,y:391}],[{x:438,y:516},{x:430,y:356}],[{x:529,y:394},{x:223,y:443}],[{x:57,y:526},{x:32,y:349}]],dots:[{x:138,y:528},{x:234,y:488},{x:327,y:486},{x:405,y:479},{x:475,y:490},{x:9,y:491},{x:159,y:491},{x:62,y:541}]};let Wl={paths:[[{x:87,y:476},{x:85,y:299}],[{x:86,y:263},{x:89,y:104}],[{x:154,y:432},{x:155,y:176}],[{x:233,y:478},{x:243,y:299}],[{x:246,y:271},{x:251,y:56}],[{x:340,y:482},{x:345,y:197}],[{x:345,y:153},{x:345,y:101}],[{x:423,y:411},{x:421,y:290}],[{x:423,y:99},{x:423,y:182}]],dots:[]};let _l={paths:[[{x:27,y:445},{x:436,y:426}],[{x:445,y:441},{x:198,y:420}],[{x:28,y:265},{x:221,y:271}],[{x:143,y:282},{x:358,y:244}],[{x:272,y:257},{x:470,y:274}],[{x:21,y:92},{x:322,y:105}],[{x:162,y:109},{x:466,y:83}],[{x:64,y:382},{x:285,y:387}],[{x:443,y:211},{x:295,y:221}]],dots:[]};let Ml={paths:[[{x:57,y:53},{x:472,y:86}],[{x:51,y:89},{x:341,y:56}],[{x:50,y:253},{x:224,y:199}],[{x:144,y:207},{x:417,y:237}],[{x:457,y:282},{x:373,y:215}],[{x:36,y:426},{x:232,y:394}],[{x:82,y:407},{x:367,y:411}],[{x:462,y:425},{x:306,y:390}]],dots:[{x:263,y:431},{x:115,y:240},{x:384,y:251},{x:179,y:82},{x:395,y:66},{x:466,y:99},{x:262,y:245}]};function Nl(e){const t=`\n\t\t\tuniform mat4 uModelViewMatrix;\n\t\t\tuniform mat4 uProjectionMatrix;\n\t\t\tattribute vec3 aPosition;\n\t\t\tattribute vec2 aTexCoord;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\tvoid main() {\n\t\t\t  vTexCoord = aTexCoord;\n\t\t\t  vec4 viewModelPosition = uModelViewMatrix * vec4(aPosition, 1.0);\n\t\t\t  gl_Position = uProjectionMatrix * viewModelPosition;\n\t\t\t}\n\t\t  `;const o=`\n\t\t\tprecision mediump float;\n\t\t\t#define PROCESSING_COLOR_SHADER\n\t\t\tuniform sampler2D subBrushsPg;\n\t\t\tuniform int blendMode;\n\t\t\tuniform int invert;\n\t\t\tuniform float glslAlpha;\n\t\t\tuniform float puta;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\tfloat extractLuma(vec3 c) {\n\t\t\t\treturn c.r * 0.299 + c.g * 0.587 + c.b * 0.114;\n\t\t\t}\n\t\t\tvec3 adjustSaturation(vec3 color, float saturation) {\n\t\t\t\tfloat luminance = extractLuma(color);\n\t\t\t\treturn mix(vec3(luminance), color, saturation);\n\t\t\t}\n\t\t\tvec3 contrast(vec3 color, float amount) {\n\t\t\t\treturn (color - 0.5) * amount + 0.5;\n\t\t\t}\n\t\t\tvoid main(void) {\n\t\t\t\tvec2 uv = vTexCoord.st;\n\t\t\t\tvec4 texColor = texture2D(subBrushsPg, uv);\n\t\t\t\tvec3 brush = texColor.rgb;\n\t\t\t\tfloat accumY = 0.0;\n\t\t\t\tvec2 texelSize = vec2(1.0) / vec2(1024.0, 1024.0);\n\t\t\t\tfor(int i = -1; i <= 1; ++i) {\n\t\t\t\t\tfor(int j = -1; j <= 1; ++j) {\n\t\t\t\t\t\tvec2 offset = vec2(i, j) * texelSize;\n\t\t\t\t\t\tfloat s = extractLuma(texture2D(subBrushsPg, uv + offset).rgb);\n\t\t\t\t\t\tfloat notCentre = min(float(i * i + j * j), 1.0);\n\t\t\t\t\t\taccumY += s * (9.0 - notCentre * 10.0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\taccumY /= 4.5;\n\t\t\t\tvec3 sharpenColor = mix(brush, vec3(accumY), 0.4);\n\t\t\t\tvec3 finalColor = contrast(sharpenColor, 1.0);\n\t\t\t\tfinalColor = adjustSaturation(finalColor, 0.9);  \n\t\t\t\tfinalColor = vec3(1.0) - ((vec3(1.0) - finalColor) * (vec3(1.0) - brush));\n\t\t\t\tif(puta==1.0) {\n\t\t\t\t\tfloat gray = extractLuma(finalColor);\n\t\t\t\t\t\tgl_FragColor = vec4(vec3(gray)*0.8, 1.0);\n\t\t\t\t}else{\n\t\t\t\t\tgl_FragColor = vec4(finalColor, glslAlpha);  \n\t\t\t\t}\n\t\t\t}\n\t\t\t`;return new p5.Shader(e,t,o)}function Hl(e){const t=`\n\t\t\tprecision mediump float;\n\t\t\tattribute vec3 aPosition;\n\t\t\tattribute vec2 aTexCoord;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\tvoid main() {\n\t\t\t  vTexCoord = aTexCoord;\n\t\t\t  vec4 positionVec4 = vec4(aPosition, 1.0);\n\t\t\t  positionVec4.xy = positionVec4.xy * 2.0 - 1.0;\n\t\t\t  gl_Position = positionVec4;\n\t\t\t}\n\t\t\t`;const o=`\n\t\t\tprecision mediump float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform float vol;\n\t\t\tuniform float magn;\n\t\t\tuniform float zoom;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\tvec3 mod289(vec3 x) {\n\t\t\t  return x - floor(x * (1.0 / 289.0)) * 289.0;\n\t\t\t}\n\t\t\tvec4 mod289(vec4 x) {\n\t\t\t  return x - floor(x * (1.0 / 289.0)) * 289.0;\n\t\t\t}\n\t\t\tvec4 permute(vec4 x) {\n\t\t\t\t return mod289(((x*34.0)+1.0)*x);\n\t\t\t}\n\t\t\tvec4 taylorInvSqrt(vec4 r)\n\t\t\t{\n\t\t\t  return 1.79284291400159 - 0.85373472095314 * r;\n\t\t\t}\n\t\t\tfloat snoise(vec3 v)\n\t\t\t  {\n\t\t\t  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t\t  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t\t  vec3 i = floor(v + dot(v, C.yyy) );\n\t\t\t  vec3 x0 = v - i + dot(i, C.xxx) ;\n\t\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t\t  vec3 l = 1.0 - g;\n\t\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t\t  vec3 x1 = x0 - i1 + C.xxx;\n\t\t\t  vec3 x2 = x0 - i2 + C.yyy; \n\t\t\t  vec3 x3 = x0 - D.yyy; \n\t\t\t  i = mod289(i);\n\t\t\t  vec4 p = permute( permute( permute(\n\t\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t\t  float n_ = 0.142857142857; \n\t\t\t  vec3 ns = n_ * D.wyz - D.xzx;\n\t\t\t  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); \n\t\t\t  vec4 x_ = floor(j * ns.z);\n\t\t\t  vec4 y_ = floor(j - 7.0 * x_ ); \n\t\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t\t  p0 *= norm.x;\n\t\t\t  p1 *= norm.y;\n\t\t\t  p2 *= norm.z;\n\t\t\t  p3 *= norm.w;\n\t\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t\t  m = m * m;\n\t\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n\t\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t\t  }\n\t\t\tconst float scalDiv = 4.;\n\t\t\tconst float scalDivt = 2.1;\n\t\t\tconst float sc1 = 1.0/scalDiv;\n\t\t\tconst float sc2 = sc1/scalDiv;\n\t\t\tconst float sc3 = sc2/scalDiv;\n\t\t\tconst float sc1t = 1.0 /scalDivt;\n\t\t\tconst float sc2t = sc1t/scalDivt;\n\t\t\tconst float sc3t = sc2t/scalDivt;\n\t\t\tfloat FBM(vec3 v) {\n\t\t\t\treturn 1.   *0.5    * snoise(v*vec3(sc3, sc3, sc3t)) +\n\t\t\t\t\t   0.4  *0.25   * snoise(v*vec3(sc2, sc2, sc2t)) +\n\t\t\t\t\t   0.15 *0.125  * snoise(v*vec3(sc1, sc1, sc1t));\n\t\t\t}\n\t\t\tfloat getGrayScale(sampler2D sampler, vec2 coods){\n\t\t\t\tvec4 color = texture2D(texture,coods);\n\t\t\t\tfloat gray = (color.r + color.g + color.b)/3.0*(vol+0.5);\n\t\t\t\treturn gray;\n\t\t\t}\n\t\t\tvec2 rotateUV(vec2 uv, float rotation) {\n\t\t\t\tfloat mid = 0.5;\n\t\t\t\treturn vec2(\n\t\t\t\t\tcos(rotation) * (uv.x - mid) + sin(rotation) * (uv.y - mid) + mid,\n\t\t\t\t\tcos(rotation) * (uv.y - mid) - sin(rotation) * (uv.x - mid) + mid\n\t\t\t\t);\n\t\t\t}\n\t\t\tvoid main(){\n\t\t\t   float v=vol;\n\t\t\t   float m=magn ;\n\t\t\t   float z = zoom ;\n\t\t\t   vec2 uv =  vTexCoord.st * (1. - 2.*z) + vec2(z, z);\n\t\t\t   float niceNoise1 = FBM( vec3(120.0 * uv*v,  60.0));\n\t\t\t   float niceNoise2 = FBM( vec3(120.0 * uv*v,  70.0));\n\t\t\t   vec4 mirror=texture2D(texture, uv + vec2(m*0.2*niceNoise1,m*0.21*niceNoise2) );\n\t\t\t   gl_FragColor = vec4(mirror.r,mirror.g,mirror.b,mirror.a);\n\t\t\t}\n\t\t\t`;return new p5.Shader(e,t,o)}function Gl(e){padfactor=10;let t=1e4;pgTex.push();let o=jo(ho);while(t--){x=o.random(0,pgTex.width);y=o.random(0,pgTex.height);pgTex.strokeWeight(o.random(.1,.2));pgTex.stroke(0,0,0,o.random(.1,.2)*e);pgTex.noFill();pgTex.curve(o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor),o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor),o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor),o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor))}pgTex.pop()}function Ul(e,t=1){let o=e*255;pgTex.noStroke();let r=jo(ho);for(var l=0;l<pgTex.width-1;l+=2){for(var n=0;n<pgTex.height-1;n+=2){if(ve==25)pgTex.fill(0,0,.5,.5);else pgTex.fill(0,0,r.random(180,265)/255,o/255);pgTex.rect(l,n,r.random(1.5,2)*t,r.random(1,1.5)*t)}}for(var l=0;l<30;l++){if(ve==25)pgTex.fill(0,0,.5,1);else pgTex.fill(0,0,r.random(60,170)/255,r.random(o,o*2)/255);pgTex.rect(r.random(0,pgTex.width-2),r.random(0,pgTex.height-2),r.random(1.5,2.5),r.random(1.5,2.5))}}function $l(e){let t=co.colors.bg[0][0];let o=co.colors.bg[0][1];let r=co.colors.bg[0][2];pgTex.push();let l=jo(ho);en(1e4);Zl(6e4);pgTex.pop()}function jl(){margin=0;let e=jo(ho);let t=e.random(0,1)>.5?e.random(pgTex.width*.3,pgTex.width*.4)+pgTex.width/2:-1*e.random(pgTex.width*.3,pgTex.width*.4)+pgTex.width/2;let o=e.random(0,1)>.5?e.random(pgTex.height*.3,pgTex.height*.4)+pgTex.height/2:-1*e.random(pgTex.height*.3,pgTex.height*.4)+pgTex.height/2;for(i=0;i<1e3;i++){pgTex.noStroke();pgTex.fill(0,0,e.random(0,.5),e.random(.005,.01)*1);let t=e.random(margin,pgTex.width-margin);let o=e.random(margin,pgTex.height-margin);pgTex.ellipse(t,o,e.random(pgTex.width*.02,pgTex.width*.2),e.random(pgTex.width*.02,pgTex.width*.2));t=e.random(margin,pgTex.width-margin);o=e.random(margin,pgTex.height-margin);pgTex.rect(t,o,e.random(pgTex.width*.02,pgTex.width*.2),e.random(pgTex.width*.02,pgTex.width*.2))}}function ql(e=1){brushSize=100;let t=jo(ho);brushSpan=qo(t,3,16);brushDist=qo(t,10,30);brushSpan=3;brushDist=10;const o=createGraphics(brushSize,brushSize);o.noFill();o.translate(brushSize/2,brushSize/2);for(let r=0;r<100;r++){o.stroke(t.random(.5,1)*255,10*e);const r=t.random(0,1)*brushSize/2;const l=t.random(0,1)*TAU;const n=r*cos(l);const a=r*sin(l);o.point(n,a)}for(let e=-brushSize;e<pgTex.width+brushSize;e+=pgTex.width/1e3){for(let t=-brushSize;t<pgTex.height+brushSize;t+=brushSpan){pgTex.image(o,e,t+(noise(e/10,t/10)-.5)*brushDist)}}}function Jl(e=1500,t=1){pgTex.push();let o=jo(ho);for(let r=0;r<e;r++){let e=o.random(0,pgTex.width);let r=o.random(0,pgTex.height);let l=o.random(3,15);let n=o.random(.5,2);let a=o.random(0,TWO_PI);pgTex.push();pgTex.translate(e,r);pgTex.rotate(a);pgTex.noFill();pgTex.strokeWeight(n);let s=o.random(.05,.3);let i=co.colors.bg[0];if(o.random(0,1)>.5)pgTex.stroke(i[0],i[1]*1.5,i[2],t*s);else pgTex.stroke(i[0],i[1],i[2]*2,t*s);let c=o.random(-2,2);let p=o.random(-2,2);pgTex.bezier(-l/2,0,-l/4+c,c,l/4+p,p,l/2,0);if(o.random(0,1)<.3){let e=l*o.random(.3,.6);let t=o.random(-PI/6,PI/6);pgTex.push();pgTex.rotate(t);pgTex.strokeWeight(n*.7);pgTex.bezier(0,0,e/4,o.random(-1,1),e/2,o.random(-1,1),e,0);pgTex.pop()}pgTex.pop()}pgTex.pop()}function Kl(shift=-3){const e=createGraphics(pgTex.width,pgTex.height);let t=min(pgTex.width,pgTex.height);t=t-t%10;e.colorMode(HSB,1);if(ve==25||ve==27)e.stroke(0,0,.5,.9);else e.stroke(.8,.3);e.noFill();const o=pgTex.width*pgTex.height;const r=sqrt(o);let l=map(B.pix,2,5.5,1,1.6);const n=int(r*l*.8);e.strokeWeight(t/1200/l);let a=jo(ho);for(let t=n;t--;){e.point(a.randomGaussian(pgTex.width/2,pgTex.width/4),a.randomGaussian(pgTex.height/2,pgTex.height/4))}for(let t=n;t--;){pgTex.push();const t=a.random(-shift,shift);const o=a.random(-shift,shift);pgTex.translate(t*pgTex.width/2/exp(abs(t)),o*pgTex.height/2/exp(abs(o)));pgTex.image(e,0,0);pgTex.pop()}e.remove()}function Ql(){let e=co.colors.bg[0];let t=1;pgTex.push();let o=jo(ho);let r=[[1,1.5],[1,2]];let l=Jo(o,r);l[1]=l[1]+.2;for(let r=0;r<width+1;r+=l[1]){for(let n=0;n<height+1;n+=l[1]){let a=.8;let s=e[0];let i=e[1];let c=e[2]*1.5;let p=o.random(l[0],l[1]);let f=p;if(noise(r*.04,n*.04,2)*o.random(0,1)*t>.8||o.random(0,1)<.01*t){s=0;i=0;c=1;p=o.random(.5,5);f=o.random(.5,5)}pgTex.noStroke();pgTex.fill(s,i,c,1);pgTex.rect(r,n,p,f)}}pgTex.pop()}function Zl(e){let t=co.colors.bg[0][0];let o=co.colors.bg[0][1];let r=co.colors.bg[0][2];let l=jo(ho);for(let t=0;t<e;t++){pgTex.stroke(0,0,1,l.random(.05,.1)+.15);pgTex.strokeWeight(l.random(.8,1.8));let e=l.random(0,1)*pgTex.width;let t=l.random(0,1)*pgTex.height;let o=l.random(0,1)*2*PI;let r=l.random(0,1)*10+5;let n=cos(o)*r+e;let a=sin(o)*r+t;let s=e+(l.random(0,1)-.5)*10;let i=t+(l.random(0,1)-.5)*10;let c=n+(l.random(0,1)-.5)*10;let p=a+(l.random(0,1)-.5)*10;pgTex.noFill();pgTex.curve(s,i,e,t,n,a,c,p)}}function en(e){const t=1e3;const o=e;let r=jo(ho);for(let e=0;e<o;e++){let e=r.random(-t,pgTex.width+t);let o=r.random(-t,pgTex.height+t);let l=r.random(-t,pgTex.width+t);let n=r.random(-t,pgTex.height+t);let a=r.random(-t,pgTex.width+t);let s=r.random(-t,pgTex.height+t);let i=r.random(-t,pgTex.width+t);let c=r.random(-t,pgTex.height+t);pgTex.push();pgTex.strokeWeight(r.random(.05,.13));pgTex.stroke(0,0,0,r.random(.04,.08));pgTex.noFill();pgTex.bezier(e,o,l,n,a,s,i,c);pgTex.pop()}}function tn(e){let t=jo(ho);if(!e){e=Jo(t,[4,5,6]);if(ve==25||ve==27)e=7}l.paperType=e;if(e==1){ql(.6);Jl(500,1)}else if(e==2){jl();ql(.5);Jl(300,2)}else if(e==3){ql(2);Kl(.1);Jl(300,2)}else if(e==4){Ul(.3);Jl(500,2)}else if(e==5){Kl();Jl(1e3,1);$l()}else if(e==6){Ql();Kl(.2);Jl(300,2)}else if(e==7){ql(2);Kl(.1);Jl(1e3,1);$l()}}class on{static stoneA(e={}){let{pg:t,baseX:o=0,baseY:r=0,size:l=random(5,20),roughness:n=1.3,detail:a=2,rotation:s=createVector(0,0,0),bSh:i=Qo(3,6),stoneH:c=random(.6,1.1),pointShift:p=2,strokeStrength:f=1.2,strokeNoiseScale:d=.1}=e;let m=jo(ho);f=f+m.random(0,1)*2;p=10*Me;function h(e){const t=10.1;const o=-.2;const r=(noise(e*t,Qo(0,100)*.05)+o)*random(3,6)*_e;return r>.5?r:random(0,1)>.8?0:0}t.push();let g=[];let u=random(TWO_PI);let b=floor(120*ue);let x=random(-.4,.4);let y=random(.4,-.4);for(let e=0;e<=b;e++){let t=e/b;let o=TWO_PI*t;let r=map(noise(cos(o)*a,sin(o)*a,u),0,1,1,1.1)*n;let s=map(noise(cos(o)*2,sin(o)*2,u+1e3),0,1,-.3,.3);let i=l*r;let p=cos(o)*i;let f=sin(o)*i;if(f>0){f*=.2}else{f*=c}p+=x*l+f*y;p+=s*l;p+=map(noise(p*.1,f*.1,u+2e3),0,1,-l*.1,l*.1);f+=map(noise(p*.1,f*.1,u+3e3),0,1,-l*.05,l*.05);g.push(createVector(p,f))}g.push(g[0]);let F=random(-PI/3,-PI/6);let w=random(.5,.8);let P=[];for(let e=0;e<i;e++){let t=e/(i-1);let o=g.map((e=>{let o=createVector(cos(F)*l*.2,sin(F)*l*.2);let r=p5.Vector.mult(o,1-t);return p5.Vector.lerp(e,r,t)}));P.push(o)}for(let e=0;e<P.length-1;e++){let l=P[e];let n=P[e+1];let a=e/(P.length-1);for(let e=0;e<l.length-1;e++){let a=l[e];let s=atan2(a.y,a.x);let i=co.colors.stone[0][0];let c=co.colors.stone[0][1];let p=co.colors.stone[0][2];yl({pg:t,pts:[l[e],l[min(e+2,l.length-1)],n[min(e+2,n.length-1)],n[e]],baseX:o,baseY:r,doFill:true,doFillBrush:true,doStr:false,col:sr(i,c,p,.8),randomOffset:1,vertexMode:0})}}let V=co.colors.stroke[Zo([0,0,0,2])];let T=co.colors.stroke[1];let C=Qo(2,6);let E=Zo([.4,.5,.6,.7]);for(let e=1;e<P.length;e++){let l=P[e];let n=l.filter((e=>{if(e.y>=0)return false;let t=abs(atan2(e.y,e.x));return t>.2&&t<3}));for(let l=0;l<n.length-C;l+=C){let a=n.slice(l,l+C+1);if(noise(e*100,l*100)<E){Fl({pg:t,pts:a,baseX:o,baseY:r,col:sr(T[0],T[1]*0,T[2]*random(.8,1),1),bwF:e=>(.5*(1-e)*map(noise(e*10+l),0,1,.5,1)+.5)*f*_e*random(1,2),randomOffset:.5,sameWidth:1,forceBrush:1})}}}for(let e=0;e<g.length-C;e+=C){let l=g.slice(e,e+C+1);Fl({pg:t,pts:l.map((e=>{let t=map(noise(e.x*d,e.y*d),0,1,-p,p);let o=map(noise(e.y*d,e.x*d),0,1,-p,p);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:sr(V[0],V[1],V[2],1),bwF:h,randomOffset:.5,sameWidth:1})}let D=co.colors.stone[0][0];let A=co.colors.stone[0][1];let S=co.colors.stone[0][2];let I=Qo(15,30);let L=0,B=0;g.forEach((e=>{L+=e.x;B+=e.y}));L/=g.length;B/=g.length;let v=0;g.forEach((e=>{let dist=sqrt(pow(e.x-L,2)+pow(e.y-B,2));v=max(v,dist)}));let k=co.colors.stroke[0];let X=co.colors.stroke[1];for(let e of P){for(let e=0;e<I;e++){let e=random(TWO_PI);let n=(1-random(random(0,1)))*v;let a=L+cos(e)*n;let s=B+sin(e)*n;if(on.isPointInPolygon(createVector(a,s),g)){let e=random(-l*.05,l*.05);let n=random(-l*.05,l*.05);let i=createVector(a+e,s+n);let c=random(2,3);t.push();t.noStroke();if(random(0,1)<.5)t.fill(sr(X[0],X[1],X[2],.8));else t.fill(sr(k[0],k[1],k[2],.5));t.ellipse(i.x+o,i.y+r,c,c);t.pop()}}}t.pop()}static stoneB(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,size:l=random(5,20)}=e;let n=on.generateCompositeStoneShape({size:l,shapeCount:floor(random(3,6))});function a(e){const t=10.1;const o=-.2;const r=(noise(e*t,Qo(0,100)*.05)+o)*random(3,6)*_e;return r>.5?r:random(0,1)>.8?0:0}n=on.validatePoints(n);if(n.length===0){console.error("Invalid stone points generated");return}let s=co.colors.stone[0][0];let i=co.colors.stone[0][1];let c=co.colors.stone[0][2];let p=Infinity,f=-Infinity;let d=Infinity,m=-Infinity;n.forEach((e=>{if(e&&e.x!==undefined&&e.y!==undefined){p=min(p,e.y);f=max(f,e.y);d=min(d,e.x);m=max(m,e.x)}}));let h=[];let g=l>20?Qo(5,12):Qo(2,5);let u=l>20?Qo(12,16):Qo(5,12);let b=[];for(let e=0;e<g;e++){b.push({x:random(d+l*.3,m-l*.3),y:random(p+l*.3,f-l*.3),size:l*random(.1,.3)*map(e,0,g-1,1,.7)})}for(let e of b){let t=on.generateCompositeHole({centerX:e.x,centerY:e.y,holeSize:e.size,shapeCount:Qo(2,5)});if(t&&Array.isArray(t)&&t.length>0){t=on.validatePoints(t);if(t.length>0){let e=on.clipHoleToStoneBoundary(t,n);if(e.length>=3){h.push(e)}}}}for(let e=0;e<u;e++){let t=l*random(.03,.08)*map(e,0,u-1,1,.6);let o=random(b);let r=random(TWO_PI);let a=random(l*.1,l*.3);let s=o.x+cos(r)*a;let i=o.y+sin(r)*a;if(on.isValidHolePosition(s,i,t,h,n,d,m,p,f)){let e=on.generateCompositeHole({centerX:s,centerY:i,holeSize:t});if(e&&Array.isArray(e)&&e.length>0){e=on.validatePoints(e);if(e.length>0){let t=on.clipHoleToStoneBoundary(e,n);if(t.length>=3){h.push(t)}}}}}let x=on.mergeOverlappingHoles(h);for(let e=0;e<3;e++){let l=n.map((e=>on.validatePoint(e)));if(l.length>0){let n=sr(s,i*map(e,0,2,1,.7),c*map(e,0,2,.9,.5),map(e,0,2,.9,.7));let p=30;let f=8;let d=[];let m=0,h=0;l.forEach((e=>{m+=e.x;h+=e.y}));m/=l.length;h/=l.length;for(let t=0;t<=f;t++){let o=t/f;let r=[];for(let t=0;t<=p;t++){let n=t/p;let a=TWO_PI*n;let s=null;let i=Infinity;for(let e=0;e<l.length;e++){let t=l[e];let o=l[(e+1)%l.length];let r=createVector(m+cos(a)*1e3,h+sin(a)*1e3);let n=on.lineIntersection(m,h,r.x,r.y,t.x,t.y,o.x,o.y);if(n){let dist=on.distance({x:m,y:h},n);if(dist<i){i=dist;s=n}}}if(s){let t=m+(s.x-m)*o;let l=h+(s.y-h)*o;let n=random(-2,2)*map(e,0,2,1,.5)*(1-o);t+=n*cos(a);l+=n*sin(a);r.push(createVector(t,l))}}d.push(r)}for(let e=0;e<d.length-1;e++){let l=d[e];let a=d[e+1];for(let e=0;e<l.length-1;e++){let s=[l[e],l[e+1],a[e+1],a[e]];yl({pg:t,pts:s,baseX:o,baseY:r,col:n,randomOffset:1})}}if(x&&Array.isArray(x)){x.forEach((l=>{if(l&&Array.isArray(l)&&l.length>2){let n=createVector(0,0);l.forEach((e=>{n.add(e)}));n.div(l.length);let a=[];let s=4;p=15;for(let t=0;t<=s;t++){let o=t/s;let r=[];for(let t=0;t<=p;t++){let a=t/p;let s=TWO_PI*a;let i=null;let c=Infinity;for(let e=0;e<l.length;e++){let t=l[e];let o=l[(e+1)%l.length];let r=createVector(n.x+cos(s)*1e3,n.y+sin(s)*1e3);let a=on.lineIntersection(n.x,n.y,r.x,r.y,t.x,t.y,o.x,o.y);if(a){let dist=on.distance({x:n.x,y:n.y},a);if(dist<c){c=dist;i=a}}}if(i){let t=n.x+(i.x-n.x)*o;let l=n.y+(i.y-n.y)*o;let a=random(-1,1)*map(e,0,2,.5,.2)*(1-o);t+=a*cos(s);l+=a*sin(s);r.push(createVector(t,l))}}a.push(r)}let i=co.colors.bg[0][0];let c=co.colors.bg[0][1];let f=co.colors.bg[0][2];let d=random(0,1)>.5?1:.5;for(let e=0;e<a.length-1;e++){let l=a[e];let n=a[e+1];for(let e=0;e<l.length-1;e++){let a=[l[e],l[e+1],n[e+1],n[e]];yl({pg:t,pts:a,baseX:o,baseY:r,col:sr(i,c,f*d,.8),randomOffset:1})}}}}))}let g=l.map((t=>{let o=random(-.5,.5)*map(e,0,2,1,.5);let r=t.copy();r.add(createVector(o,o));return r}));Fl({pg:t,pts:g,baseX:o,baseY:r,col:sr(s,i,c*.5,1),bwF:a,randomOffset:.3,sameWidth:1});if(x&&Array.isArray(x)){x.forEach((l=>{if(l&&Array.isArray(l)&&l.length>2){let n=l.map((t=>{let o=random(-.3,.3)*map(e,0,2,1,.5);let r=t.copy();r.add(createVector(o,o));return r}));Fl({pg:t,pts:n,baseX:o,baseY:r,col:sr(s,i*.9,c*.4,1),bwF:a,randomOffset:.2})}}))}}}let y=l>30?12:8;for(let e=0;e<y;e++){try{let n=isFinite(d)&&isFinite(m)?random(d,m):0;let a=isFinite(p)&&isFinite(f)?random(p,f):0;if(!isFinite(n)||!isFinite(a)){continue}let h=random(-PI/4,PI/4);if(isFinite(f)&&isFinite(p)&&isFinite(m)&&isFinite(d)){h+=atan2(f-p,m-d)}let length=l*random(.2,.5);if(!isFinite(length)){continue}let g=n+cos(h)*length;let u=a+sin(h)*length;if(!isFinite(g)||!isFinite(u)){continue}let b=(n+g)/2;let x=(a+u)/2;let y=length*.2;if(isFinite(y)){let e=h+PI/2;b+=cos(e)*random(-y,y);x+=sin(e)*random(-y,y)}if(!isFinite(b)||!isFinite(x)){continue}let F=[createVector(n,a),createVector(b,x),createVector(g,u)];if(F.every((e=>e&&isFinite(e.x)&&isFinite(e.y)))){F=F.map((e=>{if(!(e instanceof p5.Vector)){return createVector(e.x,e.y)}return e}));F=F.map((e=>{if(typeof e.copy!=="function"){e.copy=function(){return createVector(this.x,this.y)}}if(typeof e.add!=="function"){e.add=function(e){this.x+=e.x;this.y+=e.y;return this}}return e}));try{Fl({pg:t,pts:F,baseX:o,baseY:r,col:sr(s,i*.8,c*.5,.3),bwF:e=>.2*_e*(1-e),randomOffset:.5})}catch(t){console.error(`Error in texture line ${e}:`,t)}}}catch(t){console.error(`Error creating texture line ${e}:`,t)}}try{let e=n.filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined")).map((e=>{let t=random(-.5,.5);let o=e instanceof p5.Vector?e:createVector(e.x,e.y);let r=o.copy();r.add(createVector(t,t));return r})).filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined"));if(e.length>2){e=e.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));Fl({pg:t,pts:e,baseX:o,baseY:r,col:sr(s,i,c*.7,1),bwF:a,randomOffset:.5})}}catch(e){console.error("Error creating stone outline:",e)}if(x&&Array.isArray(x)){x.forEach((e=>{try{if(e&&Array.isArray(e)){let l=e.filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined")).map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));if(l.length>2){Fl({pg:t,pts:l,baseX:o,baseY:r,col:sr(s,i,c*.4,.8),bwF:a,randomOffset:.5})}}}catch(e){console.error("Error creating hole outline:",e)}}))}}static stoneC(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,hei:l=80,wid:n=100,tex:a=40,ret:s=0,sha:i=10,reso0:c=10,reso1:p=50,textureCount:f=Qo(8,12)}=e;let d=co.colors.stroke[Zo([0,0,0,2])];let m=co.colors.stroke[1];let h=[];for(let e=0;e<c;e++){h.push([]);let t=[];for(let o=0;o<p;o++){t.push(noise(e,o*.2))}for(let a=0;a<p;a++){let s=a/p*PI*2-PI/2;let i=n*l/sqrt(pow(l*cos(s),2)+pow(n*sin(s),2));i*=.7+.3*t[a];let f=1-e/c;let d=cos(s)*i*f;let m=-sin(s)*i*f;if(PI<s||s<0){m*=.2}m+=l*(e/c)*.2;h[h.length-1].push({x:d+o,y:m+r})}}if(h[0]&&h[0].length>3){let e=h[0].filter((e=>e&&typeof e.x==="number"&&typeof e.y==="number"));if(e.length>0&&(e[0].x!==e[e.length-1].x||e[0].y!==e[e.length-1].y)){e=e.concat([e[0]])}let o=e.map((e=>createVector(e.x,e.y)));let r=co.colors.stone[0][0];let l=co.colors.stone[0][1];let n=co.colors.stone[0][2];yl({pg:t,pts:o,baseX:0,baseY:0,col:sr(r,l,n,.7),doFill:true,doStr:false,randomOffset:0})}function g(e){return sin(e*PI)*random(1,2.5)*_e}function u(e){const t=10.1;const o=-.2;const r=(noise(e*t,Qo(0,100)*.05)+o)*random(2,4)*_e;return r>.5?r:random(0,1)>.8?0:0}if(h[0]&&h[0].length>3){let e=h[0].filter((e=>e&&typeof e.x==="number"&&typeof e.y==="number"));if(e.length>0&&(e[0].x!==e[e.length-1].x||e[0].y!==e[e.length-1].y)){e=e.concat([e[0]])}let o=e.map((e=>createVector(e.x,e.y)));Fl({pg:t,pts:o,baseX:0,baseY:0,col:sr(d[0],d[1],d[2],1),bwF:u,randomOffset:.2,sameWidth:0})}let b=h[0];let x=b.reduce(((e,t)=>e.y<t.y?e:t));let y=b.reduce(((e,t)=>e.x<t.x?e:t));let F=b.reduce(((e,t)=>e.x>t.x?e:t));let w=b.filter((e=>e.y>r+l*.3));for(let e=0;e<f;e++){let e=random(0,1)*(h.length-1);let o=floor(e);let r=ceil(e);let l=e-o;let n=floor(random(0,1)*h[0].length);let a=floor(random(0,1)*(h[0].length*.2));let s=max(0,n-a);let i=min(h[0].length,n+a);let c=[];for(let e=s;e<i;e++){let t=h[o][e].x*(1-l)+h[r][e].x*l;let n=h[o][e].y*(1-l)+h[r][e].y*l;c.push(createVector(t,n))}if(c.length>1){Fl({pg:t,pts:c,baseX:0,baseY:0,col:sr(d[0],d[1],d[2],random(.6,1)),bwF:g,randomOffset:.3,sameWidth:0})}}}static stoneD(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,hei:l=200,wid:n=300,tex:a=40,reso0:s=Qo(3,12),reso1:i=50,colorH:c=co.colors.stone[0][0],colorS:p=co.colors.stone[0][1],colorB:f=co.colors.stone[0][2]}=e;let d=[];let m=l*1.1;let h=random(.4,.6);for(let F=0;F<s;F++){m+=random(0,r)/100;d.push([]);for(let w=0;w<i;w++){let P=(w/i-.5)*Math.PI;let V=Math.cos(P);V*=noise(P*h+10,F*.25,0);let T=1-F/s;d[d.length-1].push({x:P/Math.PI*n*T+o,y:-V*l*T+m+r})}}function g(e){return sin(e*PI)*random(1,2)*_e}function u(e){const t=10.1;const o=-.2;const r=(noise(e*t,Qo(0,100)*.05)+o)*random(2,4)*_e;return r>.5?r:random(0,1)>.8?0:0}let b=[];if(d[0]&&d[0].length>3){let C=d[0].map((e=>createVector(e.x,e.y)));let E=C.reduce(((e,t)=>e.x<t.x?e:t));let D=C.reduce(((e,t)=>e.x>t.x?e:t));let A=r+l*1.1;let S=[];let I=12;let L=10;for(let B=0;B<=I;B++){let v=B/I;let k=E.x*(1-v)+D.x*v;let X=A+noise(k*.05,A*.05)*8+Math.sin(v*Math.PI)*L;S.push(createVector(k,X))}b=C.concat(S.reverse());yl({pg:t,pts:b,baseX:0,baseY:0,col:sr(c,p,f*random(.8,1.2),1),doFill:true,doStr:false,randomOffset:0});Fl({pg:t,pts:b,baseX:0,baseY:0,col:sr(co.colors.stroke[0][0],co.colors.stroke[0][1],co.colors.stroke[0][2],1),bwF:u,randomOffset:.2,sameWidth:0})}if(d[0]&&d[0].length>3){let Y=d[0].map((e=>createVector(e.x,e.y)));Fl({pg:t,pts:Y,baseX:0,baseY:0,col:sr(co.colors.stroke[0][0],co.colors.stroke[0][1],co.colors.stroke[0][2],1),bwF:u,randomOffset:.2,sameWidth:0})}let x=a;let y=[];if(d[0]&&d[0].length>3){let z=d[0].map((e=>createVector(e.x,e.y)));let O=z.reduce(((e,t)=>e.x<t.x?e:t));let R=z.reduce(((e,t)=>e.x>t.x?e:t));let W=r+l*1.1;let _=[];let M=12;for(let N=0;N<=M;N++){let H=N/M;let G=O.x*(1-H)+R.x*H;let U=W+noise(G*.05,W*.05)*8;_.push(createVector(G,U))}y=z.concat(_.reverse())}for(let $=0;$<x;$++){let j=random(0,1)*(d.length-1);let q=Math.floor(j);let J=Math.ceil(j);let K=j-q;let Q=Math.floor(random(0,1)*d[0].length);let Z=Math.floor(random(0,1)*(d[0].length*.2));let ee=Math.max(0,Q-Z);let te=Math.min(d[0].length,Q+Z);let oe=[];for(let re=ee;re<te;re++){let le=d[q][re].x*(1-K)+d[J][re].x*K;let ne=d[q][re].y*(1-K)+d[J][re].y*K;oe.push(createVector(le,ne))}if(oe.length>1&&y.length>2){let ae=[];for(let se=0;se<oe.length;se++){let ie=oe[se];if(on.isPointInPolygon(ie,y)){ae.push(ie)}else{if(ae.length>1){Fl({pg:t,pts:ae,baseX:0,baseY:0,col:sr(co.colors.stroke[0][0],co.colors.stroke[0][1],co.colors.stroke[0][2],random(.2,.5)),bwF:g,randomOffset:.2,sameWidth:0})}ae=[]}}if(ae.length>1){Fl({pg:t,pts:ae,baseX:0,baseY:0,col:sr(co.colors.stroke[0][0],co.colors.stroke[0][1],co.colors.stroke[0][2],random(.2,.5)),bwF:g,randomOffset:.2,sameWidth:0})}}}if(b&&b.length>3){let ce=Qo(100,300);let pe=1,fe=3;let de=4;let me=new Map;function he(e,t,o){let r=Math.floor(e.x/o);let l=Math.floor(e.y/o);for(let o=-1;o<=1;o++){for(let n=-1;n<=1;n++){let key=`${r+o},${l+n}`;if(t.has(key)){let o=t.get(key);for(let t of o){let o=p5.Vector.dist(e,t.pos);if(o<t.size/2+pe/2+1)return false}}}}return true}function ge(e,t,o,r){let l=Math.floor(e.x/o);let n=Math.floor(e.y/o);let key=`${l},${n}`;if(!t.has(key))t.set(key,[]);t.get(key).push({pos:e,size:r})}let ue=0,be=0,xe=ce*5;let ye=Zo([0,1,2]);while(ue<ce&&be<xe){be++;let Fe=b.reduce(((e,t)=>({minX:Math.min(e.minX,t.x),maxX:Math.max(e.maxX,t.x),minY:Math.min(e.minY,t.y),maxY:Math.max(e.maxY,t.y)})),{minX:Infinity,maxX:-Infinity,minY:Infinity,maxY:-Infinity});let we=random(Fe.minX,Fe.maxX);let Pe=random(Fe.minY,Fe.maxY);let Ve=createVector(we,Pe);let Te=random(pe,fe);if(on.isPointInPolygon(Ve,b)&&he(Ve,me,de)){ge(Ve,me,de,Te);ue++;let Ce=random(2,5);t.push();t.noFill();if(ye==0)t.stroke(0,0,0,random(.1,.3));else if(ye==1)t.stroke(0,0,1,random(.1,.3));else t.stroke(0,0,Zo([0,1]),random(.1,.3));t.strokeWeight(Te*map(n,80,300,.5,1.5));t.strokeCap(t.ROUND);t.translate(Ve.x,Ve.y);let Ee=noise(Ve.x*.01,Ve.y*.01)*TWO_PI;t.rotate(Ee);t.line(-Ce/2,0,Ce/2,0);t.pop()}}}}static stoneAGroup(e,t){pgBg.push();let o=Qo(1,3);let r=[];for(let e=0;e<o;e++){if(g==1){r.push({size:random(0,1)>.2?random(20,40):random(0,1)>.2?random(30,80):random(100,200)})}else{r.push({size:random(0,1)>.2?random(20,40):random(30,50)})}}r.sort(((e,t)=>t.size-e.size));let l=t;r.forEach(((t,o)=>{t.x=e+random(-t.size,t.size);t.y=l+o*t.size*.5;let r=random(0,1);on.stoneA({pg:pgL0,baseX:t.x,baseY:t.y,size:t.size*he,bSh:Qo(6,13)})}));pgBg.pop()}static stoneBGroup(e,t){let o=Qo(1,3);let r=[];for(let e=0;e<o;e++){if(g==1){r.push({size:random(0,1)>.2?random(20,40):random(0,1)>.2?random(30,80):random(100,200)})}else{r.push({size:random(0,1)>.2?random(20,40):random(30,50)})}}r.sort(((e,t)=>t.size-e.size));let l=t;r.forEach(((t,o)=>{t.x=e+random(-t.size,t.size);t.y=l+o*t.size*.5;on.stoneB({pg:pgL0,baseX:t.x,baseY:t.y,size:t.size*he})}))}static stoneCGroup(e,t,o={}){let{pg:r=pgL0,count:l=3,areaW:n=200,areaH:a=50}=o;l=Qo(1,3);let s=random(120,200);Bt=1;It=1;for(let o=0;o<l;o++){if(g==1)s=random(0,1)>.2?random(30,60):random(0,1)>.2?random(50,100):random(100,200);else s=random(30,80);let o=e+random(-n/2,n/2);let r=t+random(-a/2,a/2);on.stoneC({pg:pgL0,baseX:o,baseY:r,hei:s*.8,wid:s})}}static stoneDGroup(e,t,o={}){let{pg:r=pgL0,count:l=3,areaW:n=200,areaH:a=50}=o;l=Qo(1,3);let s=100;Bt=1;It=1;for(let o=0;o<l;o++){if(g==1)s=random(0,1)>.2?random(80,150):random(0,1)>.2?random(200,300):random(300,400);else s=random(80,150);let o=e+random(-n/2,n/2);let r=t+random(-a/2,a/2);on.stoneD({pg:pgL0,baseX:o,baseY:r,hei:s*random(.4,.8),wid:random(0,1)<.3?s*random(1,1.3):s,tex:Qo(20,40),reso0:Qo(3,12),reso1:Qo(50,100)})}}static generateBaseStoneShape(e={}){let{size:t=random(5,20),roughness:o=1.3,detail:r=2,stoneH:l=random(.6,1.1),globalOffset:n=random(-.4,.4),tilt:a=random(.4,-.4),centerX:s=0,centerY:i=0}=e;let c=[];let p=random(TWO_PI);let f=floor(120*ue);for(let e=0;e<=f;e++){let d=e/f;let m=TWO_PI*d;let h=map(noise(cos(m)*r,sin(m)*r,p),0,1,.85,1.15);let g=map(noise(cos(m)*r*2,sin(m)*r*2,p+1e3),0,1,.92,1.08);let u=(h*.7+g*.3)*o;let b=t*u;let x=s+cos(m)*b;let y=i+sin(m)*b;let F=y>i?map(y-i,0,b,1,.15):map(y-i,-b,0,l*1.2,1);y=i+(y-i)*F;x+=n*t+(y-i)*a;c.push(createVector(x,y))}c=on.smoothPoints(c,2);c=on.smoothPoints(c,1);c.push(c[0].copy());return c}static generateStoneShape(e={}){let{size:t=random(5,20),roughness:o=1.3,detail:r=2,stoneH:l=random(.6,1.1),globalOffset:n=random(-.4,.4),tilt:a=random(.4,-.4),direction:s=random(TWO_PI)}=e;let i=[];let c=random(TWO_PI);let p=floor(120*ue);for(let e=0;e<=p;e++){let f=e/p;let d=TWO_PI*f;let m=map(noise(cos(d)*r,sin(d)*r,c),0,1,.85,1.15);let h=map(noise(cos(d)*r*2,sin(d)*r*2,c+1e3),0,1,.92,1.08);let g=1+cos(d-s)*.5;let u=(m*.7+h*.3)*o*g;let b=map(noise(cos(d)*2,sin(d)*2,c+2e3),0,1,-.3,.3);let x=t*u;let y=cos(d)*x;let F=sin(d)*x;let w=F>0?map(F,0,x,1,.15):map(F,-x,0,l*1.2,1);F*=w;y+=n*t+F*a;y+=b*t;let P=noise(y*.05,F*.05,c+3e3);y+=map(P,0,1,-t*.08,t*.08)*g;F+=map(P,0,1,-t*.05,t*.05)*g;i.push(createVector(y,F))}i=on.smoothPoints(i,2);i=on.smoothPoints(i,1);i.push(i[0].copy());return i}static generateCompositeStoneShape(e={}){let{size:t=random(5,20),shapeCount:o=floor(random(2,6))}=e;let r=on.generateStoneShape({size:t,roughness:1.3,detail:2,stoneH:random(.6,1.1)});let l=[r];for(let e=1;e<o;e++){let e=random(-t*.3,t*.3);let o=random(-t*.3,t*.3);let r=t*random(.6,1.2);let n=on.generateStoneShape({size:r,roughness:random(1.1,1.4),detail:random(1.8,2.2),stoneH:random(.6,1.1),direction:random(TWO_PI)}).map((t=>createVector(t.x+e,t.y+o)));l.push(n)}let n=[];l.forEach((e=>{n=n.concat(e)}));let a=on.computeConvexHull(n);let s=[];for(let e=0;e<a.length;e++){let o=a[e];let r=noise(o.x*.1,o.y*.1);let l=t*.1*r;s.push(createVector(o.x+random(-l,l),o.y+random(-l,l)))}s=on.smoothPoints(s,2);s=on.smoothPoints(s,1);s.push(s[0].copy());return s}static generateCompositeHole(e={}){let{centerX:t=0,centerY:o=0,holeSize:r=10,shapeCount:l=floor(random(2,6))}=e;let n=on.generateHole({centerX:t,centerY:o,holeSize:r,detail:2,elongation:random(1.2,1.8)});let a=[n];for(let e=1;e<l;e++){let e=random(-r*.3,r*.3);let l=random(-r*.3,r*.3);let n=r*random(.2,.6);let s=on.generateHole({centerX:t+e,centerY:o+l,holeSize:n,detail:random(1.8,2.2),elongation:random(1.1,1.6)});a.push(s)}let s=[];a.forEach((e=>{if(e&&Array.isArray(e)){s=s.concat(e)}}));let i=on.computeConvexHull(s);let c=[];for(let e=0;e<i.length;e++){let t=i[e];let o=noise(t.x*.1,t.y*.1);let l=r*.05*o;c.push(createVector(t.x+random(-l,l),t.y+random(-l,l)))}c=on.smoothPoints(c,2);c=on.smoothPoints(c,1);c=on.ensureCounterClockwise(c);return c}static generateHole(e={}){let{centerX:t=0,centerY:o=0,holeSize:r=10,detail:l=2,elongation:n=random(1,2)}=e;let a=[];let s=random(TWO_PI);let i=floor(40*ue);let c=.2;let p=random(0,1e3);let f=.9;let d=.5;let m=.3;for(let e=0;e<=i;e++){let l=e/i;let h=TWO_PI*l;let g=noise(cos(h)*c+p,sin(h)*c+p)*f;let u=noise(cos(h)*c*2+p+1e3,sin(h)*c*2+p+1e3)*d;let b=noise(cos(h)*c*4+p+2e3,sin(h)*c*4+p+2e3)*m;let x=.6+g+u+b;let y=1+sin(h*2)*.2;let F=1+(n-1)*abs(cos(h));let w=r*x*y*F;let P=t+cos(h)*w;let V=o+sin(h)*w;let T=r*.15;P+=noise(P*.1,V*.1,s)*T;V+=noise(P*.1,V*.1,s+1e3)*T;a.push(createVector(P,V))}a=on.smoothPoints(a,3);a=on.smoothPoints(a,2);a=on.ensureCounterClockwise(a);a=on.smoothPoints(a,1);return a}static smoothPoints(e,t){let o=[];let r=e.length;for(let l=0;l<r;l++){let n=createVector(0,0);let a=0;for(let o=-t;o<=t;o++){let s=(l+o+r)%r;let i=exp(-o*o/(2*t));n.add(p5.Vector.mult(e[s],i));a+=i}n.div(a);o.push(n.copy())}return o}static ensureCounterClockwise(e){let t=0;for(let o=0;o<e.length;o++){let r=e[o];let l=e[(o+1)%e.length];t+=(l.x-r.x)*(l.y+r.y)}if(t<0){return e.reverse()}return e}static isValidHolePosition(e,t,o,r,l,n,a,s,i){let c=o*2;if(e-o<n+c||e+o>a-c||t-o<s+c||t+o>i-c){return false}for(let l of r){let r=(l[0].x+l[floor(l.length/2)].x)/2;let n=(l[0].y+l[floor(l.length/2)].y)/2;let a=(o+o)*1.5;let s=dist(e,t,r,n);if(s<a){return false}}return true}static areOverlapping(e,t){e=e.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));t=t.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));let o=on.getAxes(e).concat(on.getAxes(t));for(let r of o){if(!on.overlap(on.project(e,r),on.project(t,r))){return false}}return true}static getAxes(e){if(!e||e.length===0){console.error("Invalid polygon in getAxes");return[]}let t=[];for(let o=0;o<e.length;o++){if(!e[o]||typeof e[o].x==="undefined"||typeof e[o].y==="undefined"){console.error("Invalid point in getAxes:",e[o]);continue}let r=e[o];let l=e[(o+1)%e.length];let n=createVector(r.x-l.x,r.y-l.y);let a=createVector(-n.y,n.x);let length=a.mag();if(length!==0){a.div(length);t.push(a)}}return t}static project(e,t){let min=Infinity,max=-Infinity;for(let o=0;o<e.length;o++){let r=e[o].dot(t);if(r<min)min=r;if(r>max)max=r}return{min:min,max:max}}static overlap(e,t){return!(e.max<t.min||t.max<e.min)}static removeDuplicatePoints(e){let t=[];const o=1e-6;for(let r=0;r<e.length;r++){let l=false;for(let n=0;n<t.length;n++){if(abs(e[r].x-t[n].x)<o&&abs(e[r].y-t[n].y)<o){l=true;break}}if(!l){t.push(e[r])}}return t}static computeConvexHull(e){let t=e.reduce(((e,t)=>t.y>e.y||t.y===e.y&&t.x<e.x?t:e));let o=e.filter((e=>e!==t)).sort(((e,o)=>{let r=atan2(e.y-t.y,e.x-t.x);let l=atan2(o.y-t.y,o.x-t.x);return r-l}));let r=[t];for(let e of o){while(r.length>=2){let t=r[r.length-1];let o=r[r.length-2];if(on.crossProduct(o,t,e)>0){break}r.pop()}r.push(e)}return r}static crossProduct(e,t,o){return(t.x-e.x)*(o.y-e.y)-(t.y-e.y)*(o.x-e.x)}static mergeOverlappingHoles(e){if(!e||e.length===0){return[]}e=e.filter((e=>{if(!e||!Array.isArray(e)||e.length<3){return false}let t=e.map((e=>{if(!e||typeof e.x==="undefined"||typeof e.y==="undefined"){return null}return e instanceof p5.Vector?e:createVector(e.x,e.y)})).filter((e=>e!==null));return t.length>=3}));if(e.length===0){return[]}let t=[];let o=true;while(o){o=false;let r=new Array(e.length).fill(false);for(let l=0;l<e.length;l++){if(r[l])continue;let n=e[l].slice();r[l]=true;for(let t=0;t<e.length;t++){if(l!==t&&!r[t]){if(on.areOverlapping(n,e[t])){n=n.concat(e[t]);r[t]=true;o=true}}}let a=on.removeDuplicatePoints(n);if(a.length>=3){let e=on.grahamScan(a);if(e.length>=3){e=on.ensureCounterClockwise(e);e=on.interpolatePoints(e,4);let o=on.displacePoints(e);if(o.length>=3){t.push(o)}}}}if(t.length===0){break}e=t.filter((e=>e.length>=3));t=[];if(e.length===0){break}}return e}static grahamScan(e){e=on.validatePoints(e);if(e.length<3){return e}e.sort(on.comparePoints);let t=e[0];e.sort(((e,o)=>{let r=atan2(e.y-t.y,e.x-t.x);let l=atan2(o.y-t.y,o.x-t.x);if(r===l){return on.distance(t,o)-on.distance(t,e)}return r-l}));let o=[t];for(let t=0;t<e.length;t++){while(o.length>1&&on.cross(o[o.length-2],o[o.length-1],e[t])<=0){o.pop()}o.push(e[t])}return o}static comparePoints(e,t){if(e.y===t.y)return e.x-t.x;return e.y-t.y}static distance(e,t){return sqrt((e.x-t.x)**2+(e.y-t.y)**2)}static cross(e,t,o){return(t.x-e.x)*(o.y-e.y)-(t.y-e.y)*(o.x-e.x)}static interpolatePoints(e,t=4){let o=[];for(let r=0;r<e.length;r++){let l=e[r];let n=e[(r+1)%e.length];for(let e=0;e<t;e++){let r=e/t;let a=l.x*(1-r)+n.x*r;let s=l.y*(1-r)+n.y*r;o.push(createVector(a,s))}}return o}static displacePoints(e){return e.map((e=>{let t=on.randomDisplacement(e.x,e.y);return createVector(e.x+t.dx,e.y+t.dy)}))}static randomDisplacement(e,t){const o=1;return{dx:noise(e)*o,dy:noise(t)*o}}static validatePoint(e,t=createVector(0,0)){if(!e||typeof e.x==="undefined"||typeof e.y==="undefined"){console.error("Invalid point:",e);return t}return e instanceof p5.Vector?e:createVector(e.x,e.y)}static validatePoints(e){if(!e||!Array.isArray(e)){console.error("Invalid points array:",e);return[]}return e.map((e=>on.validatePoint(e)))}static clipHoleToStoneBoundary(e,t){e=on.validatePoints(e);t=on.validatePoints(t);if(e.length<3||t.length<3){return[]}let o=[...e];for(let e=0;e<t.length;e++){let r=t[e];let l=t[(e+1)%t.length];let n=[...o];o=[];for(let e=0;e<n.length;e++){let t=n[e];let a=n[(e+1)%n.length];let s=(l.x-r.x)*(t.y-r.y)-(l.y-r.y)*(t.x-r.x);let i=(l.x-r.x)*(a.y-r.y)-(l.y-r.y)*(a.x-r.x);if(s>=0){o.push(t)}if(s*i<0){let e=s/(s-i);let r=t.x+(a.x-t.x)*e;let l=t.y+(a.y-t.y)*e;o.push(createVector(r,l))}}}if(o.length<3){return[]}o=on.smoothPoints(o,2);o=on.ensureCounterClockwise(o);return o}static lineIntersection(e,t,o,r,l,n,a,s){let i=(e-o)*(n-s)-(t-r)*(l-a);if(i===0)return null;let c=((e-l)*(n-s)-(t-n)*(l-a))/i;let p=-((e-o)*(t-n)-(t-r)*(e-l))/i;if(c>=0&&c<=1&&p>=0&&p<=1){return createVector(e+c*(o-e),t+c*(r-t))}return null}static findIntersections(e,t){let o=[];for(let r=0;r<e.length-1;r++){for(let l=0;l<t.length-1;l++){let n=on.lineIntersection(e[r].x,e[r].y,e[r+1].x,e[r+1].y,t[l].x,t[l].y,t[l+1].x,t[l+1].y);if(n){o.push(n)}}}return o}static isPointInPolygon(e,t){let o=false;for(let r=0,l=t.length-1;r<t.length;l=r++){let n=t[r].x,a=t[r].y;let s=t[l].x,i=t[l].y;let c=a>e.y!=i>e.y&&e.x<(s-n)*(e.y-a)/(i-a)+n;if(c)o=!o}return o}static getPolygonArea(e){let t=0;for(let o=0;o<e.length;o++){let r=(o+1)%e.length;t+=e[o].x*e[r].y;t-=e[r].x*e[o].y}return abs(t)/2}static getNextPoint(e,t){for(let o=0;o<t.length-1;o++){if(abs(t[o].x-e.x)<.001&&abs(t[o].y-e.y)<.001){return t[o+1]}}return t[0]}}</script></body></html>
