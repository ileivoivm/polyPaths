<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><title>Polypaths</title><meta name="viewport" content="width=device-width,initial-scale=1"><script src="lib/p5.min.js"></script><script src="lib/p5.easycam.js"></script><script src="https://js.pusher.com/8.2.0/pusher.min.js"></script><link rel="stylesheet" type="text/css" href="style.css"></head><body><img src="project.png" class="project-image" alt="project"><div id="canvas-container"><div id="canvas-border"></div></div><script>let e=0,t=1,o=1,r=0;let n={},l=0,a=[],s=[];let c=0;let h;let p;let f=true;let d=[];const m={dim:1024,pix:1.5,ratio:1};function preload(){const e=window.location.hash;const t=e.match(/&pix_(\d+(\.\d+)?)/);if(t){const e=parseFloat(t[1]);if(!isNaN(e)){m.pix=e;console.log("***从URL读取pix:",e)}}Tr();window.addEventListener("hashchange",(function(e){const t=new URL(e.newURL);const o=new URL(e.oldURL);const r=t.hash.includes("data_")?t.hash.split("data_")[1].split("#")[0]:"";const n=o.hash.includes("data_")?o.hash.split("data_")[1].split("#")[0]:"";const l=t.hash.includes("seed_")?t.hash.split("seed_")[1].split("#")[0]:"";const a=o.hash.includes("seed_")?o.hash.split("seed_")[1].split("#")[0]:"";if(r!==n||l!==a){window.location.reload()}}));if(e&&e.includes("#data_")){hashPart=e.split("&")[0];l=1;console.log(" 讀取網址 hash 已啟用 ")}console.log(e);const o=e.match(/seed_(\d+)/);if(o){$t=parseInt(o[1]);console.log("***從URL讀取seed:",$t)}else{$t=Bo(3e6,99e5);console.log("***新亂數產生seed:",$t)}if(e.includes("&sp_2")){r=2;console.log("***特殊植物模式2已啟用")}else if(e.includes("&sp_1")){r=1;console.log("***特殊植物模式1已啟用")}Un($t)}function u(){a=[];pixelDensity(m.pix);if(gt)frameRate(1);jt=vo([0,1,2,3,4,0,1,2,3,4,0,2,5]);if(l==1)jt=vo([1,3,4]);n.layout=jt;dt=random(0,1)>.6?1:0;n.specialLayout=dt;M=vo([11,13,15,17,19,21]);if(jt==2)m.ratio=.7;else if(jt==1||jt==5)m.ratio=1.33;else if(jt==4)m.ratio=.7;else m.ratio=1;if(jt==3||jt==1||jt==4)Kn=1;if(Kn==1){if(l==1){let e=Er();s=e;if(e){Jn=e;Zt="url";console.log("***使用 URL 中的数据")}else{console.log("***URL 数据解析失败，使用默认数据");Jn=ol;Zt="預設圓形"}}else{if(jt==3)Jn=vo([Qn,tl,ol,el,al,sl]);else if(jt==1)Jn=vo([Zn,el,ol,rl,al,sl]);else if(jt==4)Jn=vo([rl,nl,ll,al,sl]);if(Jn===Qn)Zt="0";else if(Jn===Zn)Zt="1";else if(Jn===el)Zt="2";else if(Jn===tl)Zt="3";else if(Jn===ol)Zt="4";else if(Jn===rl)Zt="5";else if(Jn===nl)Zt="6";else if(Jn===ll)Zt="7";else if(Jn===al)Zt="8";else if(Jn===sl)Zt="9"}let e=0;for(let t=0;t<Jn.paths.length;t++){e+=Jn.paths[t].length-1}M=e+Jn.dots.length;console.table({"json路徑組":Zt,"總植物數量":M,"路徑段數量":e,"點的數量":Jn.dots.length});a.push({"json路徑組":Zt,"總植物數量":M,"路徑段數量":e,"點的數量":Jn.dots.length})}const e=createCanvas(m.dim*m.ratio,m.dim,WEBGL);e.canvas.willReadFrequently=true;yt=new Dw.EasyCam(this._renderer);ortho(-width/2,width/2,-height/2,height/2,-1e4,1e4);yt.setDistanceMin(100);yt.setDistanceMax(2e3);yt.setDistance(1e3);yt.setRotationConstraint(false,false,false);yt.removeMouseListeners();textSize(24);colorMode(HSB,360,1,1,1);imageMode(CENTER);nr();particles=[];q=.7;Mt=$o();Ht={...Zo()};typeC={...tr()};if(Kn==0){if(M>16){Lt=random(0,1)<.7?0:random(0,1)<.4?1:3;M=Math.floor(M*1.3);if(Lt==3)jt=5}else{Lt=random(0,1)<.5?0:2}n.植物類型=Lt;n.植物數量=M}Se=Mt.colors.bg;Ie=Mt.colors.stroke;if(o==1){let e=new URLSearchParams(window.location.search);let t=e.has("paperType")?parseInt(e.get("paperType")):null;Gn(t);pr();pgBg.background(Mt.colors.bg[0][0],Mt.colors.bg[0][1],Mt.colors.bg[0][2],1)}else{pgBg.background(0,0,.8,1)}jn()}function setup(){u();he=[1,0,1,0];n.植物類型=Lt;it=random(0,1)<.9?0:vo([1,2]);n.筆刷類型=it;ht=random(0,1)<.5?1:0;n.狂野模式=ht;pe=0;Ue=random(0,1)>.05?vo([0,1,2,3]):4;n.花朵類=Ue;$e=vo([0,1]);n.花蕊類=$e;qe=random(0,1)<.85?vo([0,1,2,3]):random(0,1)<.7?4:5;n.果實類=qe;tt=random(0,1)>.9?vo([.4,.6,.8]):1;if(l==1)tt=1;n.畫掉下葉子概率=tt;we=random(0,1)<.8?Wo(.3,1.2):.2;Ve=random(0,1)<.8?Wo(.3,1.2):.2;if(random(0,1)>.1){K=.1;n.多鬆=0}else{Ve=6;we=3;K=.03;n.多鬆=1}Ce=we;Te=Ve;n.偏移比例=K;n.筆刷偏移=we;n.填色偏移=Ve;rt=random(0,1)>.95?.1:random(0,1)>.2?.8:random(0,1)>.3?.3:1;n.素描率=rt;if(random(0,1)>rt)ot=1;else ot=0;et=random(0,1)<.1?1.1:random(0,1)<.3?0:vo([.3,.6,.8]);n.葉子漸變率=et;lt=vo([.9,1,1.1]);n.素描填色明暗=lt;je=random(0,1)<.1?3:random(0,1)<.9?0:1;n.葉子類型=je;ae=[Bo(10,20),Bo(10,25)];nt=vo([1,.9]);n.頂點修改率=nt;pt=random(0,1)>.3?0:1;n.深度顏色=pt;Q=Wo(.8,1.2);if(jt!=3)q=1;if(jt==0)U=.35;else if(jt==2)U=.6;else if(jt==1)U=.35,ae=[20,25];else if(jt==5)U=.6,ae=[25,30];Bt=vo([.1,.33,.5,.7,.8,.9,.95]);vt=vo([.1,.33,.5,.7,.8,.9,.95,1,1,1]);n.樹幹更新率=Bt;n.植物參數更新率=vt;Xt=.8;xe=random(0,1)<.05?0:random(0,1)<.3?.7:1;n.改變顏色機率=xe;Ot=.2;kt=random(0,1)<.95?vo([.96,.98,.995,.995,1,1,1,1,1,1]):.8;_t=random(0,1)<.95?vo([.96,.98,.995,.995,1,1,1,1,1,1]):.8;zt=random(0,1)>.5?.985:1;n.蝴蝶概率=kt;n.蜻蜓概率=_t;n.瓢蟲概率=zt;Z=random(0,1)<.8?vo([0,1,2,3,4,5]):6;n.物件組=Z;if(Z==0){ee={leaf:80,flower:30,fruit:20,grass:20,mushroom:5}}else if(Z==1){ee={leaf:2,flower:30,fruit:0,grass:20,mushroom:10}}else if(Z==2){ee={leaf:40,flower:0,fruit:20,grass:20,mushroom:10}}else if(Z==3){ee={leaf:15,flower:5,fruit:10,grass:5,mushroom:5}}else if(Z==4){ee={leaf:0,flower:0,fruit:3,grass:5,mushroom:3};M=floor(M*1.5);ae=[Bo(20,30),Bo(20,30)];Bt=.6;vt=1}else if(Z==5){ee={leaf:20,flower:0,fruit:2,grass:20,mushroom:2};j=1;q=.6}else if(Z==6){ee={leaf:constrain(Bo(-10,40),0,40),flower:constrain(Bo(-10,40),0,40),fruit:constrain(Bo(-10,40),0,40),grass:constrain(Bo(-10,40),0,40),mushroom:constrain(Bo(-10,40),0,40)}}if(Kn==1){ee.grass=Bo(4,10);ee.mushroom=Bo(2,6)}if(Jn==el||Jn==ll){xe=Wo(.8,1.05);Bt=Wo(.8,1.05);vt=Wo(.8,1.1);console.log("");console.log("****特殊模式")}if(r==1){ee={leaf:200,flower:5,fruit:0,grass:10,mushroom:3};Ot=.4;U=.4;j=1;q=1;Ue=2;ht=0;je=0;kt=1;_t=1;zt=1;xe=1;Bt=1;vt=1;pt=1;rt=1;Ve=.2;we=.5;Q=1;$=.1}else if(r==2){ee={leaf:20,flower:2,fruit:1,grass:0,mushroom:0};Ot=.7;U=.4;j=1;q=1;Ue=4;ht=0;je=0;kt=1;_t=1;zt=1;xe=1;Bt=1;vt=1;pt=1;rt=1;Ve=.2;we=.5;ae=[12,12];Q=.8;$=1}Jt=random(height*.45,height*.55);let e=random(0,1)>.1?0:vo([0,0]);Fe=Bo(-1,5)*10+e;let t=random(0,1)>.1?0:5;if(r==2)Fe=0,t=0;n.特殊顏色模式=t;n.色相偏移=Fe;if(t==0){De=[0,1,1];Ae=[0,1,1]}else if(t==5){ht=1;De=[vo([0,Wo(0,120)]),vo([Wo(0,1),Wo(1,5)]),vo([Wo(0,1),Wo(1,5)])];Ae=[vo([0,Wo(0,120)]),vo([Wo(0,1),Wo(1,5)]),vo([Wo(0,1),Wo(1,5)])];he=[0,0,vo([0,1]),vo([0,1])]}if(Kn==1)Cr();let o=window.location.href;let baseUrl=o.split("#")[0];window.addEventListener("beforeunload",Br);bt="seed_"+$t;let s=decodeURIComponent(window.location.hash);let i="";const c=s.match(/data_([^#]*)/);if(c){i="#data_"+c[1]}if(i){window.location.hash=i}d[0]=Yo(Nt.colors.branch[0][0],Nt.colors.branch[0][1]*.8,constrain(Nt.colors.branch[0][2]*.8,.3,1));d[1]=Yo(Nt.colors.flower[0][0],Nt.colors.flower[0][1]*.8,constrain(Nt.colors.flower[0][2]*.8,.3,1));d[2]=Yo(Nt.colors.bg[0][0],Nt.colors.bg[0][1]*.8,constrain(Nt.colors.bg[0][2]*.8,.3,1));d[3]=Yo(Nt.colors.leaf[0][0],Nt.colors.leaf[0][1]*.8,constrain(Nt.colors.leaf[0][2]*.8,.3,1));let h=random(0,1)>.5;n.材質=h;console.table(n,["參數"]);console.table(ee,["單株數量限制"]);a.push(n);a.push(ee);console.log("");if(h)V()}function g(){Sr();if(Le==5)br(eo);if(Le==0||Le==1||Le==2)xr(eo);if(Le==3||Le==4)Pr(eo,to);if(Le==0)so=random(0,1)>.95?1:0;else if(Le==1)so=random(0,1)>.95?1:0;else if(Le==2)so=random(0,1)>.95?1:0;else if(Le==3)so=random(0,1)>1?1:0;else if(Le==4)so=random(0,1)>1?1:0;if(jt==1||jt==4||Le==5)so=0;$t=$t+100;Un($t);if(Kn==0){if(ie<8){if(Lt==0)Rt=random(0,1)<.5?"A":vo(["B","B","C","D","E"]);else if(Lt==1)Rt=random(0,1)>.9?"A":vo(["C","B","D","E"]);else if(Lt==2)Rt=vo(["A","B","C","E"]);else if(Lt==3)Rt=random(0,1)>.9?"A":random(0,1)>.3?"E":"D";else Rt="A";if(Rt=="A")ie++;else ce++}else{Rt=vo(["B","C","D","E"]);ce++}}Ze=random(0,1)<et?1:0;if(r==2)Ze=1,U=random(.3,.45);if(r==0){ft=random(0,1)<.5?0:1;ae=random(0,1)<.3?[5,5]:[Bo(10,20),Bo(10,25)];J=random(0,1)<.1?vo([.2,.3,.6,.8]):vo([.9,1,1,1,1,1.2])}se={x:0,y:0,height:Infinity};if(jt==0){te=random(width*.3,width*.7);Jt=Jt+random(height*.04,height*.1);if(Jt>height*.95)Jt=random(height*.45,height*.55);oe=Jt;if(dt==1){te=width/2+random(-50,50);oe=height*.8+random(-50,50)}}else if(jt==4){te=random(width*.15,width*.85);Jt=Jt+random(height*.02,height*.07);if(Jt>height*.9)Jt=random(height*.2,height*.3);oe=Jt}else if(jt==2){te=random(0,1)<.8?random(width*.35,width*.65):random(width*.1,width*.9);if(Rt=="A")oe=random(height*.95,height*1.1);else oe=random(height*.92,height*.97)}else if(jt==5){te=random(width*.1,width*.9);Jt=Jt+random(height*.04,height*.1);if(Jt>height*.9)Jt=random(height*.25,height*.35);oe=Jt}if(Kn==1){if(O<Qt.segments.length){const e=O%Qt.segments.length;const t=Qt.segments[e];te=int(map(Number(t.baseX.toFixed(2)),0,500,0,width));oe=int(map(Number(t.baseY.toFixed(2)),0,500,0,height));Rt="A";if(e===0||t.pathIndex!==Qt.segments[e-1].pathIndex){oo=1}else{oo=0}}else{const e=O-Qt.segments.length;if(e<Qt.dots.length){const t=Qt.dots[e];te=int(map(Number(t.baseX.toFixed(2)),0,500,0,width));oe=int(map(Number(t.baseY.toFixed(2)),0,500,0,height));Rt=vo(["B","C","D","E"]);oo=0}else{te=random(width*.1,width*.9);oe=random(height*.1,height*.9);Rt=vo(["B","C","D","E"]);oo=0}}}{me=random(0,1)>xe?Bo(0,28):de;if(Rt!="B"){const e=Do(de);Nt={...Mt};if(me!==de){de=me;Mt.colors=e;Mt.colorsID=de;const t=lr();Object.assign(Nt,t)}}else{const e=Do(de);Nt={...Ht};if(me!==de){de=me;Ht.colors=e;Ht.colorsID=de;const t=lr();Object.assign(Nt,t)}}}if(pt==0){if(oe<height*.6&&random(0,1)>.7){Pe=.7;ue=.4;ge=vo([.6,2]);be=.4;ye=1}else{Pe=.6;ue=1;ge=1;be=1;ye=1}if(random(0,1)>.9){Pe=.7;ue=.4;ge=vo([.6,2]);be=.4;ye=1}lt=vo([.9,1,1.1])}else if(pt==1){Pe=.5;ue=1;ge=1;be=1;ye=1}if(random(0,1)>rt)ot=1;else ot=0;if(ot==1){ue=1;ge=1;be=1;ye=1;st=random(0,1)<nt?0:2;we=Ce*random(1,1.5);Ve=Te*random(1,1.5);let e=vo([[11,2],[1,4],[2,12],[4,2]]);Nt.veinsType=e;at=vo([0,1,2]);if(at==2)Pe=random(1.2,2.2);else Pe=random(.8,1.2)}else{if(r==0){st=random(0,1)<nt?0:2;we=Ce;Ve=Te;Nt.veinsType=Ke}}Je=Bo(3,4);if(Rt=="A"){Nt.plantType="woody";if(random(0,1)>Bt){fe=vo([[1,1],[1,1.1],[1,1.2],[.5,1.5],[20,2]]);Ot=random(.1,.4);U=vo([.3,.35,.4,.45,.5,.65]);q=random(0,1)>.9?Wo(1.15,1.3):vo([.6,.8,.9]);$=vo([.6,.8,.7]);j=random(0,1)>.95?4:vo([.5,.6,.8,.7,1.2,1.5,2]);hr();cr()}if(random(0,1)>vt&&O<=15){q=random(0,1)>.9?Wo(1.15,1.3):vo([.6,.8,.9]);pe=random(0,1)<.2?1:0;Ue=vo([0,1,2,3]);$e=vo([0,1]);qe=random(0,1)<.85?vo([0,1,2,3]):random(0,1)<.7?4:5;it=random(0,1)<.9?0:vo([1,2]);je=random(0,1)<.1?3:random(0,1)<.9?0:1;ar(ao);sr(ao);ir(ao)}if(random(0,1)>tt)C.drawLoseLeaves(te,oe,Bo(0,1))}else if(Rt=="B"){Nt.plantType="grass";N=1;if(random(0,1)>tt)C.drawLoseLeaves(te,oe,Bo(0,1))}else if(Rt=="C"){let e=tr();e.capWidth=Bo(5,20)+int(map(e.mushroomWidth,1.5,3,10,40));Nt={...e};Nt.plantType="mushroom";N=1;if(random(0,1)>tt)C.drawLoseLeaves(te,oe,Bo(0,1))}else if(Rt=="D"){N=1;Nt.plantType="stone";if(random(0,1)>.5)Jr(te,oe);else jr(te,oe);if(random(0,1)>tt)C.drawLoseLeaves(te,oe,Bo(0,1))}else if(Rt=="E"){N=1;Nt=Mt;Nt.plantType="woodBlock"}else if(Rt=="F"){N=1;Nt.plantType="loseLeaves";if(random(0,1)>tt)C.drawLoseLeaves(te,oe,1);else{N=1;Nt=Mt;Nt.plantType="woodBlock"}}let e=`plant_${O}_${te}_${oe}`;Gt={pg:pgL3,baseX:te,baseY:oe,PT:Nt,plantId:e,branchCounter:0,widthFunc:e=>1,lastLeafNode:0,hasDrawnFlower:false};if(!St.has(e)){F(Gt);St.add(e)}H=true;R=0}function b(){Lr();if(R==0&&Nt.branchFork==1&&!Nt.vineDrawn&&Nt.branchDepth<2){if(Nt.branchWidth<=4){T.drawAllPath(Nt);if(se.path){T.drawVines({...Nt,widthFunc:Gt.widthFunc,path:se.path,spiral:Nt.spiral});Nt.vineDrawn=true}}}if(Nt.plantType==="woody"&&Gt&&Gt.PLANT&&Gt.PLANT.length>0){N=Gt.PLANT.length}if(R<N){doleafDirection=random(0,1)>.85?1:0;Be=random(0,1)>.5?1:0;let e=P(R);if(e){R++}}else{O++;H=false;if(Nt.plantType!="woody")Sr()}}function F(e){se={x:e.baseX,y:e.baseY,height:Infinity,plantId:e.plantId,segmentIndex:O};currentPath=[];e.vineDrawn=false;e.PT.leafCount=0;e.PT.flowerCount=0;e.PT.fruitCount=0;e.PT.grassCount=0;e.PT.leaflimit=ee.leaf;e.PT.flowerlimit=ee.flower;e.PT.fruitlimit=ee.fruit;e.PT.grasslimit=ee.grass;if(e.PT.plantType==="woody"){let t=null;if(Kn==0){let o=0;if(jt==0)o=random(-.5,.5);else if(jt==2)o=random(-.3,.3);else if(jt==5)o=random(-2,2);e.PLANT=t=T.drawWoody({pg:pgL1,baseX:e.baseX,baseY:e.baseY,baseRotation:createVector(PI/2,0,o),branchLength:m.dim*U,branchWidthFunc:e.PT.branchWidth*random(.7,1),maxBranchDepth:e.PT.branchDepth,col:[e.PT.branchColor[0],e.PT.branchColor[1],e.PT.branchColor[2]*random(.7,1),1],forkCount:e.PT.branchFork,maxBranchWidth:e.PT.maxBranchWidth,meta:e.PT,stemTexLine:e.PT.stemTexLine})}else if(Kn==1){const o=O%Qt.segments.length;const n=Qt.segments[o];if(Jn==el||Jn==ll){ae=[Bo(5,15),Bo(5,15)]}else{ae=[Bo(5,20),Bo(5,30)]}if(l==1){if(random(0,1)>.1)ae=[Bo(3,10),Bo(3,10)];else ae=[Bo(8,20),Bo(8,20)]}if(r!=0){ae=[Bo(8,16),Bo(8,16)]}e.PLANT=t=T.drawWoody({pg:pgL1,baseX:e.baseX,baseY:e.baseY,baseRotation:n.baseRotation,branchLength:n.branchLength,branchWidthFunc:n.branchWidthFunc,maxBranchDepth:n.maxBranchDepth,col:n.col,forkCount:n.forkCount,maxBranchWidth:n.maxBranchWidth,meta:n.meta,twistIntensity:n.twistIntensity,stemTexLine:n.stemTexLine})}console.log(O+":木本生成")}else if(e.PT.plantType==="grass"){e.PLANT=vr({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,branchLength:e.PT.stemLength,branchWidthFunc:e.PT.stemWidth,col:e.PT.stemColor,benScale:e.PT.stembenScale,branchBendFunc:t=>createVector(map(noise(t*1),0,1,-1,1)*t*e.PT.stemBend,0,0),meta:e.PT});console.log(O+":草生成")}else if(e.PT.plantType==="mushroom"){e.PLANT=Wr({pg:pgL0,PT:e.PT,baseX:e.baseX,baseY:e.baseY,capWidth:e.PT.capWidth||30});console.log(O+":蘑菇生成")}else if(e.PT.plantType==="woodBlock"){fe=[.5,1.1];let t=vo([1,2,3,4,6,8,15,20]);let o;o=random(0,1)<.33?e=>5*(1-e)*map(noise(e*5),0,1,.5,1)+t:random(0,1)<.5?e=>5*sin(e*PI)*map(noise(e*10),0,1,.5,1.2)+t*.8:e=>5*cos(e*PI*2)*map(noise(e*20),0,1,.3,.6)+t;e.PLANT=T.wood({pg:pgL0,baseX:e.baseX,baseY:e.baseY,branchLength:random(50,300),branchWidthFunc:o,branchSegments:Bo(60,80),branchSegmentsH:Bo(6,16),strokeStrength:.8,forceHorizontal:random(0,1)<.3?true:false,depth:1});console.log(O+":木塊生成")}e.stepIndex=0}function P(e){if(!Gt||!Gt.PLANT||e>=Gt.PLANT.length)return true;let t;let o=Nt.branchDepth===0&&Nt.branchFork===1;if(o&&Nt.branchWidth>5){o=false}let r=0;let n=0;if(o){if(!Gt.PLANT[0]||!Gt.PLANT[0][1]){console.log("藤蔓點陣列無效，step="+e);return true}t=Gt.PLANT[0][1]}else{if(!Gt.PLANT[e]||!Gt.PLANT[e][1]){console.log("分支點陣列無效，step="+e+"，可能當前分支沒有點數據");return true}t=Gt.PLANT[e][1]}if(!t||t.length===0){console.log("點陣列為空，step="+e);return true}for(let e=1;e<t.length;e++){r+=dist(t[e][0],t[e][1],t[e-1][0],t[e-1][1])}const l=width*1.05;const a=height*1.05;const s=-width*.05;const i=-height*.05;let c=Ot;let h=o?e/N:e/Gt.PLANT.length;if(typeof Gt.currentPointIndex==="undefined"){Gt.currentPointIndex=0}const p=10;const f=Gt.currentPointIndex;const d=min(f+p,t.length-1);n=0;for(let e=1;e<=f;e++)n+=dist(t[e][0],t[e][1],t[e-1][0],t[e-1][1]);if(Gt.branchFinished&&Gt.branchFinished[e]){console.log("分支已標記為完成，跳過處理，step="+e);Gt.currentPointIndex=0;return true}for(let p=f;p<d;p++){if(t[p][0]>l||t[p][0]<s||t[p][1]>a||t[p][1]<i){continue}if(p>0)n+=dist(t[p][0],t[p][1],t[p-1][0],t[p-1][1]);let f=(n/r).toFixed(2);if(o){let o=p/t.length;if(f>=.9){let o=t[t.length-1];Gt.PT.leafGrowType=Po;Je=4;let r=atan2(t[t.length-1][1]-t[t.length-2][1],t[t.length-1][0]-t[t.length-2][0]);if(random(0,1)>.5){E.addLeaf(o[0],o[1],Gt,r,"final",1)}if(!Gt.branchFinished){Gt.branchFinished={}}Gt.branchFinished[e]=true;Gt.currentPointIndex=0;return true}if(o>h||f<c)continue}else{let o=Ot;if(e>=2){o=Math.max(.05,Ot-e*.05)}if(f>=o){if(!Gt.branchFinished){Gt.branchFinished={}}if(!Gt.branchFinished[e]){w(t,p,Gt,f,e,je)}}else{}}}if(d>=t.length-1){if(!Gt.branchFinished){Gt.branchFinished={}}Gt.branchFinished[e]=true;Gt.currentPointIndex=0;return true}Gt.currentPointIndex=d;return false}function w(e,t,o,n,l,a){let s=o.PT.branchDepth===0&&o.PT.branchFork===1;let i=o.PLANT[l][0]==o.PT.branchDepth;let c=t/(e.length-1);let h=o.widthFunc?o.widthFunc(c):1;let p=atan2(e[t-1][1]-e[t][1],e[t-1][0]-e[t][0]);let f=o.PT.leafProb;let d=random(0,1)>f&&o.PT.leafCount<o.PT.leaflimit;let m=n>=.9;if(d){if(m){if(r==2){if(!o.branchPetalDrawn){o.branchPetalDrawn={}}if(!o.branchPetalDrawn[l]){let t=e[e.length-1];let r=e[e.length-2];let n=r[0]-t[0];let a=r[1]-t[1];let s=atan2(a,n)-1.57;if(random(0,1)>.1){C.petal2({pg:pgL0,baseX:e[e.length-1][0],baseY:e[e.length-1][1],baseRotation:createVector(PI/2,0,s),strokeStrength:1,branchLength:random(15,30),branchWidthFunc:e=>h*(1-e*.8)*2,branchBendFunc:e=>createVector(0,random(-.3,.3),0),col:[Nt.flowerColorA[0],Nt.flowerColorA[1]*1.2,Nt.flowerColorA[2]*1.2],col2:[Nt.branchColor[0],Nt.branchColor[1],Nt.branchColor[2]*1.2],branchSegments:10,branchSegmentsH:3,closeS:true,closeE:true,doLeafVeins:false,meta:Nt,stemMode:3})}o.branchPetalDrawn[l]=true}}else if(r==1){if(!o.branchFlowerDrawn){o.branchFlowerDrawn={}}if(!o.branchFlowerDrawn[l]){$=.1;C.drawFlowerC({pg:pgL3,id:Nt.flowerCount,baseX:e[e.length-1][0],baseY:e[e.length-1][1],meta:Nt});o.branchFlowerDrawn[l]=true}}else{if(!o.branchPetalDrawn){o.branchPetalDrawn={}}if(!o.branchPetalDrawn[l]){if(random(0,1)>.5){o.PT.leafGrowType=Po;Je=3;if(r==0)E.addLeaf(e[e.length-1][0],e[e.length-1][1],o,p,"final",1)}o.branchPetalDrawn[l]=true}}}else{if(a==3){f=.3;let e=10;let t=o.lastLeafNode||0;o.PT.leafGrowType=Po;Je=3}if(r==1){o.PT.leafGrowType=Fo;let r=createVector(e[t][0]-e[t-1][0],e[t][1]-e[t-1][1]);r.normalize();let l=atan2(r.y,r.x)+PI/2;let a=e[t][3]||1;if(i==false){pgText.noFill();pgText.strokeWeight(1);pgText.ellipse(e[t][0],e[t][1],7);ft=0;E.addLeaf(e[t][0],e[t][1],o,l,"normal",n);o.lastLeafNode=t}}else if(r==2){o.PT.leafGrowType=xo;let r=5;if(!o.branchLeafNodes){o.branchLeafNodes={}}if(o.branchLeafNodes[l]===undefined){o.branchLeafNodes[l]=0}let a=o.branchLeafNodes[l];let s=e[t][3]||1;if(s<=5&&t-a>=r){ft=0;pgText.noFill();pgText.stroke(he[0],he[1],he[2],he[3]);pgText.strokeWeight(1);pgText.ellipse(e[t][0],e[t][1],7);E.addLeaf(e[t][0],e[t][1],o,p,"normal",n);if(random(0,1)>.1){if(random(0,1)>.2)C.addFlower(e[t+1][0],e[t+1][1],o);else D.addFruit(e[t+1][0],e[t+1][1],o)}o.branchLeafNodes[l]=t}}else{let r=createVector(e[t][0]-e[t-1][0],e[t][1]-e[t-1][1]);r.normalize();let l=3.14;if(o.PT.leafGrowType==Po)l=0;if(doleafDirection){if(Be)l=PI/2;else l=-PI/2}let s=atan2(r.y,r.x)+l;if(a==3){if(t%12==0){E.addLeaf(e[t][0],e[t][1],o,s,"normal",n);o.lastLeafNode=t}}else{E.addLeaf(e[t][0],e[t][1],o,s,"normal",n);o.lastLeafNode=t}}}}if(random(0,1)>o.PT.fruitProb&&r==0){if(o.PT.fruitCount<o.PT.fruitlimit)D.addFruit(e[t][0],e[t][1],o,h)}if(random(0,1)>o.PT.flowerProb&&r!=2){if(r==1)$=.5;if(o.PT.flowerCount<o.PT.flowerlimit)C.addFlower(e[t][0],e[t][1],o)}if(random(0,1)>o.PT.spikeProb){let r=floor(random(1,o.PT.spikeCountRange));for(let n=0;n<r;n++){let r=[];let n=o.widthFunc(c);let a=n*.3;let s=constrain(n*.3*o.PT.hasSpikesW,.05,n*.5);if(t>=5){r.push([e[t-5][0],e[t-5][1]])}else if(l>=5&&o.PLANT[l-5][1].length>0){let e=o.PLANT[l-5][1].length-1;r.push([o.PLANT[l-5][1][e][0],o.PLANT[l-5][1][e][1]])}else{r.push([e[t][0],e[t][1]+5])}r.push([e[t][0],e[t][1]]);if(t<e.length-1){r.push([e[t+1][0],e[t+1][1]])}else{r.push([e[t][0],e[t][1]-5])}if(random(0,1)>.7){T.drawSpike({pg:pgL1,baseX:e[t][0]+random(-a,a),baseY:e[t][1],meta:o.PT,baseWidth:s*.9,stemPoints:r,branchLengthScale:o.PT.hasSpikesL})}else{T.drawSpike({pg:pgL0,baseX:e[t][0]+random(-a,a),baseY:e[t][1],meta:o.PT,baseWidth:s*.9,stemPoints:r,branchLengthScale:o.PT.hasSpikesL})}}}if(random(0,1)>kt){Or(e[t][0],e[t][1],o.PT)}if(random(0,1)>_t){Rr(e[t][0],e[t][1],o.PT)}if(random(0,1)>zt){if(Wt<20&&ot==0)Nr(e[t][0],e[t][1],o.PT),Wt++}}const V=()=>{const e=e=>{let t=[];let o=[];let r,n;let l=0;let a=[[d[0],d[1],d[2],d[3]]];let s=0;let i=0;let c;let m,u;let g,b,y,x;let F;let P=30;let w=0,V=0;let C=1024,T=2;let E,D,A={};let S=0,I=0,L=0;let B,v,W,k,_,z;let X;class Y{constructor(e){this.seed=e}random_dec(){this.seed^=this.seed<<13;this.seed^=this.seed>>17;this.seed^=this.seed<<5;return(this.seed<0?~this.seed+1:this.seed)%1e3/1e3}random_num(e,t){return e+(t-e)*this.random_dec()}random_int(e,t){return Math.floor(this.random_num(e,t+1))}random_bool(e){return this.random_dec()<e}random_choice(e){return e[Math.floor(this.random_num(0,e.length*.99))]}}var O=$t;e.setup=()=>{p=e.createGraphics(C,C);p.canvas.willReadFrequently=true;e.noCanvas();n=C;r=C;F=new Y(O);e.noiseSeed(O);e.textFont("Georgia");A.mainTone=l;w=F.random_choice([0,1,2,3,4,5]);A.layout=w;E=F.random_dec()>.1?1:0;D=F.random_dec()>.05?1:0;k=F.random_dec()>.5?1:0;if(k){S=F.random_int(-20,20);I=F.random_int(-5,10);L=F.random_int(-5,10)}R();B=F.random_num(.85,.92);v=F.random_num(.8,1.1);if(V==2)W=F.random_num(.83,.93);else W=F.random_num(.92,.98);N();h=e.createGraphics(C,C);h.canvas.willReadFrequently=true};e.draw=()=>{if(!f)return;G();y.shader(g);g.setUniform("vol",B*_);g.setUniform("magn",v*_);g.setUniform("zoom",W);g.setUniform("texture",u);y.rectMode(e.CENTER);y.rect(0,0,r,n);y.resetShader();m.shader(X);X.setUniform("invert",0);X.setUniform("subBrushsPg",y);X.setUniform("blendMode",s);m.rectMode(e.CENTER);m.rect(0,0,r,n);m.resetShader();p.clear();p.image(m,0,0,r,n);h.image(m,0,0,r,n);if(e.frameCount>201){h.image(m,0,0,r,n);f=false;e.noLoop();console.log("--Buffer DONE--")}};e.mousePressed=()=>{e.save(fxhash+".png")};function R(){m=e.createGraphics(r,n,e.WEBGL);m.pixelDensity(T);m.setAttributes("alpha",true);m.setAttributes("antialias",true);m.colorMode(e.HSB,360,100,100,255);m.canvas.willReadFrequently=true;c=e.createGraphics(r,n);c.pixelDensity(T);c.colorMode(e.HSB,360,100,100,255);c.canvas.willReadFrequently=true;u=e.createGraphics(r,n);u.pixelDensity(T);u.colorMode(e.HSB,360,100,100,255);u.background(0,0,100);u.canvas.willReadFrequently=true;y=e.createGraphics(r,n,e.WEBGL);y.pixelDensity(T);y.colorMode(e.HSB,360,100,100,255);y.canvas.willReadFrequently=true;g=cl(y._renderer);X=il(m._renderer);s=5;A.blendType=s;V=F.random_choice([0,0,1,1,3]);if(D==1)A.bigBrushType=V;else A.bigBrushType="none";if(w==2||w==4){_=1;z=.3}else if(w==0){_=.6;z=1}else if(w==1){_=.8;z=.8}else if(w==3){_=.9;z=1.2}else if(w==5){_=.4;z=.5}}function N(){P=30;A.topNum=P;let t=F.random_num(n*.1,n*.9);let l=F.random_num(r*.1,r*.9);for(let a=0;a<P;a++){let a,s;let i=F.random_dec()>.5?1:0;if(V==0){if(i==0){a=F.random_num(r*.1,r*.9);s=F.random_num(n*.05,n*.15)}else{a=F.random_num(r*.1,r*.9);s=F.random_num(n*.85,n*.95)}let e=F.random_dec()<.7?F.random_num(12,48):F.random_num(2,6);o.push(new q(u,0,"F",a,s,e,F.random_num(.02,.1),F.random_int(300,600)))}else if(V==1){a=F.random_num(-r*.2,r*.2)+l;s=F.random_num(-n*.2,n*.2)+t;let e=F.random_dec()<.7?F.random_num(12,48):F.random_num(2,6);o.push(new q(u,0,"F",a,s,e,F.random_num(.02,.1),F.random_int(300,600)))}else if(V==2){a=F.random_num(r*.2,r*.8);s=F.random_num(n*.2,n*.8);let e=F.random_dec()<.8?F.random_num(12,24):F.random_num(2,6);o.push(new q(u,0,"F",a,s,e,F.random_num(.05,.3),F.random_int(300,600)))}else if(V==3){let t=F.random_num(0,e.TWO_PI);let l=F.random_num(r*.1,r*.4);a=r/2+e.cos(t)*l;s=n/2+e.sin(t)*l;let i=F.random_num(10,20);o.push(new q(u,0,"F",a,s,i,F.random_num(.05,.3),F.random_int(300,600)))}else if(V==4){a=F.random_num(r*.2,r*.8);s=F.random_num(n*.2,n*.8);let e=F.random_num(3,25);o.push(new q(u,0,"F",a,s,e,F.random_num(.05,.3),F.random_int(300,600)))}}}function M(t,o,r,n,l,a=20,s=2,i=1,c="#000000"){let h=U(c);if(V==6)t.fill(h.x,h.y,h.z,F.random_num(55,105)*2.5);else t.fill(h.x,h.y,h.z,F.random_num(5,15)*8);for(let n=0;n<a;n++){if(F.random_dec()>.1){t.push();t.noStroke();t.translate(o+F.random_num(-s/1.5,s/1.5),r+F.random_num(-s/1.5,s/1.5));t.rotate(F.random_num(0,e.TWO_PI));t.ellipse(0,0,s*F.random_num(.9,1.2)/3,s*.02/2);t.pop()}}}function H(t,o,r,n,l,a=20,s=2,i=1,c="#000000"){let h=U(c);t.stroke(h.x,h.y,h.z,F.random_num(80,250));t.noFill();t.strokeWeight(F.random_num(.2,1));for(let i=0;i<a;i++){let a=F.random_dec();let i=e.lerp(o,n,a)+F.random_num(-s,s);let c=e.lerp(r,l,a)+F.random_num(-s,s);t.point(i,c)}if(s>6){t.push();if(i==1){if(F.random_dec()>.9){t.noStroke();t.fill(s*4,F.random_num(60,100));t.ellipse(o+F.random_num(-s*.8,s*.8),r+F.random_num(-s*.8,s*.8),s*F.random_num(.1,.25))}if(F.random_dec()>.9){t.noStroke();t.fill(250,F.random_num(30,80));t.ellipse(o+F.random_num(-s*.5,s*.5),r+F.random_num(-s*.5,s*.5),s*F.random_num(.1,.25))}}t.pop()}else if(s<=6&&s>=3){t.push();if(i==1){if(F.random_dec()>.9){t.noStroke();t.fill(s*4,80);t.ellipse(o+F.random_num(-s*.8,s*.8),r+F.random_num(-s*.8,s*.8),s*F.random_num(.1,.25))}if(F.random_dec()>.9){t.noStroke();t.fill(250,150);t.ellipse(o+F.random_num(-s*.5,s*.5),r+F.random_num(-s*.5,s*.5),s*F.random_num(.1,.25))}}t.pop()}else{t.push();if(i==1){if(F.random_dec()>.7){t.noStroke();t.fill(s*4,100);t.ellipse(o+F.random_num(-s*.8,s*.8),r+F.random_num(-s*.8,s*.8),s*F.random_num(.1,.25))}if(F.random_dec()>.3){t.noStroke();t.fill(F.random_num(150,240),150);t.ellipse(o+F.random_num(-s*.5,s*.5),r+F.random_num(-s*.5,s*.5),s*F.random_num(.1,.25))}}t.pop()}}function G(){for(let e=0;e<o.length;e++){let t=o[e];t.update()}}function U(t){let o=e.color(t);return e.createVector((e.hue(o)+S)%360,(e.saturation(o)+I)%100,(e.brightness(o)+L)%100)}function $(t,o,r,n){var l=n-o;var a=r-t;var s=e.atan2(l,a)+e.PI;return s}class q{constructor(t,o,r,n,s,i,c=.1,h=0){this.pg=t;this.id=o;this.tx=n;this.ty=s;this.x=n;this.y=s;this.px=n;this.py=s;this.age=0;this.z=F.random_num(0,1e3);this.type=r;this.life=c;this.ww=F.random_num(.1,1);this.radius=h;this.topLife=h;this.n=0;this.ax=0;this.ay=0;this.w=i;this.rw=i;this.rh=c;this.age=0;if(this.w<5)this.step=F.random_num(.1,.5);else this.step=F.random_num(1,2.5)*2;this.blendVol=F.random_num(.1,1.2);this.daVol=F.random_num(.001,.2);this.spW=true;this.circleSize=c;this.topLife=F.random_int(100,200);this.CircleDefultAngle=F.random_num(0,e.TWO_PI);this.seVol=F.random_dec()>.1?.99:.85;this.c2=a[l][F.random_choice([0,0,1,2,2,3])]}update(){this.age++;this.pg.noFill();this.i=this.age*(V==2?this.step:1)/this.topLife;if(F.random_dec()>.995)this.spW=!this.spW;if(V==0){let t=this.deltaAngle(.1);this.ax=e.cos(t)*this.blendVol;if(this.ty>n/2)this.ay=-1*this.step;else this.ay=1*this.step}else if(V==1){if(this.ty>n/2)this.ay=-1*this.step;else this.ay=1*this.step;if(this.tx>r/2)this.ax=-1*this.step;else this.ax=1*this.step}else if(V==2){this.n=F.random_num(.1,.3);this.ax=e.cos(this.i*e.TWO_PI+this.CircleDefultAngle)*(this.ww+this.n)*this.step;this.ay=e.sin(this.i*e.TWO_PI+this.CircleDefultAngle)*(this.ww+this.n)*this.step}else if(V==3){let t=F.random_num(3,8);let o=F.random_num(.05,.15);let r=e.noise(this.x*.01,this.y*.01,this.age*.01)*3;let n=this.CircleDefultAngle+e.sin(this.age*.05)*e.PI+e.noise(this.age*.02)*e.PI;this.ax=e.cos(n)*t*r+e.sin(this.age*.1)*2;this.ay=e.sin(n)*t*r+e.cos(this.age*.1)*2;let l=e.pow(.995,this.age);this.ax*=l;this.ay*=l}else if(V==4){let t=e.sin(this.age*.1)*.5+.5;let o=this.deltaAngle(.03);let r=e.sin(this.age*.2)*e.cos(this.age*.1);this.ax=(e.cos(o)*(1+t)+r*3)*e.map(e.noise(this.age*.05),0,1,.5,this.step);this.ay=(e.sin(o)*(1+t)+Math.abs(r)*4)*e.map(e.noise(this.age*.05),0,1,.5,this.step)}this.x=this.x+this.ax;this.y=this.y+this.ay;this.px=this.x;this.py=this.y;if(this.age<this.topLife){if(this.spW){this.n=e.map(e.noise(this.x*.01,this.y*.01),0,1,.2,4);this.ss=this.w*this.n+.1;H(this.pg,this.px,this.py,this.x,this.y,e.int(this.n*50+50),this.ss,1,this.c2)}else{this.pg.strokeWeight(.005);this.n=e.map(e.noise(this.x*.01,this.y*.01),0,1,.2,2);this.ss=this.w*this.n*1.5+.2;M(this.pg,this.px,this.py,this.x,this.y,e.int(this.n*50+50),this.ss,1,this.c2)}}}deltaAngle(t=.001,o=-20,r=20){return e.map(e.noise(this.x*t,this.y*t,this.z),0,1,o,r)}polarToCartesian(t,o){return e.createVector(this.triangleW*t*e.cos((o+this.baseA)/360*e.TWO_PI),t*e.sin((o+this.baseA)/360*e.TWO_PI))}x_1=t=>this.tx+this.circleSize*e.cos(this.baseA+e.TWO_PI*t*this.deltaAngle(.01,.8,1.2));y_1=t=>this.ty+this.circleSize*e.sin(this.baseA+e.TWO_PI*t*this.deltaAngle(.01,.8,1.2));x_2=t=>this.tx+this.circleSize*e.cos(this.baseA+e.TWO_PI*t*this.deltaAngle(.01,.8,1.2));y_2=t=>this.ty+this.circleSize*e.sin(this.baseA+e.TWO_PI*t*this.deltaAngle(.01,.8,1.2))}};new p5(e)};class C{static petal2(e={}){let{pg:t,baseX:o=0,baseY:n=0,baseRotation:l=createVector(0,0,0),branchLength:a=100,col:s=[0,0,0,1],col2:i=[0,0,0,1],branchWidthFunc:c=e=>1,branchBendFunc:h=e=>createVector(0,0,0),branchSegments:p=10,branchSegmentsH:f=4,strokeStrength:d=1,closeS:m=false,closeE:u=false,doLeafVeins:g=false,meta:b=e.meta||{},stemMode:y=0}=e;if(y==3){}let x=Ao($t);d=d+x.random(0,1)*2;let F=5*we;f=random(0,1)<.9?3:4;p=max(10,floor(a/4));p=max(5,floor(p*J));let P=createVector(0,0,0);let w=createVector(0,0,0);let V=[P.copy()];let C=[w.copy()];let T=[];let D=e=>Co.applyEulerRotation(e,l);let A;for(let e=0;e<p;e++){let t=e/(p-1);let o=h(t);w=p5.Vector.add(w,o.copy().mult(1/p));let r=createVector(0,0,a/p);let n=Co.applyEulerRotation(r,w);P=p5.Vector.add(P,D(n));C.push(w.copy());V.push(P.copy());A=c(e/p);T.push(A)}let[S,I]=Sn({pts:V,branchWidthFunc:c});function L(e,r){const l=V.length-1;const a=f-1;const c=(r-1)/a;const h=r/a;let p=e/l;const d=.5;const m=constrain(map(p,d,1,0,1),0,1);let u,g,b,x;if(m===0){u=Mo(S[e-1],I[e-1],c);g=Mo(S[e],I[e],c);b=Mo(S[e-1],I[e-1],h);x=Mo(S[e],I[e],h)}else if(m===1){u=p5.Vector.lerp(S[e-1],I[e-1],c);g=p5.Vector.lerp(S[e],I[e],c);b=p5.Vector.lerp(S[e-1],I[e-1],h);x=p5.Vector.lerp(S[e],I[e],h)}else{const t=Mo(S[e-2],I[e-2],c);const o=Mo(S[e],I[e],c);const r=Mo(S[e-2],I[e-2],h);const n=Mo(S[e],I[e],h);const l=p5.Vector.lerp(S[e-1],I[e-1],c);const a=p5.Vector.lerp(S[e],I[e],c);const s=p5.Vector.lerp(S[e-1],I[e-1],h);const i=p5.Vector.lerp(S[e],I[e],h);u=p5.Vector.lerp(t,l,m);g=p5.Vector.lerp(o,a,m);b=p5.Vector.lerp(r,s,m);x=p5.Vector.lerp(n,i,m)}const F=1;let P=sin(h*PI)*p;let w=s[0];let C=s[1];let T=s[2];if(f==2){w=_o(s[0],s[0],e*r/V.length/f)}else{w=_o(s[0],s[0],p)}C=lerp(s[1],s[1],P)*map(noise(p*F,c*F,h*F),0,1,.5,1);T=lerp(s[2],s[2],P)*map(noise(p*F,c*F,h*F),0,1,.5,1);if(y===1){w=_o(i[0],s[0],p);C=lerp(i[1],s[1],p);T=lerp(i[2],s[2],p)}else if(y===2){if(p<.5)p=0;else p=map(p,.5,1,0,1.2);w=_o(i[0],s[0],pow(1-p,.6));C=lerp(i[1],s[1],pow(1-p,.6));T=lerp(i[2],s[2],pow(1-p,.6))}else if(y===3){w=_o(i[0],s[0],p);C=lerp(i[1],s[1],p);T=lerp(i[2],s[2],p)}Ln({pg:t,pts:[u,g,x,b],baseX:o,baseY:n,doFill:true,col:Ro(w,C,T,1),randomOffset:1,vertexMode:st})}for(let e=1;e<V.length;e++){for(let t=1;t<f;t++){L(e,t)}}let B=Mt.colors.stroke[0];if(ye==0)B=Mt.colors.stroke[2];let v=Mt.colors.stroke[1];let W=e=>{const t=.2;const o=-.35;const r=(noise(e*t,Bo(0,100)*.05)+o)*2*Pe;return r>.5?r:random(0,1)>.7?0:0};let k=e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*d*Pe;let _=vo([W,k]);if(it==1)_=k;else if(it==2)_=W;if(r==0||y==1||y==3){Bn({pg:t,pts:S.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-F,F);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-F,F);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,doFill:true,col:Ro(B[0],B[1],B[2],1),branchWidthFunc:_,randomOffset:1,forceBrush:1});Bn({pg:t,pts:I.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-F,F);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-F,F);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,doFill:true,col:Ro(B[0],B[1],B[2],1),branchWidthFunc:_,randomOffset:1,forceBrush:1})}if(g){E.drawLeafVeins({pg:t,baseX:o,baseY:n,veinsType:b.petalfType,centerPos:V,leftPos:S,rightPos:I,col:Ro(B[0],B[1],B[2],.5),strokeStrength:.5})}if(m==true){let e=[];for(let t=0;t<=f-1;t++){let o=t/(f-1);e.push(Mo(S[0],I[0],o))}Bn({pg:t,pts:e,baseX:o,baseY:n,doFill:true,col:Ro(B[0],B[1],B[2],1),branchWidthFunc:e=>(.5*(1-e)*map(noise(e*10),0,1,.5,1)+.5)*d*Pe*random(1,1.5),randomOffset:1,forceBrush:1})}if(u==true){let e=[];for(let t=0;t<=f;t++){let o=t/f;e.push(p5.Vector.lerp(S[S.length-1],I[I.length-1],o))}Bn({pg:t,pts:e,baseX:o,baseY:n,doFill:true,col:Ro(B[0],B[1],B[2],1),branchWidthFunc:e=>(1-e)*map(noise(e*10),0,1,.1,.2)+.1,forceBrush:1})}return{centerPos:V,widths:T,centerPoints:V}}static stamen(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,baseRotation:n=createVector(0,0,0),PT:l,size:a=20,eachL:s=random(.8,2),stemLength:i=i,doFruit:c=1}=e;let h=l.fruitColors["apple"][0];let p=l.fruitColors["apple"][1];let f=l.fruitColors["apple"][2];let d=n;let m=T.stem({pg:t,baseX:o,baseY:r,baseRotation:d,branchLength:i+random(-5,5),col:Nt.branchColor,branchBendFunc:e=>createVector(random(1,2),random(1,2),0),strokeStrength:0});let u=m.centerPos[m.centerPos.length-1];let g=p5.Vector.sub(m.centerPos[m.centerPos.length-1],m.centerPos[m.centerPos.length-2]).normalize();let b=p5.Vector.cross(createVector(0,-1,0),g);let y=Co.angle(createVector(0,-1,0),g);let x=e=>{let t;if(b.mag()>.001){t=Co.rotateVectorAroundAxis(e,b,y)}else{t=e.copy()}return createVector(t.x+o+u.x,t.y+r+u.y,t.z)};let F=[h,p,f,1];let P=12;let w=[];let V=10;for(let e=0;e<=V;e++){let t=e/V;let o=-a*(2*t-1);w.push(createVector(0,o))}let C=e=>{let t=2*e-1;return a*sqrt(1-pow(t,2))};let[E,D]=Sn({pts:w,branchWidthFunc:C});function A(e,o){const r=w.length-1;const n=P-1;const l=(o-1)/n;const a=o/n;const s=e/r;const i=p5.Vector.lerp(E[e-1],D[e-1],l);const c=p5.Vector.lerp(E[e],D[e],l);const h=p5.Vector.lerp(E[e-1],D[e-1],a);const p=p5.Vector.lerp(E[e],D[e],a);const f=F[0];const d=F[1];const m=F[2];Ln({pg:t,pts:[i,c,p,h].map(x),doFill:true,doFillStroke:true,doStr:false,col:Ro(f,d,m,1),randomOffset:.5})}for(let e=1;e<w.length;e++){for(let t=1;t<P;t++){A(e,t)}}Bn({pg:t,pts:E.map(x),baseX:0,baseY:0,doFill:true,col:Ro(F[0],F[1],F[2]*1.2,1),randomOffset:1,branchWidthFunc:e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1)+.05});Bn({pg:t,pts:D.map(x),baseX:0,baseY:0,doFill:true,col:Ro(F[0],F[1],F[2]*1.2,1),randomOffset:1,branchWidthFunc:e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1)+.05})}static drawFlowerA(e={}){let{pg:t,id:o,baseX:r=0,baseY:n=0,meta:l}=e;let a=random(.6,1);or();let s=0;let i=random(0,1)>.9?random(.5,1.2):random(0,.5)*1;let c=random(0,1)>.5?random(1,2):random(1,1.5)*-1;let h=createVector(PI/2+i,PI/2+c,0);let p=T.stem({pg:pgL1,baseX:r,baseY:n,baseRotation:h,branchLength:l.flowerLengthC*$,col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]],branchWidthFunc:e=>1,branchBendFunc:e=>createVector(1,0,0),pointShift:2});let f=T.stem({pg:pgL1,baseX:r,baseY:n,baseRotation:h,branchLength:random(5,10),col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]*.8],branchWidthFunc:e=>random(1,3),branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let d=random(0,1)>.2?true:false;let m=p.centerPos[p.centerPos.length-1];let u=p.centerPos[p.centerPos.length-3];let g=p5.Vector.sub(u,m).normalize();let b=g;let y=createVector(1,0,0);if(abs(p5.Vector.dot(y,b))>.9){y=createVector(0,1,0)}y=p5.Vector.cross(b,createVector(0,1,0)).normalize();let x=p5.Vector.cross(b,y);let F=createVector(atan2(-x.z,b.z),asin(y.z),atan2(-y.y,y.x));let P=random(0,PI);let w=random(.9,1.1);let V=vo([.1,.3,.5,.7,.9]);if(d==true){for(let e=0;e<l.flowerPetal;e++){let t=[l.flowerColorA[0],l.flowerColorA[1],l.flowerColorA[2]];let o=[l.flowerColorB[0],l.flowerColorB[1],l.flowerColorB[2]];let s=e/l.flowerPetal*TWO_PI;let i=createVector(cos(s),sin(s),0);let c=createVector(i.x*y.x+i.y*x.x+i.z*b.x,i.x*y.y+i.y*x.y+i.z*b.y,i.x*y.z+i.y*x.z+i.z*b.z).normalize();let h=0;let p=createVector(m.x+c.x*h,m.y+c.y*h,m.z+c.z*h);let f=createVector(-c.x,-c.y,-c.z).normalize();let d=createVector(f.x,f.y+.5,f.z);let u,g,P;if(random(0,1)>.5){u=t[0];g=t[1];P=t[2]}else{u=t[0];g=t[1]*.95;P=t[2]*.95}C.petal({pg:pgL3,baseX:r+p.x,baseY:n+p.y,branchLength:a*l.flowerLengthA*random(.9,1.1),branchSegments:24,col:[u,g,P,1],colorFunction:l.flowerColorFn,strokeStrength:.5,direction:f,branchWidthFunc:e=>a*l.flowerShape(e)*l.flowerWidthA,branchBendFunc:e=>createVector(l.flowerOpenCurve(e)*vo([1,-.1,-.2,-.3,-1]),w,0)});if($e==0){if(random(0,1)>.5){u=o[0];g=o[1];P=o[2]}else{u=o[0];g=o[1]*.95;P=o[2]*.95}C.petal({pg:pgL4,baseX:r+m.x,baseY:n+m.y,branchSegments:12,branchLength:l.flowerLengthA*random(.3,.6),col:[u,g,P,1],colorFunction:l.flowerColorFn,direction:d,strokeStrength:.3,branchWidthFunc:e=>l.flowerShape(e)*l.flowerWidthA*.3+1,branchBendFunc:e=>createVector(l.flowerOpenCurve(e)*vo([-.1,-.2,-.3,-1]),w,0)})}else if($e==1){let e=createVector(r+m.x,n+m.y);let t=floor(random(-1,5));for(let o=0;o<t;o++){let t=random(3,6);let o=random(TWO_PI);let r=cos(o)*t;let n=sin(o)*t;let a=createVector(F.x+random(-3,3),F.y+random(-3,3),0);C.stamen({pg:pgL4,baseX:e.x,baseY:e.y,baseRotation:a,PT:l,size:random(2,4)*q,stemLength:random(10,30),doFruit:0})}}}}else if(d==false){for(let e=0;e<l.flowerPetal;e++){let t=e/l.flowerPetal*TWO_PI;let o=[l.flowerColorA[0],l.flowerColorA[1],l.flowerColorA[2]];let a=[l.flowerColorA[0],l.flowerColorA[1],l.flowerColorA[2]];C.petal2({pg:pgL2,baseX:r+p.centerPos[p.centerPos.length-2].x,baseY:n+p.centerPos[p.centerPos.length-2].y,baseRotation:F,branchLength:l.flowerLengthA*random(.6,.9),col:[o[0]*w,o[1],o[2]*random(.8,.9),1],branchWidthFunc:e=>l.flowerShape(e)*l.flowerWidthA*.3+2,branchBendFunc:e=>createVector(sin(e*PI)*-1*random(1,2),0,0),branchSegments:8,closeS:true})}}}static drawFlowerB(e={}){let{baseX:t=0,baseY:o=0,direction:n=createVector(0,0,1),rot:l=0,op:a=0,meta:s=e.meta,petalfType:i=s.petalfType||[10,2]}=e;let c=Co.vectorToEulerAngles(n);let h=C.petal2({pg:pgL1,baseX:t,baseY:o,baseRotation:c,branchLength:s.flowerLengthC*$,col:[s.branchColor[0],s.branchColor[1],s.branchColor[2]],branchWidthFunc:e=>1,branchSegments:10,branchSegmentsH:4,branchBendFunc:e=>createVector(1,0,0),closeS:true,meta:{...s,petalfType:i}});let p=T.stem({pg:pgL1,baseX:t,baseY:o,baseRotation:c,branchLength:random(5,10),col:[s.branchColor[0],s.branchColor[1],s.branchColor[2]*.8],branchWidthFunc:e=>random(2,3),branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let f=h.centerPoints[h.centerPoints.length-1];for(let e=0;e<s.flowerPetal;e++){let n=e/s.flowerPetal*TWO_PI+l;let i=createVector(0,-1,0);let h=createVector(0,-.1,.8);let p=p5.Vector.lerp(i,h,a);let d=Co.rotateVectorAroundAxis(p,createVector(0,0,1),n);let m=Co.applyEulerRotation(d,c);let u=Co.vectorToEulerAngles(m);let g=[s.flowerColorA[0],s.flowerColorA[1],s.flowerColorA[2]];let b,y,x;if(random(0,1)>.5){b=g[0];y=g[1];x=g[2]}else{b=g[0];y=g[1]*.95;x=g[2]*.95}let F=e<s.flowerPetal/2?-1:1;let P=e=>{if(s.branchBendFunc==undefined)return createVector(0,0,0);let t=s.branchBendFunc(e);return createVector(t.x,t.y*F,t.z)};let w=random(.5,.7);if(r==2)w=.5;let V=random(.8,1.2);if(r==2)V=.8;let T=true;if(s.spType==0)T=1;if(T)C.petal2({pg:pgL4,baseX:t+f.x,baseY:o+f.y,baseRotation:u,strokeStrength:.5,branchLength:s.flowerLengthA*V,col:[b,y,x,1],branchWidthFunc:e=>s.flowerShape(e)*s.flowerWidthA*w,branchBendFunc:P,branchSegments:18,branchSegmentsH:3,closeS:true,closeE:true,doLeafVeins:true,meta:s})}if(a<.5){C.drawCalyx({pg:pgL4,baseX:t+f.x,baseY:o+f.y,direction:n,baseEuler:c,flowerPetal:s.flowerPetal,flowerLengthA:s.flowerLengthA,flowerWidthA:s.flowerWidthA*.3,op:a,stemColor:s.flowerColorB})}}static drawFlowerC(e={}){let{pg:t,id:o,baseX:n=0,baseY:l=0,meta:a,baseRotation:s=createVector(0,0,0),ll:i=1}=e;or();let c=random(3,7);let h=e=>{while(e>PI)e-=TWO_PI;while(e<-PI)e+=TWO_PI;return e};let p=map(l,0,m.dim,1,2);let f=createVector(h(random(-.6*PI,.6*PI)+PI/2),h(random(-.6*PI,.6*PI)),0);if(r==1){f=createVector(PI/2+random(-1,1),0,random(-1,1));p=1.5}let d=To.combineRotations(s,f);let u=T.stem({pg:pgL1,baseX:n,baseY:l,baseRotation:d,branchLength:a.flowerLengthC*$*random(.5,1)*i,col:[a.branchColor[0],a.branchColor[1],a.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2),branchBendFunc:e=>createVector(p,random(1,2)*vo([-1,1]),random(1,2)*vo([-1,1])),strokeStrength:1});let g=T.stem({pg:pgL0,baseX:n,baseY:l,baseRotation:d,branchLength:random(5,10),col:[a.branchColor[0],a.branchColor[1],a.branchColor[2]*.7],branchWidthFunc:e=>random(2,3),branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let b=u.centerPos[u.centerPos.length-1];let y=p5.Vector.sub(u.centerPos[u.centerPos.length-1],u.centerPos[u.centerPos.length-2]).normalize();t.push();t.translate(n+b.x,l+b.y);let x=c*1;let F=20;let P=[];for(let e=0;e<F;e++){let t=TWO_PI*e/F;let o=cos(t)*x;let r=sin(t)*x;P.push(createVector(o,r,0))}let w=P.map((e=>Co.applyEulerRotation(e,d)));t.fill(a.flowerColorB[0],a.flowerColorB[1],a.flowerColorB[2]);t.beginShape();w.forEach((e=>{t.vertex(e.x,e.y)}));t.endShape(CLOSE);t.pop();let V=a.sunflowerPetalCount;for(let e=0;e<9;e++){let t=e/9*TWO_PI;let o=createVector(c*1*cos(t),c*1*sin(t),0);let r=Co.applyEulerRotation(o,d);let s=createVector(cos(t),sin(t),0);s=Co.applyEulerRotation(s,d);let i=map(l,0,m.dim,3,.5);let h=map(l,m.dim*.2,m.dim,1.2,.8);let p=map(noise(n*100,l*100),0,1,.8,1.2);let f=noise(n*500,l*500)>.7?[0,2]:[1,1];let u=[a.flowerColorA[0],a.flowerColorA[1],a.flowerColorA[2]];let g,y,x;g=u[0];y=u[1]*.8*p;x=u[2]*.8*p;C.petal({pg:pgL2,baseX:n+b.x+r.x,baseY:l+b.y+r.y,branchLength:a.sunSize*.8,col:[g,y,x,1],colorFunction:a.flowerColorFn,direction:s,strokeStrength:.3,branchWidthFunc:e=>pow(sin(PI*(1-e)),.5)*a.flowerWidthA*.3,branchBendFunc:e=>createVector(i,0,0)})}for(let e=0;e<V;e++){let t=e/V*TWO_PI;let o=createVector(c*1*cos(t),c*1*sin(t),0);let r=Co.applyEulerRotation(o,d);let s=createVector(cos(t),sin(t),0);s=Co.applyEulerRotation(s,d);let i=map(l,0,m.dim,3,.5);let h=map(l,m.dim*.2,m.dim,1.2,.8);let p=map(noise(n*100,l*100),0,1,.8,1.2);let f=noise(n*500,l*500)>.7?[0,2]:[1,1];let u=[a.flowerColorA[0],a.flowerColorA[1],a.flowerColorA[2]];let g,y,x;if(random(0,1)>.5){g=u[0];y=u[1]*p*f[0];x=u[2]*p*f[1]}else{g=u[0];y=u[1]*.95*p*f[0];x=u[2]*.95*p*f[1]}C.petal({pg:pgL3,baseX:n+b.x+r.x,baseY:l+b.y+r.y,branchLength:a.sunSize,col:[g,y,x,1],colorFunction:a.flowerColorFn,direction:s,strokeStrength:.3,branchWidthFunc:e=>pow(sin(PI*(1-e)),.5)*a.flowerWidthA*.4,branchBendFunc:e=>createVector(i,0,0)})}let E=random(0,1);for(let e=0;e<10;e++){let t=e/10*TWO_PI;let o=createVector(c*.4*cos(t),c*.4*sin(t),0);let r=Co.applyEulerRotation(o,d);let s=createVector(cos(t),sin(t),0);s=Co.applyEulerRotation(s,d);C.petal({pg:pgL4,baseX:n+b.x+r.x,baseY:l+b.y+r.y,branchLength:20*q,col:a.flowerColorB,colorFunction:a.flowerColorFn,direction:s,branchSegments:10,strokeStrength:.5,branchWidthFunc:e=>.5,branchBendFunc:e=>createVector(a.flowerOpenCurve(e),sin(e*PI)*2,0)})}}static drawFlowerD(e={}){let{pg:t,id:o,baseX:r=0,baseY:n=0,meta:l}=e;const a=random(0,1)>.1?Bo(30,150):Bo(150,300);const s=vo([1.4,1.4,1.4,2.8]);const i=T.stem({pg:pgL1,baseX:r,baseY:n,baseRotation:createVector(PI/2,0,random(-2,2)),branchLength:a*.5,col:l.branchColor,branchWidthFunc:e=>s*a/25,branchBendFunc:()=>createVector(1,1,0),pointShift:1});const c=i.centerPos[i.centerPos.length-1];const h=6;const p=137.5;const f=a*random(.05,.08);const d=p*PI/180;const m=random(TWO_PI);const[u,g,b]=l.flowerColorA;for(let e=0;e<h;e++){const t=7;const o=e*f;const s=map(e,0,h-1,.4,.3+random(-.1,.2));const i=map(e,0,h-1,.8,1.2);for(let h=0;h<t;h++){const p=h*TWO_PI/t+e*d+m;const f=createVector(cos(p),sin(p),0).normalize();const y=createVector(c.x+f.x*o,c.y+f.y*o,0);const x=createVector(f.x*.3,f.y*.3,-1).normalize();const F=Co.vectorToEulerAngles(x);C.petal2({pg:pgL3,baseX:r+y.x,baseY:n+y.y,baseRotation:createVector(F.x,F.y,random(-2,2)),branchLength:a*s,col:[u,g,b*i,1],branchWidthFunc:e=>l.flowerShape(e)*l.flowerWidthA*s*.5,branchBendFunc:e=>createVector(sin(e*PI)*.9,0,0),branchSegments:6,strokeStrength:.6,closeS:true})}}}static drawFlowerG(e={}){let{pg:t,baseX:o=0,baseY:n=0,direction:l=createVector(0,0,1),rot:a=random(0,1),op:s=0,meta:i=e.meta,petalfType:c=i.petalfType||[10,2],doFruit:h=0}=e;a=0;i.branchBendFunc=e=>{if(e<random(.55,.65)){return createVector(.6,0,0)}else{return createVector(0,cos(e*PI*2)*2,0)}};if(i.spType==0)i.branchBendFunc=e=>createVector(sin(e*PI)*-2,cos(e*PI)*.3,0);let p=Co.vectorToEulerAngles(l);let f=vo([-1,1]);let d=C.petal2({pg:t,baseX:o,baseY:n,baseRotation:createVector(PI/2,0,1*f),branchLength:i.flowerLengthC*$*random(.5,1.2),col:[i.flowerColorA[0],i.flowerColorA[1],i.flowerColorA[2]*.7],col2:[i.branchColor[0],i.branchColor[1],i.branchColor[2]*.8],branchWidthFunc:e=>1.5,branchSegments:10,branchSegmentsH:4,branchBendFunc:e=>createVector(0,random(1.5,3)*f,0),closeS:true,meta:{...i,petalfType:c},stemMode:1});if(h){let e=d.centerPoints[d.centerPoints.length-1];D.melon({pg:t,baseX:o+e.x,baseY:n+e.y-10,baseRotation:createVector(0,0,0),PT:PT,size:30,length:30*random(.8,1.2),stemLength:PT.fruitstem,branchLength:80,stemBend:createVector(-1,0,0)})}let m=d.centerPoints[d.centerPoints.length-1];let u=0;for(let e=0;e<i.flowerPetal;e++){if(e>3&&e<10)u=1;else u=0;let l=e/i.flowerPetal*TWO_PI+a;let c=createVector(0,-1,0);let h=createVector(0,-.1,.8);let f=p5.Vector.lerp(c,h,s);let d=Co.rotateVectorAroundAxis(f,createVector(.05,.05,1),l);let g=Co.applyEulerRotation(d,p);let b=Co.vectorToEulerAngles(g);let y,x,F;let P=map(e,0,i.flowerPetal,.8,1.5);let w=map(e,0,i.flowerPetal,.8,1.5);let V=0;y=V;x=i.flowerColorA[1]*w;F=i.flowerColorA[2]*P;let T=e<7?-1:1;let E=e=>{let t=i.branchBendFunc(e);return createVector(t.x,t.y*T,t.z)};let D=random(.5,.7);if(r==2)D=.5;let A=random(.8,1.2);if(r==2)A=.8;if(i.spType==0)u=1;if(u)C.petal2({pg:t,baseX:o+m.x,baseY:n+m.y,baseRotation:b,strokeStrength:.5,branchLength:i.flowerLengthA*A,col:[y,x,F,1],branchWidthFunc:e=>i.flowerShape(e)*i.flowerWidthA*D,branchBendFunc:E,col:[i.flowerColorA[0],i.flowerColorA[1],i.flowerColorA[2]*.8],col2:[i.flowerColorB[0],i.flowerColorB[1],i.flowerColorB[2]*1.1],branchSegments:18,branchSegmentsH:3,closeS:true,closeE:true,doLeafVeins:false,stemMode:2,meta:i})}}static drawCalyx(e={}){let{baseX:t=0,baseY:o=0,direction:r=createVector(0,0,1),baseEuler:n=Co.vectorToEulerAngles(r),flowerPetal:l=5,flowerLengthA:a=20,flowerWidthA:s=8,op:i=0,stemColor:c=[100,.7,.8,1]}=e;let h=a*.3;let p=s*.8;let f=createVector(0,0,1);for(let e=0;e<l;e++){let r=e/l*TWO_PI;let a=i;let s=createVector(cos(r)*.1,sin(r)*.1,-.3);let d=createVector(cos(r)*.3,sin(r)*.3,-.1);let m=p5.Vector.lerp(d,s,a).normalize();let u=Co.applyEulerRotation(m,n);let g=u.angleBetween(f);let b;if(i>.5){b=g<PI/2?pgL1:pgL3}else{b=pgL3}let y=Co.vectorToEulerAngles(u);let x=map(a,0,1,3,1);C.petal2({pg:b,baseX:t,baseY:o,baseRotation:y,branchLength:-h,strokeStrength:.2,col:[c[0],c[1],c[2],1],branchWidthFunc:e=>{let t=p*(1-e*.7);return t*(a>.7?.2:map(a,0,.7,.5,.1))},branchBendFunc:e=>{let t=sin(e*PI)*(1-a)*x;let o=cos(e*PI)*x;let n=noise(r*10,e*10)*.4;return createVector(t+n,0,o+n)},branchSegments:16,branchSegmentsH:3,closeS:false,strokeStrength:.3})}}static drawLoseLeaves(e,t,o=0){st=0;ot=0;ht=0;let r=[Mt.colors.leaf[1][0],Mt.colors.leaf[1][1]*.5,Mt.colors.leaf[1][2]];let n=[Mt.colors.leaf[0][0],Mt.colors.leaf[0][1]*.5,Mt.colors.leaf[0][2]];r=r.map((e=>constrain(e,0,360)));n=n.map((e=>constrain(e,0,360)));pgBg.push();let l=5;if(o==0)l=Bo(10,30);else if(o==1)random(0,1)>.3?l=Bo(50,80):l=Bo(150,300);let a=[];for(let e=0;e<l;e++){a.push({size:random(0,1)<.9?random(40,60):random(70,120)})}let s=t-20;function i(e,t){if(e>.7){return sin(e*PI)*t*(1-e)*0}else{return sin(e*PI)*t*(1-e)*.8}}let c=1;if(o==0)c=random(0,1)<.7?random(2,3):random(3.5,4.5);else if(o==1)c=random(3.5,5.5);a.forEach(((t,o)=>{let l=0;if(random(0,1)>.95)l=c*3;else l=c;t.x=e+random(random(-t.size*l,t.size*l),random(-t.size*l,t.size*l));t.y=s+o*t.size*random(.01,.02);let a=random(0,1);let h=createVector(PI/2*vo([1,-1]),-random(-.3,.3),0).normalize();let p=random(0,1)<.8?.1:.2;let f=random(.9,1.1);let d=constrain(random(-.3,1.3),0,1);let m=[lerp(r[0],n[0],d),lerp(r[1],n[1],d),lerp(r[2],n[2],d),random(.1,.8)];C.petal({pg:pgBg,baseX:t.x,baseY:t.y,direction:h,branchLength:t.size,col:[m[0],m[1],m[2]*f,m[3]],branchSegments:12,branchWidthFunc:e=>i(e,t.size*p),branchBendFunc:e=>createVector(0,-sin(e*PI)*.4,sin(e*PI)*.3),drawOutLine:1,strokeStrength:.2,downLeaf:1})}));pgBg.pop()}static petal(e={}){let{pg:t=pgBg,baseX:o=0,baseY:n=0,direction:l=createVector(0,0,1),branchLength:a=100,branchSegments:s=12,branchWidthFunc:i=e=>sin(e*PI)*20,col:c=e.col||{},colorFunction:h=e=>e,branchBendFunc:p=e=>createVector(0,0,0),pcc:f=false,drawOutLine:d=1,pointShift:m=0,strokeStrength:u=1,downLeaf:g=0,sameWidth:b=0}=e;let y=Ao($t);u=u+y.random(0,1)*2;m=5*we;s=max(5,floor(s*J));let x=createVector(0,0,1);let F=p5.Vector.cross(x,l);let P=x.angleBetween(l);if(F.magSq()<1e-6){if(x.dot(l)<0){F=createVector(1,1,1);P=PI}else{F=createVector(1,0,0);P=0}}else{F.normalize()}let w=createVector(0,0,0);let V=createVector(0,0,0);let C=[];let T=[];let E=[];for(let e=0;e<s;e++){let r=e/(s-1);let f=p(r);V=p5.Vector.add(V,p5.Vector.mult(f,1/s));let d=createVector(0,0,a/s);d=Co.applyEulerRotation(d,V);w=p5.Vector.add(w,d);let m=i(r);let u=createVector(-l.y,l.x,0).normalize().mult(m);let g=p5.Vector.add(w,u);let b=p5.Vector.add(w,p5.Vector.mult(u,-1));let y=Co.rotateVectorAroundAxis(w,F,P);let x=Co.rotateVectorAroundAxis(g,F,P);let D=Co.rotateVectorAroundAxis(b,F,P);C.push(y.copy());T.push(x.copy());E.push(D.copy());if(e>0){let r=p5.Vector.sub(C[e],T[e-2]);let l=p5.Vector.sub(T[e],C[e]);let a=p5.Vector.cross(r,l);let s=map(abs(a.angleBetween(createVector(PI/2,PI/2,0))),0,PI,1,0);s=h(s);let i=c[0];let p=c[1];let f=c[2];let d=c[3]||1;Ln({pg:t,pts:[T[e],T[e-1],C[e-1],C[e]],baseX:o,baseY:n,col:Ro(i,p,f,d),doFill:true,randomOffset:.3,vertexMode:st});Ln({pg:t,pts:[E[e],E[e-1],C[e-1],C[e]],baseX:o,baseY:n,doFill:true,col:Ro(i,p,f,d),randomOffset:.3,vertexMode:st})}}let D=Mt.colors.stroke[0];if(ye==0)D=Mt.colors.stroke[2];let A=Mt.colors.stroke[1];let S=e=>{const t=.01;const o=-.35;const r=(noise(e*t,Bo(0,100)*.05)+o)*u*Pe;return r>.5?r:random(0,1)>.7?0:0};let I=e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.4)*u*Pe;let L=e=>(.5*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*u*Pe;let B=vo([S,I]);if(it==1)B=I;else if(it==2)B=S;if(r==1||r==2){B=e=>.5}let v=1;let W=.7;if(g==1){B=L;b=1;D=c;v=.7;W=.4}if(d>0){Bn({pg:t,pts:C.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-m,m);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,doFill:true,col:Ro(D[0],D[1],D[2]*v,W),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1});Bn({pg:t,pts:T.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-m,m);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,doFill:true,col:Ro(D[0],D[1],D[2]*v,W),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1});Bn({pg:t,pts:E.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-m,m);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-m,m);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,doFill:true,col:Ro(D[0],D[1],D[2]*v,W),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1});let e=T[T.length-1];let r=E[E.length-1];let l=[e,r];Bn({pg:t,pts:l,baseX:o,baseY:n,doFill:true,col:Ro(D[0],D[1],D[2]*v,W),branchWidthFunc:B,randomOffset:1,sameWidth:b,forceBrush:1})}return C}static addFlower(e,t,o){if(!o||!o.PT){console.warn("meta or meta.PT is undefined");return false}if(!o.PT.flowerPositions){o.PT.flowerPositions=[]}let n=false;for(let r of o.PT.flowerPositions){let o=dist(e,t,r.x,r.y);let l=Ue==2?10:50;if(o<l){n=true;break}}if(!n){o.PT.flowerPositions.push({x:e,y:t});if(r==2)Ue=4;switch(Ue){case 0:C.drawFlowerA({pg:pgL3,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT});break;case 1:let r=Ao($t);C.drawFlowerB({pg:pgL2,baseX:e,baseY:t,direction:ko(r),rot:random(0,TWO_PI),op:vo([.1,.1,.3,.6]),meta:o.PT});break;case 2:C.drawFlowerC({pg:pgL2,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT,ll:random(3,6)});break;case 3:C.drawFlowerD({pg:pgL2,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT});break;case 4:C.drawSpecialFlower({pg:pgL2,id:o.PT.flowerCount,baseX:e,baseY:t,meta:o.PT});break}o.PT.flowerCount++;return true}return false}static drawSpecialFlower({pg:e,baseX:t,baseY:o,meta:r}){let n={branchColor:r.branchColor,flowerColorA:[r.flowerColorA[0],r.flowerColorA[1],r.flowerColorA[2]*random(1.1,1.2)],flowerColorB:[r.flowerColorA[0],r.flowerColorA[1],r.flowerColorA[2]*random(.5,.7)],flowerPetal:1,flowerLengthA:80*random(.8,1.4),flowerWidthA:10*random(.6,1.2),flowerLengthC:30*random(.8,1.2),flowerShape:e=>{if(e<.5){return 2*pow(sin(e*3.14),1.5)+.3}else{return 2*pow(sin(e*3.14),1.5)+.2}},petalfType:[13,2,0],spType:0};let l={branchColor:r.branchColor,flowerColorA:[r.flowerColorA[0],r.flowerColorA[1],r.flowerColorA[2]*random(.8,1)],flowerColorB:[r.flowerColorB[0],r.flowerColorB[1],r.flowerColorB[2]*random(.9,1.1)],flowerPetal:12,flowerLengthA:110*random(.9,1.1),flowerWidthA:9*random(.6,1.2),flowerLengthC:30*random(.8,1.2),flowerShape:e=>{if(e<.4)return map(e,0,.5,.8,1);else if(e>=.4&&e<.6)return map(e,.4,.6,1,.5);else return map(e,.6,1,.5,.2)},petalfType:[13,2,0],spType:1};let a=createVector(0,1,vo([-1,1]));let s;let i=random(0,1)>.7?n:l;if(i==n)s=createVector(0,1,a.z*-10);else s=createVector(0,1,a.z*-1);C.drawFlowerG({pg:pgL0,baseX:t,baseY:o,direction:a,op:1,meta:i});if(random(0,1)>.5){C.drawFlowerG({pg:pgL3,baseX:t,baseY:o,direction:s,op:1,meta:i})}}}class T{static drawWoody(e={}){let{meta:t=e.meta||{},pg:o=pgL1,baseX:n=0,baseY:l=0,baseRotation:a=createVector(PI/2,0,0),branchLength:s=m.dim*U,branchSegments:i=30,branchWidthFunc:c=1,twistIntensity:h=5,maxBranchWidth:p=4,col:f=[50,.2,.8],stemTexLine:d=e.stemTexLine||0,maxBranchDepth:u=3,forkCount:g=4,branchStats:b=e.branchStats||{mainStemLength:0,branchCount:0,branchesByDepth:{},totalLength:0,highestBranch:null},currentDepth:y=e.currentDepth||0,currentPath:currentPath=e.currentPath||[],isMainStem:x=y===0,parentStartPoint:F=null,branchId:P=e.branchId||"main"}=e;if(r==2)d=1;if(_e)console.log("drawWoody - 樹枝深度:"+y+" branchId:"+P);let w=new Set;let V=To.combineRotations(a,createVector(re,ne,le));let C=s;b.totalLength+=C;if(y===0)b.mainStemLength=C;const E=Eo.createJoints(h,i);const D=Eo.createWidthFunction(c,p,E,i);const A=Eo.createbranchBendFunction(E,i);let{centerPos:S,widths:I}=T.stem({pg:pgL1,baseX:n,baseY:l,baseRotation:V,branchLength:C,branchSegments:i,branchWidthFunc:D,col:f,branchBendFunc:A,closeS:x,stemTexLine:d,currentDepth:y});let L=0;for(let e=1;e<S.length;e++){L+=dist(S[e].x,S[e].y,S[e-1].x,S[e-1].y)}if(x){if(!b.branchesByDepth[0]){b.branchesByDepth[0]=1}}else{if(!b.branchesByDepth[y]){b.branchesByDepth[y]=0}b.branchesByDepth[y]++}let B=[];if(u>0){let a=Bo(max(1,g-2),g+1);b.branchCount+=a;const p=width*1.05;const f=height*1.05;const m=-width*.05;const x=-height*.05;for(let g=0;g<a;g++){let a=floor(S.length*.1);let F=floor(S.length*.9);let V=floor(random(a,F));const C=n+(S[V]?S[V].x:0);const E=l+(S[V]?S[V].y:0);let D=false;for(let e of w){if(abs(e-V)<10){D=true;break}}if(D)continue;if(V>=0&&V<S.length){let a=I[V];let F=random(.3,.7);if(r!=0)F=random(.6,.8);w.add(V);let D=`${P}_${g}`;let A={x:S[V].x+n,y:S[V].y+l,depth:y+1,branchId:D,parentBranchId:P,plantId:Gt.plantId};let L=ut?[...currentPath.slice(0,V+1),A]:[];if(jt==3&&y>0)ae=[Bo(0,10),Bo(0,15)];if(C>=m&&C<=p&&E>=x&&E<=f){let r=T.drawWoody({...e,pg:o,baseX:C,baseY:E,branchSegments:i,branchLength:s*random(.5,Q),branchWidthFunc:c*F,twistIntensity:h*.7,maxBranchDepth:u-1,col:[t.branchColor[0],t.branchColor[1],t.branchColor[2]*random(.9,1),1],forkCount:t.branchFork,maxBranchWidth:a*F,branchStats:b,currentDepth:y+1,currentPath:L,isMainStem:false,parentStartPoint:A,branchId:D,stemTexLine:d});if(r&&r.length>0){B=B.concat(r)}}}}}if(ut){let e;if(w.size>0){let t=max(...Array.from(w));e=S.slice(0,t+1).map(((e,t)=>({x:round(e.x+n),y:round(e.y+l),depth:y,isMainStem:x,branchId:P,parentBranchId:F?.branchId||null,isStartbranch:w.has(t),plantId:Gt.plantId,segmentIndex:O,doTimestamp:Date.now()})))}else{e=S.map(((e,t)=>({x:round(e.x+n),y:round(e.y+l),depth:y,isMainStem:x,branchId:P,parentBranchId:F?.branchId||null,isStartbranch:false,plantId:Gt.plantId,segmentIndex:O,doTimestamp:Date.now()})))}if(!se.path){se.path=[]}se.path=[...se.path,...e];let t=S[S.length-1];if(t.y+l<se.height){se={x:t.x+n,y:t.y+l,height:t.y+l,path:se.path,plantId:Gt.plantId,segmentIndex:O}}}let v=[[u,S.map(((e,t)=>[e.x+n,e.y+l,e.z,I[t]]))]].concat(B);v.widthFunc=D;v.baseWidth=c;v.maxBranchWidthidth=p;return v}static stem(e={}){let{pg:t=pgL3,baseX:o=0,baseY:n=0,baseRotation:l=createVector(PI/2,0,0),branchLength:a=400,branchSegments:s=20,branchSegmentsH:i=4,branchWidthFunc:c=e=>.5*(1-e)*map(noise(e*10),0,1,.5,1)+.2,branchBendFunc:h=e=>createVector(random(-10,10),0,random(-5,5)),mushroomStroke:p=false,branchStats:f=null,closeS:d=false,curveS:m=true,stemTexLine:u=0,pointShift:g=10,strokeStrength:b=.8,strokeNoiseScale:y=10,lineSegScale:x=vo([.05,.2,1,5]),lineLimit:F=vo([.7,.5,.3]),col:P=[250,.5,.4],jointCount:w=Bo(10,30),currentDepth:V=0}=e;let C=Ao($t);b=b+C.random(0,1)*2;b=b*map(q,.2,5,1,2);g=5*we;s=max(5,floor(min(80,max(30,floor(a/6)))*J));let T=createVector(0,0,0);let E=createVector(0,0,0);let D=[T.copy()];let A=[E.copy()];let S=[];let I=e=>Co.applyEulerRotation(e,l);let L;let B=map(V,0,4,1,2)+random(-.2,.2);for(let e=0;e<s;e++){let t=e/(s-1);let o=h(t);E=p5.Vector.add(E,o.copy().mult(1/s));let r=createVector(0,0,a/s);let n=Co.applyEulerRotation(r,E);T=p5.Vector.add(T,I(n));A.push(E.copy());D.push(T.copy());L=c(e/s);S.push(L)}let[v,W]=Sn({pts:D,branchWidthFunc:c});let k=v.map(((e,t)=>Mo(v[t],W[t],.3+random(-.05,.15))));let _=v.map(((e,t)=>Mo(v[t],W[t],.7+random(-.15,.05))));if(i!=null){i=i}else{i=L<1.5?5:vo([6,8,10])}function z(e,l){const a=D.length-1;const s=i-1;const c=e/a;const h=l/s;const p=(l+1)/s;const f={Pos0_0:Mo(v[e],W[e],h),Pos0_1:Mo(v[e+1],W[e+1],h),Pos1_0:Mo(v[e],W[e],p),Pos1_1:e>a-5?Mo(v[e+1],W[e+1],1):Mo(v[e+1],W[e+1],p)};const d=pow(1-c,1);const m={h:P[0],s:lerp(P[1],P[1]*.8,d),b:lerp(P[2]*B,P[2]*.8,d),alpha:1};let u=.6;if(r==2)u=0;Ln({pg:t,pts:[f.Pos0_0,f.Pos0_1,f.Pos1_1,f.Pos1_0],baseX:o,baseY:n,col:Ro(m.h,m.s,m.b,m.alpha),randomOffset:u})}for(let e=0;e<D.length-1;e++){for(let t=0;t<i-1;t++){z(e,t)}}let X;X=Mt.colors.stroke[0];if(ye==0)X=Mt.colors.stroke[2];let Y=Mt.colors.stroke[1];let O=Mt.colors.vine[0];if(p){x=10;F=.8}let R=e=>{const t=.01;const o=-.35;const r=(noise(e*t,Bo(0,100)*.05)+o)*b*Pe;return r>.5?r:random(0,1)>.8?0:0};let N=e=>(.2*(1-e)*map(noise(e*y),0,1,.5,1)+.3)*b*Pe;let M=e=>.5;let H=.5;if(L>1&&u==0){for(let e=0;e<k.length-1;e++){let r=k[e];let l=k[e+1];if(noise(e*x)<F){let e=createVector(r.x,r.y);let a=createVector(l.x,l.y);let s=[];for(let t=0;t<=4;t++){let o=t/4;let r=lerp(e.x,a.x,o);let n=lerp(e.y,a.y,o);s.push(createVector(r,n))}Bn({pg:t,pts:s,baseX:o,baseY:n,col:Ro(Y[0],Y[1],Y[2],1),branchWidthFunc:N,randomOffset:.2,forceBrush:1})}}for(let e=0;e<_.length-1;e++){let r=_[e];let l=_[e+1];if(noise(e*x+1e3)<F){let e=createVector(r.x,r.y);let a=createVector(l.x,l.y);let s=[];for(let t=0;t<=4;t++){let o=t/4;let r=lerp(e.x,a.x,o);let n=lerp(e.y,a.y,o);s.push(createVector(r,n))}Bn({pg:t,pts:s,baseX:o,baseY:n,col:Ro(Y[0],Y[1],Y[2],1),branchWidthFunc:N,randomOffset:.2,forceBrush:1})}}}An({pg:pgText,pts:D,baseX:o,baseY:n});let G=vo([R,N]);if(it==1)G=N;else if(it==2)G=R;if(r==2)G=M,K=0,g=0;Bn({pg:t,pts:v.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-g,g);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-g,g);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,col:Ro(X[0],X[1],X[2],H),branchWidthFunc:G,randomOffset:.5});Bn({pg:t,pts:W.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-g,g);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-g,g);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,col:Ro(X[0],X[1],X[2],H),branchWidthFunc:G,randomOffset:.5});let U=[];let $=i;for(let e=0;e<=$;e++){let t=e/$;U.push(Mo(v[0],W[0],t))}if(d==true){Bn({pg:t,pts:U,baseX:o,baseY:n,col:Ro(X[0],X[1],X[2],H),branchWidthFunc:G,randomOffset:.5})}if(L>1.5){let e=[];let r=i;for(let t=0;t<=r;t++){let o=t/r;e.push(p5.Vector.lerp(v[v.length-1],W[W.length-1],o))}Bn({pg:t,pts:e,baseX:o,baseY:n,col:Ro(X[0],X[1],X[2],H),branchWidthFunc:G,randomOffset:0})}if(u==1&&L<10){let e=0;if(r==2)e=floor(w*Ot);for(let r=e;r<w;r++){let e=r/w;let l=floor(e*D.length);let a=D[l];let s=c(e)*2;let i=max(0,l-1);let h=min(D.length-1,l+1);let p=p5.Vector.sub(D[h],D[i]).normalize();let f=createVector(-p.y,p.x);let d=[];let m=[];let u=8;for(let e=0;e<=u;e++){let t=map(e,0,u,-s*random(.5,.65),s*random(.5,.65));let o=p5.Vector.add(a,p5.Vector.mult(f,t));d.push(o)}for(let e=0;e<=u;e++){let t=map(e,0,u,-s*.45,s*.45);let o=p5.Vector.add(a,p5.Vector.mult(f,t));m.push(o)}Bn({pg:t,pts:m,baseX:o,baseY:n,col:Ro(X[0],X[1],X[2]*.5,.8),branchWidthFunc:e=>N(e)*4,randomOffset:0,forceBrush:1});Bn({pg:t,pts:m,baseX:o,baseY:n,col:Ro(0,0,1,.8),branchWidthFunc:e=>N(e)*2,randomOffset:0,forceBrush:1})}}const j=D.reduce(((e,t)=>t.y<e.y?t:e),D[0]);const Q={centerPos:D,widths:S,highestPoint:j};return Q}static drawSpike(e={}){let{pg:t=pgL3,meta:o,baseX:r=0,baseY:n=0,branchLength:l=random(20,50),branchSegments:a=10,baseWidth:s,branchLengthScale:i,branchWidthFunc:c=e=>4*(1-e*.8),col:h=o.spikeColor,branchBendFunc:p=e.branchBendFunc||(e=>createVector(random(.5,1.5),random(1,3),0)),stemPoints:f=e.stemPoints||[],pointShift:d=5,strokeStrength:m=.2,strokeNoiseScale:u=10,sp2Mode:g=0}=e;let b=Ao($t);m=m+b.random(0,1)*2;d=10*we;s=min(s,30);h=random(0,1)>.1?o.spikeColor:o.spikeColor2;c=e=>min(s*(1-e*.95),8);let y=createVector(0,-1);l=random(s*30,s*60)*$*i;p=e=>createVector(random(-.5,2),random(-1,3),0);if(f.length>=2){let e=createVector(f[0][0],f[0][1]);let t=createVector(f[2][0],f[2][1]);y=p5.Vector.sub(t,e).normalize();let o=random(0,1)>.5?PI/2:PI/4;let r=random(-PI/12,PI/12);let n=random(-PI/9,-PI/4.5);y.rotate(o+r);y.rotate(n)}let x=atan2(y.y,y.x);let F=createVector(0,0,x);a=4;let P=createVector(0,0,0);let w=createVector(0,0,0);let V=[P.copy()];let C=[w.copy()];let T=[];let E=e=>Co.applyEulerRotation(e,F);for(let e=0;e<a;e++){let t=e/(a-1);let o=p(t);w=p5.Vector.add(w,o.copy().mult(1/a));let r=createVector(0,0,l/a);let n=Co.applyEulerRotation(r,w);P=p5.Vector.add(P,E(n));C.push(w.copy());V.push(P.copy());T.push(c(e/a))}let[D,A]=Sn({pts:V,branchWidthFunc:c});let S=6;let I=random(0,1)>.3?1:0;function L(e,o){const l=V.length-1;const a=S-1;const s=o/a;const i=(o+1)/a;const c=(e+1)/l;const p={Pos0_0:Mo(D[e],A[e],s),Pos0_1:Mo(D[e+1],A[e+1],s),Pos1_0:Mo(D[e],A[e],i),Pos1_1:Mo(D[e+1],A[e+1],i)};const f=map(i/c,0,1,1,.5)+noise(e,o)*.2;const d=I===1?{h:h[0],s:h[1]*f,b:h[2]*f}:{h:h[0],s:h[1]*.7,b:h[2]*.7};Ln({pg:t,pts:[p.Pos0_0,p.Pos0_1,p.Pos1_1,p.Pos1_0],baseX:r,baseY:n,col:Ro(d.h,d.s,d.b,1),randomOffset:1})}for(let e=0;e<V.length-1;e++){for(let t=0;t<S-1;t++){L(e,t)}}let B=Mt.colors.stroke[0];if(ye==0)B=Mt.colors.stroke[2];let v=Mt.colors.stroke[1];Bn({pg:t,pts:D.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let o=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:n,col:Ro(B[0],B[1],B[2]*.8,1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*m*Pe,randomOffset:1});Bn({pg:t,pts:A.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let o=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:n,col:Ro(B[0],B[1],B[2]*.8,1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*m*Pe,randomOffset:1});return{centerPos:V,widths:T}}static drawAllPath(e){if(!se.path)return;let t=se.path.filter((e=>e.isMainStem));let o=se.path.filter((e=>!e.isMainStem));let r=o.reduce(((e,t)=>{if(!e[t.depth]){e[t.depth]=[]}e[t.depth].push(t);return e}),{})}static drawVines(e){if(!se.path)return;let t=2;let o=1;let r=1;let n=Ao($t);r=r+n.random(0,1)*2;t=10*we;Pe=.6;const l=e.spiral;const a={maxRadiusMultiplier:1,minRadius:.5,maxNoiseEffect:.15,maxBendEffect:.3,maxTwistEffect:PI/2};pgL0.strokeCap(ROUND);pgL1.strokeCap(ROUND);let s=se.path.filter((e=>e.isMainStem));let i=se.path.filter((e=>!e.isMainStem));let c=[];c=[...s];let h={};i.forEach((e=>{if(!h[e.parentBranchId]){h[e.parentBranchId]=[]}h[e.parentBranchId].push(e)}));Object.keys(h).forEach((e=>{let t=s.find((t=>t.branchId===e));if(t){c=c.concat(h[e])}}));const p=floor(c.length*l.maxLength);let f=c.slice(0,p);let d=random(1e3);let m=random(1e3);let u=.2;let g=f.map(((t,o)=>{let r=o/(f.length-1);let n=r;let s=e.widthFunc(n);let i=constrain(s*l.baseRadius*a.maxRadiusMultiplier,a.minRadius,s*1.2);let h=noise(d+r*u)*l.noiseStrength*a.maxNoiseEffect;let p=1.3*i*(1+h*.5)*(l.radiusVariation*.8);let m=map(t.y,c[0].y,c[c.length-1].y,0,1);let g=sin(m*PI)*l.bendStrength*a.maxBendEffect;p*=1+g*.8;let b=frameCount*.003;let y=sin(b+r*PI*.8)*.4+.6;let x=noise(b*u*.8,r*u*.8);let F=lerp(y,x,.2);let P=map(F,0,1,.2,1.5);l.spiralTightness=lerp(l.spiralTightness,P,.1);let w=l.baseFrequency*TWO_PI*l.spiralTightness;let V=noise(d)*l.twistFactor*a.maxTwistEffect;let C=w+V;let T=t.x+cos(C)*p;let E=t.y;let D=sin(C)*p;d+=l.noiseScale;return{x:T,y:E,z:D,baseRadius:i}}));let b=g.map(((e,t)=>{let o=t/(f.length-1);let r=1;if(e&&typeof e.baseRadius==="number"&&isFinite(e.baseRadius)){r=l.baseWidth*e.baseRadius*.2}let n=m+t*l.smoothness||0;let a=noise(n)*(l.widthVariation||.1)*.6;r=isFinite(r)?r:1;a=isFinite(a)?a:0;let s=constrain((r+a)/2,max(.1,r*.3),max(.2,r*1));s=isFinite(s)?s:1;let i=min(t+1,g.length-1);let c;if(t<g.length-1){let t=g[i];if(t&&e){c=createVector(t.x-e.x,t.y-e.y).normalize()}else{c=createVector(0,-1)}}else{if(t>0&&g[t-1]&&e){let o=g[t-1];c=createVector(e.x-o.x,e.y-o.y).normalize()}else{c=createVector(0,-1)}}if(!c){c=createVector(0,-1)}let h=createVector(-c.y,c.x).mult(s);return{x:e.x,y:e.y,z:e.z,widthVector:h,strokeWeight:s*2}}));pgL0.push();pgL1.push();let y=l.glowChance*random(.6,1.2);for(let e=0;e<b.length-1;e++){let t=b[e];let o=b[e+1];let n=e/(b.length-1);let a=l.detailLevel;let s=_o(l.color[0],l.color[0],n);let i=map(n,0,1,l.color[1],l.color[1])*map(noise(n*a),0,1,.8,1);let c=map(n,0,1,l.color[2],l.color[2])*map(noise(n*a),0,1,.5,1);let h=Ro(s,i,c,1);let p=Ro(s,i*.8,c*.6,1);let f=createVector(t.x-t.widthVector.x,t.y-t.widthVector.y);let d=createVector(t.x+t.widthVector.x,t.y+t.widthVector.y);let m=createVector(o.x-o.widthVector.x,o.y-o.widthVector.y);let u=createVector(o.x+o.widthVector.x,o.y+o.widthVector.y);let g=random(.5,1.5)+2;if(t.z<0&&o.z<0){Ln({pg:pgL0,pts:[f,m,u,d],col:h,randomOffset:.5});Bn({pg:pgL0,pts:[f,m],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Bn({pg:pgL0,pts:[d,u],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5})}else if(t.z>=0&&o.z>=0){Ln({pg:pgL1,pts:[f,m,u,d],col:h,randomOffset:.5});Bn({pg:pgL1,pts:[f,m],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Bn({pg:pgL1,pts:[d,u],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5})}else{let e=abs(t.z)/(abs(t.z)+abs(o.z));let n=lerp(t.x,o.x,e);let l=lerp(t.y,o.y,e);let a=p5.Vector.lerp(t.widthVector,o.widthVector,e);let s=createVector(n-a.x,l-a.y);let i=createVector(n+a.x,l+a.y);if(t.z<0){Ln({pg:pgL0,pts:[f,s,i,d],col:h,randomOffset:.5});Bn({pg:pgL0,pts:[f,s],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Bn({pg:pgL0,pts:[d,i],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Ln({pg:pgL1,pts:[s,m,u,i],col:h,randomOffset:.5});Bn({pg:pgL1,pts:[s,m],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Bn({pg:pgL1,pts:[i,u],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5})}else{Ln({pg:pgL1,pts:[f,s,i,d],col:h,randomOffset:.5});Bn({pg:pgL1,pts:[f,s],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Bn({pg:pgL1,pts:[d,i],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Ln({pg:pgL0,pts:[s,m,u,i],col:h,randomOffset:.5});Bn({pg:pgL0,pts:[s,m],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5});Bn({pg:pgL0,pts:[i,u],col:p,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*r*Pe*random(.5,1),randomOffset:.5})}}}g.forEach(((t,o)=>{let r=o/(g.length-1);if(random(0,1)>.8){let o=createVector(random(-.5,.5),random(-.5,.5),random(-3,3));let r=E.leaf({pg:pgL0,outline:false,baseX:t.x,baseY:t.y,branchLength:l.leaf.size.length*random(.7,1),col:l.leaf.color,colorFunction:e.leafColorFn,branchSegments:10,baseRotation:createVector(o.x,o.y,o.z+PI/2),branchWidthFunc:e=>l.leaf.shape(e)*l.leaf.size.width,branchBendFunc:e=>createVector(map(noise(e*1,PI),0,1,-1,1)*5,0,map(noise(e*1,PI+PI),0,1,-1,1)*5),veinsType:[l.leaf.veins.type,l.leaf.veins.density,l.leaf.veins.spacing]});E.leaf({pg:pgL1,outline:false,baseX:t.x,baseY:t.y,branchLength:l.leaf.size.length*random(.7,1),col:l.leaf.color,colorFunction:e.leafColorFn,branchSegments:10,baseRotation:createVector(o.x,o.y,o.z-PI/2),branchWidthFunc:e=>l.leaf.shape(e)*l.leaf.size.width,branchBendFunc:e=>createVector(map(noise(e*1,PI+100),0,1,-1,1)*4,0,map(noise(e*1,PI+PI+100),0,1,-1,1)*4),veinsType:[l.leaf.veins.type,l.leaf.veins.density,l.leaf.veins.spacing]})}}));pgL0.pop();pgL1.pop()}static wood(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,baseRotation:n=createVector(PI/2,0,0),branchLength:l=400,branchSegments:a=20,branchSegmentsH:s=4,branchWidthFunc:i=e=>.5*(1-e)*map(noise(e*10),0,1,.5,1)+.2,branchBendFunc:c=e=>createVector(random(-10,10),0,random(-10,10)),pointShift:h=10,strokeStrength:p=.8,strokeNoiseScale:f=10,lineSegScale:d=vo([.05,.2,1,5]),lineLimit:m=vo([.7,.5,.3]),col:u=[250,.5,.4],depth:g=1,convexConcaveStrength:b=random(.2,1.3),forceHorizontal:y=false,enableCracks:x=random(0,1)>.7,crackDensity:F=random(.05,.3),crackDepth:P=random(.1,.3),enableHoles:w=random(0,1)>.7,holeDensity:V=random(.05,.3),holeSize:C=random(.1,.3),holeDepth:E=random(.1,.3)}=e;let D=Ao($t);p=p*map(q,.2,5,1,1.8);h=3*we;u=Mt.colors.branch[2];if(y){n=createVector(PI/2,random(0,.2),vo([-1*random(1.3,1.8),random(1.3,1.8)]))}else{n=createVector(PI/2,random(0,.2),random(0,.2))}let A=createVector(0,0,0);let S=createVector(0,0,0);let I=[A.copy()];let L=[S.copy()];let B=e=>Co.applyEulerRotation(e,n);for(let e=0;e<a;e++){let t=e/(a-1);let o=c(t);S=p5.Vector.add(S,o.copy().mult(1/a));let r=createVector(0,0,l/a);let n=Co.applyEulerRotation(r,S);A=p5.Vector.add(A,B(n));L.push(S.copy());I.push(A.copy())}let[v,W]=Sn({pts:I,branchWidthFunc:i});function k(e,t){const o=I.length-1;const r=s-1;const n=e/o;const l=(t-1)/r;const a=t/r;const i=.02;const c=.48;const h=.52;const p=.98;let f=0;if(n<=i){f=1*b}else if(n<c){f=(1-(n-i)/(c-i))*b}else if(n>=p){f=-1*b}else if(n>h){f=-((n-h)/(p-h))*b}const d=f>0;const m=f<0;let u,g,y,x;const F=e;if(d||m){const e=d?Mo:(e,t,o)=>Mo(t,e,1-o);const t=e(v[F-1],W[F-1],l);const o=e(v[F],W[F],l);const r=e(v[F-1],W[F-1],a);const s=e(v[F],W[F],a);const i=p5.Vector.lerp(v[F-1],W[F-1],l);const p=p5.Vector.lerp(v[F],W[F],l);const b=p5.Vector.lerp(v[F-1],W[F-1],a);const P=p5.Vector.lerp(v[F],W[F],a);const w=abs(f);u=p5.Vector.lerp(i,t,w);g=p5.Vector.lerp(p,o,w);y=p5.Vector.lerp(b,r,w);x=p5.Vector.lerp(P,s,w);const V=d&&n<c||m&&n>h?1+.2*w:1;if(V>1){const e=(u.x+x.x)/2;const t=(u.y+x.y)/2;const o=o=>createVector(e+(o.x-e)*V,t+(o.y-t)*V);u=o(u);g=o(g);y=o(y);x=o(x)}}else{u=p5.Vector.lerp(v[F-1],W[F-1],l);g=p5.Vector.lerp(v[F],W[F],l);y=p5.Vector.lerp(v[F-1],W[F-1],a);x=p5.Vector.lerp(v[F],W[F],a)}const P=(u.x+g.x+x.x+y.x)/4;const w=(u.y+g.y+x.y+y.y)/4;const V=random(1,1.2);const C=e=>createVector(P+(e.x-P)*V,w+(e.y-w)*V);return{Pos0_0:C(u),Pos0_1:C(g),Pos1_1:C(x),Pos1_0:C(y),center:createVector(P,w)}}function _(e,n){const{Pos0_0:l,Pos0_1:a,Pos1_1:s,Pos1_0:i}=e;const{h:c,s:h,b:p,alpha:f}=n;Ln({pg:t,pts:[l,a,s,i],baseX:o,baseY:r,col:Ro(c,h,p,f),randomOffset:.5})}function z(e,n){if(!x||random(0,1)>=F)return;const l=[e.Pos0_0,e.Pos0_1,e.Pos1_1,e.Pos1_0];const a=floor(random(4));let s;do{s=floor(random(4))}while(s===a);const i=l[a];const c=l[s];const h=p5.Vector.sub(c,i);const p=h.mag()*random(.3,.9);h.setMag(p);const f=p5.Vector.add(i,p5.Vector.mult(h,random(.3,.7)));const d=createVector(-h.y,h.x);d.setMag(p*P*random(.1,.3));f.add(d);const m=[];const u=floor(random(3,7));for(let e=0;e<=u;e++){let t=e/u;let o;if(e===0){o=i.copy()}else if(e===u){const e=p5.Vector.add(i,p5.Vector.mult(h,random(.7,1)));o=e.copy()}else{const e=t;const r=(1-e)**2*i.x+2*(1-e)*e*f.x+e**2*(i.x+h.x);const n=(1-e)**2*i.y+2*(1-e)*e*f.y+e**2*(i.y+h.y);const l=createVector(random(-5,5)*P,random(-5,5)*P);o=createVector(r,n).add(l)}m.push(o)}const{h:g,s:b,b:y,alpha:w}=n;const V=y*.5;const C=w*.9;for(let e=1;e<m.length;e++){const n=m[e-1];const l=m[e];const a=p5.Vector.sub(l,n);const s=createVector(-a.y,a.x);s.setMag(random(1,3)*P);const i=[p5.Vector.add(n,s),p5.Vector.add(l,s),p5.Vector.sub(l,s),p5.Vector.sub(n,s)];Ln({pg:t,pts:i,baseX:o,baseY:r,col:Ro(g,b*.9,V,C),randomOffset:.3})}}function X(e,n){if(!w||random(0,1)>=V)return;const{Pos0_0:l,Pos0_1:a,Pos1_1:s,Pos1_0:i}=e;const c=[l,a,s,i];const h=createVector((l.x+a.x+s.x+i.x)/4,(l.y+a.y+s.y+i.y)/4);const p=c.reduce(((e,t)=>e+p5.Vector.dist(h,t)),0)/4;const f=p*C*random(.3,.7);const d=createVector(random(-p,p)*.3,random(-p,p)*.3);const m=p5.Vector.add(h,d);const u=floor(random(8,16));const g=[];for(let e=0;e<u;e++){const t=e/u*TWO_PI;const o=noise(e*.3)*.5+.5;const r=map(o,0,1,.7,1.3);const n=f*r;g.push(createVector(m.x+cos(t)*n,m.y+sin(t)*n))}const{h:b,s:y,b:x,alpha:F}=n;const P=x*(.3-E*.2);const T=F*.95;Ln({pg:t,pts:g,baseX:o,baseY:r,col:Ro(b,y*.9,P,T),randomOffset:.2});const D=f*.15;for(let e=0;e<u;e++){const n=g[e];const l=g[(e+1)%u];const a=p5.Vector.sub(n,m);a.setMag(D);const s=p5.Vector.add(n,a);const i=p5.Vector.add(l,p5.Vector.sub(l,m).setMag(D));Ln({pg:t,pts:[n,l,i,s],baseX:o,baseY:r,col:Ro(b,y*.9,lerp(P,x,.3),T),randomOffset:.3})}const A=floor(random(3,8));for(let e=0;e<A;e++){const e=random(TWO_PI);const dist=random(f*.1,f*.7);const n=createVector(m.x+cos(e)*dist,m.y+sin(e)*dist);const l=f*random(.05,.15);const a=floor(random(5,8));const s=[];for(let e=0;e<a;e++){const t=e/a*TWO_PI;const o=l*random(.8,1.2);s.push(createVector(n.x+cos(t)*o,n.y+sin(t)*o))}Ln({pg:t,pts:s,baseX:o,baseY:r,col:Ro(b,y*.9,P*.7,T),randomOffset:.1})}}let Y=Mt.colors.stroke[0];let O=Mt.colors.stroke[1];let R=e=>(.6*(1-e)*map(noise(e*10),0,1,.5,1)+.5)*p*Pe;let N=Bo(10,15);if(g==0)N=Bo(1,4);const M=[];let H=.5;for(let e=0;e<N;e++){const t=.2+.8/(N-1)*e;let o;const line=[];for(let e=0;e<v.length;e++){let r=e/(v.length-1);o=t+map(noise(e*.1),0,1,-.2,.1);let n;if(r<=.48){let t=r<=.02?1:1-(r-.02)/(.48-.02);t*=b;let l=Mo(v[e],W[e],o);let a=createVector(lerp(v[e].x,W[e].x,o),lerp(v[e].y,W[e].y,o));let s=(v[e].x+W[e].x)/2;let i=(v[e].y+W[e].y)/2;n=createVector(lerp(a.x,l.x,t),lerp(a.y,l.y,t));if(r>.02&&r<.48){let e=1+.2*b*(1-(r-.02)/(.48-.02));n=createVector(s+(n.x-s)*e,i+(n.y-i)*e)}}else if(r>=.52){let t=r>=.98?-1:-(r-.52)/(.98-.52);t*=b;let l=Mo(W[e],v[e],1-o);let a=createVector(lerp(v[e].x,W[e].x,o),lerp(v[e].y,W[e].y,o));let s=(v[e].x+W[e].x)/2;let i=(v[e].y+W[e].y)/2;n=createVector(lerp(a.x,l.x,-t),lerp(a.y,l.y,-t));if(r>.52&&r<.98){let e=1+.2*b*((r-.52)/(.98-.52));n=createVector(s+(n.x-s)*e,i+(n.y-i)*e)}}else{n=createVector(lerp(v[e].x,W[e].x,o),lerp(v[e].y,W[e].y,o))}line.push(n)}M.push(line)}M.forEach(((line,e)=>{for(let n=0;n<line.length-1;n++){let l=line[n];let a=line[n+1];if(n%100==0)H=random(.1,.5);const s=n>line.length-5?.9:.6;if(noise(n*10+e*1e3)<s){let e=createVector(l.x,l.y);let n=createVector(a.x,a.y);let s=[];for(let t=0;t<=4;t++){let o=t/4;let r=lerp(e.x,n.x,o);let l=lerp(e.y,n.y,o);s.push(createVector(r,l))}Bn({pg:t,pts:s,baseX:o,baseY:r,col:Ro(O[0],O[1],O[2],1),branchWidthFunc:e=>R(e)*H,randomOffset:0})}}}));Bn({pg:t,pts:v.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-h,h);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-h,h);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(Y[0],Y[1],Y[2],1),branchWidthFunc:R,randomOffset:.5});Bn({pg:t,pts:W.map((e=>{let t=map(noise(e.x*K,e.y*K),0,1,-h,h);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-h,h);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(Y[0],Y[1],Y[2],1),branchWidthFunc:R,randomOffset:.5});let G=[];let U=s*2;let $=createVector((v[0].x+W[0].x)/2,(v[0].y+W[0].y)/2);for(let e=0;e<=U;e++){let t=e/U;let o=Mo(v[0],W[0],t);let r=1*b;o=createVector($.x+(o.x-$.x)*r,$.y+(o.y-$.y)*r);let n=map(noise(o.x*.1,o.y*.1),0,1,-h*.5,h*.5);let l=map(noise(o.y*.1,o.x*.1),0,1,-h*.5,h*.5);o.x+=n;o.y+=l;G.push(o)}Bn({pg:t,pts:G,baseX:o,baseY:r,col:Ro(Y[0],Y[1],Y[2],1),branchWidthFunc:R,randomOffset:.5});let j=[];let J=s*2;let Q=createVector((v[v.length-1].x+W[W.length-1].x)/2,(v[v.length-1].y+W[W.length-1].y)/2);for(let e=0;e<=J;e++){let t=e/J;let o=Mo(W[W.length-1],v[v.length-1],t);let r=1*b;o=createVector(Q.x+(o.x-Q.x)*r,Q.y+(o.y-Q.y)*r);let n=map(noise(o.x*.1,o.y*.1),0,1,-h*.5,h*.5);let l=map(noise(o.y*.1,o.x*.1),0,1,-h*.5,h*.5);o.x+=n;o.y+=l;j.push(o)}Bn({pg:t,pts:j,baseX:o,baseY:r,col:Ro(Y[0],Y[1],Y[2],1),branchWidthFunc:R,randomOffset:.5});if(random(0,1)>.3){let e=vo([3,3,6,12,20,40]);for(let t=0;t<e;t++){let e=floor(random(1,I.length-2));let t=random(0,1);let n=t<.33?"left":t<.66?"middle":"right";let l;if(n==="left"){l=v[e]}else if(n==="right"){l=W[e]}else{l=createVector((v[e].x+W[e].x)/2,(v[e].y+W[e].y)/2)}let a=p5.Vector.dist(v[e],W[e]);let s=a*random(.05,.15);let i=[];if(e>=5){let t;if(n==="left"){t=v[e-5]}else if(n==="right"){t=W[e-5]}else{t=createVector((v[e-5].x+W[e-5].x)/2,(v[e-5].y+W[e-5].y)/2)}i.push([t.x,t.y])}else{i.push([l.x,l.y+5])}i.push([l.x,l.y]);if(e<I.length-5){let t;if(n==="left"){t=v[e+5]}else if(n==="right"){t=W[e+5]}else{t=createVector((v[e+5].x+W[e+5].x)/2,(v[e+5].y+W[e+5].y)/2)}i.push([t.x,t.y])}else{i.push([l.x,l.y-5])}let c=random(.1,.3);let h=random(0,1)>.7?pgL1:pgL0;T.drawSpike({pg:h,baseX:l.x+o,baseY:l.y+r,meta:Mt,baseWidth:s,stemPoints:i,branchLengthScale:c})}}if(g===1){let e=e=>{let t=c(e);return createVector(t.x*random(.8,1.2),t.y*random(.8,1.2),0)};let g=random(.1,.3);let y=e=>i(e)*g;let w=l*random(.1,.3);if(random(0,1)<.8){let l=floor(random(1,I.length-2));let i=I[l];let c=v[l];let g=W[l];let V=vo([.1,.9]);let C=o+lerp(c.x,g.x,V);let E=r+lerp(c.y,g.y,V);let D=n.x+random(-PI/2,PI/2);let A=n.y+random(-PI/2,PI/2);let S=n.z+random(-PI/2,PI/2);let L=createVector(D,A,S);let B=random(0,1)<.3;T.wood({pg:t,baseX:C,baseY:E,baseRotation:L,branchLength:w,branchSegments:max(10,floor(a*.5)),branchSegmentsH:max(3,floor(s*.7)),branchWidthFunc:y,branchBendFunc:e,pointShift:h*.5,strokeStrength:p*.5,strokeNoiseScale:f,lineSegScale:d,lineLimit:m,col:u,depth:0,convexConcaveStrength:b*.8,forceHorizontal:B,enableCracks:x,crackDensity:F,crackDepth:P})}g=random(.2,.4);y=e=>i(e)*g;w=l*random(.2,.4);if(random(0,1)<.5){let l=floor(random(1,I.length-2));let i=v[l];let c=W[l];let g=vo([.1,.9]);let V=o+lerp(i.x,c.x,g);let C=r+lerp(i.y,c.y,g);let E=n.x+random(-PI/2,PI/2);let D=n.y+random(-PI/2,PI/2);let A=n.z+random(-PI/2,PI/2);let S=createVector(E,D,A);let L=random(0,1)<.3;T.wood({pg:t,baseX:V,baseY:C,baseRotation:S,branchLength:w,branchSegments:max(10,floor(a*.5)),branchSegmentsH:max(3,floor(s*.7)),branchWidthFunc:y,branchBendFunc:e,pointShift:h*.5,strokeStrength:p*.5,strokeNoiseScale:f,lineSegScale:d,lineLimit:m,col:u,depth:0,convexConcaveStrength:b*.8,forceHorizontal:L,enableCracks:x,crackDensity:F,crackDepth:P})}}}}class E{static heart(e={}){let{pg:t,meta:o,baseX:r=0,baseY:n=0,size:l=random(5,20),branchSegments:a=Bo(30,45),baseRotation:s=createVector(PI/2,0,0),branchSegmentsH:i=Bo(4,8),pointShift:c=2,strokeStrength:h=1,strokeNoiseScale:p=1,shapeVariation:f=random(.8,1.2),asymmetry:d=random(-.2,.2),col:m=[90,.2,.3],col2:u=[90,.2,.3],specID:g=0}=e;g=random(0,1)<.8?0:1;let b=Ao($t);h=h+b.random(0,1)*2;c=10*we;a=30;t.push();let y=[];let x=random(TWO_PI);let F=random(.8,2);let P=random(.8,2);for(let e=0;e<=a;e++){let t=e/a;let o=map(t,0,1,-6,6);let r=2*(o*o+abs(o)-6)*f;let n=3*(o*o+abs(o)+2);let i=r/n;let c=i+sqrt(36-o*o)*(1+d*sin(o));o=o*l*F;c=-c*l*P;let h=createVector(o,c,0);h=Co.applyEulerRotation(h,s);y.push(h)}for(let e=a;e>=0;e--){let t=e/a;let o=map(t,0,1,-6,6);let r=2*(o*o+abs(o)-6)*f;let n=3*(o*o+abs(o)+2);let i=r/n;let c=i-sqrt(36-o*o)*(1+d*sin(o));o=o*l*F;c=-c*l;let h=createVector(o,c,0);h=Co.applyEulerRotation(h,s);y.push(h)}let w=-l*7;let V=createVector(0,w,0);V=Co.applyEulerRotation(V,s);y=y.map((e=>p5.Vector.add(e,V)));let C=[];for(let e=0;e<i;e++){let t=e/(i-1);let o=y.map((e=>p5.Vector.lerp(e,p5.Vector.add(createVector(0,0),V),t)));C.push(o)}let T=random(.8,1.05);let D=Wo(.3,.6);let A=random(0,1)<.5?3:1;let S=0;if(g==0){T=random(.65,.75)+random(-.05,.05);S=1}else if(g==1){T=vo([1.2,1.2,1.5])+random(-.05,.05);S=.7}for(let e=0;e<C.length-1;e++){let o=C[e];let l=C[e+1];let a=e/(C.length-1);for(let e=0;e<o.length-1;e++){let s=o[e];let i=atan2(s.y,s.x);let c=1-lerp(sin(i)*a,a,a);c+=map(noise(i*20,a*20),0,1,.1,.4);let h=pow(fract(c*A),3);let p=map(h*.5,0,1,.7,1.1);let f=m[0]*p;let d=m[1];let u=m[2]*T;Ln({pg:t,pts:[o[e],o[min(e+2,o.length-1)],l[min(e+2,l.length-1)],l[e]],baseX:r,baseY:n,col:Ro(f,d,u,D),randomOffset:1})}}let I=Mt.colors.stroke[0];if(ye==0)I=Mt.colors.stroke[2];let L=Mt.colors.stroke[1];let B=y.slice(y.length/4,y.length/4*3).reverse();let v=y.slice(y.length/4*3,y.length-1).concat(y.slice(0,y.length/4+1));let W=y[floor(y.length/4*3)];let k=y[floor(y.length/4)];let _=[];for(let e=0;e<=30;e++){let t=e/31;let o=p5.Vector.lerp(W,k,t);_.push(o)}Bn({pg:t,pts:B.map((e=>{let t=map(noise(e.x*p,e.y*p),0,1,-c,c);let o=map(noise(e.y*p,e.x*p),0,1,-c,c);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:n,col:Ro(I[0],I[1],I[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*2*Pe,randomOffset:1});Bn({pg:t,pts:v.map((e=>{let t=map(noise(e.x*p,e.y*p),0,1,-c,c);let o=map(noise(e.y*p,e.x*p),0,1,-c,c);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:n,col:Ro(I[0],I[1],I[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*2*Pe,randomOffset:1});E.drawLeafVeins({pg:t,baseX:r,baseY:n,debug:true,veinsType:Mt.veinsType2,centerPos:_,leftPos:v,rightPos:B,col:Ro(I[0],I[1],I[2],1),col2:Mt.colors.flower[1],strokeStrength:.5,specID:g});An({pg:pgText,pts:_,baseX:r,baseY:n});t.pop()}static lotus(e={}){let{pg:t,meta:o,baseX:r=0,baseY:n=0,size:l=random(5,20),branchSegments:a=Bo(30,45),baseRotation:s=createVector(PI/2,0,0),branchSegmentsH:i=Bo(4,8),pointShift:c=2,strokeStrength:h=.8,strokeNoiseScale:p=1,shapeVariation:f=random(.8,1.2),asymmetry:d=random(-.2,.2),col:m=[90,.2,.3]}=e;let u=Ao($t);h=h+u.random(0,1)*2;c=10*we;a=60;t.push();let g=[];let b=random(TWO_PI);let y=random(.9,1.1);let x=random(.9,1.1);for(let e=0;e<=a;e++){let t=map(e,0,a,0,TWO_PI);let o=l*(1+.05*sin(t*6)+.03*sin(t*10));if(t>PI*.8&&t<PI*1.2){let e=map(t,PI*.8,PI*1.2,0,1,true);let r=e*e*(3-2*e);o*=map(r,0,1,1,.8,true)}let r=cos(t)*o*y;let n=sin(t)*o*x;n-=l*.2;let i=createVector(r,n,0);i=Co.applyEulerRotation(i,s);g.push(i)}let F=0;let P=-l*.2;let w=createVector(F,P,0);w=Co.applyEulerRotation(w,s);let V=[];for(let e=0;e<i;e++){let t=e/(i-1);let o=g.map((e=>{let o=t*t*(3-2*t);return p5.Vector.lerp(e,w,o)}));V.push(o)}let C=random(.5,1);for(let e=0;e<V.length-1;e++){let o=V[e];let l=V[e+1];let a=e/(V.length-1);for(let e=0;e<o.length-1;e++){let a=o[e];let s=atan2(a.y-w.y,a.x-w.x);let i=m[0];let c=m[1];let h=m[2];Ln({pg:t,pts:[o[e],o[min(e+1,o.length-1)],l[min(e+1,l.length-1)],l[e]],baseX:r,baseY:n,col:Ro(i,c,h*C,1),randomOffset:1})}}let T=Mt.colors.stroke[0];if(ye==0)T=Mt.colors.stroke[2];Bn({pg:t,pts:g.map((e=>{let t=map(noise(e.x*p,e.y*p),0,1,-c,c);let o=map(noise(e.y*p,e.x*p),0,1,-c,c);return createVector(e.x+t,e.y+o)})),baseX:r,baseY:n,col:Ro(T[0],T[1],T[2],1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*1.5*Pe,randomOffset:1});let E=floor(random(8,12));let D=Mt.colors.stroke[1];for(let e=0;e<E;e++){let o=map(e,0,E,0,TWO_PI);let a=0;let s=TWO_PI;for(let e=0;e<g.length;e++){let t=g[e];let r=atan2(t.y-w.y,t.x-w.x);let n=abs((r-o+TWO_PI)%TWO_PI-PI);if(n<s){s=n;a=e}}let i=g[a];let c=[];let h=floor(random(15,20));c.push(createVector(w.x,w.y,0));for(let e=1;e<=h;e++){let t=e/h;let r=t*(1+.15*sin(o*2)*(1-t));let n=noise(o*10,t*5)*.08*t*t;let a=-sin(o)*l*n;let s=cos(o)*l*n;let p=lerp(w.x,i.x,r)+a;let f=lerp(w.y,i.y,r)+s;c.push(createVector(p,f,0))}Bn({pg:t,pts:c,baseX:r,baseY:n,col:Ro(D[0],D[1],D[2]*.9,1),branchWidthFunc:e=>(.3*(1-e)+.3)*Pe,randomOffset:.3})}t.pop()}static drawLeaf(e={}){let{pg:t,baseX:o=0,baseY:n=0,meta:l,angle:a=0,baseRotation:s,dir:i=0,open:h=0,finalNode:p=1,specID:f=0,lengthProgress:d=0}=e;let m;let u;if(f==0)u=map(d,Ot,1,constrain(a,-1,0),-1.57);else u=map(d,Ot,1,constrain(a,3.4,5),5);if(i==0){m=createVector(s.x+random(-.5,.5),s.y+random(.2,.5),s.z+a+random(-.05,.05))}else if(i==1){m=createVector(s.x+h,s.y+a,s.z+random(-.2,.2))}if(r==1){m=createVector(s.x,s.y,s.z+random(-.2,.2))}else if(r==2){m=createVector(s.x+random(-.3,.3),s.y+random(.2,.5),s.z+u)}let g=vo([2,2,2.5])*map(d,Ot,1,1,0);let b=l.leafLength*random(.05,.1)*$*p;let y=random(.8,1.2)*q;if(r==2)b=30,y=1.2;let x=T.stem({pg:t,baseX:o,baseY:n,baseRotation:m,branchLength:b,col:l.branchColor,branchWidthFunc:e=>y,branchBendFunc:e=>createVector(.2,.2,0)});if(r==0){let e=T.stem({pg:t,baseX:o,baseY:n,baseRotation:m,branchLength:random(5,10),col:[l.branchColor[0],l.branchColor[1],l.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2)*q*1.5,branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0})}let F=floor(x.centerPos.length*.6);let P=x.centerPos[F].x;let w=x.centerPos[F].y;let V=[];let C=random(0,1)>.5?floor(random(5,15)):0;if(r==2)C=0;for(let e=0;e<C;e++){V.push({position:random(.1,.9),isRight:random(0,1)>.5,depth:random(.2,1.1)})}let D,A;if(r==1){A=e=>.5*(1-pow(2*e-1,2))*10*q;D=e=>createVector(random(-.2,.2),random(-1,1),0)}else if(r==2){A=e=>l.leafShape(e)*p*l.leafWidth+.5*pow(1-e,3);D=e=>createVector(random(-.2,.2),random(-.1,.1),0)}else{A=e=>l.leafShape(e)*p*l.leafWidth+.5*pow(1-e,3);D=e=>createVector(map(noise(e*1,PI),0,1,-1,1)*g*2*q,map(noise(e*2,PI+PI),0,1,-1,1)*g*q,map(noise(e*3,PI+PI+PI),0,1,-1,1)*g*2*q)}let S=E.leaf({pg:t,veinsType:l.veinsType,baseX:o+P,baseY:n+w,branchLength:l.leafLength*random(.8,1.2)*p,col:l.leafColorA,col2:l.leafColorB,colorFunction:l.leafColorFn,branchSegments:32,baseRotation:m,notches:V,strokeStrength:.5,specID:f,branchWidthFunc:A,branchBendFunc:D});let I=S.x;let L=S.y;if(c==1){pgText.noStroke();pgText.push();pgText.translate(P+o,w+n);pgText.fill(0,1,1,1);pgText.ellipse(0,0,5);pgText.pop();pgText.push();pgText.translate(I+o,L+n);pgText.fill(120,1,1,1);pgText.ellipse(0,0,5);pgText.text(`${m.x.toFixed(2)}, ${m.y.toFixed(2)}, ${m.z.toFixed(2)}`,0,0);pgText.pop();pgText.push();let e=I+o-(P+o);let t=L+n-(w+n);let r=Math.atan2(t,e)*180/Math.PI;if(r>=45&&r<=135){pgText.stroke(0,1,1,1)}else{pgText.stroke(120,1,1,1)}pgText.line(P+o,w+n,I+o,L+n);pgText.pop()}return S}static drawHeart(e={}){let{pg:t,baseX:o=0,baseY:r=0,meta:n,angle:l=0,baseRotation:a=createVector(PI/2,0,0),dir:s=2}=e;let i;if(s==0){i=createVector(random(-1,1)*PI,random(-1,1)*PI,l)}else if(s==1){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1)+l,a.z)}else if(s==2){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1),a.z+l)}let c=vo([2,2,2.5,3]);let h=T.stem({pg:t,baseX:o,baseY:r,baseRotation:i,branchLength:n.leafLength*random(.2,.5)*$,col:n.branchColor,branchWidthFunc:e=>random(.8,1.2)*q,branchBendFunc:e=>createVector(random(-1,1),random(-1,1),0)});let p=T.stem({pg:pgL0,baseX:o,baseY:r,baseRotation:i,branchLength:random(5,10),col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2)*q*1.5,branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let f=h.centerPos[h.centerPos.length-3].x;let d=h.centerPos[h.centerPos.length-3].y;let m=random(-.5,.5);let u=random(-.5,.5);let g=random(-.5,.5);E.heart({pg:pgL2,baseX:o+f,baseY:r+d,size:n.leafHeartSize*random(.5,1),branchSegmentsH:Bo(8,12),branchSegments:24,baseRotation:createVector(i.x+1.05+m,i.y+1+u,i.z+3.14+g),col:n.leafColorA,col2:n.leafColorB})}static drawLotus(e={}){let{pg:t,baseX:o=0,baseY:r=0,meta:n,angle:l=0,baseRotation:a=createVector(PI/2,0,0),dir:s=2}=e;let i;if(s==0){i=createVector(random(-1,1)*PI,random(-1,1)*PI,l)}else if(s==1){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1)+l,a.z)}else if(s==2){i=createVector(a.x+random(-.1,.1),a.y+random(-.1,.1),a.z+l)}let c=vo([2,2,2.5,3]);let h=T.stem({pg:t,baseX:o,baseY:r,baseRotation:i,branchLength:n.leafLength*random(.2,.5)*$,col:n.branchColor,branchWidthFunc:e=>random(.8,1.2)*q,branchBendFunc:e=>createVector(random(-1,1),random(-1,1),0)});let p=T.stem({pg:pgL0,baseX:o,baseY:r,baseRotation:i,branchLength:random(5,10),col:[n.branchColor[0],n.branchColor[1],n.branchColor[2]*.8],branchWidthFunc:e=>random(.8,1.2)*q*1.5,branchBendFunc:e=>createVector(0,0,0),closeS:false,strokeStrength:random(1,2),pointShift:0});let f=h.centerPos[h.centerPos.length-3].x;let d=h.centerPos[h.centerPos.length-3].y;lotus({pg:pgL2,baseX:o+f,baseY:r+d,size:100*random(.8,1.1),branchSegmentsH:3,branchSegments:24,baseRotation:createVector(random(1.8,2.2),random(-.1,.1),random(-.1,.1)),col:n.leafColorA,col2:n.leafColorB})}static addLeaf(e,t,o,n,l="normal",a){if(l==="final"){o.PT.leafGrowType=random(0,1)>.3?Po:xo;if(r==2)o.PT.leafGrowType=xo;if(r==1)o.PT.leafGrowType=Fo}switch(o.PT.leafGrowType){case xo:E.selLeaf({pg:pgL1,baseX:e,baseY:t,meta:o.PT,angle:.5,baseRotation:createVector(PI/2+1,PI-1,n),dir:0,specID:0,lengthProgress:a});E.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:o.PT,angle:PI-.5,baseRotation:createVector(PI/2+1,-1,n),dir:0,specID:1,lengthProgress:a});o.PT.leafCount+=2;break;case Po:let r=TWO_PI/Je;let s=random(.1,1.3);let i=l==="final"?vo([.3,.3,.5,.7,1,1.2]):1;for(let l=0;l<Je;l++){E.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:o.PT,angle:l*r+s,baseRotation:createVector(PI/2,0,n+PI/2),dir:1,open:s,finalNode:i,relativePosition:a})}o.PT.leafCount+=Je;break;case Fo:let c=random(-.2,.2);It=(It+1)%2;if(It==0){E.selLeaf({pg:pgL1,baseX:e,baseY:t,meta:o.PT,angle:c,baseRotation:createVector(PI/2+1,PI-1,n),dir:0,specID:0,lengthProgress:a})}else{E.selLeaf({pg:pgL2,baseX:e,baseY:t,meta:o.PT,angle:PI+c,baseRotation:createVector(PI/2+1,-1,n),dir:0,specID:1,lengthProgress:a})}o.PT.leafCount+=1;break}}static selLeaf(e={}){let{pg:t,baseX:o=0,baseY:r=0,meta:n,angle:l=0,baseRotation:a,dir:s=0,finalNode:i=1,relativePosition:c=0,specID:h=0,lengthProgress:p=0}=e;if(je==0){E.drawLeaf(e)}else if(je==1){st=0;E.drawHeart(e)}else if(je==2){E.drawLotus(e)}else if(je==3){E.drawPlam(e)}}static drawPlam(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,meta:n,angle:l=0,baseRotation:a,dir:s=0,open:i=0,finalNode:c=1,relativePosition:h=0}=e;let p;t=pgL0;if(!a){console.error("drawPlam: baseRotation is undefined");a=createVector(PI/2,0,0)}p=createVector(a.x+i,a.y+l,a.z+random(-.2,.2));let f=max(200,n.leafLength*random(1.5,2)*$*c);if(isNaN(f))f=100;let d=map(h,0,1,1,2);fe=[1,1];let m=T.stem({pg:t,baseX:o,baseY:r,baseRotation:p,branchLength:f,col:n.branchColor,branchWidthFunc:e=>(1.2-e*.5)*q,branchBendFunc:e=>createVector(d+random(-.2,.2),0,0)});let u=m.centerPos;let g=u.length;let b=Bo(12,18);let y=f*.6;let x=.15;let F=.92;let P=vo([-1,-2,-1.5]);for(let e=0;e<b;e++){let l=map(e,0,b-1,x,F);let a=floor(l*g);if(a>=u.length)continue;let s=map(l,x,F,PI/8,PI/2.2);let i=-s+random(-.1,.1);let c=createVector(p.x+random(-.1,.1),p.y+i,p.z+random(-.1,.1));let h=s+random(-.1,.1);let f=createVector(p.x+random(-.1,.1),p.y+h,p.z+random(-.1,.1));let d=t=>{let o=map(noise(e*100,t*10),0,1,-.8,.8);let r=map(noise(e*200,t*10),0,1,-.6,0);let n=map(noise(e*300,t*10),0,1,-.3,.3);return createVector(o,r,n)};fe=[1,1];let m=random(1,2);let w=random(1,2);let V=0;let C=e=>{const t=0;const o=.6;const r=1;let n=20;if(e<=o){return.3*q*n}else{return map(e,o,r,.3,0)*q*n}};E.leaf({pg:t,baseX:o+u[a].x,baseY:r+u[a].y,branchLength:y*(1-l*.6),col:n.leafColorA,col2:n.leafColorB,baseRotation:createVector(c.x*P,c.y*1,c.z),branchWidthFunc:C,branchBendFunc:e=>createVector(m,w,V)});E.leaf({pg:t,baseX:o+u[a].x,baseY:r+u[a].y,branchLength:y*(1-l*.6),col:n.leafColorA,col2:n.leafColorB,baseRotation:createVector(f.x*-1,f.y*1,f.z),branchWidthFunc:C,branchBendFunc:e=>createVector(m,w,V)})}}static leaf(e={}){let{pg:t=pgL3,baseX:o=0,baseY:n=0,baseRotation:l=createVector(PI/2,0,0),branchLength:a=400,branchSegments:s=20,veinsType:i=[0,0],notches:c=[],branchWidthFunc:h=e=>40,colorFunction:p=e=>e,branchBendFunc:f=e=>createVector(random(-10,10),0,random(-5,5)),pointShift:d=.5,strokeStrength:m=.8,strokeNoiseScale:u=10,col:g=[90,.2,.3],col2:b=[90,.2,.3],specID:y=0}=e;y=random(0,1)<.8?0:1;let x=Ao($t);m=m+x.random(0,1)*2;d=5*we;s=constrain(floor(map(a,50,300,20,60)),20,60);s=max(5,floor(s*J));let F=createVector(0,0,0);let P=createVector(0,0,0);let w=[F.copy()];let V=[P.copy()];let C=[];let T=[];let D=e=>Co.applyEulerRotation(e,l);let A=(e,t)=>{let o=h(e);for(let r of c){let n=abs(e-r.position);if(n<.05){if(t==="right"&&r.isRight&&e>r.position||t==="left"&&!r.isRight&&e<r.position){let e=30;let t=pow(1-n/.3,e)*r.depth;return o*(1-t)}}}return o};let S=random(.2,3);let I=random(0,1)>.3?1:0;let L=random(.8,1);let B=1;let v=.5;let W=Wo(.6,.9);if(r==2)W=1,L=random(.7,1.1),v=0;if(y==0){L=random(.65,.75)+random(-.05,.05);B=1}else if(y==1){L=vo([1.2,1.2,1.5])+random(-.05,.05);B=.7}let k=random(0,1)>.9?5:1;if(r==2)k=1;for(let e=0;e<s;e++){let r=e/(s-1);let l=f(r);P=p5.Vector.add(P,p5.Vector.mult(l,1/s));let i=Co.applyEulerRotation(createVector(0,0,a/s),P);F=p5.Vector.add(F,D(i));let c=A(r,"left");let h=A(r,"right");let p=Co.applyEulerRotation(createVector(-c,0,0),P);let d=Co.applyEulerRotation(createVector(h,0,0),P);let m=p5.Vector.add(F,D(p));let u=p5.Vector.add(F,D(d));C.push(m.copy());T.push(u.copy());let x=0,E=0,S=0;if(Ze==1){let e=pow(1-r,2);if(y==1)e=pow(1-r,10);x=lerp(Number(g[0]),Number(b[0]),fract(e*k));E=Number(g[1])*B;S=lerp(Number(g[2]),Number(b[2])*.7,e)*L}else{if(I==1){x=g[0];E=g[1];S=g[2]*L}else{x=g[0];E=g[1];S=g[2]}}if(e<=0){if(C[0]&&C[1]&&T[1]&&T[0]&&st==0){Ln({pg:t,pts:[C[0],C[1],T[1],T[0]],baseX:o,baseY:n,col:Ro(x,E,S,W),randomOffset:v,vertexMode:st,show:0})}}else{let r=e-1;if(C[e]&&C[r]&&w[r]&&w[e]){Ln({pg:t,pts:[C[e],C[r],w[r],w[e]],baseX:o,baseY:n,col:Ro(x,E,S,W),randomOffset:v,vertexMode:st})}if(T[e]&&T[r]&&w[r]&&w[e]){Ln({pg:t,pts:[T[e],T[r],w[r],w[e]],baseX:o,baseY:n,col:Ro(x,E,S,W),randomOffset:v,vertexMode:st})}}w.push(F.copy());V.push(P.copy())}let _=Mt.colors.stroke[0];if(ye==0)_=Mt.colors.stroke[2];let z=Mt.colors.stroke[1];let X=e=>{const t=.2;const o=-.35;const r=(noise(e*t,Bo(0,100)*.05)+o)*3*Pe;return r>.5?r:random(0,1)>.7?0:0};let Y=e=>(.2*(1-e)*map(noise(e*u),0,1,.5,1)+.3)*m*Pe;let O=vo([X,Y]);if(it==1)O=Y;else if(it==2)O=X;if(r==1||r==2){O=e=>.5;d=0;u=0}if(st==0){Bn({pg:t,pts:C.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let o=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,col:Ro(_[0],_[1],_[2],1),branchWidthFunc:O,randomOffset:v});Bn({pg:t,pts:T.map((e=>{let t=map(noise(e.x*u,e.y*u),0,1,-d,d);let o=map(noise(e.y*u,e.x*u),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,col:Ro(_[0],_[1],_[2],1),branchWidthFunc:O,randomOffset:v});Bn({pg:t,pts:[C[0],createVector(0,0)],baseX:o,baseY:n,col:Ro(_[0],_[1],_[2],1),branchWidthFunc:O,randomOffset:v});Bn({pg:t,pts:[T[0],createVector(0,0)],baseX:o,baseY:n,col:Ro(_[0],_[1],_[2],1),branchWidthFunc:O,randomOffset:v});Bn({pg:t,pts:[C[0],C[2]],baseX:o,baseY:n,col:Ro(_[0],_[1],_[2],1),branchWidthFunc:O,randomOffset:v});Bn({pg:t,pts:[T[0],T[2]],baseX:o,baseY:n,col:Ro(_[0],_[1],_[2],1),branchWidthFunc:O,randomOffset:v})}if(r==0||r==2){E.drawLeafVeins({pg:t,baseX:o,baseY:n,veinsType:i,centerPos:w,leftPos:C,rightPos:T,col:Ro(_[0],_[1],_[2],1),col2:Mt.colors.flower[1],strokeStrength:.5,specID:y})}An({pg:pgText,pts:w,baseX:o,baseY:n});return w[w.length-1]}static drawLeafVeins(e={}){let{pg:t,baseX:o,baseY:n,debug:l=false,veinsType:a=[3,2],centerPos:s,leftPos:i,rightPos:c,col:h,col2:p=Mt.colors.flower[1],pointShift:f=.5,strokeStrength:d=1,strokeNoiseScale:m=10,pointMult:u=0,specID:g=0}=e;let b=Ao($t);d=d+b.random(0,1)*3;f=1*we;u=1*we;h=[hue(h),saturation(h),brightness(h),alpha(h)];let y=Mt.colors.leaf[0];let x;if(a[0]==0||a[0]==1||a[0]==2||a[0]==4||a[0]==10||a[0]==12){if(a[0]==2||a[0]==0)x=Ro(h[0],h[1],h[2],.7);else x=Ro(y[0],y[1],y[2]*10,1);let F=.1;let P=function(e){return(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*Pe};let w=function(e){return(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe};if(r==2){if(g==1)x=Ro(y[0],y[1],y[2]*10,.2);else if(g==0)x=Ro(y[0],y[1],y[2]*10,.8);f=0;P=e=>1.35;w=e=>1.1}if(a[0]==12){Bn({pg:t,pts:s.slice(1).map((e=>{let t=map(b.noise(e.x*F,e.y*F),0,1,-f,f);let o=map(b.noise(e.y*F,e.x*F),0,1,-f,f);return createVector(e.x+t+1,e.y+o)})),baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],.3),branchWidthFunc:P,randomOffset:.2,forceBrush:1})}Bn({pg:t,pts:s.slice(1).map((e=>{let t=map(b.noise(e.x*F,e.y*F),0,1,-f,f);let o=map(b.noise(e.y*F,e.x*F),0,1,-f,f);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:n,col:x,branchWidthFunc:w,randomOffset:.2,forceBrush:1})}if(a[0]==0&&st==0){let V;if(s.length>a[1]){V=floor(s.length/a[1])}else{V=floor(s.length/5)}for(let C=V;C<s.length-V;C+=V){let T=(C-V)/(s.length-2*V);let E=.1+.5*sin(T*PI);let D=.2+.2*sin(T*PI);let A=s[C];let S=p5.Vector.lerp(A,i[C+2],E);let I=p5.Vector.lerp(A,S,.5);I.add(No(b).mult(3));let L=[];let B=5;for(let _=0;_<=B;_++){let z=_/B;let X=pow(1-z,2)*A.x+2*(1-z)*z*I.x+pow(z,2)*S.x;let Y=pow(1-z,2)*A.y+2*(1-z)*z*I.y+pow(z,2)*S.y;L.push(createVector(X,Y).add(No(b).mult(.2)))}Bn({pg:t,pts:L,baseX:o,baseY:n,col:Ro(y[0],y[1],y[2]*10.5,1),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*Pe,randomOffset:.2,forceBrush:1});let v=p5.Vector.lerp(A,c[C+2],E);let W=p5.Vector.lerp(A,v,.5);W.add(No(b).mult(3));let k=[];for(let O=0;O<=B;O++){let R=O/B;let N=pow(1-R,2)*A.x+2*(1-R)*R*W.x+pow(R,2)*v.x;let M=pow(1-R,2)*A.y+2*(1-R)*R*W.y+pow(R,2)*v.y;k.push(createVector(N,M).add(No(b).mult(.2)))}Bn({pg:t,pts:k,baseX:o,baseY:n,col:Ro(y[0],y[1],y[2]*10.5,1),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*Pe,randomOffset:.2,forceBrush:1})}}else if(a[0]==1&&st==0){for(let H=2;H<s.length-1;H++){for(let G=1;G<a[1];G++){let U=G/a[1];let $=p5.Vector.lerp(i[H-1],s[H-1],U);let q=p5.Vector.lerp(i[H],s[H],U);let j=p5.Vector.lerp(s[H-1],c[H-1],U);let J=p5.Vector.lerp(s[H],c[H],U);Bn({pg:t,pts:[j.add(No(b).mult(.4)),J.add(No(b).mult(.4))],baseX:o,baseY:n,col:Ro(y[0],y[1],y[2]*10,.5),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:.5,forceBrush:1});Bn({pg:t,pts:[$.add(No(b).mult(.4)),q.add(No(b).mult(.4))],baseX:o,baseY:n,col:Ro(y[0],y[1],y[2]*10,.5),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:.5,forceBrush:1})}}}else if(a[0]==2&&st==0){let K=min(i.length,c.length,s.length);let Q=max(2,floor(K/(a[1]*2)));let Z=floor(s.length/8);for(let ee=Z;ee<s.length-Z;ee+=Q){let te=(ee-Z)/(s.length-2*Z);let oe=.3+.4*sin(te*PI);let re=s[ee];let ne=p5.Vector.lerp(re,i[ee],oe);let le=p5.Vector.lerp(re,ne,.5);let ae=createVector(0,5*sin(te*PI),0);le.add(ae);le.add(No(b).mult(2));let se=[];let ie=5;for(let ce=0;ce<=ie;ce++){let he=ce/ie;let fe=pow(1-he,2)*re.x+2*(1-he)*he*le.x+pow(he,2)*ne.x;let de=pow(1-he,2)*re.y+2*(1-he)*he*le.y+pow(he,2)*ne.y;se.push(createVector(fe,de).add(No(b).mult(.2)))}Bn({pg:t,pts:se,baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],b.random(.2,1)),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*Pe,randomOffset:.3,forceBrush:1});if(ee+Q/2<s.length-Z){let me=s[ee+floor(Q/2)];let ue=p5.Vector.lerp(me,c[ee+floor(Q/2)],oe);let ge=p5.Vector.lerp(me,ue,.5);ge.add(ae);ge.add(No(b).mult(2));let be=[];for(let ye=0;ye<=ie;ye++){let xe=ye/ie;let Fe=pow(1-xe,2)*me.x+2*(1-xe)*xe*ge.x+pow(xe,2)*ue.x;let Ve=pow(1-xe,2)*me.y+2*(1-xe)*xe*ge.y+pow(xe,2)*ue.y;be.push(createVector(Fe,Ve).add(No(b).mult(.2)))}Bn({pg:t,pts:be,baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],b.random(.2,1)),branchWidthFunc:e=>(.5*(1-e)*map(b.noise(e*10),0,1,.5,1)+.5)*d*Pe,randomOffset:.3,forceBrush:1})}}}else if(a[0]==3){for(let Ce=2;Ce<s.length-1;Ce++){for(let Te=1;Te<a[1];Te++){let Ee=Te/a[1];let De=p5.Vector.lerp(i[Ce-1],s[Ce-1],Ee);let Ae=p5.Vector.lerp(i[Ce],s[Ce],Ee);let Se=p5.Vector.lerp(s[Ce-1],c[Ce-1],Ee);let Le=p5.Vector.lerp(s[Ce],c[Ce],Ee);let Be=p[0];let ve=p[1];let We=p[2];Ln({pg:t,pts:[De,Ae,s[Ce],s[Ce-1]],baseX:o,baseY:n,col:Ro(Be,ve,We,.6),randomOffset:.3,vertexMode:st});Ln({pg:t,pts:[Se,Le,s[Ce],s[Ce-1]],baseX:o,baseY:n,col:Ro(Be,ve,We,.6),randomOffset:.3,vertexMode:st});Bn({pg:t,pts:[Se.copy().add(No(b).mult(u)),Le.copy().add(No(b).mult(u))],baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],1),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.2)*d*Pe,randomOffset:.3,forceBrush:1});Bn({pg:t,pts:[De.copy().add(No(b).mult(u)),Ae.copy().add(No(b).mult(u))],baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],1),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.2)*d*Pe,randomOffset:.3,forceBrush:1})}}}else if(a[0]==4){}else if(a[0]==5){let ke=b.random(-.1,.1);for(let _e=2;_e<s.length-1;_e++){for(let ze=1;ze<a[1];ze++){let Xe=ze/a[1];let Ye=2*abs(_e/s.length-.5);let Oe=p5.Vector.lerp(i[_e-1],s[_e-1],Xe+ke);let Re=p5.Vector.lerp(i[_e],s[_e],Xe+ke);let Ne=p5.Vector.lerp(s[_e-1],c[_e-1],Xe+ke);let Me=p5.Vector.lerp(s[_e],c[_e],Xe+ke);let He=lerp(Mt.colors.leaf[0][0],h[0],Ye);let Ge=lerp(Mt.colors.leaf[0][1],h[1],Ye);let Ue=lerp(Mt.colors.leaf[0][2],h[2],Ye);He=h[0];Ge=h[1];Ue=h[2];let $e=lerp(0,1,Ye);Ln({pg:t,pts:[Oe,Re,s[_e],s[_e-1]],baseX:o,baseY:n,col:Ro(He,Ge,Ue,$e*.6),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[Ne,Me,s[_e],s[_e-1]],baseX:o,baseY:n,col:Ro(He,Ge,Ue,$e*.6),randomOffset:1,vertexMode:st})}}}else if(a[0]==6){let qe=b.random(.3,1);let je=map(qe,.3,1,1.7,1);for(let Je=2;Je<s.length-1;Je++){for(let Ke=1;Ke<a[1];Ke++){let Qe=Ke/a[1];let Ze=p5.Vector.lerp(i[Je-1],s[Je-1],Qe*qe);let et=p5.Vector.lerp(i[Je],s[Je],Qe*qe);let tt=p5.Vector.lerp(s[Je-1],c[Je-1],Qe*je);let ot=p5.Vector.lerp(s[Je],c[Je],Qe*je);let rt=p[0];let nt=p[1];let lt=p[2];if(b.noise(Je*.5,Ke*.5)>.6){rt=h[0];nt=h[1];lt=h[2]}Ln({pg:t,pts:[Ze,et,s[Je],s[Je-1]],baseX:o,baseY:n,col:Ro(rt,nt,lt,.6),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[tt,ot,s[Je],s[Je-1]],baseX:o,baseY:n,col:Ro(rt,nt,lt,.6),randomOffset:1,vertexMode:st})}}}else if(a[0]==7){for(let at=2;at<s.length-1;at++){for(let it=1;it<a[1];it++){let ct=it/a[1];let ht=p5.Vector.lerp(i[at-1],s[at-1],ct);let pt=p5.Vector.lerp(i[at],s[at],ct);let ft=p5.Vector.lerp(s[at-1],c[at-1],ct);let dt=p5.Vector.lerp(s[at],c[at],ct);let mt=p[0];let ut=p[1];let gt=p[2];let bt=h[0];let yt=h[1];let xt=h[2];let Ft=p5.Vector.lerp(s[at-1],ht,.5);let Pt=p5.Vector.lerp(s[at],pt,.5);let wt=p5.Vector.lerp(s[at-1],ft,.5);let Vt=p5.Vector.lerp(s[at],dt,.5);Ln({pg:t,pts:[ht,pt,Pt,Ft],baseX:o,baseY:n,col:Ro(mt,ut,gt,1),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[Ft,Pt,s[at],s[at-1]],baseX:o,baseY:n,col:Ro(bt,yt,xt,1),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[ft,dt,Vt,wt],baseX:o,baseY:n,col:Ro(mt,ut,gt,1),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[wt,Vt,s[at],s[at-1]],baseX:o,baseY:n,col:Ro(bt,yt,xt,1),randomOffset:1,vertexMode:st});Bn({pg:t,pts:[ft.copy().add(No(b).mult(u)),dt.copy().add(No(b).mult(u))],baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],h[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:1,forceBrush:1});Bn({pg:t,pts:[ht.copy().add(No(b).mult(u)),pt.copy().add(No(b).mult(u))],baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],h[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:1,forceBrush:1});Bn({pg:t,pts:[wt.copy().add(No(b).mult(u)),Vt.copy().add(No(b).mult(u))],baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],h[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:1,forceBrush:1});Bn({pg:t,pts:[Ft.copy().add(No(b).mult(u)),Pt.copy().add(No(b).mult(u))],baseX:o,baseY:n,col:Ro(h[0],h[1],h[2],h[3]),branchWidthFunc:e=>(.15*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:1,forceBrush:1})}}}else if(a[0]==8){let Ct=a[1];let Tt=b.random(.1,.35);for(let Et=2;Et<s.length-1;Et++){if(Et%Ct==0){for(let Dt=1;Dt<6;Dt++){let At=Dt/6;let St=p5.Vector.lerp(i[Et-1],s[Et-1],At);let It=p5.Vector.lerp(i[Et],s[Et],At);let Lt=p5.Vector.lerp(s[Et-1],c[Et-1],At);let Bt=p5.Vector.lerp(s[Et],c[Et],At);let vt=p[0];let Wt=p[1];let kt=p[2];let _t=h[0];let zt=h[1];let Xt=h[2];let Yt=p5.Vector.lerp(St,It,.5);let Ot=p5.Vector.lerp(Lt,Bt,.5);let Rt=p5.Vector.lerp(s[Et-1],s[Et],Tt);let Nt=p5.Vector.lerp(s[Et-1],s[Et],1-Tt);Ln({pg:t,pts:[St,Yt,Rt,s[Et-1]],baseX:o,baseY:n,col:Ro(vt,Wt,kt,1),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[Lt,Ot,Rt,s[Et-1]],baseX:o,baseY:n,col:Ro(vt,Wt,kt,1),randomOffset:1});Ln({pg:t,pts:[Yt,Rt,Nt,It],baseX:o,baseY:n,col:Ro(_t,zt,Xt,1),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[Ot,Rt,Nt,Bt],baseX:o,baseY:n,col:Ro(_t,zt,Xt,1),randomOffset:1,vertexMode:st})}}}}else if(a[0]==9){let Ht=b.random(.3,.7);for(let Gt=2;Gt<s.length-1;Gt++){for(let Ut=1;Ut<2;Ut++){let qt;let jt=2*abs(Gt/s.length-.5);let Jt=p5.Vector.lerp(i[Gt-1],s[Gt-1],.1);let Kt=p5.Vector.lerp(i[Gt],s[Gt],0);let Qt=p5.Vector.lerp(s[Gt-1],c[Gt-1],.5);let Zt=p5.Vector.lerp(s[Gt],c[Gt],0);let eo=lerp(Mt.colors.bg[0][0],h[0],1-jt);let to=lerp(Mt.colors.bg[0][1],h[1],1-jt);let oo=lerp(Mt.colors.bg[0][2],h[2],1-jt);eo=p[0];to=p[1];oo=p[2];Ln({pg:t,pts:[Jt,Kt,s[Gt],s[Gt-1]],baseX:o,baseY:n,col:Ro(eo,to,oo,Ht),randomOffset:2,vertexMode:st});Ln({pg:t,pts:[Qt,Zt,s[Gt],s[Gt-1]],baseX:o,baseY:n,col:Ro(eo,to,oo,Ht),randomOffset:2,vertexMode:st})}}}else if(a[0]==10&&st==0){function ro(e,t,o,r,n){let l=[];for(let t=0;t<=o;t++){let a=t/o;let i=floor(n*a);i=max(0,min(i,e.length-1));let c=p5.Vector.lerp(e[i],s[i],r);l.push(c)}l[l.length-1]=t;let a=[];for(let e=0;e<l.length;e++){let t=max(0,e-1);let o=min(l.length-1,e+1);let r=p5.Vector.lerp(p5.Vector.lerp(l[t],l[e],.5),p5.Vector.lerp(l[e],l[o],.5),.5);a.push(r)}return a}function no(e,color){Bn({pg:t,pts:e,baseX:o,baseY:n,col:Ro(y[0],y[1],y[2]*10,.5),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.6,1)+.3)*d*Pe,randomOffset:.1,forceBrush:1})}let lo=[{pathRatio:.6,lerpRatio:.3},{pathRatio:.7,lerpRatio:.5},{pathRatio:.8,lerpRatio:.7}];for(let{pathRatio:ao,lerpRatio:so}of lo){let io=floor(i.length*ao);let co=20;let ho=floor(i.length/10*floor(ao*10));let po=i[ho];let fo=ro(i,po,co,so,io);no(fo,y);let mo=c[ho];let uo=ro(c,mo,co,so,io);no(uo,y)}}else if(a[0]==11){let go=b.random(1.2,2.5);let bo=go*b.random(1,2.5);let yo=new Map;let xo=Bo(150,250);if(pe==1)xo=Bo(20,50);function Fo(e,t,o){let r=floor(e.x/o);let n=floor(e.y/o);for(let l=-1;l<=1;l++){for(let a=-1;a<=1;a++){let key=`${r+l},${n+a}`;if(t.has(key)){let r=t.get(key);for(let t of r){let r=p5.Vector.dist(e,t);if(r<o)return false}}}}return true}function Po(e,t,o){let r=floor(e.x/o);let n=floor(e.y/o);let key=`${r},${n}`;if(!t.has(key)){t.set(key,[])}t.get(key).push(e)}for(let wo=2;wo<s.length-1;wo++){let Vo=i[wo];let Co=c[wo];let To=s[wo];let Eo=floor(xo/(s.length-3));let Do=0;let So=0;while(So<Eo&&Do<100){Do++;let Io=b.random(0,b.random(0,1));let Lo;if(random(0,1)<.5){Lo=p5.Vector.lerp(Vo,To,Io)}else{Lo=p5.Vector.lerp(To,Co,Io)}Lo.add(No(b).mult(b.random(.5,2)));if(Fo(Lo,yo,bo)){Po(Lo,yo,bo);So++;t.push();t.translate(o,n);t.noStroke();if(pe==1){t.fill(Bo(0,6)*20,.5,.8,1)}else{if(b.random(0,1)<.7){t.fill(Ie[0][0],Ie[0][1],Ie[0][2]*.7,.3)}else{t.fill(Ie[1][0],Ie[1][1],Ie[1][2]*1.2,.5)}}t.ellipse(Lo.x,Lo.y,go*b.random(.7,1),go*b.random(.7,1));t.pop()}}}}else if(a[0]==12){let vo=min(i.length,c.length,s.length);let Wo=max(2,floor(vo/(a[1]*2)));let ko=floor(s.length/8);let _o=.4;if(g==1)_o=.6;else if(g==0)_o=.1;let zo=1;if(g==1)zo=5;for(let Xo=ko;Xo<s.length-ko;Xo+=Wo){let Yo=(Xo-ko)/(s.length-2*ko);let Oo=.48+.48*sin(Yo*PI);let Mo=s[Xo];let Ho=p5.Vector.lerp(Mo,i[Xo+5],Oo);let Go=p5.Vector.lerp(Mo,Ho,.5);let Uo=createVector(0,5*sin(Yo*PI),0);Go.add(Uo);Go.add(No(b).mult(2));let $o=[];let qo=5;for(let Qo=0;Qo<=qo;Qo++){let Zo=Qo/qo;let er=pow(1-Zo,2)*Mo.x+2*(1-Zo)*Zo*Go.x+pow(Zo,2)*Ho.x;let tr=pow(1-Zo,2)*Mo.y+2*(1-Zo)*Zo*Go.y+pow(Zo,2)*Ho.y;$o.push(createVector(er,tr).add(No(b).mult(.2)))}Bn({pg:t,pts:$o,baseX:o,baseY:n,col:Ro(h[0],h[1],h[2]*zo,_o),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:.3,forceBrush:1});let jo=p5.Vector.lerp(Mo,c[Xo+5],Oo);let Jo=p5.Vector.lerp(Mo,jo,.5);Jo.add(Uo);Jo.add(No(b).mult(2));let Ko=[];for(let or=0;or<=qo;or++){let rr=or/qo;let nr=pow(1-rr,2)*Mo.x+2*(1-rr)*rr*Jo.x+pow(rr,2)*jo.x;let lr=pow(1-rr,2)*Mo.y+2*(1-rr)*rr*Jo.y+pow(rr,2)*jo.y;Ko.push(createVector(nr,lr).add(No(b).mult(.2)))}Bn({pg:t,pts:Ko,baseX:o,baseY:n,col:Ro(h[0],h[1],h[2]*zo,_o),branchWidthFunc:e=>(.3*(1-e)*map(b.noise(e*10),0,1,.5,1)+.3)*d*Pe,randomOffset:.3,forceBrush:1})}}else if(a[0]==13){for(let cr=1;cr<s.length;cr++){for(let hr=1;hr<a[1];hr++){let pr=hr/a[1];let fr=2*abs(cr/s.length-.5);let dr=p5.Vector.lerp(i[cr-1],s[cr-1],.1);let mr=p5.Vector.lerp(i[cr],s[cr],.1);let ur=p5.Vector.lerp(s[cr-1],c[cr-1],.8);let gr=p5.Vector.lerp(s[cr],c[cr],.8);let br=Mt.colors.flower[0][0];let yr=Mt.colors.flower[0][1];let xr=Mt.colors.flower[0][2]*.8;let Fr=lerp(0,1,fr);Ln({pg:t,pts:[dr,mr,s[cr],s[cr-1]],baseX:o,baseY:n,col:Ro(br,yr,xr,Fr*1),randomOffset:0,vertexMode:0});Ln({pg:t,pts:[ur,gr,s[cr],s[cr-1]],baseX:o,baseY:n,col:Ro(br,yr,xr,Fr*1),randomOffset:0,vertexMode:0})}}let ar=Mt.colors.branch[1][0];let sr=Mt.colors.branch[1][1];let ir=Mt.colors.branch[1][2]*.6;if(a[2]==0){for(let Pr=2;Pr<s.length-1;Pr++){for(let wr=1;wr<3;wr++){let Vr=wr/3;let Cr=p5.Vector.lerp(i[Pr-1],s[Pr-1],Vr);let Tr=p5.Vector.lerp(i[Pr],s[Pr],Vr);let Er=p5.Vector.lerp(s[Pr-1],c[Pr-1],Vr);let Dr=p5.Vector.lerp(s[Pr],c[Pr],Vr);Bn({pg:t,pts:[Er.add(No(b).mult(.4)),Dr.add(No(b).mult(.1))],baseX:o,baseY:n,col:Ro(ar,sr,ir,.5),branchWidthFunc:e=>.5,randomOffset:.1,forceBrush:1});Bn({pg:t,pts:[Cr.add(No(b).mult(.4)),Tr.add(No(b).mult(.1))],baseX:o,baseY:n,col:Ro(ar,sr,ir,.5),branchWidthFunc:e=>.5,randomOffset:.1,forceBrush:1})}}}}}}class D{static fruitSeed(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,baseRotation:n=createVector(PI/2,0,0),branchLength:l=500,branchSegments:a=30,branchWidthFunc:s=e=>sin(e*PI)*20,col:i=[90,.2,.3],colorFunction:c=e=>e,branchBendFunc:h=e=>createVector(random(-10,10),0,random(-5,5)),pointShift:p=1.5,strokeNoiseScale:f=.2,strokeStrength:d=1}=e;let m=Ao($t);d=d+m.random(0,1)*2;p=10*we;a=max(5,floor(a*J));let u=createVector(0,0,0);let g=createVector(0,0,0);let b=[u.copy()];let y=[g.copy()];let x=[u.copy()];let F=[u.copy()];let P=e=>Co.applyEulerRotation(e,n);for(let e=0;e<a;e++){let n=e/(a-1);let p=h(n);g=p5.Vector.add(g,p5.Vector.mult(p,1/a));let f=Co.applyEulerRotation(createVector(0,0,l/a),g);u=p5.Vector.add(u,P(f));let d=s(n);let m=Co.applyEulerRotation(createVector(-d,0,0),g);let w=p5.Vector.add(u,P(m));let V=Co.applyEulerRotation(createVector(d,0,0),g);let C=p5.Vector.add(u,P(V));if(e>0){let e=p5.Vector.sub(u,x[x.length-1]);let n=p5.Vector.sub(w,u);let l=p5.Vector.cross(e,n);let a=map(abs(l.angleBetween(createVector(0,1,0))),0,PI,1,0);a=c(a)||0;let s=_o(i[0],i[0],a);let h=map(a,0,1,i[1],i[1]);let p=map(a,0,1,i[2],i[2]);s=i[0];h=i[1];p=i[2];Ln({pg:t,pts:[w,x[x.length-2],b[b.length-2],u],baseX:o,baseY:r,doFill:true,doStr:false,col:Ro(s,h,p,.6),randomOffset:.1});Ln({pg:t,pts:[C,F[F.length-2],b[b.length-2],u],baseX:o,baseY:r,doFill:true,doStr:false,col:Ro(s,h,p,.6),randomOffset:.1})}b.push(u.copy());y.push(g.copy());x.push(w.copy());F.push(C.copy())}if(ye==0)i=Mt.colors.stroke[2];Bn({pg:t,pts:b.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-p,p);let o=map(noise(e.y*f,e.x*f),0,1,-p,p);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(i[0],i[1],i[2]*.6,1),branchWidthFunc:e=>(.4*(1-e)*map(noise(e*100),0,1,.1,1)+.4)*d*Pe*random(.1,.2),randomOffset:.2});Bn({pg:t,pts:x.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-p,p);let o=map(noise(e.y*f,e.x*f),0,1,-p,p);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(i[0],i[1],i[2]*.6,1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*d*Pe*random(.5,1),randomOffset:.1});Bn({pg:t,pts:F.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-p,p);let o=map(noise(e.y*f,e.x*f),0,1,-p,p);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(i[0],i[1],i[2]*.6,1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*d*Pe*random(.5,1),randomOffset:.1});return b}static pinecone(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,baseRotation:n=createVector(0,0,0),col:l,PT:a}=e;let s=a.fruitSize*random(.6,1);let i=a.fruitColors["pinecone"][0];let c=a.fruitColors["pinecone"][1];let h=a.fruitColors["pinecone"][2];let p=int(a.layers*random(.5,1.2));let f=int(a.scalesPerLayer*random(.8,1.2));let d=a.coneHeight*random(.8,1.2);let m=a.coneRadius*random(.8,1.2);let u=createVector(random(-.3,.3)*PI+PI/2,random(1.8,1.95)*PI+PI/2,0);let g=s*random(.4,1);let b=T.stem({pg:t,baseX:o,baseY:r,baseRotation:u,branchLength:g,col:Nt.branchColor,branchWidthFunc:e=>1,branchBendFunc:e=>createVector(0,0,0)});let y=rr();let x=random(.2,.6);for(let e=p-1;e>=0;e--){let n=(p-1-e)/(p-1);let l=exp(-pow((n-.5)*2,2)/3);let a=m*l;let g=a;let F=d*n-d*.9;let P=random(.8,1);for(let e=0;e<f;e++){let a=(e/f+n*.5)*TWO_PI;let p=s*x*l*random(.9,1.1);let d=createVector(g*cos(a),g*sin(a),F);let m=Co.applyEulerRotation(d,u);let w=o+b.centerPos[b.centerPos.length-1].x+m.x;let V=r+b.centerPos[b.centerPos.length-1].y+m.y;let C=createVector(u.x,u.y,u.z+a);let T=y(n,P);D.fruitSeed({pg:t,baseX:w,baseY:V,baseRotation:C,branchLength:p*.6,branchWidthFunc:e=>p*.45*sin(e*PI),col:[i,c,h*random(.5,1),random(.8,1)],colorFunction:e=>e,strokeStrength:.4,branchBendFunc:e=>createVector(0,-T*(1-e),0)})}}}static drawFruit(e={}){let{pg:t=pgL3,baseX:o=0,baseY:n=0,type:l="pinecone",size:a=50,meta:s={},PT:i,branchEnd:c=createVector(o,n,0),currentWidth:h=1}=e;let p=c.x;let f=c.y;let d=p5.Vector.sub(createVector(p,f),createVector(o,n)).normalize();let m=atan2(d.y,d.x);if(r==2)qe=6;if(qe==0)l="pinecone";else if(qe==1)l="apple";else if(qe==2)l="raspberry";else if(qe==3)l="buddhahand";else if(qe==4)l="melon";else if(qe==5)l="melon";else if(qe==6)l="SP2Fruit";switch(l){case"pinecone":D.pinecone({pg:t,baseX:p,baseY:f,col:s.branchColor,baseRotation:createVector(0,0,m),PT:i});break;case"apple":let e=vo([1,1,2,2,3,4]);if(i.appleSize<8)e=e*2;let r=PI/e;fe=[1,1];for(let o=0;o<e;o++){let e=random(1,2);let o=random(-PI/4,PI/4);let r=p+cos(m+o)*e;let n=f+sin(m+o)*e;let l=random(.8,1.2);let a=vo([-1.5,1.5]);D.apple({pg:t,baseX:r,baseY:n,baseRotation:createVector(PI/2+l,a,l),PT:i,size:i.appleSize*random(.6,1.2),stemLength:i.fruitstem})}break;case"raspberry":let a=1.5;if(h>=a){D.raspberry({pg:t,baseX:p,baseY:f,baseRotation:createVector(0,0,m),PT:i,size:i.raspberrySize,stemLength:i.fruitstem})}break;case"buddhahand":let c={branchColor:i.colors.branch[0],flowerColorA:i.colors.fruit[2],flowerPetal:vo([5,7,9]),flowerLengthA:i.flowerLengthA*random(.8,1),flowerWidthA:i.flowerWidthA*random(.8,1),flowerLengthC:i.flowerLengthC,flowerShape:e=>e>.5?1-e+.1:.4,petalfType:[5,2],branchBendFunc:e=>{let t=5;let o=vo([1,-1]);return createVector(sin(e*PI)*t*o,cos(e*PI)*.5,sin(e*PI*2)*2)}};C.drawFlowerB({pg:t,baseX:p,baseY:f,direction:createVector(random(-1,1),random(-1,1),0),rot:random(0,TWO_PI),op:.95,meta:c});break;case"melon":let d=1;let u=PI/d;fe=[1,1];let g;if(qe==4)g=i.melonSize*random(.6,1.2),d=Bo(2,5);else if(qe==5)g=i.melonSize*3*random(.6,1.2),d=1;for(let e=0;e<d;e++){let e=random(1,2);let o=random(-PI/4,PI/4);let r=p+cos(m+o)*e;let n=f+sin(m+o)*e;let l=random(.8,1.2);let a=vo([0,3])+random(.1,.4);D.melon({pg:t,baseX:r,baseY:n,baseRotation:createVector(PI/2+l,a,0),PT:i,size:g,length:g*random(.8,1.2),stemLength:i.fruitstem})}break;case"SP2Fruit":let b=createVector(0,1,vo([-1,1]));{let e={branchColor:i.colors.branch[0],flowerColorA:[i.colors.flower[0][0],i.colors.flower[0][1],Number(i.colors.flower[0][2])*random(.8,1.1)],flowerColorB:[random(45,65),random(.8,1),random(.8,1)],flowerPetal:12,flowerLengthA:110*random(.9,1.1),flowerWidthA:9*random(.6,1.2),flowerLengthC:30*random(.8,1.2),flowerShape:e=>{if(e<.4)return map(e,0,.5,.8,1);else if(e>=.4&&e<.6)return map(e,.4,.6,1,.5);else return map(e,.6,1,.5,.2)},petalfType:[13,2,0],spType:1};C.drawFlowerG({pg:pgL0,baseX:o,baseY:n,direction:b,op:1,meta:e,doFruit:1})}break;default:console.warn("Unknown fruit type:",l);break}}static apple(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,baseRotation:n=createVector(0,0,0),PT:l,size:a=20,stemLength:s=30,pointShift:i=.01,strokeStrength:c=1,strokeNoiseScale:h=.1}=e;let p=Ao($t);c=c+p.random(0,1)*2;i=i*we;let f={base:{hue:l.colors.fruit[1][0],saturation:l.colors.fruit[1][1],brightness:l.colors.fruit[1][2]}};let d=[Number(f.base.hue)+Wo(-20,20),Number(f.base.saturation)+Wo(-.1,.1),Number(f.base.brightness)+Wo(-.1,.1),1];let m={pg:t,baseX:o,baseY:r,baseRotation:n,branchLength:s*random(2,5),col:Nt.branchColor,branchBendFunc:e=>createVector(random(1,2),random(1,2),0),branchWidthFunc:e=>1,strokeStrength:1};let u=T.stem(m);let g=u.centerPos[u.centerPos.length-1];let b=p5.Vector.sub(u.centerPos[u.centerPos.length-1],u.centerPos[u.centerPos.length-2]).normalize();let y=20;let x={pg:t,baseX:g.x+o,baseY:g.y+r,baseRotation:n,branchLength:y,col:Nt.branchColor,branchBendFunc:e=>createVector(1,0,0),branchWidthFunc:e=>3,strokeStrength:1};let F=T.stem(x);let P=F.centerPos[round(F.centerPos.length/2)];let w=g.x+P.x+o;let V=g.y+P.y+r;g=P;let C=p5.Vector.cross(createVector(0,-1,0),b);let D=Co.angle(createVector(0,-1,0),b);let A=e=>{let t=createVector(e.x,e.y-a,e.z);let o=C.mag()>.001?Co.rotateVectorAroundAxis(t,C,D):t.copy();return createVector(o.x+w,o.y+V,o.z)};let S=40;let I=[];for(let e=0;e<=S;e++){let t=e/S;let o=-a*(2*t-1);I.push(createVector(0,o))}let L=e=>{let t=2*e-1;return a*sqrt(1-pow(t,2))};let[B,v]=Sn({pts:I,branchWidthFunc:L});function W(e,o){const r=I.length-1;const n=k-1;const l=e/r;const a=o/n;const s=(o+1)/n;const i={Pos0_0:p5.Vector.lerp(B[e],v[e],a),Pos0_1:p5.Vector.lerp(B[e+1],v[e+1],a),Pos1_0:p5.Vector.lerp(B[e],v[e],s),Pos1_1:p5.Vector.lerp(B[e+1],v[e+1],s)};let c=sin(s*PI)*l;c+=map(noise(s*20,l*20),0,1,.2,.5);const h={h:_o(d[0],d[0],c),s:lerp(d[1],d[1],c),b:lerp(d[2],d[2]*.7,c),a:lerp(d[3],d[3]*.8,c)};Ln({pg:t,pts:[i.Pos0_0,i.Pos0_1,i.Pos1_1,i.Pos1_0].map(A),doFill:true,col:Ro(h.h,h.s,h.b,h.a),randomOffset:.5})}const k=8;const _=I.length-1;const z=k-1;for(let e=0;e<_;e++){for(let t=0;t<z;t++){W(e,t)}}let X=Mt.colors.stroke[0];if(ye==0)X=Mt.colors.stroke[2];let Y=(e,o=1.2)=>{Bn({pg:t,pts:e.map((e=>{let t=map(noise(e.x*h,e.y*h),0,1,-i,i);let o=map(noise(e.y*h,e.x*h),0,1,-i,i);let r=A(e);return createVector(r.x+t,r.y+o)})),baseX:0,baseY:0,col:Ro(X[0],X[1],X[2],1),randomOffset:0,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*c*Pe})};Y(B);Y(v);let O=(e,o,r=10,n=1.1)=>{let l=[];for(let t=0;t<=r;t++){let n=t/r;l.push(p5.Vector.lerp(e,o,n))}Bn({pg:t,pts:l.map(A),baseX:0,baseY:0,col:Ro(d[0],d[1],d[2]*n,1),randomOffset:0,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*c*Pe})};O(B[0],v[0],10,1.1);O(B[B.length-1],v[v.length-1],10,1.2);let R=floor(random(2,4));for(let e=0;e<R;e++){let e=vo([-1,1]);let o=e*random(1,2);o=e*o;let r=createVector(n.x+random(1,2),n.y+o,1);r=createVector(n.x+3,n.y+o,1);let s={leafLength:a*random(1,2),leafWidth:a,color:[l.colors.leaf[0][0],l.colors.leaf[0][1],l.colors.leaf[0][2],1]};E.leaf({pg:t,baseX:w,baseY:V,baseRotation:r,branchLength:s.leafLength,pointShift:.2,strokeNoiseScale:.05,strokeStrength:.2,branchWidthFunc:e=>sin(e*PI)*s.leafWidth*.5,branchBendFunc:e=>createVector(random(-2,2),random(-1,1),0),col:l.colors.leaf[1],strokeType:1})}return{center:g,size:a,rotation:n}}static raspberry(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,baseRotation:n=createVector(0,0,0),PT:l,size:a=15,stemLength:s=30,drupeletCount:i=Bo(5,15),layer:c=Bo(3,10)}=e;let h=T.stem({pg:t,baseX:o,baseY:r,baseRotation:n,branchLength:s,col:Nt.branchColor,branchBendFunc:e=>createVector(random(-.5,.5),random(-.5,.5),0),branchWidthFunc:e=>.8,strokeStrength:0});let p=h.centerPos[h.centerPos.length-1];let f=p5.Vector.sub(h.centerPos[h.centerPos.length-1],h.centerPos[h.centerPos.length-2]).normalize();let d=p5.Vector.cross(createVector(0,-1,0),f);let m=Co.angle(createVector(0,-1,0),f);let u=e=>{let t=d.mag()>.001?Co.rotateVectorAroundAxis(e,d,m):e.copy();return createVector(t.x+p.x+o,t.y+p.y+r,t.z)};let g=[];for(let e=0;e<i;e++){let t=1-e/(i-1)*2;let o=sqrt(1-t*t);let r=PI*2*e*(3-sqrt(5));let n=cos(r)*o;let l=sin(r)*o;let s=a*q;let c=1.2*(random(random(0,1))+.2);let h=createVector(n*s*c,t*s*c,l*s*c);g.push(h)}g.forEach((e=>{let t=e.mag()/a;let o=q*a*random(.2,.4)*(1-.2*t);let r=u(e);let n=e.copy().normalize();D.drawGradientFlowerCenter(r.x,r.y,o,n,c)}));return{center:p,size:a,rotation:n}}static drawGradientFlowerCenter(e,t,o,r,n=8){let l=2;let a=3;let s=Ao($t);a=a+s.random(0,1)*2;l=10*we;let i=Co.vectorToEulerAngles(r);let c=n;let h=16;let p=[];for(let r=0;r<c;r++){let n=o*(1-r/c);let l=o*(1-(r+1)/c);let a=[];let s=[];for(let e=0;e<=h;e++){let t=e/h*TWO_PI;let o=createVector(cos(t)*n,sin(t)*n,0);let c=createVector(cos(t)*l,sin(t)*l,0);o=Co.applyEulerRotation(o,i);c=Co.applyEulerRotation(c,i);a.push(o);s.push(c);if(r===0){p.push(o.copy())}}let f=random(.9,1);let d=random(0,.2);for(let o=0;o<h;o++){let n=r/(c-1);let l=lerp(Mt.colors.fruit[2][0],Mt.colors.fruit[2][0],n);let i=lerp(d,Mt.colors.fruit[2][1],n);let h=lerp(f,Mt.colors.fruit[2][2],n);Ln({pg:pgL4,pts:[a[o],a[o+1],s[o+1],s[o]],baseX:e,baseY:t,doFill:true,doStr:false,col:Ro(l,i,h,1),randomOffset:.5})}}let f=Mt.colors.stroke[0];if(ye==0)f=Mt.colors.stroke[2];let d=Mt.colors.fruit[1];Bn({pg:pgL4,pts:p.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-l,l);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-l,l);return createVector(e.x+t,e.y+o)})),baseX:e,baseY:t,col:Ro(f[0],f[1],f[2],1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*a*Pe*random(.3,.5)});let m=o*.2;let u=[];for(let e=0;e<=h;e++){let t=e/h*TWO_PI;let o=createVector(cos(t)*m,sin(t)*m,0);o=Co.applyEulerRotation(o,i);u.push(o)}Bn({pg:pgL4,pts:u.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-l,l);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-l,l);return createVector(e.x+t,e.y+o)})),baseX:e,baseY:t,col:Ro(d[0],d[1],d[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*100),0,1,.1,1)+.5)*a*Pe*random(.3,.5)})}static addFruit(e,t,o,r){let n=o.PT.lastFruitPos||{x:-Infinity,y:-Infinity};let l={x:e,y:t};let a=50;let s=dist(l.x,l.y,n.x,n.y);if(s>a){let e=vo(o.PT.fruitTypes);let t=o.PT.fruitColors[e];D.drawFruit({pg:pgL1,id:o.fruitCount,baseX:l.x,baseY:l.y,type:e,col:t,PT:o.PT,currentWidth:r});o.PT.fruitCount++;o.PT.lastFruitPos=l;return true}}static melon(e={}){let{pg:t=pgL3,baseX:o=0,baseY:n=0,baseRotation:l=createVector(0,0,0),PT:a,size:s=20,length:length=40,stemLength:i=30,pointShift:c=.01,strokeStrength:h=1,strokeNoiseScale:p=.1,branchLength:f=50,stemBend:d}=e;let m=Ao($t);h=h+m.random(0,1)*2;c=c*we;let u={base:{hue:a.colors.fruit[1][0],saturation:a.colors.fruit[1][1],brightness:a.colors.fruit[1][2]}};let g=[Number(u.base.hue)+Wo(-20,20),Number(u.base.saturation)+Wo(-.1,.1),Number(u.base.brightness)+Wo(-.1,.1),1];d=d||createVector(m.random(1,2),m.random(1,2),0);let b={pg:t,baseX:o,baseY:n,baseRotation:l,branchLength:f,col:Ro(0,0,0,.8),branchBendFunc:e=>d,branchWidthFunc:e=>2,strokeStrength:1};let y=T.stem(b);let x=y.centerPos[y.centerPos.length-1];let F=p5.Vector.sub(y.centerPos[y.centerPos.length-1],y.centerPos[y.centerPos.length-2]).normalize();let P=x.x+o;let w=x.y+n;let V=p5.Vector.cross(createVector(0,-1,0),F);let C=Co.angle(createVector(0,-1,0),F);let E=e=>{let t=createVector(e.x,e.y-length*2.3,e.z);let o=V.mag()>.001?Co.rotateVectorAroundAxis(t,V,C):t.copy();return createVector(o.x+P,o.y+w,o.z)};let D=40;let A=[];for(let e=0;e<=D;e++){let t=e/D;let o=-length*2.5*(2*t-1);A.push(createVector(0,o))}let S=(e,t,o,r=false)=>{let n=2*e-1;let l=s*.3*sqrt(1-pow(n,2));let a=t+1e3;let i=t+2e3;let c=r?a:i;let h=noise(e*1+c)*.2+m.random(-.03,.03);let p=sin(e*(o+(r?2:-2)))*.1;let f=noise(e*3+c)*.1;return l*(1+h+p+f)};let I=m.random(1,2);let L=So(m,6,12);let[B,v]=Sn({pts:A,branchWidthFunc:e=>S(e,I,L,true)});let W=12;let k=Mt.colors.branch[0].map(Number);let _=Mt.colors.flower[0].map(Number);function z(e,o){const n=A.length-1;const l=W-1;const a=e/n;const s=o/l;const i=(o+1)/l;const c={Pos0_0:p5.Vector.lerp(B[e],v[e],s),Pos0_1:p5.Vector.lerp(B[e+1],v[e+1],s),Pos1_0:p5.Vector.lerp(B[e],v[e],i),Pos1_1:p5.Vector.lerp(B[e+1],v[e+1],i)};let h=1-lerp(sin(i*PI)*a,a,a);h+=map(noise(i*20,a*20),0,1,.2,.5);const p=sin(i*PI*8)>0?1:.95;const f=pow(h,2.5);const d=1-f*.4;let m;if(r===2){const e=1-h;m={h:_o(k[0],_[0],e),s:lerp(k[1],_[1],e),b:lerp(k[2],_[2],e)*d,a:1}}else{m={h:_o(g[0],g[0],h),s:lerp(g[1],g[1]*.9,h),b:lerp(g[2],g[2],h)*d*(p*.3+.7),a:lerp(g[3],g[3],h)}}Ln({pg:t,pts:[c.Pos0_0,c.Pos0_1,c.Pos1_1,c.Pos1_0].map(E),doFill:true,col:Ro(m.h,m.s,m.b,m.a),randomOffset:.5})}const X=A.length-1;const Y=W-1;for(let e=0;e<X;e++){for(let t=0;t<Y;t++){z(e,t)}}let O=So(m,100,200);let R=Ro(g[0],g[1]*.5,g[2]*1.2,.5);for(let e=2;e<A.length-1;e++){let o=B[e];let r=v[e];let n=A[e];let l=floor(O/(A.length-3));for(let e=0;e<l;e++){let e=m.random(0,m.random(0,1));e=map(e,0,1,.2,.8);let l;if(random(0,1)<.5){l=p5.Vector.lerp(o,n,e)}else{l=p5.Vector.lerp(n,r,e)}l.add(No(m).mult(random(.2,.8)));let a=m.random(0,1)<.95?m.random(1,1.5):2.5;a=a*1.2;let s=color(R);t.push();t.noStroke();s.setAlpha(m.random(.1,.4));t.fill(s);let i=E(l);t.ellipse(i.x,i.y,a,a);t.pop()}}let N=Mt.colors.stroke[0];if(ye==0)N=Mt.colors.stroke[2];let M=(e,o=1.2)=>{Bn({pg:t,pts:e.map((e=>{let t=map(noise(e.x*p,e.y*p),0,1,-c,c);let o=map(noise(e.y*p,e.x*p),0,1,-c,c);let r=E(e);return createVector(r.x+t,r.y+o)})),baseX:0,baseY:0,col:Ro(N[0],N[1],N[2],1),randomOffset:0,branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*h*Pe})};M(B);M(v);return{center:x,size:s,rotation:l}}}var A=new URLSearchParams(window.location.search).get("payload");var S=JSON.parse(A?atob(A):"{}");var hash=S.hash||(Math.random()+1).toString(16).substring(2);var I=S.editionNumber||0;const L=function(e){var t,o,r,n,l=function e(t){for(var o=0,r=1779033703^t.length;o<t.length;o++)r=(r=Math.imul(r^t.charCodeAt(o),3432918353))<<13|r>>>19;return function(){return r=Math.imul((r=Math.imul(r^r>>>16,2246822507))^r>>>13,3266489909),(r^=r>>>16)>>>0}}(e),a={rand:(t=l(),o=l(),r=l(),n=l(),function(){r|=0;var e=((t|=0)+(o|=0)|0)+(n|=0)|0;return n=n+1|0,t=o^o>>>9,o=r+(r<<3)|0,r=(r=r<<21|r>>>11)+e|0,(e>>>0)/4294967296}),randInt:function(e,t){return e+Math.floor((t-e)*a.rand())}};return a};const B=L(hash);let v=B.randInt(1e8,9e8);if(new URLSearchParams(window.location.search).get("hashSeed")!==null){v=new URLSearchParams(window.location.search).get("hashSeed")}else{}function W(){dispatchEvent(new Event("capture-preview"));console.info("###verse-preview-capture")}function k(){var e=navigator.userAgent||navigator.vendor||window.opera;if(/Mac/i.test(e)){specialAlpha=.8;return"Mac"}else if(/Win/i.test(e)){specialAlpha=.2;return"PC"}else{return"Unknown"}}var _=k();const z=new URLSearchParams(window.location.search).get("machine");const X=new URLSearchParams(window.location.search).get("hires");console.log("hires:"+X);console.log("isMachine:"+z);function Y(e,t,o){const r=Math.pow(10,t-1);const n=Math.floor(e/r)%Math.pow(10,o);return n}let O=0,R=0,N=30,M;let H=false,G=false;let U=.3,$=.7,q=0,j=1;let J=1,K=.1;let Q=1.2,Z=1,ee={};let te,oe;let re=0,ne=0,le=0,ae;let se={x:0,y:0,height:0};let ie=0,ce=0;let he=[],pe=0,fe=[1,1];let de=0,me;let ue=1,ge=1,be=1,ye=1;let xe=1,Fe=0;let Pe=0,we,Ve;let Ce=0,Te=0;let Ee=0;let De=[1,1,1];let Ae=[1,1,1];let Se,Ie,Le=0,Be;let ve={pgL0:null,pgL1:null,pgL2:null,pgL3:null,pgL4:null,pgText:null,pgTex:null,pgFinal:null,snapShotImg:null,pgFrame:null};let We,ke;let _e,ze,Xe,Ye,Oe,Re,Ne,Me,He,Ge;let Ue,$e;let qe=1,je=3;let Je=0,Ke;let Qe=false;let Ze,et,tt=0;let ot=0,rt,nt;let lt=0,at=0;let st=0;let it=0,ct=0;let ht=0,pt=0;let ft=0,dt=0;let mt=0,ut=true;let gt=0;let bt="";let yt;let xt=.001,Ft=.01;let Pt=0,wt=false;const Vt=1e3;let Ct=[],Tt=[],Et=[];let Dt=[],At=[];let St=new Set;let It=0,Lt=0;let Bt,vt,Wt=0;let kt=.995,_t=.995,zt=.995;let Xt=1,Yt=.9,Ot=.1;let Rt="A";let Nt={},Mt={},Ht={},Gt={},Ut={};let $t;let qt,jt,Jt,Kt;let Qt=null,Zt="#";let eo=0,to=0;let oo=0;let ro=new URLSearchParams(window.location.search);let no=ro.has("paperType")?parseInt(ro.get("paperType")):null;let lo=/^\?\d+/.test(window.location.search);let ao={},so;const io={0:{colors:{vine:[Xo("#F6F5F9")],fruit:[Xo("#CD8A6F"),Xo("#E3AA5F"),Xo("#EAB29B")],flower:[Xo("#A75065"),Xo("#F6F5F9")],leaf:[Xo("#677079"),Xo("#FFE7F6")],branch:[Xo("#444440"),Xo("#BF8463"),Xo("#9A6A4F")],grass:[Xo("#335D80")],mushroom:[Xo("#DED5C6"),Xo("#C5885F"),Xo("#E3D65F"),Xo("#FAFEFF"),Xo("#856F5F"),Xo("#A75065")],butterfly:[Xo("#FAFEFF"),Xo("#DFD25C")],stone:[Xo("#67645F")],bg:[Xo("#DED5C6")],stroke:[Xo("#434240"),Xo("#CD8A6F"),Xo("#DED5C6")]}},1:{colors:{vine:[Xo("#FEFFFD")],fruit:[Xo("#94342A"),Xo("#BFAF94"),Xo("#DFD25C")],flower:[Xo("#FAFEFF"),Xo("#BFAF94")],leaf:[Xo("#B93737"),Xo("#FAFEFF")],branch:[Xo("#604726"),Xo("#FAFEFF"),Xo("#1E414E")],grass:[Xo("#3E322F")],mushroom:[Xo("#FAFEFF"),Xo("#FEFFFD"),Xo("#DFD25C"),Xo("#688CE3"),Xo("#DFAC5C"),Xo("#FAFEFF")],butterfly:[Xo("#DFD25C"),Xo("#FAFEFF")],stone:[Xo("#2C4F58")],bg:[Xo("#BFAF94")],stroke:[Xo("#5B5B5B"),Xo("#688CE3"),Xo("#DFAC5C")]}},2:{colors:{vine:[Xo("#FEFFFD")],fruit:[Xo("#95AADE"),Xo("#C8C9BB"),Xo("#4761A0")],flower:[Xo("#E89B65"),Xo("#D87D5D")],leaf:[Xo("#63AEA1"),Xo("#B7D1A9")],branch:[Xo("#FEFFFD"),Xo("#B7D1A9"),Xo("#94B08A")],grass:[Xo("#B7D1A9")],mushroom:[Xo("#FEFFFD"),Xo("#E89B65"),Xo("#B7D1A9"),Xo("#B7D1A9"),Xo("#63AEA1"),Xo("#63AEA1")],butterfly:[Xo("#63AEA1"),Xo("#B7D1A9")],stone:[Xo("#63AEA1")],bg:[Xo("#CCC6B3")],stroke:[Xo("#373733"),Xo("#8D4D21"),Xo("#F8C32B")]}},3:{colors:{vine:[Xo("#708075")],fruit:[Xo("#3F4A45"),Xo("#708075"),Xo("#FAD2A8")],flower:[Xo("#FAC9C4"),Xo("#FDFDEB")],leaf:[Xo("#718175"),Xo("#474F52")],branch:[Xo("#B3B0A8"),Xo("#E5E1D5"),Xo("#B3B0A8")],grass:[Xo("#A89C69")],mushroom:[Xo("#FDFDEB"),Xo("#E5E1D5"),Xo("#FAC9C4"),Xo("#E5E1D5"),Xo("#6E7850"),Xo("#E5E1D5")],butterfly:[Xo("#597356"),Xo("#597356")],stone:[Xo("#858179")],bg:[Xo("#D1CDC2")],stroke:[Xo("#514D45"),Xo("#FAC9C4"),Xo("#4C5752")]}},4:{colors:{vine:[Xo("#396782")],fruit:[Xo("#D2D2E1"),Xo("#CB97B0"),Xo("#FCC911")],flower:[Xo("#FDFDEB"),Xo("#FBE282")],leaf:[Xo("#89A9AD"),Xo("#D6D494")],branch:[Xo("#D2C09C"),Xo("#FDF8C2"),Xo("#C2B08A")],grass:[Xo("#BCD0D0")],mushroom:[Xo("#FDFDEB"),Xo("#F7E39D"),Xo("#F4E972"),Xo("#FBF8F4"),Xo("#AF7FAB"),Xo("#DEC9DC")],butterfly:[Xo("#FBE282"),Xo("#EFC09E")],stone:[Xo("##858179")],bg:[Xo("#FFFCD8")],stroke:[Xo("#5F4C26"),Xo("#396782"),Xo("#D2C09C")]}},5:{colors:{vine:[Xo("#394D4B")],fruit:[Xo("#BA6E50"),Xo("#3A5856"),Xo("#E9DEC6")],flower:[Xo("#FFFDFF"),Xo("#3A5856")],leaf:[Xo("#394D4B"),Xo("#B6866B")],branch:[Xo("#A58F75"),Xo("#F8F6F7"),Xo("#8C7A65")],grass:[Xo("#D7745A")],mushroom:[Xo("#E9DEC6"),Xo("#D7745A"),Xo("#DEDCDD"),Xo("#3A5856"),Xo("#A58F75"),Xo("#30312C")],butterfly:[Xo("#FCBFD5"),Xo("#D1A4D8")],stone:[Xo("#937C63")],bg:[Xo("#DEDCDD")],stroke:[Xo("#271F18"),Xo("#D7745A"),Xo("#A58F75")]}},6:{colors:{vine:[Xo("#090607")],fruit:[Xo("#5578B2"),Xo("#F4BFAA"),Xo("#9A3724")],flower:[Xo("#FCF0E1"),Xo("#F07E56")],leaf:[Xo("#A9A589"),Xo("#D2B26E")],branch:[Xo("#DADCD0"),Xo("#625135"),Xo("#EBD8A4")],grass:[Xo("#3D271F")],mushroom:[Xo("#5578B2"),Xo("#FFF1B4"),Xo("#F4BFAA"),Xo("#625135"),Xo("#F4BFAA"),Xo("#F8F6F7")],butterfly:[Xo("#898773"),Xo("#D2B26E")],stone:[Xo("#7A6952")],bg:[Xo("#A79470")],stroke:[Xo("#080807"),Xo("#F8F6F7"),Xo("#CA4F28")]}},7:{colors:{vine:[Xo("#5A5B3F")],fruit:[Xo("#C4A498"),Xo("#99794C"),Xo("#6D8D29")],flower:[Xo("#EFEDEB"),Xo("#F8C32B")],leaf:[Xo("#7E7F49"),Xo("#F6F7E5")],branch:[Xo("#2C1C05"),Xo("#E67A29"),Xo("#677348")],grass:[Xo("#9B9968")],mushroom:[Xo("#F1F2E0"),Xo("#A8A99B"),Xo("#545146"),Xo("#E1E2D1"),Xo("#545146"),Xo("#E1E2D1")],butterfly:[Xo("#727BB4"),Xo("#F4F3F2")],stone:[Xo("#664822")],bg:[Xo("#D8CFC2")],stroke:[Xo("#393519"),Xo("#677348"),Xo("#E5DDCF")]}},8:{colors:{vine:[Xo("#82955C")],fruit:[Xo("#FCC911"),Xo("#DC5B55"),Xo("#F1F2E0")],flower:[Xo("#F6F7E5"),Xo("#F7B515")],leaf:[Xo("#C5B26E"),Xo("#231716")],branch:[Xo("#B96942"),Xo("#F7B515"),Xo("#A15A3A")],grass:[Xo("#6D7C51")],mushroom:[Xo("#F1F2E0"),Xo("#DC5B55"),Xo("#F1F2E0"),Xo("#C5B26E"),Xo("#F1F2E0"),Xo("#82955C")],butterfly:[Xo("#FA74B2"),Xo("#5FAAA6")],stone:[Xo("#545146")],bg:[Xo("#F2DDB4")],stroke:[Xo("#465753"),Xo("#F7B515"),Xo("#B96942")]}},9:{colors:{vine:[Xo("#E6DBC4")],fruit:[Xo("#36342E"),Xo("#F6F7E5"),Xo("#E6DBC4")],flower:[Xo("#F6F7E5"),Xo("#E6DBC4")],leaf:[Xo("#E6DBC4"),Xo("#E6DBC4")],branch:[Xo("#CE5C6B"),Xo("#E9DEC6"),Xo("#403737")],grass:[Xo("#403737")],mushroom:[Xo("#F6F7E5"),Xo("#E6DBC4"),Xo("#F6F7E5"),Xo("#E6DBC4"),Xo("#F6F7E5"),Xo("#E6DBC4")],butterfly:[Xo("#FFFFFF"),Xo("#F1F2E0")],stone:[Xo("#FFFFFF")],bg:[Xo("#E6DBC4")],stroke:[Xo("#36342E"),Xo("#36342E"),Xo("#CE5C6B")]}},10:{colors:{vine:[Xo("#ECBDC0")],fruit:[Xo("#DEA643"),Xo("#ECBDC0"),Xo("#8A8FC6")],flower:[Xo("#FDF7F0"),Xo("#FDF7F0")],leaf:[Xo("#899BB3"),Xo("#A3A776")],branch:[Xo("#A3A776"),Xo("#F8E1AE"),Xo("#8C7A65")],grass:[Xo("#5E8262")],mushroom:[Xo("#FDF7F0"),Xo("#D1BC63"),Xo("#F1F2E0"),Xo("#D1BC63"),Xo("#F1F2E0"),Xo("#D1BC63")],butterfly:[Xo("#FFFFFF"),Xo("#D1BC63")],stone:[Xo("#FDF7F0")],bg:[Xo("#FDF7F0")],stroke:[Xo("#414141"),Xo("#8A8FC6"),Xo("#D1BC63")]}},11:{colors:{vine:[Xo("#FDF8EA")],fruit:[Xo("#C2B08A"),Xo("#8F3F34"),Xo("#8F3F34")],flower:[Xo("#E7DED3"),Xo("#FFFBF7")],leaf:[Xo("#6B716D"),Xo("#A3A776")],branch:[Xo("#45311C"),Xo("#E9DEC6"),Xo("#C2B08A")],grass:[Xo("#BB9F97")],mushroom:[Xo("#F1F2E0"),Xo("#C2B08A"),Xo("#F1F2E0"),Xo("#A3A776"),Xo("#5B76A8"),Xo("#8F3F34")],butterfly:[Xo("#7E887F"),Xo("#5B76A8")],stone:[Xo("#FDF7F0")],bg:[Xo("#A6AEA8")],stroke:[Xo("#565656"),Xo("#D1CBCB"),Xo("#E1D7CB")]}},12:{colors:{vine:[Xo("#7B5226")],fruit:[Xo("#E3DFC5"),Xo("#DCAAA9"),Xo("#D8A296")],flower:[Xo("#D8A296"),Xo("#F2D5B7")],leaf:[Xo("#202427"),Xo("#202427")],branch:[Xo("#2E3137"),Xo("#EBE6D9"),Xo("#B3A8A1")],grass:[Xo("#D89088")],mushroom:[Xo("#EBE6D9"),Xo("#D89088"),Xo("#F1F2E0"),Xo("#7B5226"),Xo("#DCD7C0"),Xo("#BAB2B6")],butterfly:[Xo("#DCD7C0"),Xo("#484148")],stone:[Xo("#2E3137")],bg:[Xo("#E3DFC5")],stroke:[Xo("#000000"),Xo("#D89088"),Xo("#F2D5B7")]}},13:{colors:{vine:[Xo("#8BA780")],fruit:[Xo("#F2F2E6"),Xo("#A94E5C"),Xo("#985562")],flower:[Xo("#FFFFFF"),Xo("#57896E")],leaf:[Xo("#708F68"),Xo("#F2F2E6")],branch:[Xo("#F2F2E6"),Xo("#8BA780"),Xo("#6E8A6A")],grass:[Xo("#412F2B")],mushroom:[Xo("#F2F2E6"),Xo("#E8E9D5"),Xo("#FFFFFF"),Xo("#CAD6BC"),Xo("#F2F2E6"),Xo("#CAD6BC")],butterfly:[Xo("#232F20"),Xo("#F2F2E6")],stone:[Xo("#F2F2E6")],bg:[Xo("#E8E9D5")],stroke:[Xo("#4E4E4E"),Xo("#A94E5C"),Xo("#F8C32B")]}},14:{colors:{vine:[Xo("#FEFDF9")],fruit:[Xo("#9EB745"),Xo("#8F6C37"),Xo("#EEE3C8")],flower:[Xo("#FFFFFF"),Xo("#6E8A6A")],leaf:[Xo("#6E8A6A"),Xo("#EEE3C8")],branch:[Xo("#262710"),Xo("#5E5F5A"),Xo("#8A806A")],grass:[Xo("#47872B")],mushroom:[Xo("#F2F2E6"),Xo("#6B6858"),Xo("#34302A"),Xo("#EEE3C8"),Xo("#B89340"),Xo("#6E8A6A")],butterfly:[Xo("#232F20"),Xo("#F2F2E6")],stone:[Xo("#6B6858")],bg:[Xo("#EEE3C8")],stroke:[Xo("#34302A"),Xo("#B89340"),Xo("#E1CA96")]}},15:{colors:{vine:[Xo("#E8E3D5")],fruit:[Xo("#302D00"),Xo("#8A8371"),Xo("#B05D1F")],flower:[Xo("#E4D077"),Xo("#302D00")],leaf:[Xo("#74727B"),Xo("#E8E3D5")],branch:[Xo("#E8E3D5"),Xo("#E8E3D5"),Xo("#E8E3D5")],grass:[Xo("#E4D077")],mushroom:[Xo("#EFE4C4"),Xo("#E8E3D5"),Xo("#EFE4C4"),Xo("#E8E3D5"),Xo("#EFE4C4"),Xo("#E8E3D5")],butterfly:[Xo("#E8E3D5"),Xo("#E8E3D5")],stone:[Xo("#E8E3D5")],bg:[Xo("#E8E3D5")],stroke:[Xo("#080807"),Xo("#73C3EC"),Xo("#C44287")]}},16:{colors:{vine:[Xo("#1F1200")],fruit:[Xo("#425C7C"),Xo("#8A8371"),Xo("#7B5469")],flower:[Xo("#9C8895"),Xo("#506066")],leaf:[Xo("#E4D2BE"),Xo("#EFE4C4")],branch:[Xo("#B39C86"),Xo("#E4D2BE"),Xo("#293B4A")],grass:[Xo("#5A4C3A")],mushroom:[Xo("#EFE4C4"),Xo("#E4D2BE"),Xo("#EFE4C4"),Xo("#E4D2BE"),Xo("#EFE4C4"),Xo("#E4D2BE")],butterfly:[Xo("#506066"),Xo("#EFE4C4")],stone:[Xo("#E4D2BE")],bg:[Xo("#EFE4C4")],stroke:[Xo("#1F1200"),Xo("#FEFDF9"),Xo("#293B4A")]}},17:{colors:{vine:[Xo("#A9493E")],fruit:[Xo("#C49852"),Xo("#A9493E"),Xo("#E8B05E")],flower:[Xo("#D7B170"),Xo("#5D8A66")],leaf:[Xo("#FDFDEB"),Xo("#D6D494")],branch:[Xo("#077B8C"),Xo("#C8785F"),Xo("#A9493E")],grass:[Xo("#BCBFD0")],mushroom:[Xo("#FDFDEB"),Xo("#C49852"),Xo("#D7B170"),Xo("#A9493E"),Xo("#C2B08A"),Xo("#537477")],butterfly:[Xo("#A9493E"),Xo("#CCA981")],stone:[Xo("##858179")],bg:[Xo("#EDCFB7")],stroke:[Xo("#32321F"),Xo("#396782"),Xo("#D2C09C")]}},18:{colors:{vine:[Xo("#512A0F")],fruit:[Xo("#355189"),Xo("#EAEEE9"),Xo("#5A8874")],flower:[Xo("#A1351C"),Xo("#FFC4C4")],leaf:[Xo("#625642"),Xo("#D6D494")],branch:[Xo("#A2917C"),Xo("#56846C"),Xo("#63BBB9")],grass:[Xo("#5A8874")],mushroom:[Xo("#FDFDEB"),Xo("#63BBB9"),Xo("#FFAD4C"),Xo("#DD4537"),Xo("#C2B08A"),Xo("#537477")],butterfly:[Xo("#253437"),Xo("#FEF8EB")],stone:[Xo("##FEF8EB")],bg:[Xo("#BD9E67")],stroke:[Xo("#150B0B"),Xo("#396782"),Xo("#D2C09C")]}},19:{colors:{vine:[Xo("#B5A4A0")],fruit:[Xo("#5C3A15"),Xo("#658072"),Xo("#1A1874")],flower:[Xo("#DCB5B5"),Xo("#AD9794")],leaf:[Xo("#5A5C4D"),Xo("#D6D494")],branch:[Xo("#8B542B"),Xo("#54593D"),Xo("#A0703B")],grass:[Xo("#1E1D26")],mushroom:[Xo("#FDFDEB"),Xo("#D2C09C"),Xo("#7D8160"),Xo("#D2C09C"),Xo("#C2B08A"),Xo("#AC9691")],butterfly:[Xo("#1A1874"),Xo("#FEF8EB")],stone:[Xo("#BDC2B4")],bg:[Xo("#DFE3DA")],stroke:[Xo("#2C2517"),Xo("#DCB5B5"),Xo("#D2C09C")]}},20:{colors:{vine:[Xo("#17181A")],fruit:[Xo("#EDCEE1"),Xo("#AB6958"),Xo("#DBE4E5")],flower:[Xo("#CFCAC9"),Xo("#868074")],leaf:[Xo("#4D4433"),Xo("#030305")],branch:[Xo("#3F3929"),Xo("#3F3929"),Xo("#F2EDD8")],grass:[Xo("#EDCEE1")],mushroom:[Xo("#9D8D7B"),Xo("#D2C09C"),Xo("#9D8D7B"),Xo("#D4D5D6"),Xo("#C2B08A"),Xo("#9C998E")],butterfly:[Xo("#5D4D3C"),Xo("#D4D5D6")],stone:[Xo("#EEEADE")],bg:[Xo("#BBB29D")],stroke:[Xo("#262013"),Xo("#AB6958"),Xo("#D2C09C")]}},21:{colors:{vine:[Xo("#BBCDAD")],fruit:[Xo("#F97247"),Xo("#EAD1AE"),Xo("#F97247")],flower:[Xo("#F6EEE5"),Xo("#F9AF7B")],leaf:[Xo("#A3B78E"),Xo("#BBCDAD")],branch:[Xo("#9E6E33"),Xo("#A77D37"),Xo("#F2EDD8")],grass:[Xo("#F9CF7D")],mushroom:[Xo("#F97247"),Xo("#F9CF7D"),Xo("#F6EEE5"),Xo("#F9CF7D"),Xo("#F6DFC7"),Xo("#A3B78E")],butterfly:[Xo("#F6EEE5"),Xo("#BBCDAD")],stone:[Xo("#F7C973")],bg:[Xo("#F9CF7D")],stroke:[Xo("#60503B"),Xo("#D4855A"),Xo("#F9CF7D")]}},22:{colors:{vine:[Xo("#E7E2D8")],fruit:[Xo("#161616"),Xo("#F1EEE7"),Xo("#E7E2D8")],flower:[Xo("#FFFFFF"),Xo("#FEF8EB")],leaf:[Xo("#FEF8EB"),Xo("#E7E2D8")],branch:[Xo("#161616"),Xo("#E7E2D8"),Xo("#F2EDD8")],grass:[Xo("#E7E2D8")],mushroom:[Xo("#E7E2D8"),Xo("#E7E2D8"),Xo("#E7E2D8"),Xo("#E7E2D8"),Xo("#E7E2D8"),Xo("#E7E2D8")],butterfly:[Xo("#E7E2D8"),Xo("#E7E2D8")],stone:[Xo("#E7E2D8")],bg:[Xo("#E9E9E9")],stroke:[Xo("#161616"),Xo("#161616"),Xo("#FFFFFF")]}},23:{colors:{vine:[Xo("#6A904B")],fruit:[Xo("#DCDDCD"),Xo("#DCDDCD"),Xo("#DBE4E5")],flower:[Xo("#F2EDD8"),Xo("#F2D147")],leaf:[Xo("#6A904B"),Xo("#030305")],branch:[Xo("#6A904B"),Xo("#3F3929"),Xo("#F2EDD8")],grass:[Xo("#6A904B")],mushroom:[Xo("#DCDDCD"),Xo("#DCDDCD"),Xo("#DCDDCD"),Xo("#DCDDCD"),Xo("#DCDDCD"),Xo("#DCDDCD")],butterfly:[Xo("#F2EDD8"),Xo("#F2EDD8")],stone:[Xo("#DCDDCD")],bg:[Xo("#DCDDCD")],stroke:[Xo("#262013"),Xo("#465F32"),Xo("#E5F2D8")]}},24:{colors:{vine:[Xo("#6A904B")],fruit:[Xo("#556843"),Xo("#556843"),Xo("#556843")],flower:[Xo("#BD2D2D"),Xo("#EED628")],leaf:[Xo("#8BA260"),Xo("#030305")],branch:[Xo("#595347"),Xo("#3F3929"),Xo("#7E524A")],grass:[Xo("#899F5E")],mushroom:[Xo("#DCDDCD"),Xo("#FFFFFD"),Xo("#DCDDCD"),Xo("#FFFFFD"),Xo("#DCDDCD"),Xo("#FFFFFD")],butterfly:[Xo("#E2DDD3"),Xo("#FFFFFD")],stone:[Xo("#E2DDD3")],bg:[Xo("#E2DDD3")],stroke:[Xo("#262013"),Xo("#465F32"),Xo("#E5F2D8")]}},25:{colors:{vine:[Xo("#303030")],fruit:[Xo("#000000"),Xo("#303030"),Xo("#303030")],flower:[Xo("#FF0000"),Xo("#FFFFFF")],leaf:[Xo("#303030"),Xo("#030305")],branch:[Xo("#000000"),Xo("#303030"),Xo("#303030")],grass:[Xo("#000000")],mushroom:[Xo("#303030"),Xo("#000000"),Xo("#303030"),Xo("#000000"),Xo("#303030"),Xo("#000000")],butterfly:[Xo("#FF0000"),Xo("#D3D3D3")],stone:[Xo("#303030")],bg:[Xo("#272727")],stroke:[Xo("#D3D3D3"),Xo("#303030"),Xo("#FFD900")]}},26:{colors:{vine:[Xo("#DCC902")],fruit:[Xo("#000000"),Xo("#F6FCDE"),Xo("#303030")],flower:[Xo("#DCC902"),Xo("#FFFFFF")],leaf:[Xo("#23708C"),Xo("#030305")],branch:[Xo("#15486C"),Xo("#303030"),Xo("#303030")],grass:[Xo("#303D38")],mushroom:[Xo("#D0B06C"),Xo("#23708C"),Xo("#FFD900"),Xo("#D0B06C"),Xo("#303030"),Xo("#D0B06C")],butterfly:[Xo("#F6FCDE"),Xo("#AA6B46")],stone:[Xo("#F6FCDE")],bg:[Xo("#D0B06C")],stroke:[Xo("#685A3D"),Xo("#303030"),Xo("#FFD900")]}},27:{colors:{vine:[Xo("#C853FD")],fruit:[Xo("#5E7FE3"),Xo("#89D7FC"),Xo("#C853FD")],flower:[Xo("#FF3A5D"),Xo("#FFFFFE")],leaf:[Xo("#05FCD5"),Xo("#06ED95")],branch:[Xo("#688EFF"),Xo("#7ECAFF"),Xo("#FF3A5D")],grass:[Xo("#06ED95")],mushroom:[Xo("#FF2771"),Xo("#00FFDE"),Xo("#7ECAFF"),Xo("#A463FF"),Xo("#FF99AA"),Xo("#FFFFFE")],butterfly:[Xo("#FFFFFE"),Xo("#865B4B")],stone:[Xo("#8A5E4F")],bg:[Xo("#000000")],stroke:[Xo("#E7E7E7"),Xo("#00E791"),Xo("#FF3A5D")]}}};const co={SIMPLE:"基礎橢圓形",QUILL:"羽毛",WAVE:"波浪NOISE",GOURD:"葫蘆形",TRIANGLE:"三角",HEART:"心形",JAGGED:"鋸齒邊",ROUND:"圓形",BAMBOO:"竹葉",FERN:"蕨葉",BRUG:"紅茄苳"};const ho={[co.SIMPLE]:e=>t=>pow(sin(PI*t),e.leafPointyness),[co.QUILL]:e=>t=>pow(atan(PI*(1-t)),e.leafPointyness)*.5,[co.WAVE]:e=>t=>{let o=pow(sin(PI*t),e.leafPointyness);let r=map(noise(t*.5),0,1,.05,.1)*cos(12*PI*t);return o*(1+r)},[co.GOURD]:e=>t=>{let o=t-.35;return pow(1-4*o*o,e.leafPointyness)*(.5+.2*sin(t*6*PI))},[co.TRIANGLE]:e=>e=>{if(e<.2){return e*5}else if(e>.8){return(1-e)*5}else{return 1}},[co.HEART]:e=>t=>{let o=(t-.5)*2;let r=sqrt(1-abs(o))*sqrt(abs(o));r*=1.2-.3*pow(abs(o),.5);if(t<.4){r*=map(t,0,.4,0,1)}return r*1.5*e.leafPointyness},[co.JAGGED]:e=>t=>noise(t*e.leafShapeEdge,e.leafShapeN)*pow(sin(PI*t),e.leafPointyness),[co.ROUND]:e=>e=>{let t=(e-.5)*2;return sqrt(1-t*t)},[co.BAMBOO]:e=>{let t=.5;return e=>{if(e<.1){let o=e/.05;return pow(o,.6)*.7*t}else if(e<.3){let o=(e-.05)/.15;return(.7+.3*o)*t}else{let o=(e-.3)/.7;return(1-pow(o,1.5))*(1+.1*sin(o*PI*2))*t}}},[co.FERN]:e=>t=>{let o=1.5-pow(t,.7);let r=.3*(.5+.5*sin(t*10*PI));let n=1-pow(t,.1);let width=.2;return(o+r*n)*width*e.leafPointyness},[co.BRUG]:e=>e=>pow(sin(PI*e),.7)};const po={NATURAL:"自然花瓣",HEART:"心形花瓣",SLENDER:"細長花瓣",ROUND:"圓形花瓣"};const fo={[po.NATURAL]:e=>t=>{if(t<.5){return.3+noise(t*e.flowerShapeEdge,e.flowerShapeN)*e.flowerShapeFn(t)}else{return.2+noise(t*e.flowerShapeEdge,e.flowerShapeN)*e.flowerShapeFn(t)}},[po.HEART]:e=>e=>{let t=(e-.5)*2;if(e<.5){return.2+pow(1-abs(t),2)*(1+Math.sin(e*Math.PI*2))*.9}else{return.3+pow(1-abs(t),2)*(1+Math.sin(e*Math.PI*2))}},[po.SLENDER]:e=>e=>{if(e<.5){return.2+.8*pow(sin(PI*e),1.5)}else{return.05+.95*pow(sin(PI*e),3)}},[po.ROUND]:e=>e=>{let t=(e-.5)*2;let o=sqrt(1-t*t);return o*1.5}};const mo={SHARP_UP:"急劇上揚",SHARP_DOWN:"急劇下垂"};const uo={NOISE:"noise",EDGE_GRADIENT:"邊緣漸層",REVERSE_EDGE_GRADIENT:"反轉邊緣漸層",PEAK_GRADIENT:"010漸層",SOLID_COLOR:"純色"};const go={[mo.SHARP_UP]:e=>e=>{let t=random(.1,.3);return e<t?0:e*8},[mo.SHARP_DOWN]:e=>e=>{let t=random(.1,.3);return e<t?2:e*vo([-7,-12,-15])}};const bo={[uo.NOISE]:e=>{let t=random(5,15);return e=>pow(noise(e*t),.7)},[uo.EDGE_GRADIENT]:e=>{let t=random(.3,.4);let o=random(.4,.6);return e=>{if(e<t){return 0}else{let r=(e-t)/o;r=isNaN(r)?0:constrain(r,0,1);return pow(r,1.5)}}},[uo.REVERSE_EDGE_GRADIENT]:e=>{let t=random(.7,.8);let o=random(.2,.4);return e=>{if(e>t){return 0}else{let r=(t-e)/o;r=constrain(r,0,1);return pow(r,2)}}},[uo.PEAK_GRADIENT]:e=>{let t=random(.45,.55);let o=random(.1,.2);return e=>{let r=abs(e-t)/o;r=constrain(r,0,1);return pow(1-r,3)}},[uo.SOLID_COLOR]:e=>e=>1};const yo={UPRIGHT:"直立",CURVED:"彎曲"};const xo="對生";const Fo="互生";const Po="輪生";const wo={branchFork:5,branchDepth:2,branchWidth:1.2,leafGrowType:Fo,leafWidth:3,leafLength:30,spikeProb:1,flowerProb:.5,leafProb:.5,sunflowerPetalCount:12,flowerWidthA:10,sunSize:30,veinsType:[3,0],petalfType:[1,3],flowerLengthC:60,leafShape:ho[co.ROUND]({leafPointyness:1})};const Vo={veinsType:[12,8],leafShape:ho[co.BRUG]({leafPointyness:1}),leafGrowType:Fo,branchDepth:2,branchFork:2,branchWidth:1.2,spikeProb:1,flowerProb:.9,leafProb:.5,leafLength:130,leafWidth:30};class Co{static getEulerFromPoints(e,t){if(t<=0||t>=e.length){console.error("getEulerFromPoints 中的無效索引");return createVector(0,0,0)}var o=p5.Vector.sub(e[t],e[t-1]);return this.vectorToEulerAngles(o)}static vectorToEulerAngles(e){if(!e||!this.isValidVector(e)){console.error("Invalid input vector in vectorToEulerAngles");return createVector(0,0,0)}let t=e.copy().normalize();if(!this.isValidVector(t)){console.error("Normalization failed in vectorToEulerAngles");return createVector(0,0,0)}let o=asin(constrain(-t.y,-1,1));let r=atan2(t.x,t.z);let n=0;return createVector(o,r,n)}static rotateVectorAroundAxis(e,t,o){if(!e||!t||typeof o!=="number"){console.error("Invalid parameters in rotateVectorAroundAxis");return createVector(0,0,0)}if(!this.isValidVector(e)){console.error("Invalid input vector:",e);return createVector(0,0,0)}if(!this.isValidVector(t)){console.error("Invalid rotation axis:",t);return e.copy()}let r=t.mag();if(r<1e-4){console.error("Zero magnitude rotation axis");return e.copy()}o=o%TWO_PI;let n=t.copy().mult(1/r);let l=cos(o);let a=sin(o);try{let t=e.copy().mult(l);let o=n.cross(e);let r=o.mult(a);let s=n.dot(e);let i=n.copy().mult(s*(1-l));return t.add(r).add(i)}catch(t){console.error("Error in rotation calculation:",t);return e.copy()}}static isValidVector(e){return e&&typeof e.x==="number"&&isFinite(e.x)&&typeof e.y==="number"&&isFinite(e.y)&&typeof e.z==="number"&&isFinite(e.z)}static applyEulerRotation(e,t){if(!e||!t){console.error("Invalid parameters in VectorUtils.applyEulerRotation");return createVector(0,0,0)}let o=e.copy();try{if(t.x!==0&&isFinite(t.x)){o=this.rotateVectorAroundAxis(o,createVector(1,0,0),t.x)}if(t.y!==0&&isFinite(t.y)){o=this.rotateVectorAroundAxis(o,createVector(0,1,0),t.y)}if(t.z!==0&&isFinite(t.z)){o=this.rotateVectorAroundAxis(o,createVector(0,0,1),t.z)}o.x=round(o.x*100)/100;o.y=round(o.y*100)/100;o.z=round(o.z*100)/100;return o}catch(t){console.error("Error in VectorUtils.applyEulerRotation:",t);return e.copy()}}static angle(e,t){var o=e.dot(t);var r=e.mag()*t.mag();var n=constrain(o/r,-1,1);return acos(n)}}class To{constructor(e=1,t=0,o=0,r=0){this.w=e;this.x=t;this.y=o;this.z=r}static fromEuler(e){let t=cos(e.x*.5);let o=sin(e.x*.5);let r=cos(e.y*.5);let n=sin(e.y*.5);let l=cos(e.z*.5);let a=sin(e.z*.5);return new To(t*r*l+o*n*a,o*r*l-t*n*a,t*n*l+o*r*a,t*r*a-o*n*l)}toEuler(){this.normalize();let e,t,o;let r=2*(this.w*this.x+this.y*this.z);let n=1-2*(this.x*this.x+this.y*this.y);e=atan2(r,n);let l=2*(this.w*this.y-this.z*this.x);if(abs(l)>=1){t=(l>=0?1:-1)*PI/2}else{t=asin(l)}let a=2*(this.w*this.z+this.x*this.y);let s=1-2*(this.y*this.y+this.z*this.z);o=atan2(a,s);return createVector(e,t,o)}normalize(){let e=sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);if(e===0)return this;this.w/=e;this.x/=e;this.y/=e;this.z/=e;return this}multiply(e){return new To(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.w*e.x+this.x*e.w+this.y*e.z-this.z*e.y,this.w*e.y-this.x*e.z+this.y*e.w+this.z*e.x,this.w*e.z+this.x*e.y-this.y*e.x+this.z*e.w)}static combineRotations(e,t){let o=To.fromEuler(e);let r=To.fromEuler(t);return r.multiply(o).toEuler()}}class Eo{static createWidthFunction(e,t,o,n){return function(l){let[a,s]=Eo.calculateJointDistance(l,o,n);let i;if(a<1){i=e*(3+5*(1-l))}else{if(r==2){i=e*(2+7*(1-l)*map(noise(l*.001),0,1,.8,1))}else{i=e*(2+7*(1-l)*map(noise(l*10),0,1,.5,1))}}return min(i,t)}}static createbranchBendFunction(e,t){return function(o){let[r,n]=Eo.calculateJointDistance(o,e,t);if(typeof ae==="undefined"||!Array.isArray(ae)||ae.length<2){ae=[0,0]}if(r<1){return createVector(0,n*ae[0],0)}else{return createVector(0,random(-ae[1],ae[1]),0)}}}static createJoints(e,t){let o=[];for(let r=0;r<e;r++){o.push([floor(random(0,1)*t),random(-.2,.2)])}return o}static calculateJointDistance(e,t,o){let r=o;let n=0;if(!t||t.length===0){return[r,0]}for(let l=0;l<t.length;l++){let a=abs(e*o-t[l][0]);if(a<r){r=a;n=l}}return[r,t[n][1]]}}function Do(e){if(io[e]){PT.colorsID=e;PT.colors=io[e].colors;Nt.colorsID=e;Nt.colors=io[e].colors;return io[e].colors}return null}function Ao(e){return{_seed:e,_state:new Uint32Array(4),_initialized:false,_init:function(){if(this._initialized)return;let e=this._seed;this._state[0]=e>>>0;this._state[1]=e*1597>>>0;this._state[2]=e*3571>>>0;this._state[3]=e*6011>>>0;for(let e=0;e<20;e++){this._next()}this._initialized=true},_next:function(){const e=this._state[1]*5>>>0;const t=this._state[1]<<9;this._state[2]^=this._state[0];this._state[3]^=this._state[1];this._state[1]^=this._state[2];this._state[0]^=this._state[3];this._state[2]^=t;this._state[3]=(this._state[3]<<11|this._state[3]>>>21)>>>0;return e},random:function(min=0,max=1){if(!this._initialized)this._init();const e=this._next()/4294967296;return min+e*(max-min)},noise:function(e,t=0){let o=Math.sin(e*12.9898+t*78.233)*43758.5453;return o-Math.floor(o)},randomGaussian:function(e=0,t=1){let o=this.random();let r=this.random();let n=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*r);return e+n*t}}}function So(e,t,o){return floor(e.random(t,o))}function Io(e,t){return t[floor(e.random(0,t.length*.99))]}function Lo(e,min,max){if(arguments.length===1){max=min;min=0}return parseFloat(e.random(min,max).toFixed(2))}function Bo(e,t){return floor(random(e,t))}function vo(e){return e[floor(random(0,e.length*.99))]}function Wo(min,max){if(arguments.length===1){max=min;min=0}return parseFloat(random(min,max).toFixed(2))}function ko(e){let t=e.random(0,Math.PI*2);let o=Math.acos(e.random(-1,1));let r=Math.sin(o)*Math.cos(t);let n=Math.sin(o)*Math.sin(t);let l=Math.cos(o);return createVector(r,n,l)}function _o(e,t,o){let r=((t-e)%360+540)%360-180;return(e+r*o+360)%360}function zo(e){return noise(e)*2-1}function Xo(e){e=e.replace("#","");let t=parseInt(e.substring(0,2),16)/255;let o=parseInt(e.substring(2,4),16)/255;let r=parseInt(e.substring(4,6),16)/255;let max=Math.max(t,o,r);let min=Math.min(t,o,r);let n,l,a=max;let s=max-min;l=max===0?0:s/max;if(max===min){n=0}else{switch(max){case t:n=(o-r)/s+(o<r?6:0);break;case o:n=(r-t)/s+2;break;case r:n=(t-o)/s+4;break}n/=6}return[(n*360).toFixed(2),l.toFixed(2),a.toFixed(2)]}function Yo(e,t,o){e=e%360;t=Math.min(1,Math.max(0,t));o=Math.min(1,Math.max(0,o));let r=o*t;let n=r*(1-Math.abs(e/60%2-1));let l=o-r;let a,s,i;if(e>=0&&e<60){[a,s,i]=[r,n,0]}else if(e>=60&&e<120){[a,s,i]=[n,r,0]}else if(e>=120&&e<180){[a,s,i]=[0,r,n]}else if(e>=180&&e<240){[a,s,i]=[0,n,r]}else if(e>=240&&e<300){[a,s,i]=[n,0,r]}else{[a,s,i]=[r,0,n]}a=Math.round((a+l)*255);s=Math.round((s+l)*255);i=Math.round((i+l)*255);const c=a.toString(16).padStart(2,"0");const h=s.toString(16).padStart(2,"0");const p=i.toString(16).padStart(2,"0");return`#${c}${h}${p}`}function Oo(e,t){t=t!=undefined?t:4;let o=1/(1+exp(-t*(e-.4)));let r=1/(1+exp(-t*(e-.6)));return(o+r)/2}function Ro(e,t,o,r=1){let n=e;let l=t;let a=o;let s=r;return color(n,l,a,s)}function No(e){let t=e.random(TWO_PI);return createVector(cos(t),sin(t))}function Mo(e,t,o){let r=p5.Vector.lerp(e,t,.5);let n=p5.Vector.dist(e,t)/2;let l=atan2(e.y-r.y,e.x-r.x);let a=atan2(t.y-r.y,t.x-r.x);if(a>l){a-=TWO_PI}let s=lerp(l,a,o);let i=r.x+cos(s)*n;let c=r.y+sin(s)*n;return createVector(i,c)}const Ho=new Map;function Go(e){if(e instanceof p5.Color){return e}if(typeof e==="string"){if(Ho.has(e)){return Ho.get(e)}const t=color(e);Ho.set(e,t);return t}return color("black")}function Uo(e,t,o,r=1){const n=`hsv_${e}_${t}_${o}_${r}`;if(Ho.has(n)){return Ho.get(n)}const l=Ro(e,t,o,r);Ho.set(n,l);return l}function $o(){PT={};PT.plantType="woody";PT.container={type:"",height:120,maxBranchWidthidth:45};de=Bo(0,28);if(r==1){de=23}else if(r==2){de=24}n.顏色組=de;Do(de);qt=PT.colors.bg[0];PT.leafGrowType=vo([xo,Fo,Po]);PT={...PT,...er(),...Jo(),...Ko(),...Qo(),...qo(),spiral:jo()};if(r==1){PT={...PT,...wo}}else if(r==2){PT={...PT,...Vo}}return PT}function qo(){let e={};e.maxBranchWidth=300*q;e.branchWidth=Wo(.7,.9)*j;e.stemTexLine=random(0,1)>.9?1:0;e.branchColor=PT.colors.branch[0].map(Number);e.stemWidth=Wo(2,11);e.stemBend=Wo(3,8);e.stemLength=Wo(300,500);e.stemCount=vo([2,3,4,5]);if(random(0,1)>.5)e.branchFork=vo([1,2]);else e.branchFork=vo([2,2,3,3,4,5]);e.branchDepth=vo([0,1,1,2,2,3,4]);return e}function jo(){let e={baseRadius:Wo(4.5,6.5),baseFrequency:10,baseWidth:Wo(2,4),widthVariation:Wo(3.5,6),bendStrength:Wo(.5,1),twistFactor:Wo(.3,.6),noiseScale:Wo(.05,.15),noiseStrength:Wo(.5,2),color:PT.colors.vine[0].map(Number),maxLength:Wo(.5,1),radiusVariation:Wo(1,1.5),spiralTightness:Wo(.6,1),glowProbability:Wo(.05,.3),detailLevel:Wo(2,20),smoothness:Wo(1,10),leaf:{pointyness:Wo(.5,1.5),frequency:Wo(5,10),amplitude:Wo(.05,.1),shape:t=>{let o=pow(sin(PI*t),e.leaf.pointyness);let r=e.leaf.amplitude*cos(e.leaf.frequency*PI*t);return o*(1+r)},color:PT.colors.vine[0].map(Number),size:{length:Wo(30,70)*1.5*q,width:Wo(15,25)*q},veins:{type:Bo(2,2),density:Bo(2,5),spacing:Bo(2,4)}}};return e}function Jo(){let e={fruitSize:Wo(80,130)*q,fruitProb:Wo(.5,.9),fruitTypes:["apple","apple","apple","pinecone","raspberry","raspberry","buddhahand","buddhahand"],appleSize:Wo(4,22)*q,raspberrySize:Wo(20,80)*q,melonSize:Wo(15,20)*q,buddhahandSize:Wo(20,25)*q,buddhahandFingers:Bo(12,16),buddhahandCurvature:Wo(.5,1.5),buddhaHandTextureDetail:Bo(3,6),fruitColors:{pinecone:PT.colors.fruit[0].map(Number),apple:PT.colors.fruit[1].map(Number),raspberry:PT.colors.fruit[2].map(Number),buddhahand:[60,.8,.9]},layers:Bo(6,10),scalesPerLayer:Bo(5,10)};e.fruitstem=e.appleSize*Wo(3,5)*$;if(Wo(0,1)<.5){e.coneHeight=e.fruitSize*Wo(.7,1);e.coneRadius=e.fruitSize*Wo(.2,.3)}else{e.coneHeight=e.fruitSize*Wo(.5,1);e.coneRadius=e.fruitSize*.02}return e}function Ko(){let e={flowerProb:Wo(.5,.9),flowerPetal:vo([4,5,6,9]),sunflowerPetalCount:vo([6,8,12]),flowerWidthA:Wo(10,20)*q,flowerLengthA:Wo(80,120)*q,flowerLengthC:Wo(120,300)*.3*q,flowerShapeEdge:Wo(5,10),flowerShapeN:Wo(0,PI)*.01,flowerShapeFn:e=>pow(sin(PI*e),.3)};let t=vo([po.NATURAL,po.HEART,po.SLENDER,po.ROUND]);if(t==po.ROUND)e.flowerLengthA=e.flowerLengthA/2;e.flowerShape=fo[t](e);let o=[Wo(-.5,.5),Wo(5,10)];let r=[Wo(0,1)*PI,Wo(1,5)];let n=[Wo(0,1)*PI,Wo(5,15)];let l=[Wo(0,1)*.5,Wo(.8,1.2)];e.sunSize=vo([24,28,32])*q;e.flowerLengthB=max(Wo(5,15),e.flowerWidthA*.3)*q;e.flowerWidthB=max(vo([3,Wo(2,8)]),e.flowerWidthA*.4)*q;let a=Bo(0,PT.colors.flower.length/2)*2;Ut.flowerColorId=a;e.flowerColorA=PT.colors.flower[0].map(Number);e.flowerColorB=PT.colors.flower[1].map(Number);e.petalfType=vo([[1,1],[1,2],[3,2],[6,2],[7,2],[8,Bo(1,5)],[9,2],[10,4]]);let s=vo([uo.NOISE,uo.EDGE_GRADIENT,uo.REVERSE_EDGE_GRADIENT,uo.PEAK_GRADIENT,uo.SOLID_COLOR]);let i={seed:Wo(0,PI),frequency:Wo(1,5),amplitude:Wo(.5,1.5)};e.flowerColorFn=bo[s](i);Ut.flowerColorType=s;return e}function Qo(){let e={leafProb:vo([.2,.4,.6,.9]),veinsType:random(0,1)<.5?vo([[0,Bo(8,16)],[1,Bo(2,5)],[2,Bo(5,12)],[11,2]]):vo([[3,2],[4,0],[6,2],[5,2],[7,2],[8,Bo(1,5)],[9,2],[10,4],[11,2]]),veinsType2:vo([[10,2],[0,Bo(5,10)],[11,2],[4,2]]),leafLength:random(0,1)<.8?Wo(120,250)*q:Wo(250,400)*q,leafWidth:Wo(20,40)*q,leafHeartSize:Wo(6,12)*q,leafPointyness:Wo(.5,1.5),leafShapeEdge:Wo(10,20),leafShapeN:Wo(0,1)*PI};e.leafLength=constrain(e.leafLength,100,500);e.leafWidth=constrain(e.leafWidth,20,50);e.shapeName=vo([co.SIMPLE,co.QUILL,co.TRIANGLE,co.WAVE,co.JAGGED,co.HEART,co.GOURD,co.BAMBOO,co.FERN,co.HEART]);e.leafShape=ho[e.shapeName](e);Ke=e.veinsType;e.leafColorA=PT.colors.leaf[0].map(Number);e.leafColorB=PT.colors.leaf[1].map(Number);let t=[Wo(-.1,.1),Wo(3,5)];e.leafColorFn=e=>{let o=Oo(pow(e,1.5)+t[0],t[1]);return constrain(o,.1,.9)};return e}function Zo(){return{plantType:"grass",grassProb:Wo(.2,.7),grassLength:random(0,1)<.9?Wo(300,400)*q:Wo(400,600)*q,grassWidth:Wo(3,6)*q,grassShape:vo([e=>pow(atan(PI*(1-e)*map(noise(e*1e3),0,1,.5,1)),2),e=>pow(cos(PI*e/2),2)]),grassColor:PT.colors.grass[0].map(Number),stembenScale:vo([8,10,12])}}function er(){let e={};e.spikeProb=Wo(.5,.95);e.spikeCountRange=vo([1,3,5,8]);e.hasSpikesW=Wo(2,5);e.hasSpikesL=Wo(0,1)>.1?Wo(.2,.8):Wo(1,1.5);e.spikeColor=PT.colors.branch[1].map(Number);e.spikeColor2=PT.colors.branch[2].map(Number);return e}function tr(){let e=Bo(0,5);return{plantType:"mushroom",mushroomProb:Wo(.3,.6),mushroomColor:{cap:PT.colors.mushroom[e].map(Number),stem:PT.colors.mushroom[e].map(Number)},mushroomWidth:vo([Wo(1.5,3),Wo(1.5,3),Wo(1.5,3),Wo(3,5)]),mushroomHeight:Bo(60,160),capWidth:null,capHeight:Bo(10,30),mushroomLimit:ee.mushroom,mushroomCount:0}}function or(){let e=vo([mo.SHARP_UP,mo.SHARP_DOWN]);let t={seed:Wo(0,PI),frequency:Wo(1,5),amplitude:Wo(.5,1.5)};Nt.flowerOpenCurve=go[e](t);Ut.flowerOpenType=e}function rr(){let e=[Wo(-.5,.5),Wo(5,10)];let t=[Wo(0,1)*PI,Wo(1,5)];let o=[Wo(0,1)*PI,Wo(5,15)];let r=[Wo(0,1)*PI,Wo(1,5)];let n=[Wo(0,1)*.5,Wo(.8,1.2)];let l=[function(e,t){return e<.1?2+t*o[1]:noise(e*10,o[0])},function(e,t){return e<n[0]?0:10-e*map(t,0,1,16,20)*n[1]},function(e,o){return sin(e*PI*t[1])*o*n[1]}];return vo(l)}function nr(){const e={width:m.dim*m.ratio,height:m.dim};const t={pgL4:{needsFont:false},pgL3:{needsFont:false},pgL1:{needsFont:false},pgL2:{needsFont:false},pgL0:{needsFont:false},pgBg:{needsFont:true,fontSize:60},pgText:{needsFont:true,fontSize:10,align:[LEFT,TOP]},pgFinal:{needsFont:false},pgTex:{needsFont:false},pgFrame:{needsFont:false},snapShotImg:{needsFont:false}};Object.entries(t).forEach((([t,o])=>{let r;r=createGraphics(e.width,e.height);ve[t]=r;r.colorMode(HSB,360,1,1,1);r.strokeJoin(ROUND);r.strokeCap(SQUARE);r.noStroke();window[t]=r}));Tt=Array.from({length:M},(()=>createGraphics(e.width,e.height)))}function lr(){let e={};e.leafColorA=[PT.colors.leaf[0][0],PT.colors.leaf[0][1],PT.colors.leaf[0][2]];e.leafColorB=[PT.colors.leaf[1][0],PT.colors.leaf[1][1],PT.colors.leaf[1][2]];e.branchColor=[PT.colors.branch[0][0],PT.colors.branch[0][1],PT.colors.branch[0][2]];e.vineColor=[PT.colors.vine[0][0],PT.colors.vine[0][1],PT.colors.vine[0][2]];e.fruitColors={pinecone:[PT.colors.fruit[0][0],PT.colors.fruit[0][1],PT.colors.fruit[0][2]],apple:[PT.colors.fruit[1][0],PT.colors.fruit[1][1],PT.colors.fruit[1][2]],raspberry:[PT.colors.fruit[2][0],PT.colors.fruit[2][1],PT.colors.fruit[2][2]],buddhahand:[60,.8,.9]};e.flowerColorA=[PT.colors.flower[0][0],PT.colors.flower[0][1],PT.colors.flower[0][2]];e.flowerColorB=[PT.colors.flower[1][0],PT.colors.flower[1][1],PT.colors.flower[1][2]];e.grassColor=[PT.colors.grass[0][0],PT.colors.grass[0][1],PT.colors.grass[0][2]];if(PT.colors&&PT.colors.branch){e.spikeColor=[PT.colors.branch[1][0],PT.colors.branch[1][1],PT.colors.branch[1][2]];e.spikeColor2=[PT.colors.branch[2][0],PT.colors.branch[2][1],PT.colors.branch[2][2]]}else{e.spikeColor=[0,0,0];e.spikeColor2=[0,0,0]}return e}function ar(e){let t=Qo();Nt.leafShape=t.leafShape;Nt.leafProb=t.leafProb;Nt.veinsType=t.veinsType;Nt.leafLength=t.leafLength;Nt.leafWidth=t.leafWidth;Nt.leafHeartSize=t.leafHeartSize;Nt.leafPointyness=t.leafPointyness;Nt.leafShapeEdge=t.leafShapeEdge;Nt.leafShapeN=t.leafShapeN;Nt.leafColorA=t.leafColorA;Nt.leafColorB=t.leafColorB;Nt.leafColorFn=t.leafColorFn}function sr(e){let t=Ko();Nt.flowerProb=t.flowerProb;Nt.flowerPetal=t.flowerPetal;Nt.flowerWidthA=t.flowerWidthA;Nt.flowerLengthA=t.flowerLengthA;Nt.flowerWidthB=t.flowerWidthB;Nt.flowerLengthB=t.flowerLengthB;Nt.flowerLengthC=t.flowerLengthC;Nt.flowerShapeEdge=t.flowerShapeEdge;Nt.flowerShapeN=t.flowerShapeN;Nt.flowerShapeFn=t.flowerShapeFn;Nt.flowerShape=t.flowerShape;Nt.flowerColorA=t.flowerColorA;Nt.flowerColorB=t.flowerColorB;Nt.flowerColorFn=t.flowerColorFn;Nt.sunflowerPetalCount=t.sunflowerPetalCount;Nt.sunSize=t.sunSize}function ir(e){let t=Jo();Nt.fruitSize=t.fruitSize;Nt.fruitColors=t.fruitColors;Nt.fruitProb=t.fruitProb;Nt.fruitTypes=t.fruitTypes;Nt.seedType=t.seedType;Nt.appleSize=t.appleSize;Nt.fruitstem=t.fruitstem;Nt.layers=t.layers;Nt.scalesPerLayer=t.scalesPerLayer;Nt.coneHeight=t.coneHeight;Nt.coneRadius=t.coneRadius;Nt.buddhaHandSize=t.buddhaHandSize;Nt.buddhaHandFingers=t.buddhaHandFingers;Nt.buddhaHandCurvature=t.buddhaHandCurvature;Nt.buddhaHandTextureDetail=t.buddhaHandTextureDetail}function cr(){let e=qo();Nt.branchWidth=e.branchWidth;Nt.branchDepth=e.branchDepth;Nt.branchColor=e.branchColor;Nt.branchFork=e.branchFork}function hr(){let e=er();Nt.spikeProb=e.spikeProb;Nt.hasSpikesW=e.hasSpikesW}function pr(){let e=Ao($t);if(jt==0||jt==3)Le=Io(e,[0,1,2,3,4]);else Le=Io(e,[0,1,2]);if(jt==0&&dt)Le=5;n.外框類型=Le;eo=e.random(.105,.12);pgFrame.rectMode(CENTER);pgFrame.noFill();if(Le==0||Le==1||Le==3)pgFrame.stroke(Se[0][0],Se[0][1],Se[0][2],1);else if(Le==2||Le==4)pgFrame.stroke(Se[0][0],Se[0][1]*.8,Se[0][2]*.9,1);if(Le==0)eo=.1,pgFrame.strokeWeight(width*(eo+.02));else if(Le==1)eo=.1,pgFrame.strokeWeight(width*eo);else if(Le==2)eo=.08,pgFrame.strokeWeight(width*eo);else if(Le==3)eo=.1,to=.51,pgFrame.strokeWeight(width*eo);else if(Le==4)eo=.1,to=.505,pgFrame.strokeWeight(width*eo);pgFrame.rect(width/2,height/2,width,height);pgFrame.strokeWeight(2);if(Le==0){pgFrame.stroke(Ie[0],Ie[1],Ie[2],.8);ur(width/2,height/2,width-width*eo,height-width*eo,-.15,1.5);ur(width/2,height/2,width-width*(eo+.02),height-width*(eo+.02),-.2,3)}else if(Le==1){pgFrame.stroke(Ie[0],Ie[1],Ie[2],.8);ur(width/2,height/2,width-width*.1,height-width*.1,-.2,3)}else if(Le==2){pgFrame.stroke(Ie[0],Ie[1],Ie[2],.8);ur(width/2,height/2,width-width*eo,height-width*eo,-.2,3)}else if(Le==3){pgFrame.translate(height/2,height/2);pgFrame.fill(Se[0][0],Se[0][1],Se[0][2],1);pgFrame.push();Vr(.9);pgFrame.rotate(HALF_PI);Vr(.9);pgFrame.rotate(HALF_PI);Vr(.9);pgFrame.rotate(HALF_PI);Vr(.9);pgFrame.pop();pgFrame.strokeWeight(2);pgFrame.stroke(Ie[0],Ie[1],Ie[2],.8);dr(height*.9*.5,-.1,2);dr(height*.9*to,-.2,3.5)}else if(Le==4){pgFrame.translate(height/2,height/2);pgFrame.fill(Se[0][0],Se[0][1]*.8,Se[0][2]*.9,1);pgFrame.push();Vr(.9);pgFrame.rotate(HALF_PI);Vr(.9);pgFrame.rotate(HALF_PI);Vr(.9);pgFrame.rotate(HALF_PI);Vr(.9);pgFrame.pop();pgFrame.strokeWeight(2);pgFrame.stroke(Ie[0],Ie[1],Ie[2],.8);pgFrame.strokeWeight(2);pgFrame.stroke(Ie[0],Ie[1],Ie[2],.8);dr(height*.9*.5,-.15,3.5);dr(height*.9*to,-.2,2)}gr(eo);Fr(to)}function fr(e=100){const t=[];const o=.005;for(let r=0;r<TAU;r+=o){const o=1;t.push(new createVector(cos(r)*e*o,sin(r)*e*o))}return t}function dr(e,t=-.15,o=3){let r=fr(e);pgFrame.push();const n=1;for(let e=0;e<r.length-1;e++){const l=t;const a=(noise(e*n,random(0,500)*.05)+l)*o;const s=r[e];const i=r[e+1];pgFrame.strokeWeight(a>.5?a:random(0,1)>.8?0:0);pgFrame.line(s.x,s.y,i.x,i.y)}pgFrame.pop()}function mr(e,t){const o=[];const r=.5;for(let n=-e/2;n<=e/2;n+=r){o.push(new createVector(n,-t/2))}for(let n=-t/2;n<=t/2;n+=r){o.push(new createVector(e/2,n))}for(let n=e/2;n>=-e/2;n-=r){o.push(new createVector(n,t/2))}for(let n=t/2;n>=-t/2;n-=r){o.push(new createVector(-e/2,n))}return o}function ur(e,t,o,r,n=-.15,l=3){let a=mr(o,r);pgFrame.push();pgFrame.translate(e,t);const s=1;for(let e=0;e<a.length-1;e++){const t=n;const o=(noise(e*s,frameCount*.05)+t)*l;const r=a[e];const i=a[e+1];pgFrame.strokeWeight(o>.5?o:random(0,1)>.8?0:0);pgFrame.line(r.x,r.y,i.x,i.y)}pgFrame.pop()}function gr(){if(Le>2)return;pgFrame.push();pgFrame.stroke(Ie[0],Ie[1],Ie[2],.3);let e=M;let t=5;let o=width*(eo/2);let r=width*(1-eo/2);let n=(r-o)/e;for(let e=0;e<=M;e++){let r=o+e*n;let l=height-width*(eo/2)+2;if(e%5==0)pgFrame.strokeWeight(1),pgFrame.line(r,l+2,r,l+4+t);else pgFrame.strokeWeight(.5),pgFrame.line(r,l+2,r,l+2+t)}pgFrame.pop()}function br(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Ie[0],Ie[1],Ie[2],random(.05,.15));let e=width*(1-eo/4)/M;let t=height-width*eo/4;let o=O/M;let r=width*eo/3+e*O;let n=r+e;pgFrame.ellipse(r,t,2)}function yr(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Ie[0],Ie[1],Ie[2],random(.05,.15));let e=width*(1-eo/4)/M;let t=height-width*eo/4;let o=O/M;let r=width*eo/3+e*O;let n=r+e;pgFrame.ellipse(r,t,2)}function xr(){pgFrame.strokeWeight(random(.3,.6));pgFrame.stroke(Ie[0],Ie[1],Ie[2],random(.05,.15));let e=width*(1-eo)/M;let t=height-width*(eo/2)+7;let o=O/M;let r=width*eo/2+e*O;let n=r+e;wr(r,t,n,t)}function Fr(){if(Le<3)return;pgFrame.push();pgFrame.translate(0,0);let e=height*.91*to;let t=PI/2;let o=PI*2*.75;for(let r=0;r<M;r++){let n=map(r,0,M-1,t,o);let l=cos(n)*e;let a=sin(n)*e;let s=cos(n)*(e-(r%5==0?9:5));let i=sin(n)*(e-(r%5==0?9:5));pgFrame.stroke(Ie[0],Ie[1],Ie[2],.01);pgFrame.line(l,a,s,i)}pgFrame.pop()}function Pr(){if(Le<3)return;pgFrame.push();pgFrame.translate(0,0);pgFrame.stroke(0,0,0,.5);let e=height*.91*to;let t=O/(M-1);let o=PI*2*.75;let r=map(t,0,1,PI*2*.75,PI/2);let n=.03;for(let t=o;t>r;t-=n){let o=cos(t)*e;let r=sin(t)*e;let l=cos(t-n)*e;let a=sin(t-n)*e;wr(o,r,l,a,-.2,2)}pgFrame.pop()}function wr(e,t,o,r,n=-.1,l=2){pgFrame.push();const a=1;const s=[];const i=dist(e,t,o,r);const c=1;for(let n=0;n<=i;n+=c){const l=n/i;const a=lerp(e,o,l);const c=lerp(t,r,l);s.push(createVector(a,c))}for(let e=0;e<s.length;e++){const t=n;const o=(noise(e*a,frameCount*.05)+t)*l;if(o>.5){pgFrame.strokeWeight(o);pgFrame.point(s[e].x,s[e].y)}}pgFrame.pop()}function Vr(e=.95){let t=height/2*e;pgFrame.noStroke();pgFrame.beginShape();pgFrame.vertex(-t,-t);pgFrame.vertex(0,-t);let o=-t*.552284749831;pgFrame.bezierVertex(o,-t,-t,o,-t,0);pgFrame.endShape()}async function Cr(){if(!Jn||!Jn.paths||!Array.isArray(Jn.paths)||!Jn.dots||!Array.isArray(Jn.dots)){console.error("JSON 数据格式错误，缺少必要的 paths 或 dots 数组");return}const e=Jn;allPaths=[];Qt={segments:[],dots:[]};for(let t=0;t<e.paths.length;t++){let o=e.paths[t];if(!Array.isArray(o)||o.length<2){console.warn(`路径 ${t} 无效或点数不足，跳过此路径`);continue}let r=true;for(let e of o){if(e.x===undefined||e.y===undefined){console.warn(`路径 ${t} 中有无效点，跳过此路径`);r=false;break}}if(!r)continue;allPaths.push(o.map((e=>createVector(e.x,e.y))));let n=0;for(let e=0;e<o.length-1;e++){let t=o[e];let r=o[e+1];let l=dist(t.x,t.y,r.x,r.y);n+=l}n=map(n,0,500,0,width);let l=[];for(let e=0;e<o.length;e++){if(e===0){l.push(0)}else{let t=o[e-1];let r=o[e];let n=atan2(r.y-t.y,r.x*m.ratio-t.x*m.ratio);l.push(n)}}for(let e=0;e<o.length-1;e++){let r=o[e];let l=o[e+1];let a=atan2(l.y-r.y,l.x*m.ratio-r.x*m.ratio);let s=dist(r.x*m.ratio,r.y,l.x*m.ratio,l.y);s=map(s,0,500,0,m.dim)*random(.95,1.05);let i=a+1.57;let c=Mt.branchWidth*random(.8,1.2);Qt.segments.push({startPoint:r,endPoint:l,baseX:r.x,baseY:r.y,baseRotation:createVector(PI/2,0,i),branchLength:s,branchWidthFunc:c,maxBranchDepth:Mt.branchDepth,col:Mt.branchColor,forkCount:Mt.branchFork,maxBranchWidth:Mt.maxBranchWidth,meta:Mt,twistIntensity:0,stemTexLine:1,pathIndex:t,pathTotal:n})}}let t=e.dots;let o=t.filter((e=>e.x!==undefined&&e.y!==undefined));if(o.length!==t.length){console.warn(`有 ${t.length-o.length} 个无效点被过滤`)}singlePoints=o.map((e=>createVector(e.x,e.y)));for(let e=0;e<o.length;e++){Qt.dots.push({baseX:o[e].x,baseY:o[e].y})}}function Tr(){if(window.location.hash){return}const e=new URLSearchParams(window.location.search);if(!e.has("useCommentData")){return}const t=document.getElementsByTagName("script");for(let e=0;e<t.length;e++){const o=t[e];if(!o.src||!o.src.includes("sketch.js")){continue}const r=new XMLHttpRequest;r.open("GET",o.src,false);r.send();if(r.status!==200){console.error("无法加载脚本内容");return}const n=r.responseText;const l=n.match(/\/\/#data_([^\r\n]+)/);if(!l){return}const a=l[1].trim().split(" ")[0];window.location.hash="#data_"+a;return}}window.onload=function(){Tr()};function Er(){try{const e=window.location.hash;if(e&&e.includes("#data_")){let t=e.split("#data_")[1];if(t.includes("&")){t=t.split("&")[0]}if(t.includes("#")){t=t.split("#")[0]}if(t.includes("?")){t=t.split("?")[0]}t=decodeURIComponent(t);console.log("成功解码URL参数，数据为:",t);const o=Ar(t);if(o){const e={paths:o.paths.map((e=>e.map((e=>({x:e.x,y:e.y}))))),dots:o.dots.map((e=>({x:e.x,y:e.y})))};console.log("最终JSON结构:",JSON.stringify(e,null,2));return e}try{let e;try{e=atob(t)}catch(o){console.error("base64解码失败，尝试直接解析JSON:",o);e=t}const o=JSON.parse(e);console.log("使用标准JSON格式解码");if(o.p&&Array.isArray(o.p)){const e=o.p.map(Dr);const t=e.map((e=>e.map((e=>({x:e.x,y:e.y})))));console.log(`已加载 ${e.length} 条路径 (JSON格式)`);let r=[];if(o.d&&Array.isArray(o.d)){r=o.d.map((e=>({x:e[0],y:e[1]})));console.log(`已加载 ${r.length} 个点`)}const n={paths:t,dots:r};console.log("最终JSON结构:",JSON.stringify(n,null,2));return n}else if(o.paths&&Array.isArray(o.paths)){console.log(`已加载 ${o.paths.length} 条旧格式路径`);console.log("最终JSON结构:",JSON.stringify(o,null,2));return o}}catch(e){console.warn("JSON解析失败")}}}catch(e){console.warn("解析URL数据失败:",e)}return null}function Dr(e){if(!e.length)return[];const t=[];let o=e[0][0];let r=e[0][1];t.push(createVector(o,r));for(let n=1;n<e.length;n++){o+=e[n][0];r+=e[n][1];t.push(createVector(o,r))}return t}function Ar(e){try{if(!e||e.length<5){console.log("数据太短，无法解析为有效的二进制格式");return null}let t;try{const o=e.replace(/-/g,"+").replace(/_/g,"/");t=atob(o)}catch(e){console.error("二进制解码失败",e);return null}if(t.length<2){console.log("解码后数据太短，无法包含有效信息");return null}let o=0;const r=t.charCodeAt(o++);if(r===undefined||o>=t.length){console.log("无法读取路径数量或数量为0");return null}const n=[];for(let e=0;e<r;e++){if(o>=t.length){console.log("数据不完整，无法读取所有路径");return{paths:n,dots:[]}}const e=t.charCodeAt(o++);if(e===undefined||e<1||o>=t.length){console.log("无效的点数量");continue}let r=[];let l=0,a=0;let s=e>2;let i=true;let c=null;for(let h=0;h<e;h++){if(o+1>=t.length){console.log("数据不完整，无法读取所有点");if(r.length>0){n.push(r)}return{paths:n,dots:[]}}if(h===0){const e=t.charCodeAt(o++)*2;const n=t.charCodeAt(o++)*2;l=e;a=n;r.push(createVector(e,n))}else{const e=t.charCodeAt(o++);const n=t.charCodeAt(o++);const p=e-128;const f=n-128;if(s&&h>1){const e=r[h-1].x-r[h-2].x;const t=r[h-1].y-r[h-2].y;if(h===2){c={dx:e,dy:t}}if(c){const e=Math.sign(p)===Math.sign(c.dx)&&Math.sign(f)===Math.sign(c.dy);if(!e){i=false}}}l+=p;a+=f;r.push(createVector(l,a))}}if(r.length>=2){if(s&&i&&r.length>2){const e=r[0].copy();const t=r[r.length-1].copy();r=[e,t]}n.push(r)}else{console.log("路径点数不足，已忽略")}}const l=[];if(o<t.length){try{const e=t.charCodeAt(o++);if(e>0&&e<100){console.log(`开始解析${e}个独立点`);for(let r=0;r<e;r++){if(o+1>=t.length){console.log(`数据不足，无法解析第${r+1}个点`);break}const e=t.charCodeAt(o++)*2;const n=t.charCodeAt(o++)*2;if(e>0&&e<500&&n>0&&n<500){l.push(createVector(e,n));console.log(`添加有效独立点: (${e}, ${n})`)}else{console.log(`忽略超出画布范围的点: (${e}, ${n})`)}}}}catch(e){console.error("解析独立点时出错",e)}}if(n.length>0||l.length>0){const e={paths:n,dots:l};const t={paths:n.map((e=>({length:e.length,first:e.length>0?{x:e[0].x,y:e[0].y}:null,last:e.length>0?{x:e[e.length-1].x,y:e[e.length-1].y}:null}))),dots:l.map((e=>({x:e.x,y:e.y})))};return e}else{console.log("解压结果无有效数据");return null}}catch(e){console.error("二进制解码失败",e);return null}}{function Sr(){pgL0.clear();pgL1.clear();pgL2.clear();pgL3.clear();pgL4.clear();pgText.clear();pgFinal.clear()}function Ir(){if(!Ct||Ct.length===0){console.warn("yPositions 為空或未定義");return}At=[...Ct].sort(((e,t)=>{if(abs(e.y-t.y)<.001){return e.index-t.index}return e.y-t.y}));$n();if(!ke){ke=createGraphics(m.dim*m.ratio,m.dim)}ke.clear();for(let e of At){if(Tt[e.index]){ke.image(Tt[e.index],0,0)}}}function Lr(){pgFinal.image(pgL0,0,0);if(so==0){pgFinal.image(pgL1,0,0);pgFinal.image(pgL2,0,0)}else if(so==1){pgFrame.push();if(Le==3||Le==4)pgFrame.translate(-width/2,-height/2);pgFrame.image(pgL1,0,0);pgFrame.image(pgL2,0,0);pgFrame.pop()}pgFinal.image(pgL3,0,0);pgFinal.image(pgL4,0,0);pgFinal.image(pgText,0,0);if(!Tt[O]){Tt[O]=createGraphics(m.dim*m.ratio,m.dim);Tt[O].PLANT=Gt.PLANT}Tt[O].image(pgFinal,0,0);Ct[O]={y:constrain(oe,0,m.dim),index:O};Ir()}function Br(){for(let e of Tt){if(e){e.remove()}}Tt=[];Dt=[];St.clear();Ct=[];Et=[];At=[];O=0;R=0;H=false;G=false;if(We){We.remove()}if(ke){ke.remove()}}}{function vr(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,meta:n=e.PT||{},benScale:l=10}=e;let a=[];let s=vo([[3,2],[4,2],[5,2],[8,2],[9,2],[8,2]]);let i=0;for(let e=0;e<ee.grass;e++){if(random(0,1)<n.grassProb&&n.grassCount<ee.grass){n.grassCount++;let a=random(1.2,3)*q;let c=o+random(-15,15);let h=r+random(-15,15);let p=(e,0,ee.grass,2,l);i++;E.leaf({pg:t,veinsType:s,baseX:c,baseY:h,col:[n.grassColor[0],n.grassColor[1],n.grassColor[2],1],baseRotation:createVector(PI/2+random(-.5,.5),random(-1,1)*PI,0),branchLength:n.grassLength*random(.8,1.5),branchWidthFunc:function(e){return n.grassShape(e)*n.grassWidth*a},branchBendFunc:function(t){return createVector(map(noise(t*2,e),0,1,-1,1)*p,0,map(noise(t*2,e+PI),0,1,-1,1)*p)}})}}return a}function Wr(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,PT:n=e.PT||{},capWidth:l=e.capWidth}=e;if(!Gt||!Gt.PT){console.error("eachPlant or eachPlant.PT is undefined");return[]}let a=[];for(let e=0;e<ee.mushroom;e++){if(random(0,1)<Gt.PT.mushroomProb&&Gt.PT.mushroomCount<ee.mushroom){kr({pg:t,baseX:o+random(-5,5),baseY:r+random(-5,5),M:n,capWidth:l});Gt.PT.mushroomCount++}}return a}function kr(e={}){let{pg:t,baseX:o,baseY:r,M:n=e.M||{},capWidth:l=n.capWidth,capHeight:a=n.capHeight,baseWidth:s=n.mushroomWidth,mushroomHeight:i=n.mushroomHeight,col:c=n.mushroomColor,strokeStrength:h=1,lineSegScale:p=vo([.05,.2,1,5]),lineLimit:f=vo([.4,.95,.1]),pointShift:d=3}=e;let m=Ao($t);h=h+m.random(0,1)*2;d=10*we;let u=[];let g=i-a;let b=random(0,1)>.5;let y=[random(-1,1),random(-2,2),random(-1,1)];const x=(e=true)=>{const n={pg:t,baseX:o,baseY:r,baseRotation:createVector(PI/2,y[0],0),branchLength:g,col:[Mt.colors.mushroom[0][0],Mt.colors.mushroom[0][1],Mt.colors.mushroom[0][2],1],branchWidthFunc:e=>{let t=1-pow(1-e,.2);let o=noise(e*3)*2+.5;let r=sin(e*PI*3)*.1+1;return s*(1.2-t)*o*r},branchBendFunc:e=>createVector(y[1],y[2],0),branchSegmentsH:3,closeS:true,curveS:false,mushroomStroke:true};return T.stem(n)};let F=x();let P=F.centerPos[F.centerPos.length-1];let w=random(.5,3);let V=random(0,1)>.5;let C=createVector(0,0,0);let E=[];let D=16;for(let e=0;e<D;e++){E.push({x:random(-2,2),y:random(1,2),z:random(-2,2)})}let A;if(random(0,1)<Xt)A=Mt.colors.stroke[2];else A=Mt.colors.stroke[0];if(ye==0)A=[0,0,1];const S=(e,n=false)=>{let s=createVector(e.x,e.y+7,e.z);let i=createVector(0,0,0);let p=[s.copy()];let f=[];let m=[];let u=D;let g=e=>createVector(sin(e*PI)*random(-2,2)*w,-cos(e*PI)*random(1,2),cos(e*PI)*random(-2,2)*w);let b=(e,t)=>{let o=l*sin(e*PI);let r=noise(e*5)*.3;if(V){t=t==="left"?"right":"left"}return t==="left"?o*(1-r):o*(1+r)};for(let e=0;e<u;e++){let l=e/(D-1);let h=createVector(sin(l*PI)*E[e].x,-cos(l*PI)*E[e].y,cos(l*PI)*E[e].z);i.add(p5.Vector.mult(h,1/D));let d=createVector(0,-a/D,0);let u=Co.applyEulerRotation(d,i);s.add(u);let g=b(l,"left");let y=b(l,"right");if(n){if(l<.5){let e=map(l,0,.5,-.5,1);let t=sin(map(e,0,1,PI/2,PI));g*=t;y*=t}if(l>.5)continue}let x=Co.applyEulerRotation(createVector(-g,0,0),i);let F=Co.applyEulerRotation(createVector(y,0,0),i);f.push(p5.Vector.add(s,x));m.push(p5.Vector.add(s,F));p.push(s.copy());if(e>0){let l;let a;let s;if(n){l=c.cap[0];a=c.cap[1];s=c.cap[2]}else{l=c.cap[0];a=c.cap[1];s=c.cap[2]*.7}Ln({pg:t,pts:[f[e],f[max(e-2,0)],p[max(e-2,0)],p[e]],baseX:o,baseY:r,doFill:true,doStr:false,col:Ro(l,a,s,1),randomOffset:1,vertexMode:st});Ln({pg:t,pts:[m[e],m[max(e-2,0)],p[max(e-2,0)],p[e]],baseX:o,baseY:r,doFill:true,doStr:false,col:Ro(l,a,s,1),randomOffset:1,vertexMode:st})}}if(!n){Bn({pg:t,pts:f.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-d,d);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(A[0],A[1],A[2],1),branchWidthFunc:e=>(.15*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*h*Pe});Bn({pg:t,pts:m.map((e=>{let t=map(noise(e.x*K,e.y*K,frameCount),0,1,-d,d);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(A[0],A[1],A[2],1),branchWidthFunc:e=>(.15*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*h*Pe})}else if(n){let n=5;for(let l=0;l<n;l++){let a=floor(map(l,0,n-1,f.length*.1,f.length*.9));if(a>=0&&a<f.length){let n=f[a];let s=m[a];let i=createVector(e.x,e.y-5,e.z);let c=[];let h=[];let p=10;for(let e=0;e<=p;e++){let t=e/p;let o=lerp(n.x,i.x,t);let r=lerp(n.y,i.y,t);let a=lerp(n.z,i.z,t);let s=sin(t*PI)*noise(t*5+l)*5;o+=s*noise(t*3+l*10);r+=s*noise(t*3+l*20);c.push(createVector(o,r,a))}for(let e=0;e<=p;e++){let t=e/p;let o=lerp(s.x,i.x,t);let r=lerp(s.y,i.y,t);let n=lerp(s.z,i.z,t);let a=sin(t*PI)*noise(t*5+l+100)*5;o+=a*noise(t*3+l*10+100);r+=a*noise(t*3+l*20+100);h.push(createVector(o,r,n))}Bn({pg:t,pts:c,branchWidthFunc:e=>{let t=1;let o=noise(e*5+l*10)*.5+.5;let r=sin(e*PI);let n=1-pow(abs(e-.5)*2,2);return t*r*o*n},doFill:true,baseX:o,baseY:r,col:Ro(A[0],A[1],A[2],.5)});Bn({pg:t,pts:h,branchWidthFunc:e=>{let t=1;let o=noise(e*5+l*10+100)*.5+.5;let r=sin(e*PI);let n=1-pow(abs(e-.5)*2,2);return t*r*o*n},doFill:true,baseX:o,baseY:r,col:Ro(A[0],A[1],A[2],.5)})}}Bn({pg:t,pts:f.map((e=>{let t=map(noise(e.x*K,e.y*K),0,1,-d,d);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,doFill:true,col:Ro(A[0],A[1],A[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*h*Pe});Bn({pg:t,pts:m.map((e=>{let t=map(noise(e.x*K,e.y*K),0,1,-d,d);let o=map(noise(e.y*K,e.x*K,frameCount),0,1,-d,d);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,doFill:true,col:Ro(A[0],A[1],A[2],1),branchWidthFunc:e=>(.2*(1-e)*map(noise(e*10),0,1,.5,1)+.2)*h*Pe})}return{leftPos:f,rightPos:m,centerPos:p}};if(b){t.push();x(true);let e=S(P);Yr(t,o,r,l,a,e.leftPos,e.rightPos,e.centerPos,c.cap);t.pop()}else{t.push();let e=x(false);let n=e.centerPos[e.centerPos.length-1];let s=S(n,false);Yr(t,o,r,l,a,s.leftPos,s.rightPos,s.centerPos,c.cap);S(n,true);x(true);t.pop()}return u}function _r(e,t){let o=false;for(let r=0,n=t.length-1;r<t.length;n=r++){let l=t[r].x,a=t[r].y;let s=t[n].x,i=t[n].y;let c=a>e.y!==i>e.y&&e.x<(s-l)*(e.y-a)/(i-a)+l;if(c)o=!o}return o}function zr(e,t){let o=null;let r=Infinity;for(let n=0,l=t.length-1;n<t.length;l=n++){let a=t[l];let s=t[n];let i=createVector(s.x-a.x,s.y-a.y);let c=createVector(e.x-a.x,e.y-a.y);let h=i.magSq();if(h===0){let t=dist(e.x,e.y,a.x,a.y);if(t<r){r=t;o=createVector(a.x,a.y)}continue}let p=c.dot(i);let f=constrain(p/h,0,1);let d=createVector(a.x+f*i.x,a.y+f*i.y);let m=dist(e.x,e.y,d.x,d.y);if(m<r){r=m;o=d}}return o||createVector(e.x,e.y)}function Xr(e,t){for(let o of e){if(!_r(o,t)){let e=zr(o,t);o.x=e.x;o.y=e.y}}return e}function Yr(e,t,o,r,n,l,a,s,i){const c=random(10,15);let h=[];for(let r=0;r<c;r++){let r,c,p,f,d,m,u;let g=20;let b=50;let y=0;let x=false;while(!x&&y<b){r=floor(random(1,s.length-1));c=s[r];p=random(-n*2,n*2);f=random(-n*.5,n*.5);d=random(1,6);m=t+c.x+p;u=o+c.y+f;x=true;for(let e of h){let t=dist(m,u,e.x,e.y);if(t<g){x=false;break}}y++}if(!x)continue;h.push({x:m,y:u});let F=[];let P=random(.5,1.5);let w=random(.5,1.5);for(let e=0;e<60;e++){let t=e/60*TWO_PI;let o=noise(cos(t)*1.5,sin(t)*1.5)*.2+.9;let r=m+cos(t)*d*o*P;let n=u+sin(t)*d*o*w;F.push(createVector(r,n))}let V=[];for(let e=0;e<l.length;e++){V.push({x:t+l[e].x,y:o+l[e].y})}for(let e=a.length-1;e>=0;e--){V.push({x:t+a[e].x,y:o+a[e].y})}F=Xr(F,V);Ln({pg:e,pts:F,doFill:true,col:Ro(i[0],i[1]*random(.8,1.2),i[2]*random(.8,1.2),1),randomOffset:2,n:5});let C;if(random(0,1)<Xt)C=Mt.colors.stroke[2];else C=Mt.colors.stroke[0];Bn({pg:e,pts:F,doFill:true,col:Ro(C[0],C[1],C[2],1),branchWidthFunc:e=>(.3*(1-e)*map(noise(e*10),0,1,.5,1)+.3)*Pe,randomOffset:1,n:5})}}function Or(e,t,o){let r=random(.1,.5);let n=random(random(0,1))*vo([1,-1])*width*.4;let l=random(random(0,1))*vo([1,-1])*height*.4;Gr({pg:pgL4,baseX:e+n,baseY:t+l,size:r,bodyColor:[o.colors.butterfly[0][0],o.colors.butterfly[0][1],o.colors.butterfly[0][2]*random(.6,1.2),1],wingColor:[o.colors.butterfly[1][0]*random(.9,1.1),o.colors.butterfly[1][1],o.colors.butterfly[1][2]*random(.9,1.1),1]})}function Rr(e,t,o){let r=random(.1,.5);let n=random(random(0,1))*vo([1,-1])*width*.4;let l=random(random(0,1))*vo([1,-1])*height*.4;Ur({pg:pgL4,baseX:e+n,baseY:t+l,size:r,bodyColor:[o.colors.butterfly[0][0],o.colors.butterfly[0][1]*.8,o.colors.butterfly[0][2]*random(.8,1.2),1],wingColor:[0,0,random(.6,1),.3]})}function Nr(e,t,o){let r=random(.2,.4);let n=random(random(0,1))*vo([1,-1])+random(-10,10);let l=random(random(0,1))*vo([1,-1])+random(-10,10);Mr({pg:pgText,baseX:e+n,baseY:t+l,size:r,bodyColor:vo([Mt.colors.stroke[1],Mt.colors.stroke[2]]),spotColor:Mt.colors.stroke[0],rotation:TWO_PI*.75+random(-1.5,1.5),ratio:random(.4,.8)})}function Mr(e={}){const{pg:t,baseX:o,baseY:r,size:n=1,bodyColor:l=[0,1,.5,1],spotColor:a=[0,0,.1,1],rotation:s=TWO_PI*.75,ratio:i=.5}=e;let c=30*n;let h=c*2*i;let p=o;let f=r;let d=s;let m=100;let u=100;let g=random(.05,.4);let b=vo([.02,.15,.25,.4]);let y=int(map(b,.02,.15,90,80));let x=random(.8,1.2);let F=n<1?1/n*1:1;let P=h*1.2;let w=i*2;function V(e,t,o,r=0){let l=[];let a=r;let s=0;for(let r=0;r<t.length;r++){let i=e+o[r];a+=cos(i)*t[r]*(c/30)*n*F;s+=sin(i)*t[r]*(c/30)*n*F;l.push([a,s])}return l}function C(e,t,o,r=0){let l=[];let a=r;let s=0;for(let r=0;r<t.length;r++){let i=e+o[r];a+=cos(i)*t[r]*(c/30)*n*F;s+=sin(i)*t[r]*(c/30)*n*F;l.push([a,s])}return l}let T=[{baseAngle:-PI*.45,lengths:[10,10*w,10*w],angles:[0,PI*.25,-PI*.15],offsetX:P*1.6},{baseAngle:-PI*.5,lengths:[20,7*w,5*w],angles:[0,PI*.2,-PI*.1],offsetX:P*1.2},{baseAngle:-PI*.65,lengths:[18,6*w,4*w],angles:[0,PI*.15,-PI*.1],offsetX:P*.8}];let E=[{baseAngle:-PI*.3,lengths:[5,8*w,6*w],angles:[0,PI*.15,-PI*.2],offsetX:P*1.7},{baseAngle:PI*.3,lengths:[5,8*w,6*w],angles:[0,-PI*.15,PI*.2],offsetX:P*1.7}];let D=T.map((e=>V(e.baseAngle,e.lengths,e.angles,e.offsetX)));t.push();{t.push();t.stroke(a[0],a[1],a[2],.8);t.strokeWeight(.5*n);t.translate(p,f);t.rotate(d);t.translate(-c*.1,c*0);t.noFill();let e=100;let o=.8;E.forEach(((e,o)=>{let r=C(e.baseAngle,e.lengths,e.angles,e.offsetX);for(let e=0;e<r.length-1;e++){let o=e+1;Hr(t,r[e][0],r[e][1],r[o][0],r[o][1],100,1,0)}}));t.pop()}{t.push();t.stroke(a[0],a[1],a[2],.8);t.strokeWeight(.6*n);t.translate(p,f);t.rotate(d);t.translate(-c*.2,c*-.3);t.noFill();let e=100;let o=1;D.forEach((e=>{for(let o=0;o<e.length-1;o++){let r=o+1;Hr(t,e[o][0],e[o][1],e[r][0],e[r][1],100,1,0);t.push();t.scale(1,-1);t.translate(0,-c*.6);Hr(t,e[o][0],e[o][1],e[r][0],e[r][1],100,1,0);t.pop()}}));t.pop();for(let e=0;e<200;e++){let o=e+1;let r,s;let i,F;let P=noise(e*.1+random(1e3));let w=map(P,0,1,-2,2)*n;if(e<m){r=h*cos(e/200*6.28)+h;i=pow(e/m,g)*sin(e/200*6.28)*c+w}else if(e>=m&&e<u){r=h*cos(e/200*6.28)+h;i=sin(e/200*6.28)*c+w}else if(e>=u){r=h*cos(e/200*6.28)+h;i=pow(1-(e-u)/m,g)*sin(e/200*6.28)*c+w}if(o<m){s=h*cos(o/200*6.28)+h;F=pow(o/m,g)*sin(o/200*6.28)*c+w}else if(o>=m&&o<u){s=h*cos(o/200*6.28)+h;F=sin(e/200*6.28)*c+w}else if(o>=u){s=h*cos(e/200*6.28)+h;F=pow(1-(o-u)/m,g)*sin(o/200*6.28)*c+w}t.push();t.translate(p,f);t.rotate(d);if(e<30){t.strokeWeight(.2);t.stroke(a[0],a[1],a[2],.8);let e=5;for(let o=0;o<e;o++){let e=r+random(-1,1)*n;let o=random(-1,1)*n;Hr(t,e,o,e+random(-.5,.5),o+random(-.5,.5),40,i*.3,0)}Hr(t,r,0,s,0,40,i,0,0)}else if(e>30&&e<100){t.strokeWeight(.15);t.stroke(l[0],l[1],l[2]*x,1);let e=3;for(let o=0;o<e;o++){let e=lerp(r,s,random(0,1));let o=lerp(0,i,random(0,1))+random(-1,1)*n;Hr(t,e,o,e+random(-.3,.3),o+random(-.3,.3),30,i*.2,0)}Hr(t,r,0,s,0,80,i,0)}if(e>32&&e<y){t.strokeWeight(.15);t.stroke(a[0],a[1],a[2],.6);let o=4;for(let l=0;l<o;l++){let o=lerp(r,s,random(0,1));let l=random(-.5,.5)*n;Hr(t,o,l,o+random(-.2,.2),l+random(-.2,.2),30,map(e,32,y,h*.005,h*b)*random(.8,1.2))}Hr(t,r,0,s,0,30,map(e,32,y,h*.005))}t.pop()}}t.pop()}function Hr(e,t,o,r,n,l=20,a=2,s=1){for(let i=0;i<l;i++){let l=random(0,1);let i=lerp(t,r,l)+random(-a,a)*s;let c=lerp(o,n,l)+random(-a,a);e.point(i,c)}}function Gr(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,size:n=1,bodyColor:l=[20,.5,.8,1],wingColor:a=[100,.7,.7,1],wingPattern:s=0,pointShift:i=1.5,strokeNoiseScale:c=.2,strokeStrength:h=1}=e;let p=Ao($t);h=h+p.random(0,1)*2;i=10*we;let f=50*n;let d=30*n;let m=15*n;let u=createVector(PI/2,0,random(-2,2));let g=C.petal2({pg:t,baseX:o,baseY:r,baseRotation:u,branchLength:f,branchSegments:10,branchSegmentsH:3,branchWidthFunc:e=>sin(e*PI)*1,branchBendFunc:e=>createVector(0,0,0),col:l,closeS:true,closeE:true});let b=map(n,.4,1.6,12,24);let y=g.centerPoints;let x=5;let F=y[x];let P=y[x-Bo(1,4)];let w=y[x+1]||y[x];let V=y[x-1]||y[x];let T=p5.Vector.sub(w,V).normalize();let E=createVector(-T.y,T.x,0).normalize();function D(e,t){if(e>.7){return sin(e*PI)*t*(1-e)*0}else{return sin(e*PI)*t*(1-e)*.8}}let A=random(1,2);C.petal({pg:t,baseX:o+F.x,baseY:r+F.y,direction:E.copy().mult(-1).rotate(-PI/3.5),branchLength:d*3,branchSegments:b,branchWidthFunc:e=>D(e,d*A),col:a,branchBendFunc:e=>createVector(0,sin(e*PI)*.8,-sin(e*PI)*.3),drawOutLine:1,strokeStrength:.4});C.petal({pg:t,baseX:o+P.x,baseY:r+P.y,direction:E.copy().mult(-1).rotate(PI/3),branchLength:d*2,branchSegments:b-10,branchWidthFunc:e=>D(e,d*.8),col:a,branchBendFunc:e=>createVector(0,-sin(e*PI)*.3,sin(e*PI)*.2),drawOutLine:1,strokeStrength:.4});C.petal({pg:t,baseX:o+F.x,baseY:r+F.y,direction:E.copy().rotate(PI/3.5),branchLength:d*3,branchSegments:b,branchWidthFunc:e=>D(e,d*A),col:a,branchBendFunc:e=>createVector(0,sin(e*PI)*.8,-sin(e*PI)*.3),drawOutLine:1,strokeStrength:.2});C.petal({pg:t,baseX:o+P.x,baseY:r+P.y,direction:E.copy().rotate(-PI/3),branchLength:d*2,branchSegments:b-10,branchWidthFunc:e=>D(e,d*.8),col:a,branchBendFunc:e=>createVector(0,-sin(e*PI)*.3,sin(e*PI)*.2),drawOutLine:1,strokeStrength:.2});let S=y[0];let I=[];let L=createVector(S.x-d*.1,S.y);let B=E.copy().mult(-1).rotate(-PI/2.5).normalize();for(let e=0;e<=20;e++){let t=e/20;let o=p5.Vector.add(L,p5.Vector.mult(B,t*d));let r=createVector(-B.y,B.x,0);o.add(p5.Vector.mult(r,sin(t*PI*.5)*d*.2));I.push(o)}let v=[];let W=createVector(S.x+d*.1,S.y);let k=E.copy().rotate(PI/2.5).normalize();for(let e=0;e<=20;e++){let t=e/20;let o=p5.Vector.add(W,p5.Vector.mult(k,t*d));let r=createVector(-k.y,k.x,0);o.add(p5.Vector.mult(r,-sin(t*PI*.5)*d*.2));v.push(o)}Bn({pg:t,pts:I,baseX:o,baseY:r,doFill:true,col:Ro(0,0,0,1),branchWidthFunc:e=>.5*(sin(e*PI)*.5+.5),randomOffset:1});Bn({pg:t,pts:v,baseX:o,baseY:r,doFill:true,col:Ro(0,0,0,1),branchWidthFunc:e=>.5*(sin(e*PI)*.5+.5),randomOffset:1})}function Ur(e={}){let{pg:t=pgL3,baseX:o=0,baseY:r=0,size:n=1,bodyColor:l=[20,.5,.8,1],wingColor:a=[0,0,.9,.3],dir:s=0,pointShift:i=1.5,strokeNoiseScale:c=.2,strokeStrength:h=1}=e;let p=Ao($t);i=10*we;let f=80*n;let d=40*n;let m=createVector(PI/2,0,random(-3,3));s=10;let u=C.petal2({pg:t,baseX:o,baseY:r,baseRotation:m,branchLength:f,branchSegments:12,branchSegmentsH:4,branchWidthFunc:e=>sin(e*PI)*n*.8,branchBendFunc:e=>createVector(random(-3,3),random(0,2),2),col:l,closeS:true,closeE:true});let g=u.centerPoints;let b=floor(g.length*random(.3,.4));let y=g[b];let x=g[b+vo([0,1])];let F=p5.Vector.sub(g[b+1]||g[b],g[b-1]||g[b]).normalize();let P=p5.Vector.sub(g[b+1]||g[b],g[b-1]||g[b]).normalize();let w=createVector(-F.y,F.x,0).normalize();let V=sin(s*.2)*PI*.1;V+=noise(s*.05)*PI*.05;function T(e,length,width,n,l){C.petal({pg:t,baseX:o+n.x,baseY:r+n.y,direction:e,branchLength:length,branchSegments:12,branchWidthFunc:e=>{let t=sin(e*PI)*width;if(e<.2)return t*e*5;if(e>.8)return t*(1-e)*5;return t},col:a,branchBendFunc:e=>createVector(sin(e*PI)*l,0,0),drawOutLine:1,strokeStrength:.1})}T(w.copy().mult(-1).rotate(-PI/6+V),d*1.4,d*.2,y,1);T(w.copy().mult(-1).rotate(-PI/12+V),d*1.1,d*.1,x,-1);T(w.copy().rotate(PI/6-V),d*1.4,d*.2,y,1);T(w.copy().rotate(PI/12-V),d*1.1,d*.1,x,-1);let E=g[0];let A=p5.Vector.sub(g[1],g[0]).normalize();let S=n*6;let I=n*random(2,3);let L=createVector(E.x-S*w.x,E.y-S*w.y,E.z);let B=createVector(E.x+S*w.x,E.y+S*w.y,E.z);D.drawGradientFlowerCenter(o+L.x,r+L.y,I,createVector(0,0,1),4);D.drawGradientFlowerCenter(o+B.x,r+B.y,I,createVector(0,0,1),4)}}{function $r(e={}){let{pg:t,baseX:o=0,baseY:r=0,size:n=random(5,20),roughness:l=1.3,detail:a=2,rotation:s=createVector(0,0,0),branchSegmentsH:i=Bo(3,6),stoneH:c=random(.6,1.1),pointShift:h=2,strokeStrength:p=1.2,strokeNoiseScale:f=.1}=e;let d=Ao($t);p=p+d.random(0,1)*2;h=10*we;function m(e){const t=10.1;const o=-.2;const r=(noise(e*t,Bo(0,100)*.05)+o)*random(3,6)*Pe;return r>.5?r:random(0,1)>.8?0:0}t.push();let u=[];let g=random(TWO_PI);let b=floor(120*J);let y=random(-.4,.4);let x=random(.4,-.4);for(let e=0;e<=b;e++){let t=e/b;let o=TWO_PI*t;let r=map(noise(cos(o)*a,sin(o)*a,g),0,1,1,1.1)*l;let s=map(noise(cos(o)*2,sin(o)*2,g+1e3),0,1,-.3,.3);let i=n*r;let h=cos(o)*i;let p=sin(o)*i;if(p>0){p*=.2}else{p*=c}h+=y*n+p*x;h+=s*n;h+=map(noise(h*.1,p*.1,g+2e3),0,1,-n*.1,n*.1);p+=map(noise(h*.1,p*.1,g+3e3),0,1,-n*.05,n*.05);u.push(createVector(h,p))}u.push(u[0]);let F=random(-PI/3,-PI/6);let P=random(.5,.8);let w=[];for(let e=0;e<i;e++){let t=e/(i-1);let o=u.map((e=>{let o=createVector(cos(F)*n*.2,sin(F)*n*.2);let r=p5.Vector.mult(o,1-t);return p5.Vector.lerp(e,r,t)}));w.push(o)}for(let e=0;e<w.length-1;e++){let n=w[e];let l=w[e+1];let a=e/(w.length-1);for(let e=0;e<n.length-1;e++){let a=n[e];let s=atan2(a.y,a.x);let i=Mt.colors.stone[0][0];let c=Mt.colors.stone[0][1];let h=Mt.colors.stone[0][2];Ln({pg:t,pts:[n[e],n[min(e+2,n.length-1)],l[min(e+2,l.length-1)],l[e]],baseX:o,baseY:r,doFill:true,doFillBrush:true,doStr:false,col:Ro(i,c,h,.8),randomOffset:1,vertexMode:0})}}let V=Mt.colors.stroke[vo([0,0,0,2])];let C=Mt.colors.stroke[1];let T=Bo(2,6);let E=vo([.4,.5,.6,.7]);for(let e=1;e<w.length;e++){let n=w[e];let l=n.filter((e=>{if(e.y>=0)return false;let t=abs(atan2(e.y,e.x));return t>.2&&t<3}));for(let n=0;n<l.length-T;n+=T){let a=l.slice(n,n+T+1);if(noise(e*100,n*100)<E){Bn({pg:t,pts:a,baseX:o,baseY:r,col:Ro(C[0],C[1]*0,C[2]*random(.8,1),1),branchWidthFunc:e=>(.5*(1-e)*map(noise(e*10+n),0,1,.5,1)+.5)*p*Pe*random(1,2),randomOffset:.5,sameWidth:1,forceBrush:1})}}}for(let e=0;e<u.length-T;e+=T){let n=u.slice(e,e+T+1);Bn({pg:t,pts:n.map((e=>{let t=map(noise(e.x*f,e.y*f),0,1,-h,h);let o=map(noise(e.y*f,e.x*f),0,1,-h,h);return createVector(e.x+t,e.y+o)})),baseX:o,baseY:r,col:Ro(V[0],V[1],V[2],1),branchWidthFunc:m,randomOffset:.5,sameWidth:1})}let D=Mt.colors.stone[0][0];let A=Mt.colors.stone[0][1];let S=Mt.colors.stone[0][2];let I=Bo(5,20);let L=0,B=0;u.forEach((e=>{L+=e.x;B+=e.y}));L/=u.length;B/=u.length;let v=0;u.forEach((e=>{let dist=sqrt(pow(e.x-L,2)+pow(e.y-B,2));v=max(v,dist)}));let W=Mt.colors.stroke[0];let k=Mt.colors.stroke[1];for(let e of w){for(let e=0;e<I;e++){let e=random(TWO_PI);let l=(1-random(random(0,1)))*v;let a=L+cos(e)*l;let s=B+sin(e)*l;if(_r(createVector(a,s),u)){let e=random(-n*.05,n*.05);let l=random(-n*.05,n*.05);let i=createVector(a+e,s+l);let c=random(1,2);t.push();t.noStroke();if(random(0,1)<.5)t.fill(Ro(k[0],k[1],k[2],.8));else t.fill(Ro(W[0],W[1],W[2],.5));t.ellipse(i.x+o,i.y+r,c,c);t.pop()}}}t.pop()}function _r(e,t){let o=false;for(let r=0,n=t.length-1;r<t.length;n=r++){let l=t[r].x,a=t[r].y;let s=t[n].x,i=t[n].y;let c=a>e.y!=i>e.y&&e.x<(s-l)*(e.y-a)/(i-a)+l;if(c)o=!o}return o}function qr(e={}){let{pg:t=pgL0,baseX:o=0,baseY:r=0,size:n=random(5,20)}=e;let l=hn({size:n,shapeCount:floor(random(3,6))});function a(e){const t=10.1;const o=-.2;const r=(noise(e*t,Bo(0,100)*.05)+o)*random(3,6)*Pe;return r>.5?r:random(0,1)>.8?0:0}l=wn(l);if(l.length===0){console.error("Invalid stone points generated");return}let s=Mt.colors.stone[0][0];let i=Mt.colors.stone[0][1];let c=Mt.colors.stone[0][2];let h=Infinity,p=-Infinity;let f=Infinity,d=-Infinity;l.forEach((e=>{if(e&&e.x!==undefined&&e.y!==undefined){h=min(h,e.y);p=max(p,e.y);f=min(f,e.x);d=max(d,e.x)}}));let m=[];let u=n>30?Bo(2,8):Bo(1,3);let g=n>30?Bo(8,12):Bo(4,8);let b=[];for(let e=0;e<u;e++){b.push({x:random(f+n*.3,d-n*.3),y:random(h+n*.3,p-n*.3),size:n*random(.12,.25)*map(e,0,u-1,1,.7)})}for(let e of b){let t=Zr({centerX:e.x,centerY:e.y,holeSize:e.size,shapeCount:Bo(2,5)});if(t&&Array.isArray(t)&&t.length>0){t=wn(t);if(t.length>0){let e=Vn(t,l);if(e.length>=3){m.push(e)}}}}for(let e=0;e<g;e++){let t=n*random(.03,.08)*map(e,0,g-1,1,.6);let o=random(b);let r=random(TWO_PI);let a=random(n*.1,n*.3);let s=o.x+cos(r)*a;let i=o.y+sin(r)*a;if(rn(s,i,t,m,l,f,d,h,p)){let e=Zr({centerX:s,centerY:i,holeSize:t});if(e&&Array.isArray(e)&&e.length>0){e=wn(e);if(e.length>0){let t=Vn(e,l);if(t.length>=3){m.push(t)}}}}}let y=dn(m);for(let e=0;e<3;e++){let n=l.map((e=>Pn(e)));if(n.length>0){let l=Ro(s,i*map(e,0,2,1,.7),c*map(e,0,2,.9,.5),map(e,0,2,.9,.7));let h=30;let p=8;let f=[];let d=0,m=0;n.forEach((e=>{d+=e.x;m+=e.y}));d/=n.length;m/=n.length;for(let t=0;t<=p;t++){let o=t/p;let r=[];for(let t=0;t<=h;t++){let l=t/h;let a=TWO_PI*l;let s=null;let i=Infinity;for(let e=0;e<n.length;e++){let t=n[e];let o=n[(e+1)%n.length];let r=createVector(d+cos(a)*1e3,m+sin(a)*1e3);let l=Cn(d,m,r.x,r.y,t.x,t.y,o.x,o.y);if(l){let dist=gn({x:d,y:m},l);if(dist<i){i=dist;s=l}}}if(s){let t=d+(s.x-d)*o;let n=m+(s.y-m)*o;let l=random(-2,2)*map(e,0,2,1,.5)*(1-o);t+=l*cos(a);n+=l*sin(a);r.push(createVector(t,n))}}f.push(r)}for(let e=0;e<f.length-1;e++){let n=f[e];let a=f[e+1];for(let e=0;e<n.length-1;e++){let s=[n[e],n[e+1],a[e+1],a[e]];Ln({pg:t,pts:s,baseX:o,baseY:r,col:l,randomOffset:1})}}if(y&&Array.isArray(y)){y.forEach((n=>{if(n&&Array.isArray(n)&&n.length>2){let l=createVector(0,0);n.forEach((e=>{l.add(e)}));l.div(n.length);let a=[];let s=4;h=15;for(let t=0;t<=s;t++){let o=t/s;let r=[];for(let t=0;t<=h;t++){let a=t/h;let s=TWO_PI*a;let i=null;let c=Infinity;for(let e=0;e<n.length;e++){let t=n[e];let o=n[(e+1)%n.length];let r=createVector(l.x+cos(s)*1e3,l.y+sin(s)*1e3);let a=Cn(l.x,l.y,r.x,r.y,t.x,t.y,o.x,o.y);if(a){let dist=gn({x:l.x,y:l.y},a);if(dist<c){c=dist;i=a}}}if(i){let t=l.x+(i.x-l.x)*o;let n=l.y+(i.y-l.y)*o;let a=random(-1,1)*map(e,0,2,.5,.2)*(1-o);t+=a*cos(s);n+=a*sin(s);r.push(createVector(t,n))}}a.push(r)}let i=Mt.colors.bg[0][0];let c=Mt.colors.bg[0][1];let p=Mt.colors.bg[0][2];let f=random(0,1)>.5?1:.5;for(let e=0;e<a.length-1;e++){let n=a[e];let l=a[e+1];for(let e=0;e<n.length-1;e++){let a=[n[e],n[e+1],l[e+1],l[e]];Ln({pg:t,pts:a,baseX:o,baseY:r,col:Ro(i,c,p*f,.8),randomOffset:1})}}}}))}let u=n.map((t=>{let o=random(-.5,.5)*map(e,0,2,1,.5);let r=t.copy();r.add(createVector(o,o));return r}));Bn({pg:t,pts:u,baseX:o,baseY:r,col:Ro(s,i,c*.5,1),branchWidthFunc:a,randomOffset:.3,sameWidth:1});if(y&&Array.isArray(y)){y.forEach((n=>{if(n&&Array.isArray(n)&&n.length>2){let l=n.map((t=>{let o=random(-.3,.3)*map(e,0,2,1,.5);let r=t.copy();r.add(createVector(o,o));return r}));Bn({pg:t,pts:l,baseX:o,baseY:r,col:Ro(s,i*.9,c*.4,1),branchWidthFunc:a,randomOffset:.2})}}))}}}let x=n>30?12:8;for(let e=0;e<x;e++){try{let l=isFinite(f)&&isFinite(d)?random(f,d):0;let a=isFinite(h)&&isFinite(p)?random(h,p):0;if(!isFinite(l)||!isFinite(a)){continue}let m=random(-PI/4,PI/4);if(isFinite(p)&&isFinite(h)&&isFinite(d)&&isFinite(f)){m+=atan2(p-h,d-f)}let length=n*random(.2,.5);if(!isFinite(length)){continue}let u=l+cos(m)*length;let g=a+sin(m)*length;if(!isFinite(u)||!isFinite(g)){continue}let b=(l+u)/2;let y=(a+g)/2;let x=length*.2;if(isFinite(x)){let e=m+PI/2;b+=cos(e)*random(-x,x);y+=sin(e)*random(-x,x)}if(!isFinite(b)||!isFinite(y)){continue}let F=[createVector(l,a),createVector(b,y),createVector(u,g)];if(F.every((e=>e&&isFinite(e.x)&&isFinite(e.y)))){F=F.map((e=>{if(!(e instanceof p5.Vector)){return createVector(e.x,e.y)}return e}));F=F.map((e=>{if(typeof e.copy!=="function"){e.copy=function(){return createVector(this.x,this.y)}}if(typeof e.add!=="function"){e.add=function(e){this.x+=e.x;this.y+=e.y;return this}}return e}));try{Bn({pg:t,pts:F,baseX:o,baseY:r,col:Ro(s,i*.8,c*.5,.3),branchWidthFunc:e=>.2*Pe*(1-e),randomOffset:.5})}catch(t){console.error(`Error in texture line ${e}:`,t)}}}catch(t){console.error(`Error creating texture line ${e}:`,t)}}try{let e=l.filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined")).map((e=>{let t=random(-.5,.5);let o=e instanceof p5.Vector?e:createVector(e.x,e.y);let r=o.copy();r.add(createVector(t,t));return r})).filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined"));if(e.length>2){e=e.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));Bn({pg:t,pts:e,baseX:o,baseY:r,col:Ro(s,i,c*.7,1),branchWidthFunc:a,randomOffset:.5})}}catch(e){console.error("Error creating stone outline:",e)}if(y&&Array.isArray(y)){y.forEach((e=>{try{if(e&&Array.isArray(e)){let n=e.filter((e=>e&&typeof e.x!=="undefined"&&typeof e.y!=="undefined")).map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));if(n.length>2){Bn({pg:t,pts:n,baseX:o,baseY:r,col:Ro(s,i,c*.4,.8),branchWidthFunc:a,randomOffset:.5})}}}catch(e){console.error("Error creating hole outline:",e)}}))}}function jr(e,t){pgBg.push();let o=Bo(1,3);let r=[];for(let e=0;e<o;e++){r.push({size:random(0,1)>.2?random(20,30):random(40,80)})}r.sort(((e,t)=>t.size-e.size));let n=t;r.forEach(((t,o)=>{t.x=e+random(-t.size,t.size);t.y=n+o*t.size*.5;let r=random(0,1);$r({pg:pgL0,baseX:t.x,baseY:t.y,size:t.size*q,branchSegmentsH:Bo(6,13)})}));pgBg.pop()}function Jr(e,t){let o=Bo(1,3);let r=[];for(let e=0;e<o;e++){r.push({size:random(0,1)>.2?random(20,30):random(40,80)})}r.sort(((e,t)=>t.size-e.size));let n=t;r.forEach(((t,o)=>{t.x=e+random(-t.size,t.size);t.y=n+o*t.size*.5;qr({pg:pgL0,baseX:t.x,baseY:t.y,size:t.size*q})}))}function Kr(e={}){let{size:t=random(5,20),roughness:o=1.3,detail:r=2,stoneH:n=random(.6,1.1),globalOffset:l=random(-.4,.4),tilt:a=random(.4,-.4),centerX:s=0,centerY:i=0}=e;let c=[];let h=random(TWO_PI);let p=floor(120*J);for(let e=0;e<=p;e++){let f=e/p;let d=TWO_PI*f;let m=map(noise(cos(d)*r,sin(d)*r,h),0,1,.85,1.15);let u=map(noise(cos(d)*r*2,sin(d)*r*2,h+1e3),0,1,.92,1.08);let g=(m*.7+u*.3)*o;let b=t*g;let y=s+cos(d)*b;let x=i+sin(d)*b;let F=x>i?map(x-i,0,b,1,.15):map(x-i,-b,0,n*1.2,1);x=i+(x-i)*F;y+=l*t+(x-i)*a;c.push(createVector(y,x))}c=tn(c,2);c=tn(c,1);c.push(c[0].copy());return c}function Qr(e={}){let{size:t=random(5,20),roughness:o=1.3,detail:r=2,stoneH:n=random(.6,1.1),globalOffset:l=random(-.4,.4),tilt:a=random(.4,-.4),direction:s=random(TWO_PI)}=e;let i=[];let c=random(TWO_PI);let h=floor(120*J);for(let e=0;e<=h;e++){let p=e/h;let f=TWO_PI*p;let d=map(noise(cos(f)*r,sin(f)*r,c),0,1,.85,1.15);let m=map(noise(cos(f)*r*2,sin(f)*r*2,c+1e3),0,1,.92,1.08);let u=1+cos(f-s)*.5;let g=(d*.7+m*.3)*o*u;let b=map(noise(cos(f)*2,sin(f)*2,c+2e3),0,1,-.3,.3);let y=t*g;let x=cos(f)*y;let F=sin(f)*y;let P=F>0?map(F,0,y,1,.15):map(F,-y,0,n*1.2,1);F*=P;x+=l*t+F*a;x+=b*t;let w=noise(x*.05,F*.05,c+3e3);x+=map(w,0,1,-t*.08,t*.08)*u;F+=map(w,0,1,-t*.05,t*.05)*u;i.push(createVector(x,F))}i=tn(i,2);i=tn(i,1);i.push(i[0].copy());return i}function Zr(e={}){let{centerX:t=0,centerY:o=0,holeSize:r=10,shapeCount:n=floor(random(2,6))}=e;let l=en({centerX:t,centerY:o,holeSize:r,detail:2,elongation:random(1.2,1.8)});let a=[l];for(let e=1;e<n;e++){let e=random(-r*.3,r*.3);let n=random(-r*.3,r*.3);let l=r*random(.2,.6);let s=en({centerX:t+e,centerY:o+n,holeSize:l,detail:random(1.8,2.2),elongation:random(1.1,1.6)});a.push(s)}let s=[];a.forEach((e=>{if(e&&Array.isArray(e)){s=s.concat(e)}}));let i=pn(s);let c=[];for(let e=0;e<i.length;e++){let t=i[e];let o=noise(t.x*.1,t.y*.1);let n=r*.05*o;c.push(createVector(t.x+random(-n,n),t.y+random(-n,n)))}c=tn(c,2);c=tn(c,1);c=on(c);return c}function en(e={}){let{centerX:t=0,centerY:o=0,holeSize:r=10,detail:n=2,elongation:l=random(1,2)}=e;let a=[];let s=random(TWO_PI);let i=floor(40*J);let c=.2;let h=random(0,1e3);let p=.9;let f=.5;let d=.3;for(let e=0;e<=i;e++){let n=e/i;let m=TWO_PI*n;let u=noise(cos(m)*c+h,sin(m)*c+h)*p;let g=noise(cos(m)*c*2+h+1e3,sin(m)*c*2+h+1e3)*f;let b=noise(cos(m)*c*4+h+2e3,sin(m)*c*4+h+2e3)*d;let y=.6+u+g+b;let x=1+sin(m*2)*.2;let F=1+(l-1)*abs(cos(m));let P=r*y*x*F;let w=t+cos(m)*P;let V=o+sin(m)*P;let C=r*.15;w+=noise(w*.1,V*.1,s)*C;V+=noise(w*.1,V*.1,s+1e3)*C;a.push(createVector(w,V))}a=tn(a,3);a=tn(a,2);a=on(a);a=tn(a,1);return a}function tn(e,t){let o=[];let r=e.length;for(let n=0;n<r;n++){let l=createVector(0,0);let a=0;for(let o=-t;o<=t;o++){let s=(n+o+r)%r;let i=exp(-o*o/(2*t));l.add(p5.Vector.mult(e[s],i));a+=i}l.div(a);o.push(l.copy())}return o}function on(e){let t=0;for(let o=0;o<e.length;o++){let r=e[o];let n=e[(o+1)%e.length];t+=(n.x-r.x)*(n.y+r.y)}if(t<0){return e.reverse()}return e}function rn(e,t,o,r,n,l,a,s,i){let c=o*2;if(e-o<l+c||e+o>a-c||t-o<s+c||t+o>i-c){return false}for(let n of r){let r=(n[0].x+n[floor(n.length/2)].x)/2;let l=(n[0].y+n[floor(n.length/2)].y)/2;let a=(o+o)*1.5;let s=dist(e,t,r,l);if(s<a){return false}}return true}function nn(e,t){e=e.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));t=t.map((e=>e instanceof p5.Vector?e:createVector(e.x,e.y)));let o=ln(e).concat(ln(t));for(let r of o){if(!sn(an(e,r),an(t,r))){return false}}return true}function ln(e){if(!e||e.length===0){console.error("Invalid polygon in getAxes");return[]}let t=[];for(let o=0;o<e.length;o++){if(!e[o]||typeof e[o].x==="undefined"||typeof e[o].y==="undefined"){console.error("Invalid point in getAxes:",e[o]);continue}let r=e[o];let n=e[(o+1)%e.length];let l=createVector(r.x-n.x,r.y-n.y);let a=createVector(-l.y,l.x);let length=a.mag();if(length!==0){a.div(length);t.push(a)}}return t}function an(e,t){let min=Infinity,max=-Infinity;for(let o=0;o<e.length;o++){let r=e[o].dot(t);if(r<min)min=r;if(r>max)max=r}return{min:min,max:max}}function sn(e,t){return!(e.max<t.min||t.max<e.min)}function cn(e){let t=[];const o=1e-6;for(let r=0;r<e.length;r++){let n=false;for(let l=0;l<t.length;l++){if(abs(e[r].x-t[l].x)<o&&abs(e[r].y-t[l].y)<o){n=true;break}}if(!n){t.push(e[r])}}return t}function hn(e={}){let{size:t=random(5,20),shapeCount:o=floor(random(2,6))}=e;let r=Qr({size:t,roughness:1.3,detail:2,stoneH:random(.6,1.1)});let n=[r];for(let e=1;e<o;e++){let e=random(-t*.3,t*.3);let o=random(-t*.3,t*.3);let r=t*random(.6,1.2);let l=Qr({size:r,roughness:random(1.1,1.4),detail:random(1.8,2.2),stoneH:random(.6,1.1),direction:random(TWO_PI)}).map((t=>createVector(t.x+e,t.y+o)));n.push(l)}let l=[];n.forEach((e=>{l=l.concat(e)}));let a=pn(l);let s=[];for(let e=0;e<a.length;e++){let o=a[e];let r=noise(o.x*.1,o.y*.1);let n=t*.1*r;s.push(createVector(o.x+random(-n,n),o.y+random(-n,n)))}s=tn(s,2);s=tn(s,1);s.push(s[0].copy());return s}function pn(e){let t=e.reduce(((e,t)=>t.y>e.y||t.y===e.y&&t.x<e.x?t:e));let o=e.filter((e=>e!==t)).sort(((e,o)=>{let r=atan2(e.y-t.y,e.x-t.x);let n=atan2(o.y-t.y,o.x-t.x);return r-n}));let r=[t];for(let e of o){while(r.length>=2){let t=r[r.length-1];let o=r[r.length-2];if(fn(o,t,e)>0){break}r.pop()}r.push(e)}return r}function fn(e,t,o){return(t.x-e.x)*(o.y-e.y)-(t.y-e.y)*(o.x-e.x)}function dn(e){if(!e||e.length===0){return[]}e=e.filter((e=>{if(!e||!Array.isArray(e)||e.length<3){return false}let t=e.map((e=>{if(!e||typeof e.x==="undefined"||typeof e.y==="undefined"){return null}return e instanceof p5.Vector?e:createVector(e.x,e.y)})).filter((e=>e!==null));return t.length>=3}));if(e.length===0){return[]}let t=[];let o=true;while(o){o=false;let r=new Array(e.length).fill(false);for(let n=0;n<e.length;n++){if(r[n])continue;let l=e[n].slice();r[n]=true;for(let t=0;t<e.length;t++){if(n!==t&&!r[t]){if(nn(l,e[t])){l=l.concat(e[t]);r[t]=true;o=true}}}let a=cn(l);if(a.length>=3){let e=mn(a);if(e.length>=3){e=on(e);e=yn(e,4);let o=xn(e);if(o.length>=3){t.push(o)}}}}if(t.length===0){break}e=t.filter((e=>e.length>=3));t=[];if(e.length===0){break}}return e}function mn(e){e=wn(e);if(e.length<3){return e}e.sort(un);let t=e[0];e.sort(((e,o)=>{let r=atan2(e.y-t.y,e.x-t.x);let n=atan2(o.y-t.y,o.x-t.x);if(r===n){return gn(t,o)-gn(t,e)}return r-n}));let o=[t];for(let t=0;t<e.length;t++){while(o.length>1&&bn(o[o.length-2],o[o.length-1],e[t])<=0){o.pop()}o.push(e[t])}return o}function un(e,t){if(e.y===t.y)return e.x-t.x;return e.y-t.y}function gn(e,t){return sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function bn(e,t,o){return(t.x-e.x)*(o.y-e.y)-(t.y-e.y)*(o.x-e.x)}function yn(e,t=4){let o=[];for(let r=0;r<e.length;r++){let n=e[r];let l=e[(r+1)%e.length];for(let e=0;e<t;e++){let r=e/t;let a=n.x*(1-r)+l.x*r;let s=n.y*(1-r)+l.y*r;o.push(createVector(a,s))}}return o}function xn(e){return e.map((e=>{let t=Fn(e.x,e.y);return createVector(e.x+t.dx,e.y+t.dy)}))}function Fn(e,t){const o=1;return{dx:noise(e)*o,dy:noise(t)*o}}function Pn(e,t=createVector(0,0)){if(!e||typeof e.x==="undefined"||typeof e.y==="undefined"){console.error("Invalid point:",e);return t}return e instanceof p5.Vector?e:createVector(e.x,e.y)}function wn(e){if(!e||!Array.isArray(e)){console.error("Invalid points array:",e);return[]}return e.map((e=>Pn(e)))}function Vn(e,t){e=wn(e);t=wn(t);if(e.length<3||t.length<3){return[]}let o=[...e];for(let e=0;e<t.length;e++){let r=t[e];let n=t[(e+1)%t.length];let l=[...o];o=[];for(let e=0;e<l.length;e++){let t=l[e];let a=l[(e+1)%l.length];let s=(n.x-r.x)*(t.y-r.y)-(n.y-r.y)*(t.x-r.x);let i=(n.x-r.x)*(a.y-r.y)-(n.y-r.y)*(a.x-r.x);if(s>=0){o.push(t)}if(s*i<0){let e=s/(s-i);let r=t.x+(a.x-t.x)*e;let n=t.y+(a.y-t.y)*e;o.push(createVector(r,n))}}}if(o.length<3){return[]}o=tn(o,2);o=on(o);return o}function Cn(e,t,o,r,n,l,a,s){let i=(e-o)*(l-s)-(t-r)*(n-a);if(i===0)return null;let c=((e-n)*(l-s)-(t-l)*(n-a))/i;let h=-((e-o)*(t-l)-(t-r)*(e-n))/i;if(c>=0&&c<=1&&h>=0&&h<=1){return createVector(e+c*(o-e),t+c*(r-t))}return null}function Tn(e,t){let o=[];for(let r=0;r<e.length-1;r++){for(let n=0;n<t.length-1;n++){let l=Cn(e[r].x,e[r].y,e[r+1].x,e[r+1].y,t[n].x,t[n].y,t[n+1].x,t[n+1].y);if(l){o.push(l)}}}return o}function _r(e,t){let o=false;for(let r=0,n=t.length-1;r<t.length;n=r++){let l=t[r].x,a=t[r].y;let s=t[n].x,i=t[n].y;let c=a>e.y!=i>e.y&&e.x<(s-l)*(e.y-a)/(i-a)+l;if(c)o=!o}return o}function En(e){let t=0;for(let o=0;o<e.length;o++){let r=(o+1)%e.length;t+=e[o].x*e[r].y;t-=e[r].x*e[o].y}return abs(t)/2}function Dn(e,t){for(let o=0;o<t.length-1;o++){if(abs(t[o].x-e.x)<.001&&abs(t[o].y-e.y)<.001){return t[o+1]}}return t[0]}}{function An(e={}){let{pts:t=[],pg:o=pgText,baseX:r=0,baseY:n=0,minPoints:l=50}=e;if(he[3]==0)return;if(t.length<l){let e=[];if(t.length>=2){for(let o=0;o<t.length-1;o++){let r=t[o];let n=t[o+1];let a=yn(r,n,ceil(l/(t.length-1)));if(o===0){e=e.concat(a)}else{e=e.concat(a.slice(1))}}t=e}}o.strokeWeight(.5);o.stroke(he[0],he[1],he[2],he[3]);o.noFill();for(let e=0;e<t.length-1;e++){if(e%1===0){o.ellipse(t[e].x+r,t[e].y+n,1)}}}function yn(e,t,o=20){let r=[];for(let n=0;n<o;n++){let l=n/(o-1);let a=lerp(e.x,t.x,l);let s=lerp(e.y,t.y,l);a+=zo(l*10)*.5;s+=zo(l*10+100)*.5;r.push(createVector(a,s))}return r}function Sn(e={}){let{pts:t=[],branchWidthFunc:o=e=>10,widthMultiplier:n=1}=e;let l=[];let a=[];let s=fe[0];let i=fe[1];if(t.length<3){return[[],[]]}for(let e=1;e<t.length-1;e++){n=map(noise(e*s,t.length*s),0,1,1/i,1*i);if(r==2)n=1;let c=o(e/t.length)*n;let h=t[e-1];let p=t[e];let f=t[e+1];let d=atan2(p.y-h.y,p.x-h.x);let m=atan2(p.y-f.y,p.x-f.x);let u=(d+m)/2;if(u<m){u+=PI}l.push(createVector(p.x+c*cos(u),p.y+c*sin(u)));a.push(createVector(p.x-c*cos(u),p.y-c*sin(u)))}if(r==2)n=1;let c=t.length-1;let h=t[0];let p=t[c];let f=atan2(t[1].y-h.y,t[1].x-h.x)-PI/2;let d=atan2(p.y-t[c-1].y,p.x-t[c-1].x)-PI/2;let m=o(0)*n;let u=o(1)*n;l.unshift(createVector(h.x+m*cos(f),h.y+m*sin(f)));a.unshift(createVector(h.x-m*cos(f),h.y-m*sin(f)));l.push(createVector(p.x+u*cos(d),p.y+u*sin(d)));a.push(createVector(p.x-u*cos(d),p.y-u*sin(d)));return[l,a]}function In(e,t=1,o=1,r=1){push();let n=hue(e);let l=saturation(e);let a=brightness(e);let s=alpha(e);let i=abs(n+Fe)%360;if(t>0)i=t;let c=l*o;let h=a*r;if(o>9)c=1;if(r>9)h=1;let p=color(i,c,h,s);pop();return p}function Ln(e={}){let{pts:t=[],pg:o=pgL3,doFill:r=true,col:n=color("black"),baseX:l=0,baseY:a=0,randomOffset:s=0,vertexMode:i=0}=e;const c=t.length*1e3+l*10+a+random(0,1e4)^$t;const h=Ao(c);if(i==1)s=0;else s=s*Ve;function p(){return random(-s,s)}if(ot==1&&i==0){n=color(qt[0],qt[1],qt[2]*lt,1)}if(i==0)n=In(n,De[0],De[1],De[2]);o.beginShape();if(t.length>-1){if(r){let e=noise(t.length*10)>.3?2:1;if(i==0){o.fill(hue(n),saturation(n)*ue,brightness(n)*ge,alpha(n)*be)}else if(i==1){o.fill(hue(n),saturation(n)*ue,brightness(n)*ge*random(.8,1),alpha(n)*constrain(random(-.2,.5*e),.5,.9)*be)}else{o.fill(hue(n),saturation(n)*ue,brightness(n)*ge*random(.9,1),alpha(n)*constrain(random(-.2,.5*e),.7,.9)*be)}o.noStroke()}else{o.noFill()}if(i==0){for(let e=0;e<t.length;e++){o.vertex(t[e].x+l+p(),t[e].y+a+p())}}else if(i==1){for(let e=0;e<t.length;e++){o.curveVertex(t[e].x+l+p(),t[e].y+a+p())}}else if(i==2){let e=t[0];o.curveVertex(e.x+l+p(),e.y+a+p());o.curveVertex(e.x+l+p(),e.y+a+p());for(let e=1;e<t.length-2;e+=3){let r=t[e];let n=t[e+1];let s=t[e+2];let i=lerp(r.x,n.x,random(.2,.4));let c=lerp(r.y,n.y,random(.2,.4));o.curveVertex(i+l+p(),c+a+p());let h=lerp(r.x,n.x,random(.4,.6));let f=lerp(r.y,n.y,random(.4,.6));o.curveVertex(h+l+p()*1.2,f+a+p()*1.2);let d=lerp(n.x,s.x,random(.2,.4));let m=lerp(n.y,s.y,random(.2,.4));o.curveVertex(d+l+p(),m+a+p());o.curveVertex(s.x+l+p(),s.y+a+p())}for(let e=floor(t.length/3)*3;e<t.length;e++){let r=t[e];o.curveVertex(r.x+l+p(),r.y+a+p())}let r=t[t.length-1];o.curveVertex(r.x+l+p(),r.y+a+p())}}o.endShape(CLOSE)}function Bn(e={}){let{pts:t=[],pg:o=pgL3,baseX:r=0,baseY:n=0,col:l="black",branchWidthFunc:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:i=0,vertexMode:c=1,minPoints:h=10,sameWidth:p=0,forceBrush:f=0}=e;if(f==1){return Wn(e)}if(ft==0){return Wn(e)}else if(ft==1){return Wn(e),vn(e)}}function vn(e={}){let{pts:t=[],pg:o=pgL3,baseX:r=0,baseY:n=0,col:l="black",branchWidthFunc:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:i=0,vertexMode:c=1,minPoints:h=10,sameWidth:p=0}=e;let f=Ao($t);let d;if(ot==1){let e=Mt.colors.stroke[0];let t=Mt.colors.stroke[1];if(at==0)d=Ro(e[0],e[1],e[2],.4);else if(at==1)d=Ro(t[0],t[1],t[2],.3);else if(at==2)d=Ro(0,0,1,.5)}else{d=l;d.levels[3]=.5;if(d.levels[3]===0)return}let m=1;let[u,g]=Sn({pts:t,branchWidthFunc:e=>a(e)*m});o.push();o.noStroke();let b=u.concat(g.reverse());if(b.length<2){o.pop();return[u,g]}let y=[];for(let e=0;e<b.length-1;e++){let t=b[e];let o=b[e+1];let r=dist(t.x,t.y,o.x,o.y);let n=floor(map(r,0,20,2,6));n=constrain(n,2,6);y.push(t);for(let e=1;e<=n;e++){let r=e/(n+1);let l=lerp(t.x,o.x,r);let a=lerp(t.y,o.y,r);y.push({x:l,y:a})}}y.push(b[b.length-1]);let x=y.length;for(let e=0;e<x;e++){if(Lo(f,0,1)>.2){let t=hue(d);let l=saturation(d);let s=Lo(f,0,1)<.9?Lo(f,.7,1.3):Io(f,[.8,2]);let i=brightness(d)*s;let c=y[e];let h=noise(c.x*.1,c.y*.1);let p=So(f,1,3);for(let s=0;s<p;s++){let s=Lo(f,0,1)<.9?Lo(f,.8,1.8):Lo(f,2,3);s*=a(e/x);let h=Lo(f,0,1)>.05?random(.7,.98):Lo(f,1.2,2);let p=Lo(f,-s,s)*h;let d=Lo(f,-s,s)*h;o.fill(t,l,i,.3);s=constrain(s,0,4);if(s>=3)s=s*random(.1,.5);o.ellipse(c.x+p+r,c.y+d+n,s)}}}o.pop();return[u,g]}function Wn(e={}){let{pts:t=[],pg:o=pgL3,baseX:r=0,baseY:n=0,col:l="black",branchWidthFunc:a=e=>1*sin(e*PI)*map(noise(e*10),0,1,.5,1),doFill:s=true,randomOffset:i=0,vertexMode:c=1,minPoints:h=10,sameWidth:p=0}=e;if(t.length<4){let e=[];for(let o=0;o<t.length-1;o++){let r=t[o];let n=t[o+1];e.push(r);let l=ceil((5-t.length)/(t.length-1));for(let t=1;t<=l;t++){let o=t/(l+1);let a=lerp(r.x,n.x,o);let s=lerp(r.y,n.y,o);e.push(createVector(a,s))}}e.push(t[t.length-1]);t=e}let f;if(ot==1){let e=Mt.colors.stroke[0];let t=Mt.colors.stroke[1];if(at==0)f=Ro(e[0],e[1],e[2],.8);else if(at==1)f=Ro(t[0],t[1],t[2],.5);else if(at==2)f=Ro(0,0,1,.9)}else{f=l;if(f.levels[3]===0)return}f=In(f,Ae[0],Ae[1],Ae[2]);let d=1;if(at==2){d=random(0,1)<.05?random(5,10):random(0,1)<.5?random(2,3):random(.8,1.2)}if(ot==1&&ht==1){d=random(0,1)<.2?random(1.5,2.2):random(.8,1.2)}if(p==1)d=1;let[m,u]=Sn({pts:t,branchWidthFunc:e=>a(e)*d});if(ht==1&&random(0,1)<.2){let[e,l]=Sn({pts:t,branchWidthFunc:e=>noise(e*10)*vo([2,2,1,1,0])});let a=Mt.colors.stroke[2];o.push();o.noFill();o.strokeWeight(random(.5,2));o.stroke(a[0],a[1],a[2],.5);if(random(0,1)>.95){let e=r+random(-10,10);let t=n+random(-10,10);let l=random(1,3);o.ellipse(e,t,l)}o.pop();Ln({pts:e.map((e=>({x:e.x+noise(e.x*.1,e.y*.1)*5,y:e.y+noise(e.y*.1,e.x*.1)*5}))).concat(l.reverse().map((e=>({x:e.x+noise(e.x*.1,e.y*.1)*5,y:e.y+noise(e.y*.1,e.x*.1)*5})))),pg:o,col:Ro(a[0],1,a[2]*vo([.6,1,1.2]),1),baseX:r,baseY:n,randomOffset:i,vertexMode:1})}Ln({pts:m.concat(u.reverse()),pg:o,col:f,baseX:r,baseY:n,randomOffset:i,vertexMode:1});return[m,u]}}{function kn(e){padfactor=10;let t=1e4;pgTex.push();let o=Ao($t);while(t--){x=o.random(0,pgTex.width);y=o.random(0,pgTex.height);pgTex.strokeWeight(o.random(.1,.2));pgTex.stroke(0,0,0,o.random(.1,.2)*e);pgTex.noFill();pgTex.curve(o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor),o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor),o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor),o.random(-padfactor,pgTex.width+padfactor),o.random(-padfactor,pgTex.height+padfactor))}pgTex.pop()}function _n(e,t=1){let o=e*255;pgTex.noStroke();let r=Ao($t);for(var n=0;n<pgTex.width-1;n+=2){for(var l=0;l<pgTex.height-1;l+=2){if(de==25)pgTex.fill(0,0,.5,.5);else pgTex.fill(0,0,r.random(180,265)/255,o/255);pgTex.rect(n,l,r.random(1.5,2)*t,r.random(1,1.5)*t)}}for(var n=0;n<30;n++){if(de==25)pgTex.fill(0,0,.5,1);else pgTex.fill(0,0,r.random(60,170)/255,r.random(o,o*2)/255);pgTex.rect(r.random(0,pgTex.width-2),r.random(0,pgTex.height-2),r.random(1.5,2.5),r.random(1.5,2.5))}}function zn(e){let t=Mt.colors.bg[0][0];let o=Mt.colors.bg[0][1];let r=Mt.colors.bg[0][2];pgTex.push();let n=Ao($t);Hn(1e4);Mn(6e4);pgTex.pop()}function Xn(){margin=0;let e=Ao($t);let t=e.random(0,1)>.5?e.random(pgTex.width*.3,pgTex.width*.4)+pgTex.width/2:-1*e.random(pgTex.width*.3,pgTex.width*.4)+pgTex.width/2;let o=e.random(0,1)>.5?e.random(pgTex.height*.3,pgTex.height*.4)+pgTex.height/2:-1*e.random(pgTex.height*.3,pgTex.height*.4)+pgTex.height/2;for(i=0;i<1e3;i++){pgTex.noStroke();pgTex.fill(0,0,e.random(0,.5),e.random(.005,.01)*1);let t=e.random(margin,pgTex.width-margin);let o=e.random(margin,pgTex.height-margin);pgTex.ellipse(t,o,e.random(pgTex.width*.02,pgTex.width*.2),e.random(pgTex.width*.02,pgTex.width*.2));t=e.random(margin,pgTex.width-margin);o=e.random(margin,pgTex.height-margin);pgTex.rect(t,o,e.random(pgTex.width*.02,pgTex.width*.2),e.random(pgTex.width*.02,pgTex.width*.2))}}function Yn(e=1){brushSize=100;let t=Ao($t);brushSpan=So(t,3,16);brushDist=So(t,10,30);brushSpan=3;brushDist=10;const o=createGraphics(brushSize,brushSize);o.noFill();o.translate(brushSize/2,brushSize/2);for(let r=0;r<100;r++){o.stroke(t.random(.5,1)*255,10*e);const r=t.random(0,1)*brushSize/2;const n=t.random(0,1)*TAU;const l=r*cos(n);const a=r*sin(n);o.point(l,a)}for(let e=-brushSize;e<pgTex.width+brushSize;e+=pgTex.width/1e3){for(let t=-brushSize;t<pgTex.height+brushSize;t+=brushSpan){pgTex.image(o,e,t+(noise(e/10,t/10)-.5)*brushDist)}}}function On(e=1500,t=1){pgTex.push();let o=Ao($t);for(let r=0;r<e;r++){let e=o.random(0,pgTex.width);let r=o.random(0,pgTex.height);let n=o.random(3,15);let l=o.random(.5,2);let a=o.random(0,TWO_PI);pgTex.push();pgTex.translate(e,r);pgTex.rotate(a);pgTex.noFill();pgTex.strokeWeight(l);let s=o.random(.05,.3);let i=Mt.colors.bg[0];if(o.random(0,1)>.5)pgTex.stroke(i[0],i[1]*1.5,i[2],t*s);else pgTex.stroke(i[0],i[1],i[2]*2,t*s);let c=o.random(-2,2);let h=o.random(-2,2);pgTex.bezier(-n/2,0,-n/4+c,c,n/4+h,h,n/2,0);if(o.random(0,1)<.3){let e=n*o.random(.3,.6);let t=o.random(-PI/6,PI/6);pgTex.push();pgTex.rotate(t);pgTex.strokeWeight(l*.7);pgTex.bezier(0,0,e/4,o.random(-1,1),e/2,o.random(-1,1),e,0);pgTex.pop()}pgTex.pop()}pgTex.pop()}function Rn(shift=-3){const e=createGraphics(pgTex.width,pgTex.height);let t=min(pgTex.width,pgTex.height);t=t-t%10;e.colorMode(HSB,1);if(de==25||de==27)e.stroke(0,0,.5,.9);else e.stroke(.8,.3);e.noFill();const o=pgTex.width*pgTex.height;const r=sqrt(o);let n=map(m.pix,2,5.5,1,1.6);const l=int(r*n*.8);e.strokeWeight(t/1200/n);let a=Ao($t);for(let t=l;t--;){e.point(a.randomGaussian(pgTex.width/2,pgTex.width/4),a.randomGaussian(pgTex.height/2,pgTex.height/4))}for(let t=l;t--;){pgTex.push();const t=a.random(-shift,shift);const o=a.random(-shift,shift);pgTex.translate(t*pgTex.width/2/exp(abs(t)),o*pgTex.height/2/exp(abs(o)));pgTex.image(e,0,0);pgTex.pop()}e.remove()}function Nn(){let e=Mt.colors.bg[0];let t=1;pgTex.push();let o=Ao($t);let r=[[1,1.5],[1,2]];let n=Io(o,r);n[1]=n[1]+.2;for(let r=0;r<width+1;r+=n[1]){for(let l=0;l<height+1;l+=n[1]){let a=.8;let s=e[0];let i=e[1];let c=e[2]*1.5;let h=o.random(n[0],n[1]);let p=h;if(noise(r*.04,l*.04,2)*o.random(0,1)*t>.8||o.random(0,1)<.01*t){s=0;i=0;c=1;h=o.random(.5,5);p=o.random(.5,5)}pgTex.noStroke();pgTex.fill(s,i,c,1);pgTex.rect(r,l,h,p)}}pgTex.pop()}function Mn(e){let t=Mt.colors.bg[0][0];let o=Mt.colors.bg[0][1];let r=Mt.colors.bg[0][2];let n=Ao($t);for(let t=0;t<e;t++){pgTex.stroke(0,0,1,n.random(.05,.1)+.15);pgTex.strokeWeight(n.random(.8,1.8));let e=n.random(0,1)*pgTex.width;let t=n.random(0,1)*pgTex.height;let o=n.random(0,1)*2*PI;let r=n.random(0,1)*10+5;let l=cos(o)*r+e;let a=sin(o)*r+t;let s=e+(n.random(0,1)-.5)*10;let i=t+(n.random(0,1)-.5)*10;let c=l+(n.random(0,1)-.5)*10;let h=a+(n.random(0,1)-.5)*10;pgTex.noFill();pgTex.curve(s,i,e,t,l,a,c,h)}}function Hn(e){const t=1e3;const o=e;let r=Ao($t);for(let e=0;e<o;e++){let e=r.random(-t,pgTex.width+t);let o=r.random(-t,pgTex.height+t);let n=r.random(-t,pgTex.width+t);let l=r.random(-t,pgTex.height+t);let a=r.random(-t,pgTex.width+t);let s=r.random(-t,pgTex.height+t);let i=r.random(-t,pgTex.width+t);let c=r.random(-t,pgTex.height+t);pgTex.push();pgTex.strokeWeight(r.random(.05,.13));pgTex.stroke(0,0,0,r.random(.04,.08));pgTex.noFill();pgTex.bezier(e,o,n,l,a,s,i,c);pgTex.pop()}}function Gn(e){let t=Ao($t);if(!e){e=Io(t,[4,5,6]);if(de==25||de==27)e=7}n.紙張類別=e;if(e==1){Yn(.6);On(500,1)}else if(e==2){Xn();Yn(.5);On(300,2)}else if(e==3){Yn(2);Rn(.1);On(300,2)}else if(e==4){_n(.3);On(500,2)}else if(e==5){Rn();On(1e3,1);zn()}else if(e==6){Nn();Rn(.2);On(300,2)}else if(e==7){Yn(2);Rn(.1);On(1e3,1);zn()}}}function draw(){ortho(-width/2,width/2,-height/2,height/2,-1e4,1e4);if(O>=M&&G==false){G=true;if(e==1){setTimeout((()=>{saveCanvas(bt,"png")}),500);setTimeout((()=>{$t=Bo(3e6,99e5);let e=window.location.hash;let t="";if(e.includes("data_")){t="#data_"+e.split("data_")[1].split("#")[0]}window.location.hash=t+(t?"#":"")+"seed_"+$t}),3500)}if(z)W();console.log("");console.log("== 生成完成 ==");return}if(G==false){yt.setState({distance:1e3,center:[0,0,0],rotation:[1,0,0,0]});if(!H)g();else b()}if(G==true){if(t==false)noLoop();let e=frameCount*.005;let o=yt.getState();if(!wt){Pt=millis();wt=true}let r=constrain((millis()-Pt)/Vt,0,1);let n=1;let l=.01*cos(e);let a=.06*sin(e);let s=-.01;let i=sqrt(n*n+l*l+a*a+s*s);n/=i;l/=i;a/=i;s/=i;let c=o.rotation;let h=[n,l,a,s];o.rotation=[lerp(c[0],h[0],r*.1),lerp(c[1],h[1],r*.1),lerp(c[2],h[2],r*.1),lerp(c[3],h[3],r*.1)];yt.setState(o);$n()}if(gt){save("plant_"+frameCount+".png")}if(G&&!wt){Dt=[]}}function Un(e){randomSeed(e);noiseSeed(e)}function $n(){rectMode(CENTER);clear();stroke(1,0,1,1);noFill();yt.beginHUD();push();translate(0,0,-1e3);image(pgBg,width/2,height/2);pop();yt.endHUD();for(let e=0;e<At.length;e++){let t=At[e];if(!Tt[t.index]){console.warn(`圖層 ${t.index} 不存在`);continue}push();let o=constrain(t.y,0,m.dim);let r=map(e,0,At.length,-700,-200);r+=e*.001;translate(0,0,r);image(Tt[t.index],0,0,width,height);pop()}yt.beginHUD();push();if(h){blendMode(DARKEST);image(h,width/2,height/2,width,height)}blendMode(BLEND);image(pgFrame,width/2,height/2);blendMode(MULTIPLY);image(pgTex,width/2,height/2);blendMode(BLEND);pop();yt.endHUD()}function keyPressed(){if(keyCode===ENTER){console.log("儲存圖片:"+bt);saveCanvas(bt,"png")}if(keyCode===SHIFT){let hash=window.location.hash;let e="";if(hash.includes("data_")){e=decodeURIComponent(hash)}let t;try{t=JSON.parse(e)}catch(o){t=e}let o={"hash值":t,"植物統計":a,"路徑資料":s};let r=JSON.stringify(o,null,2);saveJSON(o,bt+".json")}if(key==="g"||key==="G"){console.log("開始儲存圖層...");console.log("總圖層數量:",Tt.length);console.log("yPositions 數量:",Ct.length);if(!Ct||Ct.length===0){console.warn("沒有可儲存的圖層");return}let e=[...Ct].sort(((e,t)=>e.y-t.y));console.log("圖層位置信息：");e.forEach(((e,t)=>{console.log(`圖層 ${t}: index=${e.index}, y=${e.y}, 是否存在=${!!Tt[e.index]}`)}));e.forEach(((e,t)=>{if(Tt[e.index]){let o=$t+`_layer_${t+1}_${e.index}.png`;Tt[e.index].save(o);console.log(`儲存圖層: ${o}`)}else{console.warn(`無法儲存圖層 ${e.index}: 圖層不存在`)}}))}}function mousePressed(){window.location.reload()}function qn(){window.location.reload()}function jn(){const e=document.querySelector("canvas");if(!e)return;const t=window.innerWidth;const o=window.innerHeight;const r=m.dim*m.ratio;const n=m.dim;if(t/o>r/n){e.style.height=o+"px";e.style.width=o*r/n+"px"}else{e.style.width=t+"px";e.style.height=t*n/r+"px"}}window.addEventListener("resize",jn);window.setup=setup;window.draw=draw;let Jn={},Kn=0;let Qn={paths:[[{x:244,y:170},{x:110,y:239}],[{x:109,y:253},{x:228,y:332}],[{x:251,y:334},{x:361,y:275}],[{x:358,y:265},{x:249,y:176}],[{x:220,y:246},{x:112,y:381}],[{x:266,y:275},{x:369,y:347}],[{x:272,y:222},{x:381,y:220}],[{x:170,y:246},{x:171,y:49}],[{x:241,y:294},{x:224,y:432}],[{x:289,y:243},{x:409,y:157}],[{x:305,y:391},{x:391,y:301}]],dots:[{x:295,y:352},{x:130,y:300},{x:135,y:170},{x:313,y:248},{x:304,y:180}]};let Zn={paths:[[{x:70,y:418},{x:15,y:340}],[{x:47,y:357},{x:119,y:266}],[{x:130,y:352},{x:71,y:291}],[{x:125,y:395},{x:228,y:299}],[{x:171,y:406},{x:294,y:336}],[{x:270,y:413},{x:235,y:336}],[{x:330,y:380},{x:310,y:252}],[{x:312,y:453},{x:404,y:341}],[{x:436,y:415},{x:346,y:321}],[{x:466,y:367},{x:423,y:243}]],dots:[{x:170,y:283},{x:140,y:454},{x:272,y:317},{x:402,y:293},{x:236,y:397},{x:442,y:479},{x:375,y:317},{x:57,y:485},{x:242,y:445}]};let el={paths:[[{x:471,y:100},{x:66,y:105}],[{x:44,y:120},{x:296,y:125}],[{x:472,y:249},{x:213,y:251}],[{x:45,y:225},{x:350,y:229}],[{x:36,y:387},{x:224,y:384}],[{x:114,y:406},{x:293,y:409}],[{x:450,y:378},{x:310,y:378}]],dots:[]};let tl={paths:[[{x:249,y:483},{x:226.28,y:425.04},{x:184.74,y:377.74},{x:145.58,y:328.11},{x:122.15,y:269.87},{x:116,y:207}],[{x:213,y:367},{x:199,y:283.17},{x:210.83,y:198.68},{x:240.26,y:118.47},{x:251,y:35}],[{x:254,y:433},{x:282.65,y:376.35},{x:333.84,y:332.16},{x:366.24,y:274.16},{x:374,y:207}],[{x:248,y:393},{x:266,y:300.23},{x:298.7,y:211.53},{x:317,y:119}]],dots:[{x:194,y:442},{x:301,y:396},{x:318,y:451},{x:227,y:334},{x:308,y:332}]};let ol={paths:[[{x:455,y:245},{x:409.73,y:135.67},{x:318.71,y:60},{x:204.1,y:40.3},{x:98.42,y:96.58},{x:35.44,y:200.4},{x:41.71,y:318.82},{x:116.74,y:413.83},{x:221.71,y:465.71},{x:338.62,y:455.38},{x:423.31,y:370.39},{x:464,y:260}],[{x:103,y:449},{x:232,y:372}],[{x:402,y:430},{x:342,y:338}],[{x:53,y:109},{x:91,y:241}],[{x:448,y:180},{x:307,y:187}]],dots:[{x:392,y:355},{x:320,y:423},{x:206,y:428},{x:393,y:219},{x:100,y:350}]};let rl={paths:[[{x:62,y:535},{x:4,y:391}],[{x:63,y:535},{x:71,y:276}],[{x:145,y:528},{x:98,y:434}],[{x:163,y:537},{x:169,y:336}],[{x:290,y:517},{x:227,y:420}],[{x:302,y:522},{x:364,y:375}],[{x:440,y:522},{x:417,y:312}],[{x:472,y:511},{x:480,y:400}],[{x:364,y:517},{x:300,y:392}],[{x:449,y:502},{x:450,y:441}],[{x:207,y:515},{x:215,y:247}],[{x:0,y:214},{x:94,y:281}],[{x:0,y:328},{x:182,y:387}]],dots:[{x:386,y:493},{x:236,y:492},{x:292,y:493},{x:84,y:492},{x:416,y:481},{x:19,y:487},{x:142,y:493}]};let nl={paths:[[{x:270,y:508},{x:255,y:300}],[{x:344,y:522},{x:314,y:144}],[{x:518,y:63},{x:335,y:301}],[{x:506,y:209},{x:414,y:330}],[{x:173,y:532},{x:189,y:226}],[{x:2,y:222},{x:92,y:334}],[{x:100,y:522},{x:94,y:391}],[{x:438,y:516},{x:430,y:356}],[{x:529,y:394},{x:223,y:443}],[{x:57,y:526},{x:32,y:349}]],dots:[{x:138,y:528},{x:234,y:488},{x:327,y:486},{x:405,y:479},{x:475,y:490},{x:9,y:491},{x:159,y:491},{x:62,y:541}]};let ll={paths:[[{x:87,y:476},{x:85,y:299}],[{x:86,y:263},{x:89,y:104}],[{x:154,y:432},{x:155,y:176}],[{x:233,y:478},{x:243,y:299}],[{x:246,y:271},{x:251,y:56}],[{x:340,y:482},{x:345,y:197}],[{x:345,y:153},{x:345,y:101}],[{x:423,y:411},{x:421,y:290}],[{x:423,y:99},{x:423,y:182}]],dots:[]};let al={paths:[[{x:27,y:445},{x:436,y:426}],[{x:445,y:441},{x:198,y:420}],[{x:28,y:265},{x:221,y:271}],[{x:143,y:282},{x:358,y:244}],[{x:272,y:257},{x:470,y:274}],[{x:21,y:92},{x:322,y:105}],[{x:162,y:109},{x:466,y:83}],[{x:64,y:382},{x:285,y:387}],[{x:443,y:211},{x:295,y:221}]],dots:[]};let sl={paths:[[{x:57,y:53},{x:472,y:86}],[{x:51,y:89},{x:341,y:56}],[{x:50,y:253},{x:224,y:199}],[{x:144,y:207},{x:417,y:237}],[{x:457,y:282},{x:373,y:215}],[{x:36,y:426},{x:232,y:394}],[{x:82,y:407},{x:367,y:411}],[{x:462,y:425},{x:306,y:390}]],dots:[{x:263,y:431},{x:115,y:240},{x:384,y:251},{x:179,y:82},{x:395,y:66},{x:466,y:99},{x:262,y:245}]};function il(e){const t=`\n\t\t\tuniform mat4 uModelViewMatrix;\n\t\t\tuniform mat4 uProjectionMatrix;\n\t\t\n\t\t\tattribute vec3 aPosition;\n\t\t\tattribute vec2 aTexCoord;\n\t\t\n\t\t\tvarying vec2 vTexCoord;\n\t\t\n\t\t\tvoid main() {\n\t\t\t  vTexCoord = aTexCoord;\n\t\t\t  vec4 viewModelPosition = uModelViewMatrix * vec4(aPosition, 1.0);\n\t\t\t  gl_Position = uProjectionMatrix * viewModelPosition;\n\t\t\t}\n\t\t  `;const o=`\n\t\t\tprecision mediump float;\n\t\t\n\t\t\t#define PROCESSING_COLOR_SHADER\n\t\t\n\t\t\tuniform sampler2D subBrushsPg;\n\t\t\tuniform int blendMode;\n\t\t\tuniform int invert;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\n\t\t\tfloat extractLuma(vec3 c) {\n\t\t\t\treturn c.r * 0.299 + c.g * 0.587 + c.b * 0.114;\n\t\t\t}\n\t\t\n\t\t\tvec3 adjustSaturation(vec3 color, float saturation) {\n\t\t\t\tfloat luminance = extractLuma(color);\n\t\t\t\treturn mix(vec3(luminance), color, saturation);\n\t\t\t}\n\t\t\n\t\t\tvec3 contrast(vec3 color, float amount) {\n\t\t\t\treturn (color - 0.5) * amount + 0.5;\n\t\t\t}\n\t\t\n\t\t\tvoid main(void) {\n\t\t\t\tvec2 uv = vTexCoord.st;\n\t\t\t\tvec4 texColor = texture2D(subBrushsPg, uv);\n\t\t\t\tvec3 brush = texColor.rgb;\n\t\t\t\t\n\t\t\t\t// 锐化处理\n\t\t\t\tfloat accumY = 0.0;\n\t\t\t\tvec2 texelSize = vec2(1.0) / vec2(1024.0, 1024.0);\n\t\t\n\t\t\t\tfor(int i = -1; i <= 1; ++i) {\n\t\t\t\t\tfor(int j = -1; j <= 1; ++j) {\n\t\t\t\t\t\tvec2 offset = vec2(i, j) * texelSize;\n\t\t\t\t\t\tfloat s = extractLuma(texture2D(subBrushsPg, uv + offset).rgb);\n\t\t\t\t\t\tfloat notCentre = min(float(i * i + j * j), 1.0);\n\t\t\t\t\t\taccumY += s * (9.0 - notCentre * 10.0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\taccumY /= 2.0;\n\t\t\n\t\t\t\tvec3 sharpenColor = mix(brush, vec3(accumY), 0.9);\n\t\t\t\tvec3 finalColor = contrast(sharpenColor, 1.2);\n\t\t\t\t\n\t\t\t\t// 降低飽和度\n\t\t\t\tfinalColor = adjustSaturation(finalColor, 1.0);  // 降低到50%的飽和度\n\t\t\t\t\n\t\t\t\t// 降低整體顏色強度\n\t\t\t\t// finalColor *= 0.1;  \n\t\t\t\tfinalColor = vec3(1.0) - ((vec3(1.0) - finalColor) * (vec3(1.0) - brush));\n\t\t\t\t\n\t\t\t\tgl_FragColor = vec4(finalColor, 1.0);  // 最後輸出時再降低10%的強度\n\t\t\t}\n\t\t\t`;return new p5.Shader(e,t,o)}function cl(e){const t=`\n\t\t\tprecision mediump float;\n\t\t\tattribute vec3 aPosition;\n\t\t\tattribute vec2 aTexCoord;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\tvoid main() {\n\t\t\t  vTexCoord = aTexCoord;\n\t\t\t  vec4 positionVec4 = vec4(aPosition, 1.0);\n\t\t\t  positionVec4.xy = positionVec4.xy * 2.0 - 1.0;\n\t\t\t  gl_Position = positionVec4;\n\t\t\t}\n\t\t\t`;const o=`\n\t\t\tprecision mediump float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform float vol;\n\t\t\tuniform float magn;\n\t\t\tuniform float zoom;\n\t\t\tvarying vec2 vTexCoord;\n\t\t\tvec3 mod289(vec3 x) {\n\t\t\t  return x - floor(x * (1.0 / 289.0)) * 289.0;\n\t\t\t}\n\t\t  \n\t\t\tvec4 mod289(vec4 x) {\n\t\t\t  return x - floor(x * (1.0 / 289.0)) * 289.0;\n\t\t\t}\n\t\t  \n\t\t\tvec4 permute(vec4 x) {\n\t\t\t\t return mod289(((x*34.0)+1.0)*x);\n\t\t\t}\n\t\t  \n\t\t\tvec4 taylorInvSqrt(vec4 r)\n\t\t\t{\n\t\t\t  return 1.79284291400159 - 0.85373472095314 * r;\n\t\t\t}\n\t\t  \n\t\t\tfloat snoise(vec3 v)\n\t\t\t  {\n\t\t\t  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t\t  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  \n\t\t\t  vec3 i = floor(v + dot(v, C.yyy) );\n\t\t\t  vec3 x0 = v - i + dot(i, C.xxx) ;\n\t\t  \n\t\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t\t  vec3 l = 1.0 - g;\n\t\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  \n\t\t\t  vec3 x1 = x0 - i1 + C.xxx;\n\t\t\t  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\t\t\t  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\t\t  \n\t\t\t  i = mod289(i);\n\t\t\t  vec4 p = permute( permute( permute(\n\t\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  \n\t\t\t  float n_ = 0.142857142857; // 1.0/7.0\n\t\t\t  vec3 ns = n_ * D.wyz - D.xzx;\n\t\t  \n\t\t\t  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n\t\t  \n\t\t\t  vec4 x_ = floor(j * ns.z);\n\t\t\t  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n\t\t  \n\t\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  \n\t\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  \n\t\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  \n\t\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  \n\t\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  \n\t\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t\t  p0 *= norm.x;\n\t\t\t  p1 *= norm.y;\n\t\t\t  p2 *= norm.z;\n\t\t\t  p3 *= norm.w;\n\t\t  \n\t\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t\t  m = m * m;\n\t\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n\t\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t\t  }\n\t\t  \n\t\t  \n\t\t\tconst float scalDiv = 4.;\n\t\t\tconst float scalDivt = 2.1;\n\t\t\tconst float sc1 = 1.0/scalDiv;\n\t\t\tconst float sc2 = sc1/scalDiv;\n\t\t\tconst float sc3 = sc2/scalDiv;\n\t\t\tconst float sc1t = 1.0 /scalDivt;\n\t\t\tconst float sc2t = sc1t/scalDivt;\n\t\t\tconst float sc3t = sc2t/scalDivt;\n\t\t\tfloat FBM(vec3 v) {\n\t\t\t\treturn 1.   *0.5    * snoise(v*vec3(sc3, sc3, sc3t)) +\n\t\t\t\t\t   0.4  *0.25   * snoise(v*vec3(sc2, sc2, sc2t)) +\n\t\t\t\t\t   0.15 *0.125  * snoise(v*vec3(sc1, sc1, sc1t));\n\t\t\t}\n\t\t  \n\t\t  \n\t\t\tfloat getGrayScale(sampler2D sampler, vec2 coods){\n\t\t\t\tvec4 color = texture2D(texture,coods);\n\t\t\t\tfloat gray = (color.r + color.g + color.b)/3.0*(vol+0.5);\n\t\t\t\treturn gray;\n\t\t\t}\n\t\t\tvoid main(){\n\t\t\t   float v=vol;\n\t\t\t   float m=magn ;\n\t\t\t   float z = zoom ;\n\t\t\t   vec2 uv =  vTexCoord.st * (1. - 2.*z) + vec2(z, z);\n\t\t\t   float niceNoise1 = FBM( vec3(120.0 * uv*v,  60.0));\n\t\t\t   float niceNoise2 = FBM( vec3(120.0 * uv*v,  70.0));\n\t\t\t   vec4 mirror=texture2D(texture, uv + vec2(m*0.2*niceNoise1,m*0.21*niceNoise2) );\n\t\t\t   gl_FragColor = vec4(mirror.r,mirror.g,mirror.b,mirror.a);\n\t\t\t}\n\t\t\t`;return new p5.Shader(e,t,o)}const hl="f1cfa9850908263f2b05";const pl="ap3";const fl="postbotany";const dl="reload";if(!window.Pusher){console.error("Pusher SDK 未加载，请确保已引入 https://cdn.jsdelivr.net/npm/pusher-js@7.3.0/dist/pusher.min.js")}window.pusherInstance=window.pusherInstance||new Pusher(hl,{cluster:pl});window.pusherChannel=window.pusherChannel||window.pusherInstance.subscribe(fl);window.sendReloadEvent=function(hash){alert("请用后端或 Pusher REST API 触发 reload 事件，前端无法直接 trigger。")};window.onReloadEvent=function(e){window.pusherChannel.bind(dl,(function(t){e&&e(t.hash)}))};</script></body></html>
